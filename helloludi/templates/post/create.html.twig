{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="{{ asset('css/form-styles.css') }}" rel="stylesheet">
    <link href="{{ asset('css/rich-editor.css') }}" rel="stylesheet">
    <link href="{{ asset('css/stable-images.css') }}" rel="stylesheet">
    <link href="{{ asset('css/image-fix-v3.css') }}" rel="stylesheet">
    <link href="{{ asset('css/gallery-styles.css') }}" rel="stylesheet">
    <link href="{{ asset('css/post-content-styles.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="form-container">
        <div class="form-header">
            <h2>Cr√©er un nouvel article</h2>
            <p class="form-subtitle">Cr√©ez un article et partagez votre cr√©ativit√© avec le monde</p>
        </div>

        {# Messages flash #}
        {% for type, messages in app.flashes %}
            <div class="flash-messages">
                {% for message in messages %}
                    <div class="alert alert-{{ type }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endfor %}

        {{ form_start(form, { 'attr': { 'enctype': 'multipart/form-data', 'id': 'postForm' } }) }}

        {# Titre #}
        <div class="form-group">
            <label class="form-label">
                <i class="bi bi-pen"></i>
                {{ form_label(form.title) }}
            </label>
            {{ form_widget(form.title, {'attr': {'class': 'form-control', 'placeholder': 'Un titre accrocheur pour votre article...'}}) }}
            {{ form_errors(form.title) }}
        </div>

        {# Cat√©gorie #}
        <div class="form-group">
            <label class="form-label">
                <i class="bi bi-grid-3x3-gap"></i>
                {{ form_label(form.category) }}
            </label>
            {{ form_widget(form.category, {'attr': {'class': 'form-control'}}) }}
            {{ form_errors(form.category) }}
            <div class="category-tags mt-2">
                <span class="category-tag recipe" data-tooltip="Pour vos d√©licieuses recettes">üç≥ Recette</span>
                <span class="category-tag photo" data-tooltip="Pour vos plus belles photos">üì∏ Photo</span>
                <span class="category-tag event" data-tooltip="Pour vos √©v√©nements">üéâ √âv√©nement</span>
                <span class="category-tag blabla" data-tooltip="Pour discuter">üí¨ Blabla</span>
            </div>
        </div>

        {# Contenu avec l'√©diteur riche #}
        <div class="form-group">
            <label class="form-label">
                <i class="bi bi-file-text"></i>
                {{ form_label(form.content) }}
            </label>
            {{ form_widget(form.content, {'attr': {'style': 'display: none;', 'id': 'post_content'}}) }}
            <div id="richEditorContainer" class="editor-form-container"></div>
            {{ form_errors(form.content) }}
        </div>

        {# Champs conditionnels pour les √©v√©nements #}
        <div class="conditional-section date-wrapper" style="display: none;">
            <div class="form-group">
                <label class="form-label">
                    <i class="bi bi-calendar-event"></i>
                    {{ form_label(form.date) }}
                </label>
                {{ form_widget(form.date, {'attr': {'class': 'form-control'}}) }}
                {{ form_errors(form.date) }}
            </div>
        </div>

        <div class="conditional-section place-wrapper" style="display: none;">
            <div class="form-group">
                <label class="form-label">
                    <i class="bi bi-geo-alt"></i>
                    {{ form_label(form.place) }}
                </label>
                {{ form_widget(form.place, {'attr': {'class': 'form-control', 'placeholder': 'O√π se d√©roule votre √©v√©nement ?'}}) }}
                {{ form_errors(form.place) }}
            </div>
        </div>

        {# Champs conditionnels pour les recettes #}
        <div class="conditional-section personsNumber-wrapper" style="display: none;">
            <div class="form-group">
                <label class="form-label">
                    <i class="bi bi-people"></i>
                    {{ form_label(form.personsNumber) }}
                </label>
                {{ form_widget(form.personsNumber, {'attr': {'class': 'form-control', 'placeholder': 'Pour combien de gourmands ?'}}) }}
                {{ form_errors(form.personsNumber) }}
            </div>
        </div>

        <div class="conditional-section cookingTime-wrapper" style="display: none;">
            <div class="form-group">
                <label class="form-label">
                    <i class="bi bi-clock"></i>
                    {{ form_label(form.cookingTime) }}
                </label>
                {{ form_widget(form.cookingTime, {'attr': {'class': 'form-control', 'placeholder': 'Temps en minutes'}}) }}
                {{ form_errors(form.cookingTime) }}
            </div>
        </div>

        {# Image √† la une #}
        <div class="form-group">
            <label class="form-label">
                <i class="bi bi-image"></i>
                {{ form_label(form.image) }}
            </label>
            <div class="image-upload-wrapper">
                {{ form_widget(form.image, {'attr': {'class': 'main-file-input'}}) }}
                <div class="main-upload-button">
                    <div>
                        <i class="bi bi-cloud-upload"></i>
                        <p class="upload-text">Cliquez ou glissez votre image ici</p>
                        <small class="text-muted">JPG, PNG ou GIF - Max 5MB</small>
                    </div>
                </div>
            </div>
            {{ form_errors(form.image) }}
        </div>

        {# Galerie d'images pour la cat√©gorie photo #}
        <div class="form-group gallery-images-wrapper" style="display: none;">
            <label class="form-label">
                <i class="bi bi-images"></i>
                {{ form_label(form.galleryImages) }}
            </label>
            <div class="gallery-upload-wrapper">
                {{ form_widget(form.galleryImages, {'attr': {'class': 'gallery-file-input', 'multiple': 'multiple', 'accept': 'image/*'}}) }}
                <div class="gallery-upload-button">
                    <div>
                        <i class="bi bi-card-image"></i>
                        <p class="upload-text">Cliquez ou glissez-d√©posez vos images ici</p>
                        <small class="text-muted">JPG, PNG, GIF ou WebP - Max 5MB chaque - Max 50 images</small>
                    </div>
                </div>
                <div class="gallery-preview" id="galleryPreview"></div>
            </div>
            {{ form_errors(form.galleryImages) }}
            <div class="form-help">
                {{ form_help(form.galleryImages) }}
            </div>
        </div>

        {# Actions #}
        <div class="form-actions">
            <a href="{{ path("homepage") }}" class="btn btn-salmon">
                <i class="bi bi-arrow-left-circle"></i>
                Retour aux articles
            </a>
            <button type="submit" class="btn btn-orange">
                <i class="bi bi-check-circle"></i>
                Publier l'article
            </button>
        </div>

        {{ form_end(form) }}
    </div>

    {# Modales pour l'√©diteur #}
    {% include 'components/_simple_editor_modals.html.twig' %}

    <script src="{{ asset('js/SimpleRichEditor-v3-fixed.js') }}"></script>
    <script src="{{ asset('js/form-handler.js') }}"></script>
    <script src="{{ asset('js/gallery-init.js') }}"></script>
    <script src="{{ asset('js/gallery-simple.js') }}"></script>

{% endblock %}