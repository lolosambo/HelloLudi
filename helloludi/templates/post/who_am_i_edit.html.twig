{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="{{ asset('css/form-styles.css') }}" rel="stylesheet">
    <link href="{{ asset('css/rich-editor.css') }}" rel="stylesheet">
    <link href="{{ asset('css/stable-images.css') }}" rel="stylesheet">
    <link href="{{ asset('css/image-fix-v3.css') }}" rel="stylesheet">
    <link href="{{ asset('css/table-editor.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="form-container">
        <div class="form-header">
            <h2>"Qui suis-je ?" - Edition</h2>
            <p class="form-subtitle">Modifiez votre présentation personnelle</p>
        </div>

        {# Messages flash #}
        {% for type, messages in app.flashes %}
            <div class="flash-messages">
                {% for message in messages %}
                    <div class="alert alert-{{ type }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endfor %}

        {{ form_start(form, { 'attr': { 'enctype': 'multipart/form-data', 'id': 'whoAmIForm' } }) }}

        {# Contenu avec l'éditeur riche #}
        <div class="form-group">
            <label class="form-label">
                <i class="bi bi-file-text"></i>
                {{ form_label(form.content) }}
            </label>
            {{ form_widget(form.content, {'attr': {'style': 'display: none;', 'id': 'whoami_content'}}) }}
            <div id="richEditorContainer" class="editor-form-container"></div>
            {{ form_errors(form.content) }}
        </div>

        {# Actions #}
        {% if app.user and app.user.getRole() == "admin" %}
            <div class="form-actions">
                <a href="{{ path('who_am_i') }}" class="btn btn-salmon">
                    <i class="bi bi-arrow-left-circle"></i>
                    Retour à la présentation
                </a>
                <button type="submit" class="btn btn-orange">
                    <i class="bi bi-check-circle"></i>
                    Mettre à jour
                </button>
            </div>
        {% endif %}

        {{ form_end(form) }}
    </div>

    {# Modales pour l'éditeur #}
    {% include 'components/_simple_editor_modals.html.twig' %}

    <script src="{{ asset('js/SimpleRichEditor.js') }}"></script>
    <script src="{{ asset('js/table-editor.js') }}"></script>
    <script src="{{ asset('js/form-handler.js') }}"></script>
    <script src="{{ asset('js/pages/who-am-i-editor.js') }}"></script>

{% endblock %}
