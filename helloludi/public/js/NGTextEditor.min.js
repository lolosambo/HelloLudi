var NGTextEditor=function(e){"use strict";const t="nge-language";let n="fr";const o=[{code:"fr",label:"Français"},{code:"en",label:"English"},{code:"de",label:"Deutsch"},{code:"es",label:"Español"}],r={fr:{toolbar:{paragraph:"Style de paragraphe",fontFamily:"Police de caractères",fontSize:"Taille de police",lineHeight:"Interlignage",textColor:"Couleur du texte",bgColor:"Couleur de fond",bold:"Gras (Ctrl+B)",italic:"Italique (Ctrl+I)",underline:"Souligner (Ctrl+U)",strikethrough:"Barrer",textCase:"Changer la casse",superscript:"Exposant",alignLeft:"Aligner à gauche",alignCenter:"Centrer",alignRight:"Aligner à droite",alignJustify:"Justifier",indent:"Augmenter le retrait",outdent:"Diminuer le retrait",listUl:"Liste à puces",listOl:"Liste numérotée",listTodo:"Liste de tâches",listStyleDecimal:"Nombres",listStyleLowerAlpha:"Alpha (min.)",listStyleUpperAlpha:"Alpha (MAJ.)",listStyleUpperRoman:"Romain",listStyleGreek:"Grec",link:"Insérer un lien",image:"Insérer une image",video:"Insérer une vidéo",table:"Insérer un tableau",columns:"Insérer des colonnes",emoji:"Insérer un emoji",quote:"Insérer une citation",code:"Insérer un bloc de code",hr:"Insérer un séparateur",config:"Configuration de la toolbar",undo:"Annuler (Ctrl+Z)",redo:"Rétablir (Ctrl+Y)",preview:"Prévisualisation",exportJson:"Exporter en JSON",exportPdf:"Exporter en PDF",exportHtml:"Exporter en HTML"},preview:{title:"Prévisualisation",close:"Fermer"},counter:{words:"{count} mot(s)",chars:"{count} caractère(s)"},common:{delete:"Supprimer",deleteImage:"Supprimer l'image",deleteVideo:"Supprimer la vidéo",deleteTable:"Supprimer le tableau",deleteColumn:"Supprimer les colonnes",deleteQuote:"Supprimer la citation",deleteCode:"Supprimer le bloc de code"},paragraphStyles:{p:"Paragraphe",h1:"Titre 1",h2:"Titre 2",h3:"Titre 3",h4:"Titre 4",h5:"Titre 5"},fonts:{default:"Police par défaut"},config:{title:"Configuration de la toolbar",language:"Langue / Language",selectAll:"Tout cocher",deselectAll:"Tout décocher",cancel:"Annuler",apply:"Appliquer",groupFont:"Sélecteurs et couleurs",groupTextStyle:"Style de texte",groupAlignment:"Alignement",groupLists:"Listes",groupMedia:"Médias",groupInsert:"Insertion",toolParagraph:"Style de paragraphe",toolFontFamily:"Police",toolFontSize:"Taille",toolLineHeight:"Interlignage",toolTextColor:"Couleur du texte",toolBgColor:"Couleur de fond",toolBold:"Gras",toolItalic:"Italique",toolUnderline:"Souligné",toolStrikethrough:"Barré",toolTextCase:"Changer la casse",toolSuperscript:"Exposant",toolAlignLeft:"Aligner à gauche",toolAlignCenter:"Centrer",toolAlignRight:"Aligner à droite",toolAlignJustify:"Justifier",toolIndent:"Augmenter le retrait",toolOutdent:"Diminuer le retrait",toolListUl:"Liste à puces",toolListOl:"Liste numérotée",toolListTodo:"Liste de tâches",toolLink:"Lien",toolImage:"Image",toolVideo:"Vidéo",toolTable:"Tableau",toolColumns:"Colonnes",toolEmoji:"Emoji",toolQuote:"Citation",toolCode:"Code",toolHr:"Séparateur",toolExportJson:"Export JSON",toolExportPdf:"Export PDF",toolExportHtml:"Export HTML",groupAction:"Actions",toolUndo:"Annuler",toolRedo:"Rétablir",toolPreview:"Aperçu",toolConfig:"Configuration",theme:"Thème",themeLight:"Clair",themeDark:"Sombre",themeWarm:"Chaud",themeCold:"Froid",themeTaupe:"Taupe",themePink:"Rose",iconSize:"Taille des icônes",iconSizeSmall:"Petites",iconSizeLarge:"Grandes",toolbarMode:"Position de la toolbar",toolbarModeIntegrated:"Intégré",toolbarModeFullwidthTop:"Pleine largeur en haut de l'écran",customColors:"Couleurs personnalisées",customColorsHelp:"Si des couleurs sont définies, seules celles-ci seront disponibles",addColor:"Ajouter une couleur",removeColor:"Supprimer",invalidColor:"Couleur invalide"},modal:{cancel:"Annuler",ok:"OK",apply:"Appliquer",insert:"Insérer",edit:"Modifier",close:"Fermer"},table:{title:"Créer un tableau avancé",editTitle:"Modifier le tableau",structure:"Structure du tableau",rows:"Nombre de lignes",columns:"Nombre de colonnes",includeHeader:"Inclure une ligne d'en-tête",sortable:"Ajouter le tri sur les colonnes",style:"Style du tableau",styleStandard:"Standard",styleBordered:"Bordures complètes",styleStriped:"Lignes alternées",styleMinimal:"Minimal",responsive:"Tableau responsive",width:"Largeur du tableau",alignment:"Alignement du tableau",alignLeft:"Gauche",alignCenter:"Centre",alignRight:"Droite",headerStyle:"Style de l'en-tête",headerBgColor:"Couleur de fond de l'en-tête",transparent:"Transparent",headerFont:"Police de l'en-tête",inheritFont:"Hériter du tableau",size:"Taille",weight:"Graisse",weightNormal:"Normal",weightMedium:"Medium",weightSemiBold:"Semi-gras",weightBold:"Gras",textColor:"Couleur du texte",preview:"Aperçu en temps réel",previewHeader:"En-tête",previewCell:"Cellule",insertTable:"Insérer ce tableau",errorRowsMin:"Le nombre de lignes doit être au moins 1",errorRowsMax:"Le nombre de lignes ne peut pas dépasser 50",errorColsMin:"Le nombre de colonnes doit être au moins 1",errorColsMax:"Le nombre de colonnes ne peut pas dépasser 20"},image:{title:"Insérer une image",editTitle:"Modifier l'image",source:"Source de l'image",chooseFile:"Choisir un fichier",dragDrop:"ou glisser-déposer ici",preview:"Aperçu",noImage:"Aucune image",invalidImage:"Image invalide",readError:"Erreur de lecture",invalidFile:"Fichier invalide",width:"Largeur (px)",height:"Hauteur",auto:"auto",keepRatio:"Conserver les proportions",rotation:"Rotation",rotate90:"Rotation 90°",wrapping:"Habillage",wrapBlock:"Texte en dessous (bloc)",wrapLeft:"Flottant gauche",wrapRight:"Flottant droite",alignment:"Alignement",alignLeft:"Gauche",alignCenter:"Centre",alignRight:"Droite",opacity:"Transparence",border:"Bordure",borderStyle:"Style",borderWidth:"Epaisseur",borderColor:"Couleur",borderRadius:"Arrondis",borderNone:"Aucune",borderSolid:"Continue",borderDashed:"Tirets",borderDotted:"Pointilles",borderDouble:"Double",borderGroove:"Rainure",borderRidge:"Crete",borderInset:"Incrust.",borderOutset:"Relief",insertImage:"Insérer l'image",editImage:"Modifier",errorRequired:"Une source d'image est requise",errorInvalid:"Valeurs invalides",urlPlaceholder:"https://example.com/image.jpg"},video:{title:"Insérer une vidéo",editTitle:"Modifier la vidéo",url:"URL de la vidéo",urlPlaceholder:"https://www.youtube.com/watch?v=...",supported:"Supporte YouTube, Vimeo et Dailymotion",preview:"Aperçu",width:"Largeur (px)",autoplay:"Lecture automatique",alignment:"Alignement",alignLeft:"Gauche",alignCenter:"Centre",alignRight:"Droite",border:"Bordure",borderStyle:"Style",borderWidth:"Epaisseur",borderColor:"Couleur",borderRadius:"Arrondis",borderNone:"Aucune",borderSolid:"Continue",borderDashed:"Tirets",borderDotted:"Pointillés",borderDouble:"Double",borderGroove:"Rainure",borderRidge:"Crête",borderInset:"Incrust.",borderOutset:"Relief",insertVideo:"Insérer la vidéo",errorRequired:"Une URL de vidéo est requise",errorInvalid:"Valeurs invalides",errorUnsupported:"URL de vidéo non reconnue. Utilisez YouTube, Vimeo ou Dailymotion."},link:{title:"Insérer un lien",url:"URL",urlPlaceholder:"https://example.com",text:"Texte à afficher",textPlaceholder:"Texte du lien (optionnel)",tooltip:"Info-bulle",tooltipPlaceholder:"Description au survol (optionnel)",newWindow:"Ouvrir dans une nouvelle fenêtre",nofollow:'Ajouter rel="nofollow" (référencement)',insert:"Insérer",errorRequired:"L'URL est obligatoire",errorInvalid:"URL invalide"},columns:{title:"Configuration des colonnes",editTitle:"Modifier les colonnes",count:"Nombre de colonnes",countHint:"Choisissez le nombre de colonnes pour votre texte",col1:"1 colonne",col2:"2 colonnes",col3:"3 colonnes",spacing:"Espacement entre colonnes",spacingSmall:"Petit (1rem)",spacingMedium:"Moyen (2rem)",spacingLarge:"Grand (3rem)",height:"Hauteur des colonnes",heightHint:"Définissez la hauteur fixe ou automatique des colonnes",heightAuto:"Indéfinie",heightSmall:"Petite",heightMedium:"Moyenne",heightLarge:"Grande",blockWidth:"Largeur du bloc",widthHint:"Choisissez la largeur du bloc de colonnes dans votre article",blockAlignment:"Alignement du bloc",alignHint:"Définissez l'alignement horizontal du bloc de colonnes",alignLeft:"Gauche",alignCenter:"Centre",alignRight:"Droite",textWrap:"Habillage du texte",wrapBlock:"Retour à la ligne",wrapFloat:"Texte englobant",verticalAlign:"Alignement vertical",vAlignTop:"Haut",vAlignMiddle:"Milieu",vAlignBottom:"Bas",borders:"Bordures entre les colonnes",borderRadius:"Arrondi des bords",borderThickness:"Épaisseur",borderStyle:"Style",borderColor:"Couleur",styleSolid:"Solide",styleDashed:"Tirets",styleDotted:"Points",styleDouble:"Double",bgColors:"Couleurs de fond",bgArea:"Zone des colonnes",bgColumns:"Colonnes",preview:"Aperçu",previewColumn:"Colonne",apply:"Appliquer les colonnes",errorCount:"Le nombre de colonnes doit être entre 1 et 3",errorSpacing:"Espacement invalide",errorHeight:"Hauteur invalide",errorWidth:"Largeur invalide",errorAlignment:"Alignement invalide"},hr:{title:"Insérer un séparateur",selectStyle:"Sélectionnez un style de séparateur :",opacity:"Transparence :",width:"Largeur :",insert:"Insérer",simple:"Simple",simpleDesc:"Ligne fine classique",thick:"Épaisse",thickDesc:"Ligne épaisse",double:"Double",doubleDesc:"Double ligne",dashed:"Tirets",dashedDesc:"Ligne en tirets",dotted:"Pointillés",dottedDesc:"Ligne en pointillés",gradient:"Dégradé",gradientDesc:"Dégradé bleu",shadow:"Ombre",shadowDesc:"Ligne avec ombre",ornament:"Ornement",ornamentDesc:"Avec symbole central",wavy:"Ondulée",wavyDesc:"Forme ondulée",fade:"Fondu",fadeDesc:"Fondu vers les bords"},quote:{title:"Insérer une citation",selectStyle:"Sélectionnez un style de citation :",insert:"Insérer",previewText:"Votre citation ici...",classic:"Classique",classicDesc:"Bordure gauche bleue traditionnelle",modern:"Moderne",modernDesc:"Carte flottante avec accent",elegant:"Élégant",elegantDesc:"Guillemets dorés décoratifs",minimal:"Minimaliste",minimalDesc:"Épuré avec lignes fines",framed:"Encadré",framedDesc:"Double bordure distinctive",shadow:"Ombre profonde",shadowDesc:"Effet carte surélevée",gradient:"Dégradé vif",gradientDesc:"Fond coloré dynamique",retro:"Rétro",retroDesc:"Style machine à écrire",academic:"Académique",academicDesc:"Style citation universitaire",highlight:"Mise en avant",highlightDesc:"Bloc d'attention coloré"},colorPicker:{title:"Choisir une couleur",preview:"Aperçu",opacity:"Transparence",savedColors:"Couleurs sauvegardées",noSavedColors:"Aucune couleur sauvegardée",saveColor:"Sauvegarder la couleur actuelle",remove:"Supprimer",eyedropper:"Pipette - Capturer une couleur à l'écran",eyedropperUnavailable:"Pipette non disponible dans ce navigateur",borderRadius:"Arrondi des bords",highlightThickness:"Épaisseur du surlignage",hex:"Hex"},emoji:{search:"Rechercher un emoji...",noResults:"Aucun emoji trouvé",resultsFor:"Résultats pour",mostUsed:"Les plus utilisés",noRecentEmoji:"Aucun emoji utilisé récemment",catSmileys:"Smileys & Émotions",catPeople:"Personnes & Corps",catAnimals:"Animaux & Nature",catFood:"Nourriture & Boissons",catActivities:"Activités",catTravel:"Voyages & Lieux",catObjects:"Objets",catSymbols:"Symboles",catFlags:"Drapeaux"},code:{placeholder:"Entrez votre code ici...",copy:"Copier",copyCode:"Copier le code",copied:"Copié !"},cellFormat:{title:"Format de cellule",bgColor:"Couleur de fond",textColor:"Couleur du texte",border:"Bordure",padding:"Marge intérieure",alignment:"Alignement"},status:{localMode:"Utilisation en local, toutes les fonctionnalités sont disponibles",restrictedTool:"Fonctionnalité disponible avec une licence",freeVersion:"Version gratuite - {current}/{limit} mots",wordLimitReached:"Limite de mots atteinte ({limit} mots max)",licensePro:"Licence Pro",licenseEnterprise:"Licence Enterprise",licenseTrial:"Version d'essai"}},en:{toolbar:{paragraph:"Paragraph style",fontFamily:"Font family",fontSize:"Font size",lineHeight:"Line height",textColor:"Text color",bgColor:"Background color",bold:"Bold (Ctrl+B)",italic:"Italic (Ctrl+I)",underline:"Underline (Ctrl+U)",strikethrough:"Strikethrough",textCase:"Change case",superscript:"Superscript",alignLeft:"Align left",alignCenter:"Center",alignRight:"Align right",alignJustify:"Justify",indent:"Increase indent",outdent:"Decrease indent",listUl:"Bullet list",listOl:"Numbered list",listTodo:"Todo list",listStyleDecimal:"Numbers",listStyleLowerAlpha:"Alpha (lower)",listStyleUpperAlpha:"Alpha (UPPER)",listStyleUpperRoman:"Roman",listStyleGreek:"Greek",link:"Insert link",image:"Insert image",video:"Insert video",table:"Insert table",columns:"Insert columns",emoji:"Insert emoji",quote:"Insert quote",code:"Insert code block",hr:"Insert separator",config:"Toolbar configuration",undo:"Undo (Ctrl+Z)",redo:"Redo (Ctrl+Y)",preview:"Preview",exportJson:"Export as JSON",exportPdf:"Export as PDF",exportHtml:"Export as HTML"},preview:{title:"Preview",close:"Close"},counter:{words:"{count} word(s)",chars:"{count} character(s)"},common:{delete:"Delete",deleteImage:"Delete image",deleteVideo:"Delete video",deleteTable:"Delete table",deleteColumn:"Delete columns",deleteQuote:"Delete quote",deleteCode:"Delete code block"},paragraphStyles:{p:"Paragraph",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5"},fonts:{default:"Default font"},config:{title:"Toolbar configuration",language:"Language / Langue",selectAll:"Select all",deselectAll:"Deselect all",cancel:"Cancel",apply:"Apply",groupFont:"Selectors and colors",groupTextStyle:"Text style",groupAlignment:"Alignment",groupLists:"Lists",groupMedia:"Media",groupInsert:"Insert",toolParagraph:"Paragraph style",toolFontFamily:"Font",toolFontSize:"Size",toolLineHeight:"Line height",toolTextColor:"Text color",toolBgColor:"Background color",toolBold:"Bold",toolItalic:"Italic",toolUnderline:"Underline",toolStrikethrough:"Strikethrough",toolTextCase:"Change case",toolSuperscript:"Superscript",toolAlignLeft:"Align left",toolAlignCenter:"Center",toolAlignRight:"Align right",toolAlignJustify:"Justify",toolIndent:"Increase indent",toolOutdent:"Decrease indent",toolListUl:"Bullet list",toolListOl:"Numbered list",toolListTodo:"Todo list",toolLink:"Link",toolImage:"Image",toolVideo:"Video",toolTable:"Table",toolColumns:"Columns",toolEmoji:"Emoji",toolQuote:"Quote",toolCode:"Code",toolHr:"Separator",toolExportJson:"JSON Export",toolExportPdf:"PDF Export",toolExportHtml:"HTML Export",groupAction:"Actions",toolUndo:"Undo",toolRedo:"Redo",toolPreview:"Preview",toolConfig:"Configuration",theme:"Theme",themeLight:"Light",themeDark:"Dark",themeWarm:"Warm",themeCold:"Cold",themeTaupe:"Taupe",themePink:"Pink",iconSize:"Icon size",iconSizeSmall:"Small",iconSizeLarge:"Large",toolbarMode:"Toolbar position",toolbarModeIntegrated:"Integrated",toolbarModeFullwidthTop:"Full width at top of screen",customColors:"Custom colors",customColorsHelp:"If colors are defined, only these will be available",addColor:"Add a color",removeColor:"Remove",invalidColor:"Invalid color"},modal:{cancel:"Cancel",ok:"OK",apply:"Apply",insert:"Insert",edit:"Edit",close:"Close"},table:{title:"Create advanced table",editTitle:"Edit table",structure:"Table structure",rows:"Number of rows",columns:"Number of columns",includeHeader:"Include header row",sortable:"Add column sorting",style:"Table style",styleStandard:"Standard",styleBordered:"Full borders",styleStriped:"Striped rows",styleMinimal:"Minimal",responsive:"Responsive table",width:"Table width",alignment:"Table alignment",alignLeft:"Left",alignCenter:"Center",alignRight:"Right",headerStyle:"Header style",headerBgColor:"Header background color",transparent:"Transparent",headerFont:"Header font",inheritFont:"Inherit from table",size:"Size",weight:"Weight",weightNormal:"Normal",weightMedium:"Medium",weightSemiBold:"Semi-bold",weightBold:"Bold",textColor:"Text color",preview:"Live preview",previewHeader:"Header",previewCell:"Cell",insertTable:"Insert this table",errorRowsMin:"Number of rows must be at least 1",errorRowsMax:"Number of rows cannot exceed 50",errorColsMin:"Number of columns must be at least 1",errorColsMax:"Number of columns cannot exceed 20"},image:{title:"Insert image",editTitle:"Edit image",source:"Image source",chooseFile:"Choose file",dragDrop:"or drag & drop here",preview:"Preview",noImage:"No image",invalidImage:"Invalid image",readError:"Read error",invalidFile:"Invalid file",width:"Width (px)",height:"Height",auto:"auto",keepRatio:"Keep aspect ratio",rotation:"Rotation",rotate90:"Rotate 90°",wrapping:"Text wrapping",wrapBlock:"Text below (block)",wrapLeft:"Float left",wrapRight:"Float right",alignment:"Alignment",alignLeft:"Left",alignCenter:"Center",alignRight:"Right",opacity:"Opacity",border:"Border",borderStyle:"Style",borderWidth:"Width",borderColor:"Color",borderRadius:"Radius",borderNone:"None",borderSolid:"Solid",borderDashed:"Dashed",borderDotted:"Dotted",borderDouble:"Double",borderGroove:"Groove",borderRidge:"Ridge",borderInset:"Inset",borderOutset:"Outset",insertImage:"Insert image",editImage:"Edit",errorRequired:"Image source is required",errorInvalid:"Invalid values",urlPlaceholder:"https://example.com/image.jpg"},video:{title:"Insert video",editTitle:"Edit video",url:"Video URL",urlPlaceholder:"https://www.youtube.com/watch?v=...",supported:"Supports YouTube, Vimeo and Dailymotion",preview:"Preview",width:"Width (px)",autoplay:"Autoplay",alignment:"Alignment",alignLeft:"Left",alignCenter:"Center",alignRight:"Right",border:"Border",borderStyle:"Style",borderWidth:"Width",borderColor:"Color",borderRadius:"Radius",borderNone:"None",borderSolid:"Solid",borderDashed:"Dashed",borderDotted:"Dotted",borderDouble:"Double",borderGroove:"Groove",borderRidge:"Ridge",borderInset:"Inset",borderOutset:"Outset",insertVideo:"Insert video",errorRequired:"Video URL is required",errorInvalid:"Invalid values",errorUnsupported:"Unrecognized video URL. Use YouTube, Vimeo or Dailymotion."},link:{title:"Insert link",url:"URL",urlPlaceholder:"https://example.com",text:"Display text",textPlaceholder:"Link text (optional)",tooltip:"Tooltip",tooltipPlaceholder:"Hover description (optional)",newWindow:"Open in new window",nofollow:'Add rel="nofollow" (SEO)',insert:"Insert",errorRequired:"URL is required",errorInvalid:"Invalid URL"},columns:{title:"Column configuration",editTitle:"Edit columns",count:"Number of columns",countHint:"Choose the number of columns for your text",col1:"1 column",col2:"2 columns",col3:"3 columns",spacing:"Column spacing",spacingSmall:"Small (1rem)",spacingMedium:"Medium (2rem)",spacingLarge:"Large (3rem)",height:"Column height",heightHint:"Set the fixed or automatic height of columns",heightAuto:"Auto",heightSmall:"Small",heightMedium:"Medium",heightLarge:"Large",blockWidth:"Block width",widthHint:"Choose the column block width in your article",blockAlignment:"Block alignment",alignHint:"Set the horizontal alignment of the column block",alignLeft:"Left",alignCenter:"Center",alignRight:"Right",textWrap:"Text wrapping",wrapBlock:"Line break",wrapFloat:"Surrounding text",verticalAlign:"Vertical alignment",vAlignTop:"Top",vAlignMiddle:"Middle",vAlignBottom:"Bottom",borders:"Column borders",borderRadius:"Border radius",borderThickness:"Thickness",borderStyle:"Style",borderColor:"Color",styleSolid:"Solid",styleDashed:"Dashed",styleDotted:"Dotted",styleDouble:"Double",bgColors:"Background colors",bgArea:"Column area",bgColumns:"Columns",preview:"Preview",previewColumn:"Column",apply:"Apply columns",errorCount:"Number of columns must be between 1 and 3",errorSpacing:"Invalid spacing",errorHeight:"Invalid height",errorWidth:"Invalid width",errorAlignment:"Invalid alignment"},hr:{title:"Insert separator",selectStyle:"Select a separator style:",opacity:"Opacity:",width:"Width:",insert:"Insert",simple:"Simple",simpleDesc:"Classic thin line",thick:"Thick",thickDesc:"Thick line",double:"Double",doubleDesc:"Double line",dashed:"Dashed",dashedDesc:"Dashed line",dotted:"Dotted",dottedDesc:"Dotted line",gradient:"Gradient",gradientDesc:"Blue gradient",shadow:"Shadow",shadowDesc:"Line with shadow",ornament:"Ornament",ornamentDesc:"With central symbol",wavy:"Wavy",wavyDesc:"Wavy shape",fade:"Fade",fadeDesc:"Fade to edges"},quote:{title:"Insert quote",selectStyle:"Select a quote style:",insert:"Insert",previewText:"Your quote here...",classic:"Classic",classicDesc:"Traditional blue left border",modern:"Modern",modernDesc:"Floating card with accent",elegant:"Elegant",elegantDesc:"Golden decorative quotes",minimal:"Minimal",minimalDesc:"Clean with thin lines",framed:"Framed",framedDesc:"Double distinctive border",shadow:"Deep shadow",shadowDesc:"Elevated card effect",gradient:"Vivid gradient",gradientDesc:"Dynamic colored background",retro:"Retro",retroDesc:"Typewriter style",academic:"Academic",academicDesc:"University citation style",highlight:"Highlight",highlightDesc:"Colored attention block"},colorPicker:{title:"Choose a color",preview:"Preview",opacity:"Opacity",savedColors:"Saved colors",noSavedColors:"No saved colors",saveColor:"Save current color",remove:"Remove",eyedropper:"Eyedropper - Pick color from screen",eyedropperUnavailable:"Eyedropper not available in this browser",borderRadius:"Border radius",highlightThickness:"Highlight thickness",hex:"Hex"},emoji:{search:"Search emoji...",noResults:"No emoji found",resultsFor:"Results for",mostUsed:"Most used",noRecentEmoji:"No recently used emojis",catSmileys:"Smileys & Emotions",catPeople:"People & Body",catAnimals:"Animals & Nature",catFood:"Food & Drinks",catActivities:"Activities",catTravel:"Travel & Places",catObjects:"Objects",catSymbols:"Symbols",catFlags:"Flags"},code:{placeholder:"Enter your code here...",copy:"Copy",copyCode:"Copy code",copied:"Copied!"},cellFormat:{title:"Cell format",bgColor:"Background color",textColor:"Text color",border:"Border",padding:"Padding",alignment:"Alignment"},status:{localMode:"Running locally, all features are available",restrictedTool:"Feature available with a license",freeVersion:"Free version - {current}/{limit} words",wordLimitReached:"Word limit reached ({limit} words max)",licensePro:"Pro License",licenseEnterprise:"Enterprise License",licenseTrial:"Trial version"}},de:{toolbar:{paragraph:"Absatzformat",fontFamily:"Schriftart",fontSize:"Schriftgröße",lineHeight:"Zeilenabstand",textColor:"Textfarbe",bgColor:"Hintergrundfarbe",bold:"Fett (Strg+B)",italic:"Kursiv (Strg+I)",underline:"Unterstrichen (Strg+U)",strikethrough:"Durchgestrichen",textCase:"Groß-/Kleinschreibung",superscript:"Hochgestellt",alignLeft:"Linksbündig",alignCenter:"Zentriert",alignRight:"Rechtsbündig",alignJustify:"Blocksatz",indent:"Einzug vergrößern",outdent:"Einzug verkleinern",listUl:"Aufzählung",listOl:"Nummerierung",listTodo:"Aufgabenliste",listStyleDecimal:"Zahlen",listStyleLowerAlpha:"Alpha (klein)",listStyleUpperAlpha:"Alpha (GROSS)",listStyleUpperRoman:"Römisch",listStyleGreek:"Griechisch",link:"Link einfügen",image:"Bild einfügen",video:"Video einfügen",table:"Tabelle einfügen",columns:"Spalten einfügen",emoji:"Emoji einfügen",quote:"Zitat einfügen",code:"Codeblock einfügen",hr:"Trennlinie einfügen",config:"Symbolleiste konfigurieren",undo:"Rückgängig (Strg+Z)",redo:"Wiederherstellen (Strg+Y)",preview:"Vorschau",exportJson:"Als JSON exportieren",exportPdf:"Als PDF exportieren",exportHtml:"Als HTML exportieren"},preview:{title:"Vorschau",close:"Schließen"},counter:{words:"{count} Wort(e)",chars:"{count} Zeichen"},common:{delete:"Löschen",deleteImage:"Bild löschen",deleteVideo:"Video löschen",deleteTable:"Tabelle löschen",deleteColumn:"Spalten löschen",deleteQuote:"Zitat löschen",deleteCode:"Codeblock löschen"},paragraphStyles:{p:"Absatz",h1:"Überschrift 1",h2:"Überschrift 2",h3:"Überschrift 3",h4:"Überschrift 4",h5:"Überschrift 5"},fonts:{default:"Standardschrift"},config:{title:"Symbolleiste konfigurieren",language:"Sprache / Language",selectAll:"Alle auswählen",deselectAll:"Alle abwählen",cancel:"Abbrechen",apply:"Anwenden",groupFont:"Auswahl und Farben",groupTextStyle:"Textformat",groupAlignment:"Ausrichtung",groupLists:"Listen",groupMedia:"Medien",groupInsert:"Einfügen",toolParagraph:"Absatzformat",toolFontFamily:"Schriftart",toolFontSize:"Größe",toolLineHeight:"Zeilenabstand",toolTextColor:"Textfarbe",toolBgColor:"Hintergrundfarbe",toolBold:"Fett",toolItalic:"Kursiv",toolUnderline:"Unterstrichen",toolStrikethrough:"Durchgestrichen",toolTextCase:"Groß-/Kleinschreibung",toolSuperscript:"Hochgestellt",toolAlignLeft:"Linksbündig",toolAlignCenter:"Zentriert",toolAlignRight:"Rechtsbündig",toolAlignJustify:"Blocksatz",toolIndent:"Einzug vergrößern",toolOutdent:"Einzug verkleinern",toolListUl:"Aufzählung",toolListOl:"Nummerierung",toolListTodo:"Aufgabenliste",toolLink:"Link",toolImage:"Bild",toolVideo:"Video",toolTable:"Tabelle",toolColumns:"Spalten",toolEmoji:"Emoji",toolQuote:"Zitat",toolCode:"Code",toolHr:"Trennlinie",toolExportJson:"JSON-Export",toolExportPdf:"PDF-Export",toolExportHtml:"HTML-Export",groupAction:"Aktionen",toolUndo:"Rückgängig",toolRedo:"Wiederherstellen",toolPreview:"Vorschau",toolConfig:"Konfiguration",theme:"Thema",themeLight:"Hell",themeDark:"Dunkel",themeWarm:"Warm",themeCold:"Kalt",themeTaupe:"Taupe",themePink:"Rosa",iconSize:"Symbolgröße",iconSizeSmall:"Klein",iconSizeLarge:"Groß",toolbarMode:"Toolbar-Position",toolbarModeIntegrated:"Integriert",toolbarModeFullwidthTop:"Volle Breite oben am Bildschirm",customColors:"Benutzerdefinierte Farben",customColorsHelp:"Wenn Farben definiert sind, sind nur diese verfügbar",addColor:"Farbe hinzufügen",removeColor:"Entfernen",invalidColor:"Ungültige Farbe"},modal:{cancel:"Abbrechen",ok:"OK",apply:"Anwenden",insert:"Einfügen",edit:"Bearbeiten",close:"Schließen"},table:{title:"Erweiterte Tabelle erstellen",editTitle:"Tabelle bearbeiten",structure:"Tabellenstruktur",rows:"Anzahl Zeilen",columns:"Anzahl Spalten",includeHeader:"Kopfzeile einschließen",sortable:"Spaltensortierung hinzufügen",style:"Tabellenstil",styleStandard:"Standard",styleBordered:"Volle Rahmen",styleStriped:"Gestreifte Zeilen",styleMinimal:"Minimal",responsive:"Responsive Tabelle",width:"Tabellenbreite",alignment:"Tabellenausrichtung",alignLeft:"Links",alignCenter:"Mitte",alignRight:"Rechts",headerStyle:"Kopfzeilenstil",headerBgColor:"Kopfzeilen-Hintergrundfarbe",transparent:"Transparent",headerFont:"Kopfzeilen-Schriftart",inheritFont:"Von Tabelle erben",size:"Größe",weight:"Stärke",weightNormal:"Normal",weightMedium:"Mittel",weightSemiBold:"Halbfett",weightBold:"Fett",textColor:"Textfarbe",preview:"Live-Vorschau",previewHeader:"Kopfzeile",previewCell:"Zelle",insertTable:"Diese Tabelle einfügen",errorRowsMin:"Die Anzahl der Zeilen muss mindestens 1 sein",errorRowsMax:"Die Anzahl der Zeilen darf 50 nicht überschreiten",errorColsMin:"Die Anzahl der Spalten muss mindestens 1 sein",errorColsMax:"Die Anzahl der Spalten darf 20 nicht überschreiten"},image:{title:"Bild einfügen",editTitle:"Bild bearbeiten",source:"Bildquelle",chooseFile:"Datei wählen",dragDrop:"oder hierher ziehen",preview:"Vorschau",noImage:"Kein Bild",invalidImage:"Ungültiges Bild",readError:"Lesefehler",invalidFile:"Ungültige Datei",width:"Breite (px)",height:"Höhe",auto:"auto",keepRatio:"Seitenverhältnis beibehalten",rotation:"Drehung",rotate90:"90° drehen",wrapping:"Textumbruch",wrapBlock:"Text darunter (Block)",wrapLeft:"Links fließend",wrapRight:"Rechts fließend",alignment:"Ausrichtung",alignLeft:"Links",alignCenter:"Mitte",alignRight:"Rechts",opacity:"Transparenz",border:"Rahmen",borderStyle:"Stil",borderWidth:"Breite",borderColor:"Farbe",borderRadius:"Radius",borderNone:"Keine",borderSolid:"Durchgehend",borderDashed:"Gestrichelt",borderDotted:"Gepunktet",borderDouble:"Doppelt",borderGroove:"Rille",borderRidge:"Grat",borderInset:"Eingelassen",borderOutset:"Erhaben",insertImage:"Bild einfügen",editImage:"Bearbeiten",errorRequired:"Bildquelle ist erforderlich",errorInvalid:"Ungültige Werte",urlPlaceholder:"https://example.com/image.jpg"},video:{title:"Video einfügen",editTitle:"Video bearbeiten",url:"Video-URL",urlPlaceholder:"https://www.youtube.com/watch?v=...",supported:"Unterstützt YouTube, Vimeo und Dailymotion",preview:"Vorschau",width:"Breite (px)",autoplay:"Automatische Wiedergabe",alignment:"Ausrichtung",alignLeft:"Links",alignCenter:"Mitte",alignRight:"Rechts",border:"Rahmen",borderStyle:"Stil",borderWidth:"Breite",borderColor:"Farbe",borderRadius:"Radius",borderNone:"Keine",borderSolid:"Durchgehend",borderDashed:"Gestrichelt",borderDotted:"Gepunktet",borderDouble:"Doppelt",borderGroove:"Rille",borderRidge:"Grat",borderInset:"Eingelassen",borderOutset:"Erhaben",insertVideo:"Video einfügen",errorRequired:"Video-URL ist erforderlich",errorInvalid:"Ungültige Werte",errorUnsupported:"Unbekannte Video-URL. Verwenden Sie YouTube, Vimeo oder Dailymotion."},link:{title:"Link einfügen",url:"URL",urlPlaceholder:"https://example.com",text:"Anzeigetext",textPlaceholder:"Linktext (optional)",tooltip:"Tooltip",tooltipPlaceholder:"Hover-Beschreibung (optional)",newWindow:"In neuem Fenster öffnen",nofollow:'rel="nofollow" hinzufügen (SEO)',insert:"Einfügen",errorRequired:"URL ist erforderlich",errorInvalid:"Ungültige URL"},columns:{title:"Spaltenkonfiguration",editTitle:"Spalten bearbeiten",count:"Anzahl Spalten",countHint:"Wählen Sie die Anzahl der Spalten für Ihren Text",col1:"1 Spalte",col2:"2 Spalten",col3:"3 Spalten",spacing:"Spaltenabstand",spacingSmall:"Klein (1rem)",spacingMedium:"Mittel (2rem)",spacingLarge:"Groß (3rem)",height:"Spaltenhöhe",heightHint:"Legen Sie eine feste oder automatische Höhe für die Spalten fest",heightAuto:"Automatisch",heightSmall:"Klein",heightMedium:"Mittel",heightLarge:"Groß",blockWidth:"Blockbreite",widthHint:"Wählen Sie die Breite des Spaltenblocks in Ihrem Artikel",blockAlignment:"Blockausrichtung",alignHint:"Legen Sie die horizontale Ausrichtung des Spaltenblocks fest",alignLeft:"Links",alignCenter:"Mitte",alignRight:"Rechts",textWrap:"Textumbruch",wrapBlock:"Zeilenumbruch",wrapFloat:"Umfließender Text",verticalAlign:"Vertikale Ausrichtung",vAlignTop:"Oben",vAlignMiddle:"Mitte",vAlignBottom:"Unten",borders:"Spaltenrahmen",borderRadius:"Eckenradius",borderThickness:"Stärke",borderStyle:"Stil",borderColor:"Farbe",styleSolid:"Durchgehend",styleDashed:"Gestrichelt",styleDotted:"Gepunktet",styleDouble:"Doppelt",bgColors:"Hintergrundfarben",bgArea:"Spaltenbereich",bgColumns:"Spalten",preview:"Vorschau",previewColumn:"Spalte",apply:"Spalten anwenden",errorCount:"Anzahl der Spalten muss zwischen 1 und 3 liegen",errorSpacing:"Ungültiger Abstand",errorHeight:"Ungültige Höhe",errorWidth:"Ungültige Breite",errorAlignment:"Ungültige Ausrichtung"},hr:{title:"Trennlinie einfügen",selectStyle:"Wählen Sie einen Trennlinienstil:",opacity:"Transparenz:",width:"Breite:",insert:"Einfügen",simple:"Einfach",simpleDesc:"Klassische dünne Linie",thick:"Dick",thickDesc:"Dicke Linie",double:"Doppelt",doubleDesc:"Doppelte Linie",dashed:"Gestrichelt",dashedDesc:"Gestrichelte Linie",dotted:"Gepunktet",dottedDesc:"Gepunktete Linie",gradient:"Verlauf",gradientDesc:"Blauer Verlauf",shadow:"Schatten",shadowDesc:"Linie mit Schatten",ornament:"Ornament",ornamentDesc:"Mit zentralem Symbol",wavy:"Wellig",wavyDesc:"Wellige Form",fade:"Ausblenden",fadeDesc:"Ausblenden zu den Rändern"},quote:{title:"Zitat einfügen",selectStyle:"Wählen Sie einen Zitatstil:",insert:"Einfügen",previewText:"Ihr Zitat hier...",classic:"Klassisch",classicDesc:"Traditioneller blauer linker Rand",modern:"Modern",modernDesc:"Schwebende Karte mit Akzent",elegant:"Elegant",elegantDesc:"Goldene dekorative Anführungszeichen",minimal:"Minimal",minimalDesc:"Sauber mit dünnen Linien",framed:"Gerahmt",framedDesc:"Doppelter markanter Rahmen",shadow:"Tiefer Schatten",shadowDesc:"Erhöhter Karteneffekt",gradient:"Lebhafter Verlauf",gradientDesc:"Dynamischer farbiger Hintergrund",retro:"Retro",retroDesc:"Schreibmaschinenstil",academic:"Akademisch",academicDesc:"Universitärer Zitierstil",highlight:"Hervorhebung",highlightDesc:"Farbiger Aufmerksamkeitsblock"},colorPicker:{title:"Farbe wählen",preview:"Vorschau",opacity:"Transparenz",savedColors:"Gespeicherte Farben",noSavedColors:"Keine gespeicherten Farben",saveColor:"Aktuelle Farbe speichern",remove:"Entfernen",eyedropper:"Pipette - Farbe vom Bildschirm aufnehmen",eyedropperUnavailable:"Pipette in diesem Browser nicht verfügbar",borderRadius:"Eckenradius",highlightThickness:"Hervorhebungsdicke",hex:"Hex"},emoji:{search:"Emoji suchen...",noResults:"Kein Emoji gefunden",resultsFor:"Ergebnisse für",mostUsed:"Am häufigsten verwendet",noRecentEmoji:"Keine kürzlich verwendeten Emojis",catSmileys:"Smileys & Emotionen",catPeople:"Personen & Körper",catAnimals:"Tiere & Natur",catFood:"Essen & Trinken",catActivities:"Aktivitäten",catTravel:"Reisen & Orte",catObjects:"Objekte",catSymbols:"Symbole",catFlags:"Flaggen"},code:{placeholder:"Geben Sie Ihren Code hier ein...",copy:"Kopieren",copyCode:"Code kopieren",copied:"Kopiert!"},cellFormat:{title:"Zellenformat",bgColor:"Hintergrundfarbe",textColor:"Textfarbe",border:"Rahmen",padding:"Innenabstand",alignment:"Ausrichtung"},status:{localMode:"Lokaler Betrieb, alle Funktionen sind verfügbar",restrictedTool:"Funktion mit Lizenz verfügbar",freeVersion:"Kostenlose Version - {current}/{limit} Wörter",wordLimitReached:"Wortlimit erreicht ({limit} Wörter max)",licensePro:"Pro-Lizenz",licenseEnterprise:"Enterprise-Lizenz",licenseTrial:"Testversion"}},es:{toolbar:{paragraph:"Estilo de párrafo",fontFamily:"Tipo de letra",fontSize:"Tamaño de fuente",lineHeight:"Interlineado",textColor:"Color del texto",bgColor:"Color de fondo",bold:"Negrita (Ctrl+B)",italic:"Cursiva (Ctrl+I)",underline:"Subrayado (Ctrl+U)",strikethrough:"Tachado",textCase:"Cambiar mayúsculas",superscript:"Superíndice",alignLeft:"Alinear a la izquierda",alignCenter:"Centrar",alignRight:"Alinear a la derecha",alignJustify:"Justificar",indent:"Aumentar sangría",outdent:"Reducir sangría",listUl:"Lista con viñetas",listOl:"Lista numerada",listTodo:"Lista de tareas",listStyleDecimal:"Números",listStyleLowerAlpha:"Alfa (min.)",listStyleUpperAlpha:"Alfa (MAY.)",listStyleUpperRoman:"Romano",listStyleGreek:"Griego",link:"Insertar enlace",image:"Insertar imagen",video:"Insertar vídeo",table:"Insertar tabla",columns:"Insertar columnas",emoji:"Insertar emoji",quote:"Insertar cita",code:"Insertar bloque de código",hr:"Insertar separador",config:"Configuración de la barra",undo:"Deshacer (Ctrl+Z)",redo:"Rehacer (Ctrl+Y)",preview:"Vista previa",exportJson:"Exportar como JSON",exportPdf:"Exportar como PDF",exportHtml:"Exportar como HTML"},preview:{title:"Vista previa",close:"Cerrar"},counter:{words:"{count} palabra(s)",chars:"{count} carácter(es)"},common:{delete:"Eliminar",deleteImage:"Eliminar imagen",deleteVideo:"Eliminar vídeo",deleteTable:"Eliminar tabla",deleteColumn:"Eliminar columnas",deleteQuote:"Eliminar cita",deleteCode:"Eliminar bloque de código"},paragraphStyles:{p:"Párrafo",h1:"Título 1",h2:"Título 2",h3:"Título 3",h4:"Título 4",h5:"Título 5"},fonts:{default:"Fuente predeterminada"},config:{title:"Configuración de la barra",language:"Idioma / Language",selectAll:"Seleccionar todo",deselectAll:"Deseleccionar todo",cancel:"Cancelar",apply:"Aplicar",groupFont:"Selectores y colores",groupTextStyle:"Estilo de texto",groupAlignment:"Alineación",groupLists:"Listas",groupMedia:"Medios",groupInsert:"Insertar",toolParagraph:"Estilo de párrafo",toolFontFamily:"Fuente",toolFontSize:"Tamaño",toolLineHeight:"Interlineado",toolTextColor:"Color del texto",toolBgColor:"Color de fondo",toolBold:"Negrita",toolItalic:"Cursiva",toolUnderline:"Subrayado",toolStrikethrough:"Tachado",toolTextCase:"Cambiar mayúsculas",toolSuperscript:"Superíndice",toolAlignLeft:"Alinear a la izquierda",toolAlignCenter:"Centrar",toolAlignRight:"Alinear a la derecha",toolAlignJustify:"Justificar",toolIndent:"Aumentar sangría",toolOutdent:"Reducir sangría",toolListUl:"Lista con viñetas",toolListOl:"Lista numerada",toolListTodo:"Lista de tareas",toolLink:"Enlace",toolImage:"Imagen",toolVideo:"Vídeo",toolTable:"Tabla",toolColumns:"Columnas",toolEmoji:"Emoji",toolQuote:"Cita",toolCode:"Código",toolHr:"Separador",toolExportJson:"Exportar JSON",toolExportPdf:"Exportar PDF",toolExportHtml:"Exportar HTML",groupAction:"Acciones",toolUndo:"Deshacer",toolRedo:"Rehacer",toolPreview:"Vista previa",toolConfig:"Configuración",theme:"Tema",themeLight:"Claro",themeDark:"Oscuro",themeWarm:"Cálido",themeCold:"Frío",themeTaupe:"Topo",themePink:"Rosa",iconSize:"Tamaño de iconos",iconSizeSmall:"Pequeños",iconSizeLarge:"Grandes",toolbarMode:"Posición de la toolbar",toolbarModeIntegrated:"Integrado",toolbarModeFullwidthTop:"Ancho completo arriba de la pantalla",customColors:"Colores personalizados",customColorsHelp:"Si se definen colores, solo estos estarán disponibles",addColor:"Añadir un color",removeColor:"Eliminar",invalidColor:"Color no válido"},modal:{cancel:"Cancelar",ok:"OK",apply:"Aplicar",insert:"Insertar",edit:"Editar",close:"Cerrar"},table:{title:"Crear tabla avanzada",editTitle:"Editar tabla",structure:"Estructura de la tabla",rows:"Número de filas",columns:"Número de columnas",includeHeader:"Incluir fila de encabezado",sortable:"Añadir ordenación de columnas",style:"Estilo de tabla",styleStandard:"Estándar",styleBordered:"Bordes completos",styleStriped:"Filas alternas",styleMinimal:"Minimal",responsive:"Tabla responsive",width:"Ancho de tabla",alignment:"Alineación de tabla",alignLeft:"Izquierda",alignCenter:"Centro",alignRight:"Derecha",headerStyle:"Estilo del encabezado",headerBgColor:"Color de fondo del encabezado",transparent:"Transparente",headerFont:"Fuente del encabezado",inheritFont:"Heredar de la tabla",size:"Tamaño",weight:"Grosor",weightNormal:"Normal",weightMedium:"Medio",weightSemiBold:"Semi-negrita",weightBold:"Negrita",textColor:"Color del texto",preview:"Vista previa en tiempo real",previewHeader:"Encabezado",previewCell:"Celda",insertTable:"Insertar esta tabla",errorRowsMin:"El número de filas debe ser al menos 1",errorRowsMax:"El número de filas no puede superar 50",errorColsMin:"El número de columnas debe ser al menos 1",errorColsMax:"El número de columnas no puede superar 20"},image:{title:"Insertar imagen",editTitle:"Editar imagen",source:"Fuente de imagen",chooseFile:"Elegir archivo",dragDrop:"o arrastrar y soltar aquí",preview:"Vista previa",noImage:"Sin imagen",invalidImage:"Imagen no válida",readError:"Error de lectura",invalidFile:"Archivo no válido",width:"Ancho (px)",height:"Alto",auto:"auto",keepRatio:"Mantener proporciones",rotation:"Rotación",rotate90:"Rotar 90°",wrapping:"Ajuste de texto",wrapBlock:"Texto debajo (bloque)",wrapLeft:"Flotante izquierda",wrapRight:"Flotante derecha",alignment:"Alineación",alignLeft:"Izquierda",alignCenter:"Centro",alignRight:"Derecha",opacity:"Opacidad",border:"Borde",borderStyle:"Estilo",borderWidth:"Grosor",borderColor:"Color",borderRadius:"Radio",borderNone:"Ninguno",borderSolid:"Solido",borderDashed:"Guiones",borderDotted:"Puntos",borderDouble:"Doble",borderGroove:"Ranura",borderRidge:"Cresta",borderInset:"Hundido",borderOutset:"Relieve",insertImage:"Insertar imagen",editImage:"Editar",errorRequired:"Se requiere una fuente de imagen",errorInvalid:"Valores no válidos",urlPlaceholder:"https://example.com/image.jpg"},video:{title:"Insertar vídeo",editTitle:"Editar vídeo",url:"URL del vídeo",urlPlaceholder:"https://www.youtube.com/watch?v=...",supported:"Soporta YouTube, Vimeo y Dailymotion",preview:"Vista previa",width:"Ancho (px)",autoplay:"Reproducción automática",alignment:"Alineación",alignLeft:"Izquierda",alignCenter:"Centro",alignRight:"Derecha",border:"Borde",borderStyle:"Estilo",borderWidth:"Grosor",borderColor:"Color",borderRadius:"Radio",borderNone:"Ninguno",borderSolid:"Sólido",borderDashed:"Rayas",borderDotted:"Puntos",borderDouble:"Doble",borderGroove:"Ranura",borderRidge:"Cresta",borderInset:"Hundido",borderOutset:"Relieve",insertVideo:"Insertar vídeo",errorRequired:"Se requiere una URL de vídeo",errorInvalid:"Valores no válidos",errorUnsupported:"URL de vídeo no reconocida. Use YouTube, Vimeo o Dailymotion."},link:{title:"Insertar enlace",url:"URL",urlPlaceholder:"https://example.com",text:"Texto a mostrar",textPlaceholder:"Texto del enlace (opcional)",tooltip:"Información emergente",tooltipPlaceholder:"Descripción al pasar (opcional)",newWindow:"Abrir en nueva ventana",nofollow:'Añadir rel="nofollow" (SEO)',insert:"Insertar",errorRequired:"La URL es obligatoria",errorInvalid:"URL no válida"},columns:{title:"Configuración de columnas",editTitle:"Editar columnas",count:"Número de columnas",countHint:"Elija el número de columnas para su texto",col1:"1 columna",col2:"2 columnas",col3:"3 columnas",spacing:"Espaciado entre columnas",spacingSmall:"Pequeño (1rem)",spacingMedium:"Medio (2rem)",spacingLarge:"Grande (3rem)",height:"Altura de columnas",heightHint:"Defina una altura fija o automática para las columnas",heightAuto:"Automática",heightSmall:"Pequeña",heightMedium:"Media",heightLarge:"Grande",blockWidth:"Ancho del bloque",widthHint:"Elija el ancho del bloque de columnas en su artículo",blockAlignment:"Alineación del bloque",alignHint:"Defina la alineación horizontal del bloque de columnas",alignLeft:"Izquierda",alignCenter:"Centro",alignRight:"Derecha",textWrap:"Ajuste de texto",wrapBlock:"Salto de línea",wrapFloat:"Texto envolvente",verticalAlign:"Alineación vertical",vAlignTop:"Arriba",vAlignMiddle:"Medio",vAlignBottom:"Abajo",borders:"Bordes entre columnas",borderRadius:"Radio de borde",borderThickness:"Grosor",borderStyle:"Estilo",borderColor:"Color",styleSolid:"Sólido",styleDashed:"Guiones",styleDotted:"Puntos",styleDouble:"Doble",bgColors:"Colores de fondo",bgArea:"Área de columnas",bgColumns:"Columnas",preview:"Vista previa",previewColumn:"Columna",apply:"Aplicar columnas",errorCount:"El número de columnas debe estar entre 1 y 3",errorSpacing:"Espaciado no válido",errorHeight:"Altura no válida",errorWidth:"Ancho no válido",errorAlignment:"Alineación no válida"},hr:{title:"Insertar separador",selectStyle:"Seleccione un estilo de separador:",opacity:"Opacidad:",width:"Ancho:",insert:"Insertar",simple:"Simple",simpleDesc:"Línea fina clásica",thick:"Gruesa",thickDesc:"Línea gruesa",double:"Doble",doubleDesc:"Línea doble",dashed:"Guiones",dashedDesc:"Línea de guiones",dotted:"Puntos",dottedDesc:"Línea de puntos",gradient:"Degradado",gradientDesc:"Degradado azul",shadow:"Sombra",shadowDesc:"Línea con sombra",ornament:"Ornamento",ornamentDesc:"Con símbolo central",wavy:"Ondulada",wavyDesc:"Forma ondulada",fade:"Difuminado",fadeDesc:"Difuminado hacia los bordes"},quote:{title:"Insertar cita",selectStyle:"Seleccione un estilo de cita:",insert:"Insertar",previewText:"Tu cita aquí...",classic:"Clásico",classicDesc:"Borde izquierdo azul tradicional",modern:"Moderno",modernDesc:"Tarjeta flotante con acento",elegant:"Elegante",elegantDesc:"Comillas doradas decorativas",minimal:"Minimalista",minimalDesc:"Limpio con líneas finas",framed:"Enmarcado",framedDesc:"Doble borde distintivo",shadow:"Sombra profunda",shadowDesc:"Efecto de tarjeta elevada",gradient:"Degradado vivo",gradientDesc:"Fondo de color dinámico",retro:"Retro",retroDesc:"Estilo máquina de escribir",academic:"Académico",academicDesc:"Estilo de cita universitaria",highlight:"Destacado",highlightDesc:"Bloque de atención coloreado"},colorPicker:{title:"Elegir un color",preview:"Vista previa",opacity:"Opacidad",savedColors:"Colores guardados",noSavedColors:"Sin colores guardados",saveColor:"Guardar color actual",remove:"Eliminar",eyedropper:"Cuentagotas - Capturar color de pantalla",eyedropperUnavailable:"Cuentagotas no disponible en este navegador",borderRadius:"Radio de borde",highlightThickness:"Grosor del resaltado",hex:"Hex"},emoji:{search:"Buscar emoji...",noResults:"No se encontró emoji",resultsFor:"Resultados para",mostUsed:"Más usados",noRecentEmoji:"No hay emojis usados recientemente",catSmileys:"Smileys y emociones",catPeople:"Personas y cuerpo",catAnimals:"Animales y naturaleza",catFood:"Comida y bebida",catActivities:"Actividades",catTravel:"Viajes y lugares",catObjects:"Objetos",catSymbols:"Símbolos",catFlags:"Banderas"},code:{placeholder:"Ingrese su código aquí...",copy:"Copiar",copyCode:"Copiar código",copied:"¡Copiado!"},cellFormat:{title:"Formato de celda",bgColor:"Color de fondo",textColor:"Color del texto",border:"Borde",padding:"Relleno",alignment:"Alineación"},status:{localMode:"Uso local, todas las funciones están disponibles",restrictedTool:"Función disponible con licencia",freeVersion:"Versión gratuita - {current}/{limit} palabras",wordLimitReached:"Límite de palabras alcanzado ({limit} palabras máx)",licensePro:"Licencia Pro",licenseEnterprise:"Licencia Enterprise",licenseTrial:"Versión de prueba"}}};function a(){if("undefined"!=typeof localStorage)try{const e=localStorage.getItem(t);e&&r[e]&&(n=e)}catch(e){}return n}function l(e){const t=a(),n=e.split(".");let o=r[t];for(const t of n){if(!o||"object"!=typeof o)return e;o=o[t]}return o||e}const i=[{value:"",label:"Police par défaut"},{value:"Arial, sans-serif",label:"Arial"},{value:"Helvetica, Arial, sans-serif",label:"Helvetica"},{value:"Georgia, serif",label:"Georgia"},{value:"Times New Roman, Times, serif",label:"Times New Roman"},{value:"Courier New, Courier, monospace",label:"Courier New"},{value:"Verdana, Geneva, sans-serif",label:"Verdana"},{value:"Trebuchet MS, sans-serif",label:"Trebuchet MS"},{value:"Impact, sans-serif",label:"Impact"},{value:"Comic Sans MS, cursive",label:"Comic Sans MS"},{value:"Palatino Linotype, Book Antiqua, Palatino, serif",label:"Palatino"},{value:"Lucida Sans Unicode, Lucida Grande, sans-serif",label:"Lucida Sans"},{value:"Tahoma, Geneva, sans-serif",label:"Tahoma"},{value:"Century Gothic, sans-serif",label:"Century Gothic"},{value:"Garamond, serif",label:"Garamond"},{value:"Bookman Old Style, serif",label:"Bookman"},{value:"Arial Black, sans-serif",label:"Arial Black"},{value:"Brush Script MT, cursive",label:"Brush Script"},{value:"Copperplate, Copperplate Gothic Light, fantasy",label:"Copperplate"},{value:"Rockwell, serif",label:"Rockwell"}],s=[{value:"9px",label:"9"},{value:"10px",label:"10"},{value:"11px",label:"11"},{value:"12px",label:"12"},{value:"14px",label:"14"},{value:"16px",label:"16"},{value:"18px",label:"18"},{value:"20px",label:"20"},{value:"24px",label:"24"},{value:"28px",label:"28"},{value:"32px",label:"32"},{value:"36px",label:"36"},{value:"42px",label:"42"},{value:"48px",label:"48"}],d=[{value:"1",label:"1"},{value:"1.15",label:"1.15"},{value:"1.5",label:"1.5"},{value:"2",label:"2"},{value:"2.5",label:"2.5"},{value:"3",label:"3"}];function c(e,t){return!t||!1!==t[e]}function u(e=null){const t=document.createElement("div");t.className="nge-toolbar",t.setAttribute("role","toolbar"),t.setAttribute("data-testid","nge-toolbar");const n=document.createElement("div");if(n.className="nge-toolbar-group",n.setAttribute("data-group","font"),c("paragraph",e)){const e=m({id:"paragraph",title:l("toolbar.paragraph"),options:[{value:"p",label:l("paragraphStyles.p")},{value:"h1",label:l("paragraphStyles.h1")},{value:"h2",label:l("paragraphStyles.h2")},{value:"h3",label:l("paragraphStyles.h3")},{value:"h4",label:l("paragraphStyles.h4")},{value:"h5",label:l("paragraphStyles.h5")}],showFontPreview:!1,showParagraphPreview:!0,width:"110px"});n.appendChild(e)}if(c("font-family",e)){const e=m({id:"font-family",title:l("toolbar.fontFamily"),options:[{value:"",label:l("fonts.default")},{value:"Arial, sans-serif",label:"Arial"},{value:"Helvetica, Arial, sans-serif",label:"Helvetica"},{value:"Georgia, serif",label:"Georgia"},{value:"Times New Roman, Times, serif",label:"Times New Roman"},{value:"Courier New, Courier, monospace",label:"Courier New"},{value:"Verdana, Geneva, sans-serif",label:"Verdana"},{value:"Trebuchet MS, sans-serif",label:"Trebuchet MS"},{value:"Impact, sans-serif",label:"Impact"},{value:"Comic Sans MS, cursive",label:"Comic Sans MS"},{value:"Palatino Linotype, Book Antiqua, Palatino, serif",label:"Palatino"},{value:"Lucida Sans Unicode, Lucida Grande, sans-serif",label:"Lucida Sans"},{value:"Tahoma, Geneva, sans-serif",label:"Tahoma"},{value:"Century Gothic, sans-serif",label:"Century Gothic"},{value:"Garamond, serif",label:"Garamond"},{value:"Bookman Old Style, serif",label:"Bookman"},{value:"Arial Black, sans-serif",label:"Arial Black"},{value:"Brush Script MT, cursive",label:"Brush Script"},{value:"Copperplate, Copperplate Gothic Light, fantasy",label:"Copperplate"},{value:"Rockwell, serif",label:"Rockwell"}],showFontPreview:!0,width:"140px"});n.appendChild(e)}if(c("font-size",e)){const e=m({id:"font-size",title:l("toolbar.fontSize"),options:s,showFontPreview:!1,width:"65px"});n.appendChild(e)}if(c("line-height",e)){const e=document.createElement("div");e.className="nge-toolbar-select-with-icon",e.setAttribute("title",l("toolbar.lineHeight"));const t=document.createElement("span");t.className="nge-icon nge-icon-line-height",e.appendChild(t);const o=m({id:"line-height",title:l("toolbar.lineHeight"),options:d,showFontPreview:!1,width:"55px"});e.appendChild(o),n.appendChild(e)}if(c("text-color",e)){const e=g({id:"text-color",title:l("toolbar.textColor"),icon:"text-color"});n.appendChild(e)}if(c("bg-color",e)){const e=g({id:"bg-color",title:l("toolbar.bgColor"),icon:"bg-color"});n.appendChild(e)}n.children.length>0&&t.appendChild(n);return[{name:"text-style",buttons:[{id:"bold",title:l("toolbar.bold"),icon:"bold"},{id:"italic",title:l("toolbar.italic"),icon:"italic"},{id:"underline",title:l("toolbar.underline"),icon:"underline"},{id:"strikethrough",title:l("toolbar.strikethrough"),icon:"strikethrough"},{id:"text-case",title:l("toolbar.textCase"),icon:"text-case"},{id:"superscript",title:l("toolbar.superscript"),icon:"superscript"}]},{name:"alignment",buttons:[{id:"align-left",title:l("toolbar.alignLeft"),icon:"align-left"},{id:"align-center",title:l("toolbar.alignCenter"),icon:"align-center"},{id:"align-right",title:l("toolbar.alignRight"),icon:"align-right"},{id:"align-justify",title:l("toolbar.alignJustify"),icon:"align-justify"},{id:"indent",title:l("toolbar.indent"),icon:"indent"},{id:"outdent",title:l("toolbar.outdent"),icon:"outdent"}]},{name:"lists",buttons:[{id:"list-ul",title:l("toolbar.listUl"),icon:"list-ul"},{id:"list-ol",title:l("toolbar.listOl"),icon:"list-ol"},{id:"list-todo",title:l("toolbar.listTodo"),icon:"list-todo"}]},{name:"media",buttons:[{id:"link",title:l("toolbar.link"),icon:"link"},{id:"image",title:l("toolbar.image"),icon:"image"},{id:"video",title:l("toolbar.video"),icon:"video"},{id:"table",title:l("toolbar.table"),icon:"table"},{id:"columns",title:l("toolbar.columns"),icon:"columns"},{id:"emoji",title:l("toolbar.emoji"),icon:"emoji"}]},{name:"insert",buttons:[{id:"quote",title:l("toolbar.quote"),icon:"quote"},{id:"code",title:l("toolbar.code"),icon:"code"},{id:"hr",title:l("toolbar.hr"),icon:"hr"}]},{name:"action",buttons:[{id:"undo",title:l("toolbar.undo"),icon:"undo"},{id:"redo",title:l("toolbar.redo"),icon:"redo"},{id:"preview",title:l("toolbar.preview"),icon:"preview"},{id:"export-json",title:l("toolbar.exportJson"),icon:"export-json"},{id:"export-pdf",title:l("toolbar.exportPdf"),icon:"export-pdf"},{id:"export-html",title:l("toolbar.exportHtml"),icon:"export-html"},{id:"toolbar-config",title:l("toolbar.config"),icon:"settings"}]}].forEach(n=>{const o=document.createElement("div");o.className="nge-toolbar-group",o.setAttribute("data-group",n.name),n.buttons.forEach(t=>{if(c(t.id,e))if("list-ol"===t.id){const e=document.createElement("div");e.className="nge-toolbar-select-with-icon",e.setAttribute("title",l("toolbar.listOl"));const t=document.createElement("span");t.className="nge-icon nge-icon-list-ol",e.appendChild(t);const n=m({id:"list-ol",title:l("toolbar.listOl"),options:[{value:"decimal",label:l("toolbar.listStyleDecimal")},{value:"lower-alpha",label:l("toolbar.listStyleLowerAlpha")},{value:"upper-alpha",label:l("toolbar.listStyleUpperAlpha")},{value:"upper-roman",label:l("toolbar.listStyleUpperRoman")},{value:"lower-greek",label:l("toolbar.listStyleGreek")}],showFontPreview:!1,width:"90px"});e.appendChild(n),o.appendChild(e)}else{const e=g(t);o.appendChild(e)}}),o.children.length>0&&t.appendChild(o)}),t}function g(e){if(!(e&&e.id&&e.title&&e.icon))throw new Error("Invalid toolbar button configuration");const t=document.createElement("button");return t.type="button",t.className="nge-toolbar-button",t.setAttribute("data-command",e.id),t.setAttribute("data-testid",`nge-button-${e.id}`),t.setAttribute("title",e.title),t.setAttribute("aria-label",e.title),t.innerHTML=`<span class="nge-icon nge-icon-${e.icon}"></span>`,t}const p={h1:{fontSize:"18px",fontWeight:"bold"},h2:{fontSize:"16px",fontWeight:"bold"},h3:{fontSize:"14px",fontWeight:"bold"},h4:{fontSize:"13px",fontWeight:"bold"},h5:{fontSize:"12px",fontWeight:"bold"},p:{fontSize:"13px",fontWeight:"normal"}};function m(e){if(!(e&&e.id&&e.title&&e.options))throw new Error("Invalid toolbar select configuration");const t=document.createElement("select");return t.className="nge-toolbar-select",t.setAttribute("data-command",e.id),t.setAttribute("data-testid",`nge-select-${e.id}`),t.setAttribute("title",e.title),t.setAttribute("aria-label",e.title),e.width&&(t.style.width=e.width),e.options.forEach(n=>{const o=document.createElement("option");if(o.value=n.value,o.textContent=n.label,e.showFontPreview&&n.value&&(o.style.fontFamily=n.value),e.showParagraphPreview&&n.value){const e=p[n.value];e&&(o.style.fontSize=e.fontSize,o.style.fontWeight=e.fontWeight)}t.appendChild(o)}),t}function h(e,t){if(!e||!t)throw new Error("Invalid parameters for syncContent");t.value=e.innerHTML||""}const b={bold:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="6" y="18" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="currentColor">B</text>\n  </svg>',italic:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="8" y="18" font-family="Times New Roman, serif" font-size="16" font-style="italic" fill="currentColor">I</text>\n  </svg>',underline:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="6" y="16" font-family="Arial, sans-serif" font-size="14" fill="currentColor">U</text>\n    <path d="M6 19h12" stroke="currentColor" stroke-width="1.5"/>\n  </svg>',strikethrough:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="7" y="17" font-family="Arial, sans-serif" font-size="14" fill="currentColor">S</text>\n    <path d="M5 12h14" stroke="currentColor" stroke-width="1.5"/>\n  </svg>',"align-left":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 5h16M4 9h10M4 13h16M4 17h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"align-center":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 5h16M7 9h10M4 13h16M7 17h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"align-right":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 5h16M10 9h10M4 13h16M10 17h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"align-justify":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 5h16M4 9h16M4 13h16M4 17h16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"list-ul":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <circle cx="5" cy="6" r="1.5" fill="currentColor"/>\n    <circle cx="5" cy="12" r="1.5" fill="currentColor"/>\n    <circle cx="5" cy="18" r="1.5" fill="currentColor"/>\n    <path d="M10 6h10M10 12h10M10 18h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"list-ol":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="3" y="8" font-family="Arial, sans-serif" font-size="8" fill="currentColor">1.</text>\n    <text x="3" y="14" font-family="Arial, sans-serif" font-size="8" fill="currentColor">2.</text>\n    <text x="3" y="20" font-family="Arial, sans-serif" font-size="8" fill="currentColor">3.</text>\n    <path d="M10 6h10M10 12h10M10 18h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"list-todo":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="3" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M4.5 6l1.5 1.5 3-3" stroke="#22c55e" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <rect x="3" y="9" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <rect x="3" y="15" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M12 6h8M12 12h8M12 18h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',indent:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 5h16M12 9h8M12 13h8M4 17h16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M4 8l4 3.5-4 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n  </svg>',outdent:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 5h16M12 9h8M12 13h8M4 17h16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M8 8l-4 3.5 4 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n  </svg>',link:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M15 7h2a5 5 0 0 1 0 10h-2m-6 0H7a5 5 0 0 1 0-10h2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M8 12h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',image:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="3" y="4" width="18" height="16" rx="2" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <circle cx="8" cy="9" r="2" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M3 16l5-5 4 4 3-3 6 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',video:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M10 8v8l6-4-6-4z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n  </svg>',"text-color":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M5 17l3-8h1l3 8M6 14h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <rect x="4" y="19" width="16" height="2" rx="0.5" fill="currentColor" class="nge-color-indicator"/>\n  </svg>',"bg-color":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M14 3l7 7-9 9H5v-7l9-9z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n    <path d="M5 19l4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <rect x="4" y="20" width="16" height="2" rx="0.5" fill="currentColor" class="nge-color-indicator"/>\n  </svg>',close:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',eyedropper:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M20 4l-1.5 1.5M14 6l4 4M4 20l2-6 8-8 4 4-8 8-6 2z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n    <circle cx="18.5" cy="5.5" r="2.5" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  </svg>',quote:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="3" y="16" font-family="Georgia, serif" font-size="20" fill="currentColor">"</text>\n    <text x="13" y="16" font-family="Georgia, serif" font-size="20" fill="currentColor">"</text>\n  </svg>',hr:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 12h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n  </svg>',code:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M8 6l-5 6 5 6M16 6l5 6-5 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',copy:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="8" y="8" width="12" height="12" rx="1.5" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M16 8V5a1.5 1.5 0 0 0-1.5-1.5H5A1.5 1.5 0 0 0 3.5 5v9.5A1.5 1.5 0 0 0 5 16h3" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  </svg>',gear:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c.26.604.852.997 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n  </svg>',settings:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c.26.604.852.997 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n  </svg>',rotate:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M21 12a9 9 0 1 1-3-6.7L21 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M21 3v5h-5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',table:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M3 9h18M3 15h18M9 3v18M15 3v18" stroke="currentColor" stroke-width="1.5"/>\n  </svg>',columns:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="3" y="3" width="7" height="18" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <rect x="14" y="3" width="7" height="18" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  </svg>',emoji:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <circle cx="9" cy="10" r="1" fill="currentColor"/>\n    <circle cx="15" cy="10" r="1" fill="currentColor"/>\n    <path d="M8 14s1.5 2 4 2 4-2 4-2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"line-height":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M11 6h9M11 12h9M11 18h9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M5 7v10M3 9l2-3 2 3M3 15l2 3 2-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',"text-case":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="2" y="18" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="currentColor">A</text>\n    <text x="12" y="18" font-family="Arial, sans-serif" font-size="11" fill="currentColor">a</text>\n  </svg>',superscript:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="3" y="18" font-family="Arial, sans-serif" font-size="14" fill="currentColor">X</text>\n    <text x="14" y="10" font-family="Arial, sans-serif" font-size="9" fill="currentColor">2</text>\n  </svg>',trash:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',undo:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M3 9h13a5 5 0 0 1 0 10H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M7 5L3 9l4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',redo:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M21 9H8a5 5 0 0 0 0 10h9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M17 5l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',preview:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',"export-json":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <text x="7" y="17" font-family="monospace" font-size="7" font-weight="bold" fill="currentColor">{}</text>\n  </svg>',"export-pdf":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <text x="5" y="17" font-family="sans-serif" font-size="6" font-weight="bold" fill="currentColor">PDF</text>\n  </svg>',"export-html":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <text x="5" y="17" font-family="sans-serif" font-size="6" font-weight="bold" fill="currentColor">HTML</text>\n  </svg>'};function f(){document.querySelectorAll(".nge-icon").forEach(e=>{const t=Array.from(e.classList).find(e=>e.startsWith("nge-icon-"));if(t){const n=t.replace("nge-icon-","");try{const t=function(e){if(!e||"string"!=typeof e)throw new Error("Icon name must be a string");if(!b[e])throw new Error(`Icon "${e}" not found`);return b[e]}(n);t&&(e.innerHTML=t)}catch(e){}}})}function v(e){if(!e||!e.id||!e.title)throw new Error("Invalid modal configuration: id and title are required");const t=document.createElement("div");t.className="nge-modal-overlay",t.setAttribute("data-testid",`nge-modal-overlay-${e.id}`),t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),t.setAttribute("aria-labelledby",`nge-modal-title-${e.id}`);const n=document.createElement("div");n.className="nge-modal",n.setAttribute("data-modal-id",e.id),n.setAttribute("data-testid",`nge-modal-${e.id}`);const o=document.createElement("div");o.className="nge-modal-header";const r=document.createElement("h3");r.className="nge-modal-title",r.id=`nge-modal-title-${e.id}`,r.textContent=e.title;const a=document.createElement("button");a.type="button",a.className="nge-modal-close",a.setAttribute("data-testid",`nge-modal-close-${e.id}`),a.setAttribute("aria-label","Close modal"),a.innerHTML='<span class="nge-icon nge-icon-close">&times;</span>',o.appendChild(r),o.appendChild(a);const l=document.createElement("div");l.className="nge-modal-body",l.setAttribute("data-testid",`nge-modal-body-${e.id}`),e.content&&("string"==typeof e.content?l.innerHTML=e.content:e.content instanceof HTMLElement&&l.appendChild(e.content));const i=document.createElement("div");i.className="nge-modal-footer";return(e.buttons||[{id:"cancel",label:"Cancel",variant:"secondary"},{id:"confirm",label:"OK",variant:"primary"}]).forEach(e=>{const t=document.createElement("button");t.type="button",t.className=`nge-modal-button nge-modal-button-${e.variant||"secondary"}`,t.setAttribute("data-action",e.id),t.setAttribute("data-testid",`nge-modal-button-${e.id}`),t.textContent=e.label,i.appendChild(t)}),n.appendChild(o),n.appendChild(l),n.appendChild(i),t.appendChild(n),t._onClose=e.onClose,t}function w(e){return new Promise((t,n)=>{if(!(e&&e instanceof HTMLElement))return void n(new Error("Invalid modal element"));document.body.appendChild(e),e.offsetHeight,e.classList.add("nge-modal-visible");const o=e.querySelector("input, textarea, select"),r=e.querySelector(".nge-modal-button");o?o.focus():r&&r.focus();const a=e.querySelector(".nge-modal-close");a&&(a.onclick=()=>{C(e),t("close")});e.querySelectorAll(".nge-modal-button").forEach(n=>{n.onclick=()=>{const o=n.getAttribute("data-action");C(e),t(o)}}),e.onclick=n=>{n.target===e&&(C(e),t("overlay"))};const l=n=>{"Escape"===n.key&&(C(e),document.removeEventListener("keydown",l),t("escape"))};document.addEventListener("keydown",l)})}function C(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid modal element");e.classList.remove("nge-modal-visible"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),"function"==typeof e._onClose&&e._onClose()},300)}const y="nge-saved-colors";function x(e,t,n){e=(e%360+360)%360,t=Math.max(0,Math.min(1,t));const o=(n=Math.max(0,Math.min(1,n)))*t,r=o*(1-Math.abs(e/60%2-1)),a=n-o;let l,i,s;return[l,i,s]=e<60?[o,r,0]:e<120?[r,o,0]:e<180?[0,o,r]:e<240?[0,r,o]:e<300?[r,0,o]:[o,0,r],{r:Math.round(255*(l+a)),g:Math.round(255*(i+a)),b:Math.round(255*(s+a))}}function E(e,t,n){e=Math.max(0,Math.min(255,e))/255,t=Math.max(0,Math.min(255,t))/255,n=Math.max(0,Math.min(255,n))/255;const o=Math.max(e,t,n),r=o-Math.min(e,t,n);let a=0;return 0!==r&&(a=o===e?60*((t-n)/r+(t<n?6:0)):o===t?60*((n-e)/r+2):60*((e-t)/r+4)),{h:a,s:0===o?0:r/o,v:o}}function S(e){return e&&"string"==typeof e?(3===(e=e.replace(/^#/,"")).length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),6===e.length&&/^[0-9A-Fa-f]{6}$/.test(e)?{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}:null):null}function k(e,t,n,o){return e=Math.max(0,Math.min(255,Math.round(e))),t=Math.max(0,Math.min(255,Math.round(t))),n=Math.max(0,Math.min(255,Math.round(n))),1===(o=Math.max(0,Math.min(1,o)))?`rgb(${e}, ${t}, ${n})`:`rgba(${e}, ${t}, ${n}, ${o})`}function A(e){if(!e||"string"!=typeof e)return null;if((e=e.trim().toLowerCase()).startsWith("#")){const t=S(e);return t?{...t,a:1}:null}const t=e.match(/^rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d.]+)\s*)?\)$/);return t?{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10),a:void 0!==t[4]?parseFloat(t[4]):1}:null}function L(){try{const e=localStorage.getItem(y);if(e){const t=JSON.parse(e);if(Array.isArray(t))return t.slice(0,8)}}catch(e){}return[]}function T(e){let t=L();t=t.filter(t=>t!==e);try{localStorage.setItem(y,JSON.stringify(t))}catch(e){}return t}function M(e,t={}){const n=document.createElement("div");n.className="nge-color-picker",n.setAttribute("data-testid","nge-color-picker");const o=t.selectedText||"",r="bg-color"===(t.mode||"text-color"),a=t.restrictedColors||[],i=a.length>0,s=o.length>150?o.substring(0,150)+"...":o,d=s?`\n    <div class="nge-cp-text-preview-section">\n      <label class="nge-cp-label">${l("colorPicker.preview")}</label>\n      <div class="nge-cp-text-preview-container" data-testid="nge-cp-text-preview-container">\n        <span class="nge-cp-text-preview" data-testid="nge-cp-text-preview">${function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}(s)}</span>\n      </div>\n    </div>\n  `:"",c=r?`\n    <div class="nge-cp-style-sliders">\n      <div class="nge-cp-slider-group">\n        <label class="nge-cp-label">${l("colorPicker.borderRadius")}</label>\n        <div class="nge-cp-slider-row">\n          <input type="range" class="nge-cp-range nge-cp-border-radius-range" data-testid="nge-cp-border-radius-range" min="0" max="20" value="0" />\n          <span class="nge-cp-slider-value nge-cp-border-radius-value" data-testid="nge-cp-border-radius-value">0px</span>\n        </div>\n      </div>\n      <div class="nge-cp-slider-group">\n        <label class="nge-cp-label">${l("colorPicker.highlightThickness")}</label>\n        <div class="nge-cp-slider-row">\n          <input type="range" class="nge-cp-range nge-cp-padding-range" data-testid="nge-cp-padding-range" min="0" max="10" value="0" />\n          <span class="nge-cp-slider-value nge-cp-padding-value" data-testid="nge-cp-padding-value">0px</span>\n        </div>\n      </div>\n    </div>\n  `:"",u=i?`\n    <div class="nge-cp-restricted-colors" data-testid="nge-cp-restricted-colors">\n      ${a.map(e=>`\n        <div class="nge-cp-restricted-swatch" data-testid="nge-cp-restricted-swatch" data-color="${e}" title="${e}">\n          <div class="nge-cp-restricted-swatch-inner" style="background-color: ${e}"></div>\n        </div>\n      `).join("")}\n    </div>\n  `:"";return n.innerHTML=i?`\n      <div class="nge-cp-main nge-cp-restricted-mode">\n        ${d}\n\n        <div class="nge-cp-restricted-section">\n          ${u}\n        </div>\n\n        ${c}\n\n        <div class="nge-cp-preview-only">\n          <div class="nge-cp-preview-container">\n            <div class="nge-cp-preview-bg"></div>\n            <div class="nge-cp-preview" data-testid="nge-cp-preview"></div>\n          </div>\n          <span class="nge-cp-hex-display" data-testid="nge-cp-hex-display"></span>\n        </div>\n      </div>\n    `:`\n      <div class="nge-cp-main">\n        <div class="nge-cp-spectrum-area">\n          <div class="nge-cp-sv-container">\n            <canvas class="nge-cp-sv-canvas" data-testid="nge-cp-sv-canvas" width="200" height="200"></canvas>\n            <div class="nge-cp-sv-cursor" data-testid="nge-cp-sv-cursor"></div>\n          </div>\n          <div class="nge-cp-hue-container">\n            <canvas class="nge-cp-hue-canvas" data-testid="nge-cp-hue-canvas" width="24" height="200"></canvas>\n            <div class="nge-cp-hue-cursor" data-testid="nge-cp-hue-cursor"></div>\n          </div>\n        </div>\n\n        <div class="nge-cp-alpha-container">\n          <label class="nge-cp-label">${l("colorPicker.transparency")}</label>\n          <div class="nge-cp-alpha-slider-container">\n            <div class="nge-cp-alpha-bg"></div>\n            <canvas class="nge-cp-alpha-canvas" data-testid="nge-cp-alpha-canvas" width="200" height="16"></canvas>\n            <div class="nge-cp-alpha-cursor" data-testid="nge-cp-alpha-cursor"></div>\n          </div>\n          <span class="nge-cp-alpha-value" data-testid="nge-cp-alpha-value">100%</span>\n        </div>\n\n        ${d}\n\n        ${c}\n\n        <div class="nge-cp-inputs-row">\n          <div class="nge-cp-preview-eyedropper">\n            <div class="nge-cp-preview-container">\n              <div class="nge-cp-preview-bg"></div>\n              <div class="nge-cp-preview" data-testid="nge-cp-preview"></div>\n            </div>\n            <button type="button" class="nge-cp-eyedropper-btn" data-testid="nge-cp-eyedropper-btn" title="${l("colorPicker.eyedropper")}">${b.eyedropper}</button>\n          </div>\n          <div class="nge-cp-inputs">\n            <div class="nge-cp-input-group nge-cp-hex-group">\n              <label class="nge-cp-input-label">Hex</label>\n              <input type="text" class="nge-cp-input nge-cp-hex-input" data-testid="nge-cp-hex-input" maxlength="7" placeholder="#000000" />\n            </div>\n            <div class="nge-cp-rgb-inputs">\n              <div class="nge-cp-input-group">\n                <label class="nge-cp-input-label">R</label>\n                <input type="number" class="nge-cp-input nge-cp-r-input" data-testid="nge-cp-r-input" min="0" max="255" />\n              </div>\n              <div class="nge-cp-input-group">\n                <label class="nge-cp-input-label">G</label>\n                <input type="number" class="nge-cp-input nge-cp-g-input" data-testid="nge-cp-g-input" min="0" max="255" />\n              </div>\n              <div class="nge-cp-input-group">\n                <label class="nge-cp-input-label">B</label>\n                <input type="number" class="nge-cp-input nge-cp-b-input" data-testid="nge-cp-b-input" min="0" max="255" />\n              </div>\n              <div class="nge-cp-input-group">\n                <label class="nge-cp-input-label">A%</label>\n                <input type="number" class="nge-cp-input nge-cp-a-input" data-testid="nge-cp-a-input" min="0" max="100" />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="nge-cp-saved">\n        <div class="nge-cp-saved-header">\n          <label class="nge-cp-label">${l("colorPicker.savedColors")}</label>\n          <button type="button" class="nge-cp-save-btn" data-testid="nge-cp-save-btn" title="${l("colorPicker.saveColor")}">+</button>\n        </div>\n        <div class="nge-cp-saved-colors" data-testid="nge-cp-saved-colors"></div>\n      </div>\n    `,n}function N(e,t,n){const o=L();if(e.innerHTML="",o.forEach(o=>{const r=document.createElement("div");r.className="nge-cp-saved-swatch",r.setAttribute("data-testid","nge-cp-saved-swatch"),r.setAttribute("data-color",o),r.title=o;const a=document.createElement("div");a.className="nge-cp-saved-swatch-inner",a.style.backgroundColor=o,r.appendChild(a);const i=document.createElement("button");i.type="button",i.className="nge-cp-saved-remove",i.setAttribute("data-testid","nge-cp-saved-remove"),i.innerHTML="&times;",i.title=l("colorPicker.remove"),r.appendChild(i),r.addEventListener("click",e=>{e.target.classList.contains("nge-cp-saved-remove")||t(o)}),i.addEventListener("click",e=>{e.stopPropagation(),n(o)}),e.appendChild(r)}),0===o.length){const t=document.createElement("span");t.className="nge-cp-saved-empty",t.textContent=l("colorPicker.noSavedColors"),e.appendChild(t)}}function R(e={}){const t=e.title||l("colorPicker.title"),n=!1!==e.showAlpha,o=e.selectedText||"",r=e.mode||"text-color",a="bg-color"===r,i=e.textColor||"#212529",s=e.bgColor||null,d=e.textStyles||{},c=e.initialBorderRadius||0,u=e.initialPadding||0,g=e.restrictedColors||[],p=g.length>0;let m=A(e.initialColor);m||(m={r:0,g:0,b:0,a:1});const h=E(m.r,m.g,m.b),b={h:h.h,s:h.s,v:h.v,a:m.a,borderRadius:c,padding:u},f=M(0,{selectedText:o,mode:r,restrictedColors:g}),C=v({id:"color-picker",title:t,content:f,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:l("modal.apply"),variant:"primary"}]}),R=f.querySelector(".nge-cp-sv-canvas"),I=f.querySelector(".nge-cp-sv-cursor"),q=f.querySelector(".nge-cp-hue-canvas"),$=f.querySelector(".nge-cp-hue-cursor"),D=f.querySelector(".nge-cp-alpha-container"),B=f.querySelector(".nge-cp-alpha-canvas"),z=f.querySelector(".nge-cp-alpha-cursor"),H=f.querySelector(".nge-cp-alpha-value"),F=f.querySelector(".nge-cp-preview"),j=f.querySelector(".nge-cp-hex-input"),P=f.querySelector(".nge-cp-r-input"),W=f.querySelector(".nge-cp-g-input"),O=f.querySelector(".nge-cp-b-input"),V=f.querySelector(".nge-cp-a-input"),U=f.querySelector(".nge-cp-save-btn"),G=f.querySelector(".nge-cp-saved-colors"),_=f.querySelector(".nge-cp-eyedropper-btn"),J=f.querySelector(".nge-cp-hex-display"),K=f.querySelectorAll(".nge-cp-restricted-swatch"),Z=f.querySelector(".nge-cp-text-preview"),X=f.querySelector(".nge-cp-text-preview-container"),Y=f.querySelector(".nge-cp-border-radius-range"),Q=f.querySelector(".nge-cp-border-radius-value"),ee=f.querySelector(".nge-cp-padding-range"),te=f.querySelector(".nge-cp-padding-value");Y&&Q&&(Y.value=c,Q.textContent=c+"px"),ee&&te&&(ee.value=u,te.textContent=u+"px"),!p&&!n&&D&&V&&(D.style.display="none",V.parentElement.style.display="none",b.a=1),p&&(b.a=1);const ne="undefined"!=typeof window&&"EyeDropper"in window;!ne&&_&&(_.disabled=!0,_.title=l("colorPicker.eyedropperUnavailable"));const oe=R?R.getContext("2d"):null,re=q?q.getContext("2d"):null,ae=B?B.getContext("2d"):null;function le(){const e=x(b.h,b.s,b.v),t=function(e,t,n){const o=e=>{const t=Math.max(0,Math.min(255,Math.round(e))).toString(16);return 1===t.length?"0"+t:t};return"#"+o(e)+o(t)+o(n)}(e.r,e.g,e.b),o=k(e.r,e.g,e.b,b.a);if(F&&(F.style.backgroundColor=o),J&&(J.textContent=t),p&&K.forEach(e=>{const n=e.getAttribute("data-color");n&&n.toUpperCase()===t.toUpperCase()?e.classList.add("nge-cp-swatch-selected"):e.classList.remove("nge-cp-swatch-selected")}),!p){if(oe&&R&&function(e,t,n,o){const r=x(o,1,1),a=e.createLinearGradient(0,0,t,0);a.addColorStop(0,"#ffffff"),a.addColorStop(1,`rgb(${r.r}, ${r.g}, ${r.b})`),e.fillStyle=a,e.fillRect(0,0,t,n);const l=e.createLinearGradient(0,0,0,n);l.addColorStop(0,"rgba(0, 0, 0, 0)"),l.addColorStop(1,"rgba(0, 0, 0, 1)"),e.fillStyle=l,e.fillRect(0,0,t,n)}(oe,R.width,R.height,b.h),I&&R){const e=b.s*R.width,t=(1-b.v)*R.height;I.style.left=e+"px",I.style.top=t+"px"}if($&&q){const e=b.h/360*q.height;$.style.top=e+"px"}if(n&&ae&&B&&z&&H){!function(e,t,n,o,r,a){e.clearRect(0,0,t,n);const l=e.createLinearGradient(0,0,t,0);l.addColorStop(0,`rgba(${o}, ${r}, ${a}, 0)`),l.addColorStop(1,`rgba(${o}, ${r}, ${a}, 1)`),e.fillStyle=l,e.fillRect(0,0,t,n)}(ae,B.width,B.height,e.r,e.g,e.b);const t=B.getBoundingClientRect().width||B.width,n=b.a*t;z.style.left=n+"px",H.textContent=Math.round(100*b.a)+"%"}j&&(j.value=t),P&&(P.value=e.r),W&&(W.value=e.g),O&&(O.value=e.b),V&&(V.value=Math.round(100*b.a))}if(Z&&X)if(Z.style.fontWeight=d.bold?"bold":"normal",Z.style.fontStyle=d.italic?"italic":"normal",Z.style.textDecoration=[d.underline?"underline":"",d.strikethrough?"line-through":""].filter(Boolean).join(" ")||"none",d.fontFamily&&(Z.style.fontFamily=d.fontFamily),d.fontSize&&(Z.style.fontSize=d.fontSize),a){Z.style.backgroundColor=o,Z.style.color=i,Z.style.borderRadius=b.borderRadius+"px";const e=b.borderRadius>0?4:2;Z.style.padding=`${b.padding}px ${e}px`}else Z.style.color=o,Z.style.backgroundColor=s||"transparent",s&&(Z.style.padding="2px 4px",Z.style.borderRadius="3px")}function ie(e,t,n,o){const r=E(e,t,n);b.h=r.h,b.s=r.s,b.v=r.v,void 0!==o&&(b.a=o),le()}function se(){const e=x(b.h,b.s,b.v);return k(e.r,e.g,e.b,b.a)}let de=!1,ce=!1,ue=!1;function ge(e){de&&R&&me(e),ce&&q&&he(e),ue&&B&&be(e)}function pe(){de=!1,ce=!1,ue=!1}function me(e){const t=R.getBoundingClientRect(),n=Math.max(0,Math.min(R.width,e.clientX-t.left)),o=Math.max(0,Math.min(R.height,e.clientY-t.top));b.s=n/R.width,b.v=1-o/R.height,le()}function he(e){const t=q.getBoundingClientRect(),n=Math.max(0,Math.min(q.height,e.clientY-t.top));b.h=n/q.height*360,le()}function be(e){const t=B.getBoundingClientRect(),n=t.width,o=Math.max(0,Math.min(n,e.clientX-t.left));b.a=o/n,le()}if(p)K.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-color");if(t){const e=S(t);e&&ie(e.r,e.g,e.b,1)}})}),le();else{function fe(){ie(parseInt(P.value,10)||0,parseInt(W.value,10)||0,parseInt(O.value,10)||0)}re&&q&&function(e,t,n){const o=e.createLinearGradient(0,0,0,n);[{pos:0,color:"#ff0000"},{pos:.17,color:"#ffff00"},{pos:.33,color:"#00ff00"},{pos:.5,color:"#00ffff"},{pos:.67,color:"#0000ff"},{pos:.83,color:"#ff00ff"},{pos:1,color:"#ff0000"}].forEach(e=>{o.addColorStop(e.pos,e.color)}),e.fillStyle=o,e.fillRect(0,0,t,n)}(re,q.width,q.height),le(),R&&R.addEventListener("mousedown",e=>{de=!0,me(e)}),q&&q.addEventListener("mousedown",e=>{ce=!0,he(e)}),n&&B&&B.addEventListener("mousedown",e=>{ue=!0,be(e)}),document.addEventListener("mousemove",ge),document.addEventListener("mouseup",pe),j&&j.addEventListener("input",()=>{const e=S(j.value);e&&ie(e.r,e.g,e.b)}),P&&P.addEventListener("input",fe),W&&W.addEventListener("input",fe),O&&O.addEventListener("input",fe),V&&V.addEventListener("input",()=>{const e=parseInt(V.value,10)||0;b.a=Math.max(0,Math.min(100,e))/100,le()}),U&&G&&U.addEventListener("click",()=>{!function(e){if(!e||"string"!=typeof e)return L();let t=L();t=t.filter(t=>t!==e),t.unshift(e),t=t.slice(0,8);try{localStorage.setItem(y,JSON.stringify(t))}catch(e){}}(se()),N(G,e=>{const t=A(e);t&&ie(t.r,t.g,t.b,t.a)},e=>{T(e),N(G,e=>{const t=A(e);t&&ie(t.r,t.g,t.b,t.a)},e=>{T(e),N(G,()=>{},()=>{})})})}),ne&&_&&_.addEventListener("click",async()=>{try{const e=new window.EyeDropper,t=await e.open();if(t&&t.sRGBHex){const e=S(t.sRGBHex);e&&ie(e.r,e.g,e.b,b.a)}}catch(e){}}),G&&N(G,e=>{const t=A(e);t&&ie(t.r,t.g,t.b,t.a)},e=>{T(e),N(G,e=>{const t=A(e);t&&ie(t.r,t.g,t.b,t.a)},()=>{})})}return Y&&Q&&Y.addEventListener("input",()=>{b.borderRadius=parseInt(Y.value,10),Q.textContent=b.borderRadius+"px",le()}),ee&&te&&ee.addEventListener("input",()=>{b.padding=parseInt(ee.value,10),te.textContent=b.padding+"px",le()}),w(C).then(e=>{if(document.removeEventListener("mousemove",ge),document.removeEventListener("mouseup",pe),"confirm"===e){const t={action:e,color:se()};return a&&(t.borderRadius=b.borderRadius,t.padding=b.padding),t}throw new Error("Color picker cancelled")})}function I(e={}){const t=function(e={}){const t=document.createElement("div");t.className="nge-link-modal-content";const n=document.createElement("div");n.className="nge-form-group";const o=document.createElement("label");o.className="nge-form-label",o.setAttribute("for","nge-link-url"),o.textContent=l("link.url");const r=document.createElement("input");r.type="url",r.id="nge-link-url",r.className="nge-form-input",r.placeholder=l("link.urlPlaceholder"),r.value=e.url||"",r.setAttribute("data-testid","nge-link-url"),r.required=!0,n.appendChild(o),n.appendChild(r);const a=document.createElement("div");a.className="nge-form-group";const i=document.createElement("label");i.className="nge-form-label",i.setAttribute("for","nge-link-text"),i.textContent=l("link.text");const s=document.createElement("input");s.type="text",s.id="nge-link-text",s.className="nge-form-input",s.placeholder=l("link.textPlaceholder"),s.value=e.text||"",s.setAttribute("data-testid","nge-link-text"),a.appendChild(i),a.appendChild(s);const d=document.createElement("div");d.className="nge-form-group";const c=document.createElement("label");c.className="nge-form-label",c.setAttribute("for","nge-link-title"),c.textContent=l("link.tooltip");const u=document.createElement("input");u.type="text",u.id="nge-link-title",u.className="nge-form-input",u.placeholder=l("link.tooltipPlaceholder"),u.value=e.title||"",u.setAttribute("data-testid","nge-link-title"),d.appendChild(c),d.appendChild(u);const g=document.createElement("div");g.className="nge-form-group nge-checkbox-group";const p=document.createElement("div");p.className="nge-checkbox-wrapper";const m=document.createElement("input");m.type="checkbox",m.id="nge-link-new-window",m.className="nge-form-checkbox",m.checked=e.newWindow||!1,m.setAttribute("data-testid","nge-link-new-window");const h=document.createElement("label");h.className="nge-checkbox-label",h.setAttribute("for","nge-link-new-window"),h.textContent=l("link.newWindow"),p.appendChild(m),p.appendChild(h);const b=document.createElement("div");b.className="nge-checkbox-wrapper";const f=document.createElement("input");f.type="checkbox",f.id="nge-link-nofollow",f.className="nge-form-checkbox",f.checked=e.nofollow||!1,f.setAttribute("data-testid","nge-link-nofollow");const v=document.createElement("label");return v.className="nge-checkbox-label",v.setAttribute("for","nge-link-nofollow"),v.textContent=l("link.nofollow"),b.appendChild(f),b.appendChild(v),g.appendChild(p),g.appendChild(b),t.appendChild(n),t.appendChild(a),t.appendChild(d),t.appendChild(g),t}({...e,text:e.text||e.selectedText||""});return w(v({id:"link-modal",title:l("link.title"),content:t,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:l("link.insert"),variant:"primary"}]})).then(e=>{if("confirm"===e){const e=function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector("#nge-link-url"),n=e.querySelector("#nge-link-text"),o=e.querySelector("#nge-link-title"),r=e.querySelector("#nge-link-new-window"),a=e.querySelector("#nge-link-nofollow");return{url:t?t.value.trim():"",text:n?n.value.trim():"",title:o?o.value.trim():"",newWindow:!!r&&r.checked,nofollow:!!a&&a.checked}}(t),n=function(e){if(!e||"object"!=typeof e)return{isValid:!1,error:l("link.errorInvalid")};if(!e.url)return{isValid:!1,error:l("link.errorRequired")};if(!/^(https?:\/\/|mailto:|tel:|\/|#)/i.test(e.url)){if(!e.url.includes(".")||e.url.includes(" "))return{isValid:!1,error:l("link.errorInvalid")};e.url="https://"+e.url}return{isValid:!0,error:null}}(e);if(!n.isValid)throw new Error(n.error);return{action:"confirm",...e}}throw new Error("Modal cancelled")})}const q=[{id:"classic",name:"Classique",description:"Bordure gauche bleue traditionnelle",styles:{borderLeft:"5px solid #3b82f6",paddingLeft:"20px",paddingTop:"12px",paddingBottom:"12px",marginLeft:"0",marginRight:"0",fontStyle:"italic",color:"#374151",background:"#eff6ff"}},{id:"modern",name:"Moderne",description:"Carte flottante avec accent",styles:{background:"#ffffff",borderRadius:"12px",padding:"24px 28px",marginLeft:"0",marginRight:"0",borderLeft:"6px solid #8b5cf6",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",color:"#1f2937"}},{id:"elegant",name:"Élégant",description:"Guillemets dorés décoratifs",styles:{paddingLeft:"50px",paddingRight:"24px",paddingTop:"16px",paddingBottom:"16px",marginLeft:"0",marginRight:"0",fontStyle:"italic",fontFamily:"Georgia, serif",fontSize:"1.1em",lineHeight:"1.7",color:"#44403c",background:"linear-gradient(to right, #fef3c7, #fefbf3)",borderLeft:"4px solid #d97706",borderRadius:"0 8px 8px 0"}},{id:"minimal",name:"Minimaliste",description:"Épuré avec lignes fines",styles:{textAlign:"center",padding:"32px 48px",marginLeft:"40px",marginRight:"40px",color:"#6b7280",borderLeft:"none",borderTop:"1px solid #e5e7eb",borderBottom:"1px solid #e5e7eb",fontWeight:"300",letterSpacing:"0.025em"}},{id:"boxed",name:"Encadré",description:"Double bordure distinctive",styles:{border:"3px double #059669",borderRadius:"0",padding:"20px 24px",marginLeft:"0",marginRight:"0",background:"#ecfdf5",borderLeft:"3px double #059669",color:"#065f46",fontWeight:"500"}},{id:"shadow",name:"Ombre profonde",description:"Effet carte surélevée",styles:{background:"linear-gradient(145deg, #ffffff 0%, #f9fafb 100%)",padding:"28px 32px",marginLeft:"8px",marginRight:"8px",borderRadius:"16px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04), 0 0 0 1px rgba(0, 0, 0, 0.05)",borderLeft:"none",color:"#111827"}},{id:"gradient",name:"Dégradé vif",description:"Fond coloré dynamique",styles:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"24px 28px",marginLeft:"0",marginRight:"0",borderRadius:"10px",borderLeft:"none",color:"#ffffff",fontWeight:"500",textShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"}},{id:"retro",name:"Rétro",description:"Style machine à écrire",styles:{fontFamily:"Courier New, Courier, monospace",fontSize:"0.95em",padding:"20px 24px",marginLeft:"0",marginRight:"0",background:"#fefce8",border:"2px dashed #ca8a04",borderLeft:"5px solid #ca8a04",color:"#713f12",letterSpacing:"0.05em"}},{id:"academic",name:"Académique",description:"Style citation universitaire",styles:{fontFamily:"Georgia, Times New Roman, serif",fontSize:"1.05em",lineHeight:"2",padding:"20px 48px",marginLeft:"32px",marginRight:"32px",borderLeft:"3px solid #78716c",color:"#1c1917",background:"#fafaf9",textIndent:"2em",textAlign:"justify"}},{id:"callout",name:"Mise en avant",description:"Bloc d'attention coloré",styles:{background:"#fef2f2",padding:"20px 24px 20px 56px",marginLeft:"0",marginRight:"0",borderRadius:"8px",borderLeft:"4px solid #ef4444",color:"#991b1b",position:"relative"}}];function $(){const e=document.createElement("div");e.className="nge-quote-modal-content";const t=document.createElement("p");t.className="nge-quote-instructions",t.textContent=l("quote.selectStyle"),e.appendChild(t);const n=document.createElement("div");n.className="nge-quote-grid",n.setAttribute("data-testid","nge-quote-grid");return q.map(e=>({...e,name:l(`quote.${e.id}`),description:l(`quote.${e.id}Desc`)})).forEach(e=>{const t=function(e){if(!e||!e.id)throw new Error("Invalid template");const t=document.createElement("div");t.className="nge-quote-preview",t.setAttribute("data-template-id",e.id),t.setAttribute("data-testid",`nge-quote-template-${e.id}`);const n=document.createElement("blockquote");n.className="nge-quote-preview-block",Object.assign(n.style,e.styles),n.style.fontSize="11px",n.style.padding="8px 10px",n.style.margin="0",n.textContent="Aperçu du texte...";const o=document.createElement("div");return o.className="nge-quote-preview-label",o.textContent=e.name,t.appendChild(n),t.appendChild(o),t}(e);n.appendChild(t)}),e.appendChild(n),e}function D(e,t){const n=(o=e)&&"string"==typeof o&&q.find(e=>e.id===o)||null;var o;if(!n)throw new Error(`Template "${e}" not found`);const r=Object.entries(n.styles).map(([e,t])=>`${e.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${t}`).join("; "),a=t||l("quote.previewText"),i=l("common.deleteQuote");return`<div class="nge-quote-wrapper" contenteditable="false" data-testid="nge-quote-wrapper"><blockquote style="${r}" data-quote-template="${e}" contenteditable="true">${a}</blockquote><button type="button" class="nge-quote-delete-btn" data-testid="nge-quote-delete-btn" title="${i}" aria-label="${i}"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg></button></div>`}function B(){const e=$(),t=v({id:"quote-modal",title:l("quote.title"),content:e,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:l("quote.insert"),variant:"primary"}]}),n=e.querySelectorAll(".nge-quote-preview");return n.forEach(e=>{e.addEventListener("click",()=>{n.forEach(e=>e.classList.remove("nge-selected")),e.classList.add("nge-selected")})}),n.length>0&&n[0].classList.add("nge-selected"),w(t).then(t=>{if("confirm"===t){const t=function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector(".nge-quote-preview.nge-selected");return t?t.getAttribute("data-template-id"):null}(e);if(!t)throw new Error("No template selected");return{action:"confirm",templateId:t}}throw new Error("Modal cancelled")})}const z=[{id:"simple",name:"Simple",description:"Ligne fine classique",styles:{height:"1px",background:"#dee2e6",border:"none",margin:"16px 0"}},{id:"thick",name:"Épaisse",description:"Ligne épaisse",styles:{height:"4px",background:"#6c757d",border:"none",borderRadius:"2px",margin:"16px 0"}},{id:"double",name:"Double",description:"Double ligne",styles:{height:"6px",background:"transparent",border:"none",borderTop:"2px solid #6c757d",borderBottom:"2px solid #6c757d",margin:"16px 0"}},{id:"dashed",name:"Tirets",description:"Ligne en tirets",styles:{height:"0",background:"transparent",border:"none",borderTop:"2px dashed #6c757d",margin:"16px 0"}},{id:"dotted",name:"Pointillés",description:"Ligne en pointillés",styles:{height:"0",background:"transparent",border:"none",borderTop:"3px dotted #6c757d",margin:"16px 0"}},{id:"gradient",name:"Dégradé",description:"Dégradé bleu",styles:{height:"3px",background:"linear-gradient(90deg, #0d6efd, #6610f2, #0d6efd)",border:"none",borderRadius:"2px",margin:"16px 0"}},{id:"shadow",name:"Ombre",description:"Ligne avec ombre",styles:{height:"2px",background:"#495057",border:"none",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)",margin:"16px 0"}},{id:"ornament",name:"Ornement",description:"Avec symbole central",styles:{width:"100%",height:"20px",background:"transparent",border:"none",margin:"16px 0",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},beforeContent:"─────────────────────────────── ◆ ───────────────────────────────",beforeStyles:{color:"#6c757d",fontSize:"14px",letterSpacing:"0px",fontFamily:"serif",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"clip"}},{id:"wave",name:"Ondulée",description:"Forme ondulée",styles:{width:"100%",height:"20px",background:"transparent",border:"none",margin:"16px 0",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},beforeContent:"∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿",beforeStyles:{color:"#6c757d",fontSize:"20px",lineHeight:"1",letterSpacing:"-2px",whiteSpace:"nowrap"}},{id:"fade",name:"Fondu",description:"Fondu vers les bords",styles:{height:"2px",background:"linear-gradient(90deg, transparent, #6c757d 20%, #6c757d 80%, transparent)",border:"none",margin:"16px 0"}}];function H(e){return e&&"string"==typeof e&&z.find(t=>t.id===e)||null}function F(e,t){if(t>=1)return e;if(e.startsWith("#")){const n=e.slice(1);let o,r,a;return 3===n.length?(o=parseInt(n[0]+n[0],16),r=parseInt(n[1]+n[1],16),a=parseInt(n[2]+n[2],16)):(o=parseInt(n.slice(0,2),16),r=parseInt(n.slice(2,4),16),a=parseInt(n.slice(4,6),16)),`rgba(${o}, ${r}, ${a}, ${t})`}const n=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(n)return`rgba(${n[1]}, ${n[2]}, ${n[3]}, ${t})`;const o=e.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*[\d.]+\)/);return o?`rgba(${o[1]}, ${o[2]}, ${o[3]}, ${t})`:e}function j(e,t){if(t>=1)return{...e};const n={...e},o=n.background||"",r=n.backgroundImage;if(o.includes("gradient")||o.includes("url(")||r?n.opacity=t.toString():n.background&&"transparent"!==n.background&&(n.background=F(n.background,t)),n.borderTop){const e=n.borderTop.match(/^(\d+px\s+\w+\s+)(.+)$/);e&&(n.borderTop=e[1]+F(e[2],t))}if(n.borderBottom){const e=n.borderBottom.match(/^(\d+px\s+\w+\s+)(.+)$/);e&&(n.borderBottom=e[1]+F(e[2],t))}return n}function P(){const e=document.createElement("div");e.className="nge-hr-modal-content";const t=document.createElement("p");t.className="nge-hr-instructions",t.textContent=l("hr.selectStyle"),e.appendChild(t);const n=document.createElement("div");n.className="nge-hr-grid",n.setAttribute("data-testid","nge-hr-grid");z.map(e=>({...e,name:l(`hr.${e.id}`),description:l(`hr.${e.id}Desc`)})).forEach(e=>{const t=function(e,t=1){if(!e||!e.id)throw new Error("Invalid template");const n=document.createElement("div");let o;if(n.className="nge-hr-preview",n.setAttribute("data-template-id",e.id),n.setAttribute("data-testid",`nge-hr-template-${e.id}`),e.beforeContent){if(o=document.createElement("div"),o.className="nge-hr-preview-line nge-hr-ornament",o.textContent=e.beforeContent,e.beforeStyles){const n=j(e.beforeStyles,t);Object.assign(o.style,n)}const n=j(e.styles,t);Object.assign(o.style,n)}else{o=document.createElement("hr"),o.className="nge-hr-preview-line";const n=j(e.styles,t);Object.assign(o.style,n)}o.style.margin="8px 0";const r=document.createElement("div");return r.className="nge-hr-preview-label",r.textContent=e.name,n.appendChild(o),n.appendChild(r),n}(e,1);n.appendChild(t)}),e.appendChild(n);const o=document.createElement("div");o.className="nge-hr-opacity-control";const r=document.createElement("label");r.className="nge-hr-opacity-label",r.setAttribute("for","nge-hr-opacity-slider");const a=document.createElement("span");a.textContent=l("hr.opacity"),r.appendChild(a);const i=document.createElement("span");i.className="nge-hr-opacity-value",i.setAttribute("data-testid","nge-hr-opacity-value"),i.textContent="0%",r.appendChild(i);const s=document.createElement("input");s.type="range",s.id="nge-hr-opacity-slider",s.className="nge-hr-opacity-slider",s.setAttribute("data-testid","nge-hr-opacity-slider"),s.min="0",s.max="100",s.step="5",s.value="0",o.appendChild(r),o.appendChild(s),e.appendChild(o);const d=document.createElement("div");d.className="nge-hr-width-control";const c=document.createElement("label");c.className="nge-hr-width-label",c.setAttribute("for","nge-hr-width-slider");const u=document.createElement("span");u.textContent=l("hr.width"),c.appendChild(u);const g=document.createElement("span");g.className="nge-hr-width-value",g.setAttribute("data-testid","nge-hr-width-value"),g.textContent="100%",c.appendChild(g);const p=document.createElement("input");return p.type="range",p.id="nge-hr-width-slider",p.className="nge-hr-width-slider",p.setAttribute("data-testid","nge-hr-width-slider"),p.min="10",p.max="100",p.step="5",p.value="100",d.appendChild(c),d.appendChild(p),e.appendChild(d),e}function W(e){return Object.entries(e).map(([e,t])=>`${e.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${t}`).join("; ")}function O(){const e=P(),t=v({id:"hr-modal",title:l("hr.title"),content:e,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:l("hr.insert"),variant:"primary"}]}),n=e.querySelectorAll(".nge-hr-preview");n.forEach(e=>{e.addEventListener("click",()=>{n.forEach(e=>e.classList.remove("nge-selected")),e.classList.add("nge-selected")})}),n.length>0&&n[0].classList.add("nge-selected");const o=e.querySelector(".nge-hr-opacity-slider"),r=e.querySelector(".nge-hr-opacity-value"),a=e.querySelector(".nge-hr-width-slider"),i=e.querySelector(".nge-hr-width-value"),s=()=>{const t=1-(o?parseInt(o.value,10):0)/100,n=a?parseInt(a.value,10):100;!function(e,t,n=100){e.querySelectorAll(".nge-hr-preview").forEach(e=>{const o=H(e.getAttribute("data-template-id"));if(o){const r=e.querySelector("hr")||e.querySelector(".nge-hr-ornament");if(r){if(r.style.cssText="",o.beforeContent){if(o.beforeStyles){const e=j(o.beforeStyles,t);Object.assign(r.style,e)}const e=j(o.styles,t);Object.assign(r.style,e)}else{const e=j(o.styles,t);Object.assign(r.style,e)}n<100&&(r.style.width=`${n}%`,r.style.marginLeft="auto",r.style.marginRight="auto"),r.style.margin="8px 0"}}})}(e,t,n)};return o&&o.addEventListener("input",()=>{const e=parseInt(o.value,10);r&&(r.textContent=`${e}%`),s()}),a&&a.addEventListener("input",()=>{const e=parseInt(a.value,10);i&&(i.textContent=`${e}%`),s()}),w(t).then(t=>{if("confirm"===t){const t=function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector(".nge-hr-preview.nge-selected");return t?t.getAttribute("data-template-id"):null}(e);if(!t)throw new Error("No template selected");const n=function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector(".nge-hr-opacity-slider");if(t)return 1-parseInt(t.value,10)/100;return 1}(e),o=function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector(".nge-hr-width-slider");return t?parseInt(t.value,10):100}(e);return{action:"confirm",templateId:t,opacity:n,width:o}}throw new Error("Modal cancelled")})}function V(e){if(!e)return"";const t=e.cloneNode(!0);t.querySelectorAll("br").forEach(e=>{e.replaceWith("\n")});return t.querySelectorAll("div, p").forEach(e=>{e.previousSibling&&e.before("\n")}),t.textContent||""}async function U(e){if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(e),!0}catch{}try{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",t.style.top="0",document.body.appendChild(t),t.focus(),t.select();const n=document.execCommand("copy");return document.body.removeChild(t),n}catch{return!1}}let G=!1;async function _(e){const t=e.target.closest(".nge-code-copy-btn");if(!t)return;e.preventDefault(),e.stopPropagation();const n=t.closest(".nge-code-block");if(!n)return;const o=n.querySelector("pre");if(!o)return;const r=V(o);await U(r)&&(t.classList.add("nge-copied"),t.setAttribute("data-tooltip",l("code.copied")),setTimeout(()=>{t.classList.remove("nge-copied"),t.removeAttribute("data-tooltip")},1500))}function J(){G||"undefined"!=typeof document&&(document.addEventListener("click",_),G=!0)}function K(e={}){const{id:t,testId:n,value:o="#000000",onChange:r}=e,a=function(){try{const e=localStorage.getItem("nge-custom-colors");if(e){const t=JSON.parse(e);if(Array.isArray(t))return t}}catch(e){}return[]}(),l=a.length>0,i=document.createElement("div");if(i.className="nge-color-input-group",l){i.className="nge-color-input-group nge-restricted-color-picker";const e=document.createElement("input");e.type="hidden",e.id=t,n&&e.setAttribute("data-testid",n),e.value=o;const l=document.createElement("button");l.type="button",l.className="nge-restricted-color-trigger",l.setAttribute("data-testid",n?`${n}-trigger`:null);const s=document.createElement("span");s.className="nge-restricted-color-preview",s.style.backgroundColor=o;const d=document.createElement("span");d.className="nge-restricted-color-code",d.textContent=o.toUpperCase();const c=document.createElement("span");c.className="nge-restricted-color-arrow",c.innerHTML="&#9662;",l.appendChild(s),l.appendChild(d),l.appendChild(c);const u=document.createElement("div");u.className="nge-restricted-color-dropdown";const g=document.createElement("div");g.className="nge-restricted-color-grid",a.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="nge-restricted-color-swatch",t.toUpperCase()===o.toUpperCase()&&n.classList.add("selected"),n.style.backgroundColor=t,n.setAttribute("data-color",t),n.setAttribute("title",t),n.addEventListener("click",o=>{o.stopPropagation(),g.querySelectorAll(".nge-restricted-color-swatch").forEach(e=>{e.classList.remove("selected")}),n.classList.add("selected"),e.value=t,s.style.backgroundColor=t,d.textContent=t.toUpperCase(),u.classList.remove("open"),l.classList.remove("open"),r&&r(t)}),g.appendChild(n)}),u.appendChild(g),l.addEventListener("click",e=>{e.stopPropagation();const t=u.classList.contains("open");document.querySelectorAll(".nge-restricted-color-dropdown.open").forEach(e=>{e.classList.remove("open"),e.previousElementSibling?.classList.remove("open")}),t||(u.classList.add("open"),l.classList.add("open"))});const p=e=>{i.contains(e.target)||(u.classList.remove("open"),l.classList.remove("open"))};document.addEventListener("click",p),i._cleanup=()=>{document.removeEventListener("click",p)},i.appendChild(e),i.appendChild(l),i.appendChild(u),i._getValue=()=>e.value,i._setValue=t=>{e.value=t,s.style.backgroundColor=t,d.textContent=t.toUpperCase(),g.querySelectorAll(".nge-restricted-color-swatch").forEach(e=>{e.classList.toggle("selected",e.getAttribute("data-color").toUpperCase()===t.toUpperCase())})}}else{const e=document.createElement("input");e.type="color",e.id=t,e.className="nge-color-picker",n&&e.setAttribute("data-testid",n),e.value=o;const a=document.createElement("input");a.type="text",a.id=`${t}-hex`,a.className="nge-input nge-color-hex",n&&a.setAttribute("data-testid",`${n}-hex`),a.value=o.toUpperCase(),e.addEventListener("input",()=>{a.value=e.value.toUpperCase(),r&&r(e.value)}),a.addEventListener("input",()=>{/^#[0-9A-Fa-f]{6}$/.test(a.value)&&(e.value=a.value,r&&r(a.value))}),i.appendChild(e),i.appendChild(a),i._getValue=()=>e.value,i._setValue=t=>{e.value=t,a.value=t.toUpperCase()}}return i}"undefined"!=typeof document&&"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",J):J());const Z={src:"",width:300,height:"auto",rotation:0,opacity:100,wrap:"block",align:"center",keepAspectRatio:!0,borderStyle:"none",borderWidth:0,borderColor:"#000000",borderRadius:0};function X(e={}){const t={...Z,...e},n=document.createElement("div");n.className="nge-image-modal-content";const o=document.createElement("div");o.className="nge-form-group";const r=document.createElement("label");r.className="nge-form-label",r.textContent=l("image.source");const a=document.createElement("div");a.className="nge-image-url-group";const i=document.createElement("input");i.type="url",i.id="nge-image-url",i.className="nge-form-input",i.placeholder=l("image.urlPlaceholder"),i.value=t.src&&!t.src.startsWith("data:")?t.src:"",i.setAttribute("data-testid","nge-image-url"),t.src&&t.src.startsWith("data:")&&(n.dataset.base64Src=t.src),a.appendChild(i);const s=document.createElement("div");s.className="nge-image-separator",s.textContent="—";const d=document.createElement("div");d.className="nge-image-file-group";const c=document.createElement("div");c.className="nge-image-dropzone",c.id="nge-image-dropzone",c.setAttribute("data-testid","nge-image-dropzone");const u=document.createElement("input");u.type="file",u.id="nge-image-file",u.className="nge-form-file",u.accept="image/*",u.setAttribute("data-testid","nge-image-file");const g=document.createElement("label");g.className="nge-file-label",g.setAttribute("for","nge-image-file"),g.textContent=l("image.chooseFile");const p=document.createElement("span");p.className="nge-dropzone-text",p.textContent=l("image.dragDrop");const m=document.createElement("span");m.className="nge-file-name",m.id="nge-image-file-name",m.textContent="",c.appendChild(u),c.appendChild(g),c.appendChild(p),c.appendChild(m),d.appendChild(c),o.appendChild(r),o.appendChild(a),o.appendChild(s),o.appendChild(d);const h=document.createElement("div");h.className="nge-form-group";const b=document.createElement("label");b.className="nge-form-label",b.textContent=l("image.preview");const f=document.createElement("div");f.className="nge-image-preview",f.id="nge-image-preview",f.setAttribute("data-testid","nge-image-preview");const v=document.createElement("img");v.id="nge-image-preview-img",v.className="nge-image-preview-img",v.setAttribute("data-testid","nge-image-preview-img"),v.style.display="none";const w=document.createElement("div");w.className="nge-image-preview-placeholder",w.id="nge-image-preview-placeholder",w.textContent=l("image.noImage"),f.appendChild(v),f.appendChild(w),h.appendChild(b),h.appendChild(f);const C=document.createElement("div");C.className="nge-form-group nge-image-dimensions";const y=document.createElement("div");y.className="nge-dimension-group";const x=document.createElement("label");x.className="nge-form-label",x.setAttribute("for","nge-image-width"),x.textContent=l("image.width");const E=document.createElement("input");E.type="number",E.id="nge-image-width",E.className="nge-form-input",E.min="1",E.max="2000",E.value=t.width,E.setAttribute("data-testid","nge-image-width"),y.appendChild(x),y.appendChild(E);const S=document.createElement("div");S.className="nge-dimension-group";const k=document.createElement("label");k.className="nge-form-label",k.setAttribute("for","nge-image-height"),k.textContent=l("image.height");const A=document.createElement("input");A.type="text",A.id="nge-image-height",A.className="nge-form-input",A.placeholder="auto",A.value="auto"===t.height?"":t.height,A.setAttribute("data-testid","nge-image-height"),S.appendChild(k),S.appendChild(A),C.appendChild(y),C.appendChild(S);const L=document.createElement("div");L.className="nge-form-group nge-checkbox-wrapper";const T=document.createElement("input");T.type="checkbox",T.id="nge-image-aspect-ratio",T.className="nge-form-checkbox",T.checked=t.keepAspectRatio,T.setAttribute("data-testid","nge-image-aspect-ratio");const M=document.createElement("label");M.className="nge-checkbox-label",M.setAttribute("for","nge-image-aspect-ratio"),M.textContent=l("image.keepRatio"),L.appendChild(T),L.appendChild(M);const N=document.createElement("div");N.className="nge-form-group";const R=document.createElement("label");R.className="nge-form-label",R.setAttribute("for","nge-image-rotation"),R.textContent=l("image.rotation");const I=document.createElement("div");I.className="nge-range-container";const q=document.createElement("input");q.type="range",q.id="nge-image-rotation",q.className="nge-range-input",q.min="0",q.max="360",q.step="1",q.value=t.rotation,q.setAttribute("data-testid","nge-image-rotation");const $=document.createElement("span");$.className="nge-range-value",$.id="nge-image-rotation-value",$.textContent=`${t.rotation}°`,I.appendChild(q),I.appendChild($),N.appendChild(R),N.appendChild(I);const D=document.createElement("div");D.className="nge-form-group";const B=document.createElement("label");B.className="nge-form-label",B.textContent=l("image.wrapping");const z=document.createElement("div");z.className="nge-radio-group",z.setAttribute("data-testid","nge-image-wrap-group");[{value:"block",label:l("image.wrapBlock")},{value:"left",label:l("image.wrapLeft")},{value:"right",label:l("image.wrapRight")}].forEach(e=>{const n=document.createElement("div");n.className="nge-radio-wrapper";const o=document.createElement("input");o.type="radio",o.name="nge-image-wrap",o.id=`nge-image-wrap-${e.value}`,o.className="nge-form-radio",o.value=e.value,o.checked=t.wrap===e.value,o.setAttribute("data-testid",`nge-image-wrap-${e.value}`);const r=document.createElement("label");r.className="nge-radio-label",r.setAttribute("for",`nge-image-wrap-${e.value}`),r.textContent=e.label,n.appendChild(o),n.appendChild(r),z.appendChild(n)}),D.appendChild(B),D.appendChild(z);const H=document.createElement("div");H.className="nge-form-group";const F=document.createElement("label");F.className="nge-form-label",F.textContent=l("image.alignment");const j=document.createElement("div");j.className="nge-radio-group nge-radio-group-horizontal",j.setAttribute("data-testid","nge-image-align-group");[{value:"left",label:l("image.alignLeft")},{value:"center",label:l("image.alignCenter")},{value:"right",label:l("image.alignRight")}].forEach(e=>{const n=document.createElement("div");n.className="nge-radio-wrapper";const o=document.createElement("input");o.type="radio",o.name="nge-image-align",o.id=`nge-image-align-${e.value}`,o.className="nge-form-radio",o.value=e.value,o.checked=t.align===e.value,o.setAttribute("data-testid",`nge-image-align-${e.value}`);const r=document.createElement("label");r.className="nge-radio-label",r.setAttribute("for",`nge-image-align-${e.value}`),r.textContent=e.label,n.appendChild(o),n.appendChild(r),j.appendChild(n)}),H.appendChild(F),H.appendChild(j);const P=document.createElement("div");P.className="nge-form-group";const W=document.createElement("label");W.className="nge-form-label",W.setAttribute("for","nge-image-opacity"),W.textContent=l("image.opacity");const O=document.createElement("div");O.className="nge-range-container";const V=document.createElement("input");V.type="range",V.id="nge-image-opacity",V.className="nge-range-input",V.min="0",V.max="100",V.step="1",V.value=t.opacity,V.setAttribute("data-testid","nge-image-opacity");const U=document.createElement("span");U.className="nge-range-value",U.id="nge-image-opacity-value",U.textContent=`${t.opacity}%`,O.appendChild(V),O.appendChild(U),P.appendChild(W),P.appendChild(O);const G=document.createElement("div");G.className="nge-form-group nge-border-section";const _=document.createElement("label");_.className="nge-form-label",_.textContent=l("image.border"),G.appendChild(_);const J=document.createElement("div");J.className="nge-border-options";const X=document.createElement("div");X.className="nge-border-option-group";const ee=document.createElement("label");ee.className="nge-form-label-small",ee.setAttribute("for","nge-image-border-style"),ee.textContent=l("image.borderStyle");const te=document.createElement("select");te.id="nge-image-border-style",te.className="nge-form-select",te.setAttribute("data-testid","nge-image-border-style");[{value:"none",label:l("image.borderNone")},{value:"solid",label:l("image.borderSolid")},{value:"dashed",label:l("image.borderDashed")},{value:"dotted",label:l("image.borderDotted")},{value:"double",label:l("image.borderDouble")},{value:"groove",label:l("image.borderGroove")},{value:"ridge",label:l("image.borderRidge")},{value:"inset",label:l("image.borderInset")},{value:"outset",label:l("image.borderOutset")}].forEach(e=>{const n=document.createElement("option");n.value=e.value,n.textContent=e.label,e.value===t.borderStyle&&(n.selected=!0),te.appendChild(n)}),X.appendChild(ee),X.appendChild(te);const ne=document.createElement("div");ne.className="nge-border-option-group";const oe=document.createElement("label");oe.className="nge-form-label-small",oe.setAttribute("for","nge-image-border-width"),oe.textContent=l("image.borderWidth");const re=document.createElement("input");re.type="number",re.id="nge-image-border-width",re.className="nge-form-input nge-form-input-small",re.min="0",re.max="20",re.value=t.borderWidth,re.setAttribute("data-testid","nge-image-border-width"),ne.appendChild(oe),ne.appendChild(re);const ae=document.createElement("div");ae.className="nge-border-option-group";const le=document.createElement("label");le.className="nge-form-label-small",le.setAttribute("for","nge-image-border-color"),le.textContent=l("image.borderColor");const ie=K({id:"nge-image-border-color",testId:"nge-image-border-color",value:t.borderColor});ae.appendChild(le),ae.appendChild(ie);const se=document.createElement("div");se.className="nge-border-option-group";const de=document.createElement("label");de.className="nge-form-label-small",de.setAttribute("for","nge-image-border-radius"),de.textContent=l("image.borderRadius");const ce=document.createElement("input");return ce.type="number",ce.id="nge-image-border-radius",ce.className="nge-form-input nge-form-input-small",ce.min="0",ce.max="100",ce.value=t.borderRadius,ce.setAttribute("data-testid","nge-image-border-radius"),se.appendChild(de),se.appendChild(ce),J.appendChild(X),J.appendChild(ne),J.appendChild(ae),J.appendChild(se),G.appendChild(J),n.appendChild(o),n.appendChild(h),n.appendChild(C),n.appendChild(L),n.appendChild(N),n.appendChild(D),n.appendChild(H),n.appendChild(P),n.appendChild(G),function(e,t){const n=e.querySelector("#nge-image-url"),o=e.querySelector("#nge-image-file"),r=e.querySelector("#nge-image-file-name"),a=e.querySelector("#nge-image-dropzone"),i=e.querySelector("#nge-image-width"),s=e.querySelector("#nge-image-height"),d=e.querySelector("#nge-image-aspect-ratio"),c=e.querySelector("#nge-image-rotation"),u=e.querySelector("#nge-image-rotation-value"),g=e.querySelector("#nge-image-opacity"),p=e.querySelector("#nge-image-opacity-value"),m=e.querySelector("#nge-image-border-style"),h=e.querySelector("#nge-image-border-width"),b=e.querySelector("#nge-image-border-color"),f=e.querySelector("#nge-image-border-radius");let v=t.naturalWidth||0,w=t.naturalHeight||0;function C(){return{borderStyle:m?m.value:"none",borderWidth:h&&parseInt(h.value,10)||0,borderColor:b?b.value:"#000000",borderRadius:f&&parseInt(f.value,10)||0}}async function y(t){if(t&&t.type.startsWith("image/")){r.textContent=t.name,n.value="";try{const n=await function(e){return new Promise((t,n)=>{if(!(e&&e instanceof File))return void n(new Error("Invalid file"));const o=new FileReader;o.onload=()=>t(o.result),o.onerror=()=>n(new Error("Failed to read file")),o.readAsDataURL(e)})}(t);Y(e,n,c.value,g.value),e.dataset.base64Src=n;const o=new Image;o.onload=()=>{v=o.naturalWidth,w=o.naturalHeight},o.src=n}catch(e){r.textContent=l("image.readError")}}else r.textContent=l("image.invalidFile")}let x=null;n.addEventListener("input",()=>{clearTimeout(x),x=setTimeout(()=>{const t=n.value.trim();if(t){o.value="",r.textContent="",Y(e,t,c.value,g.value);const n=new Image;n.onload=()=>{v=n.naturalWidth,w=n.naturalHeight},n.src=t}},500)}),o.addEventListener("change",async()=>{const e=o.files[0];e&&await y(e)}),a.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation(),a.classList.add("nge-dropzone-dragover")}),a.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),a.classList.remove("nge-dropzone-dragover")}),a.addEventListener("drop",async e=>{e.preventDefault(),e.stopPropagation(),a.classList.remove("nge-dropzone-dragover");const t=e.dataTransfer.files;t.length>0&&await y(t[0])}),i.addEventListener("input",()=>{if(d.checked&&v&&w){const e=parseInt(i.value,10);if(!isNaN(e)&&e>0){const t=w/v;s.value=Math.round(e*t)}}}),s.addEventListener("input",()=>{if(d.checked&&v&&w){const e=parseInt(s.value,10);if(!isNaN(e)&&e>0){const t=v/w;i.value=Math.round(e*t)}}}),c.addEventListener("input",()=>{u.textContent=`${c.value}°`,Q(e,c.value,g.value,C())}),g.addEventListener("input",()=>{p.textContent=`${g.value}%`,Q(e,c.value,g.value,C())}),m&&m.addEventListener("change",()=>{Q(e,c.value,g.value,C())});h&&h.addEventListener("input",()=>{Q(e,c.value,g.value,C())});b&&b.addEventListener("input",()=>{Q(e,c.value,g.value,C())});f&&f.addEventListener("input",()=>{Q(e,c.value,g.value,C())})}(n,t),t.src&&Y(n,t.src,t.rotation,t.opacity),n}function Y(e,t,n,o){const r=e.querySelector("#nge-image-preview-img"),a=e.querySelector("#nge-image-preview-placeholder"),i=e.querySelector("#nge-image-border-style"),s=e.querySelector("#nge-image-border-width"),d=e.querySelector("#nge-image-border-color"),c=e.querySelector("#nge-image-border-radius"),u={borderStyle:i?i.value:"none",borderWidth:s&&parseInt(s.value,10)||0,borderColor:d?d.value:"#000000",borderRadius:c&&parseInt(c.value,10)||0};if(!t)return r.style.display="none",void(a.style.display="block");r.onload=()=>{r.style.display="block",a.style.display="none",Q(e,n,o,u)},r.onerror=()=>{r.style.display="none",a.style.display="block",a.textContent=l("image.invalidImage")},r.src=t}function Q(e,t,n,o={}){const r=e.querySelector("#nge-image-preview-img");if(r){r.style.transform=`rotate(${t}deg)`,r.style.opacity=n/100;const{borderStyle:e="none",borderWidth:a=0,borderColor:l="#000000",borderRadius:i=0}=o;r.style.border=e&&"none"!==e&&a>0?`${a}px ${e} ${l}`:"none",r.style.borderRadius=i>0?`${i}px`:"0"}}function ee(e={}){const t=X(e),n=e.src?l("image.editImage"):l("modal.insert");return w(v({id:"image-modal",title:e.src?l("image.editTitle"):l("image.title"),content:t,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:n,variant:"primary"}]})).then(e=>{if("confirm"===e){const e=function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector("#nge-image-url"),n=e.querySelector("#nge-image-width"),o=e.querySelector("#nge-image-height"),r=e.querySelector("#nge-image-aspect-ratio"),a=e.querySelector("#nge-image-rotation"),l=e.querySelector("#nge-image-opacity"),i=e.querySelector('input[name="nge-image-wrap"]:checked'),s=e.querySelector('input[name="nge-image-align"]:checked'),d=e.querySelector("#nge-image-border-style"),c=e.querySelector("#nge-image-border-width"),u=e.querySelector("#nge-image-border-color"),g=e.querySelector("#nge-image-border-radius");let p=t?t.value.trim():"";e.dataset.base64Src&&(p=e.dataset.base64Src);const m=o?o.value.trim():"";return{src:p,width:n&&parseInt(n.value,10)||Z.width,height:m&&parseInt(m,10)||"auto",rotation:a?parseInt(a.value,10):Z.rotation,opacity:l?parseInt(l.value,10):Z.opacity,wrap:i?i.value:Z.wrap,align:s?s.value:Z.align,keepAspectRatio:r?r.checked:Z.keepAspectRatio,borderStyle:d?d.value:Z.borderStyle,borderWidth:c?parseInt(c.value,10)||0:Z.borderWidth,borderColor:u?u.value:Z.borderColor,borderRadius:g?parseInt(g.value,10)||0:Z.borderRadius}}(t),n=function(e){return e&&"object"==typeof e?e.src?{isValid:!0,error:null}:{isValid:!1,error:"Une source d'image est requise"}:{isValid:!1,error:"Valeurs invalides"}}(e);if(!n.isValid)throw new Error(n.error);return{action:"confirm",...e}}throw new Error("Modal cancelled")})}function te(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onRotate callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-image-rotate-btn");if(!n)return;e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-image-wrapper");if(o){const e=function(e){if(!e||!e.classList.contains("nge-image-wrapper"))return 0;const t=e.querySelector("img");if(!t)return 0;const n=((parseInt(e.dataset.rotation,10)||0)+90)%360;return e.dataset.rotation=n,t.style.transform=`rotate(${n}deg)`,n}(o);t(o,e)}})}const ne=["nw","n","ne","e","se","s","sw","w"],oe=["nw","ne","se","sw"];let re=null,ae=null,le=null;function ie(e){e&&e.classList.contains("nge-image-wrapper")&&(re&&re!==e&&se(re),function(e){if(!e||!e.classList.contains("nge-image-wrapper"))throw new Error("Invalid wrapper element");let t=e.querySelector(".nge-resize-handles");t||(t=document.createElement("div"),t.className="nge-resize-handles",t.setAttribute("data-testid","nge-resize-handles"),ne.forEach(e=>{const n=document.createElement("div");n.className=`nge-resize-handle nge-resize-handle-${e}`,n.setAttribute("data-handle",e),n.setAttribute("data-testid",`nge-resize-handle-${e}`),t.appendChild(n)}),oe.forEach(e=>{const n=document.createElement("div");n.className=`nge-rotate-handle nge-rotate-handle-${e}`,n.setAttribute("data-rotate",e),n.setAttribute("data-testid",`nge-rotate-handle-${e}`),t.appendChild(n)}),e.appendChild(t))}(e),e.classList.add("nge-image-selected"),re=e)}function se(e){e&&(e.classList.remove("nge-image-selected"),re===e&&(re=null))}function de(e,t,n){if(!ae)return null;const o=e-ae.startX,r=t-ae.startY,a=function(e,t,n,o,r,a){let l=t,i=n;const s=t/n;switch(e){case"e":l=t+o,a&&(i=l/s);break;case"w":l=t-o,a&&(i=l/s);break;case"s":i=n+r,a&&(l=i*s);break;case"n":i=n-r,a&&(l=i*s);break;case"se":a?(l=t+Math.max(o,r),i=l/s):(l=t+o,i=n+r);break;case"sw":a?(l=t+Math.max(-o,r),i=l/s):(l=t-o,i=n+r);break;case"ne":a?(l=t+Math.max(o,-r),i=l/s):(l=t+o,i=n-r);break;case"nw":a?(l=t+Math.max(-o,-r),i=l/s):(l=t-o,i=n-r)}return l=Math.max(20,l),i=Math.max(20,i),{width:Math.round(l),height:Math.round(i)}}(ae.handle,ae.startWidth,ae.startHeight,o,r,n);return function(e,t,n){if(!e||!e.classList.contains("nge-image-wrapper"))return;const o=e.querySelector("img");o&&(e.dataset.width=t,e.dataset.height=n,o.style.width=`${t}px`,o.style.height=`${n}px`)}(ae.wrapper,a.width,a.height),a}function ce(e,t,n){const o=e.getBoundingClientRect(),r=t-(o.left+o.width/2),a=n-(o.top+o.height/2);let l=Math.atan2(a,r)*(180/Math.PI);return l=(l+90+360)%360,l}function ue(e,t,n){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onResize callback is required");e.addEventListener("click",e=>{const t=e.target.closest(".nge-image-wrapper");if(t){if(e.target.closest(".nge-image-edit-btn")||e.target.closest(".nge-image-rotate-btn"))return;e.preventDefault(),e.stopPropagation(),ie(t)}}),e.addEventListener("mousedown",e=>{const n=e.target.closest(".nge-resize-handle");if(!n)return;const o=n.closest(".nge-image-wrapper");if(!o)return;e.preventDefault(),e.stopPropagation();!function(e,t,n,o){if(!e||!ne.includes(t))return null;const r=e.querySelector("img");r&&(ae={wrapper:e,handle:t,startX:n,startY:o,startWidth:parseInt(e.dataset.width,10)||r.offsetWidth,startHeight:parseInt(e.dataset.height,10)||r.offsetHeight},e.classList.add("nge-image-resizing"),document.body.classList.add("nge-resizing"))}(o,n.getAttribute("data-handle"),e.clientX,e.clientY);const r=e=>{if(null===ae)return;e.preventDefault();const t=e.altKey;de(e.clientX,e.clientY,t)},a=()=>{const e=function(){if(!ae)return null;const{wrapper:e}=ae;e.classList.remove("nge-image-resizing"),document.body.classList.remove("nge-resizing");const t={wrapper:e,width:parseInt(e.dataset.width,10),height:parseInt(e.dataset.height,10)};return ae=null,t}();e&&t&&t(e.wrapper,e.width,e.height),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)}),e.addEventListener("mousedown",e=>{const t=e.target.closest(".nge-rotate-handle");if(!t)return;const o=t.closest(".nge-image-wrapper");if(!o)return;e.preventDefault(),e.stopPropagation(),function(e,t,n){if(!e||!e.classList.contains("nge-image-wrapper"))return null;if(!e.querySelector("img"))return null;const o=parseInt(e.dataset.rotation,10)||0,r=ce(e,t,n);le={wrapper:e,startX:t,startY:n,startRotation:o,startAngle:r},e.classList.add("nge-image-rotating"),document.body.classList.add("nge-rotating")}(o,e.clientX,e.clientY);const r=e=>{if(null===le)return;e.preventDefault();const t=e.shiftKey;!function(e,t,n=!1){if(!le)return null;let o=ce(le.wrapper,e,t)-le.startAngle,r=(le.startRotation+o+360)%360;n&&(r=45*Math.round(r/45)),r=Math.round(r),function(e,t){if(!e||!e.classList.contains("nge-image-wrapper"))return;const n=e.querySelector("img");if(!n)return;e.dataset.rotation=t;const o=e.dataset.opacity||100;n.style.transform=`rotate(${t}deg)`,n.style.opacity=o/100}(le.wrapper,r)}(e.clientX,e.clientY,t)},a=()=>{const e=function(){if(!le)return null;const{wrapper:e}=le;e.classList.remove("nge-image-rotating"),document.body.classList.remove("nge-rotating");const t={wrapper:e,rotation:parseInt(e.dataset.rotation,10)};return le=null,t}();e&&n&&n(e.wrapper,e.rotation),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)}),document.addEventListener("click",e=>{e.target.closest(".nge-image-wrapper")||e.target.closest(".nge-modal-overlay")||re&&(se(re),re=null)})}const ge={youtube:{name:"YouTube",patterns:[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/,/youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/],getEmbedUrl:(e,t)=>`https://www.youtube.com/embed/${e}${t?"?autoplay=1":""}`},vimeo:{name:"Vimeo",patterns:[/vimeo\.com\/(\d+)/,/player\.vimeo\.com\/video\/(\d+)/],getEmbedUrl:(e,t)=>`https://player.vimeo.com/video/${e}${t?"?autoplay=1":""}`},dailymotion:{name:"Dailymotion",patterns:[/dailymotion\.com\/video\/([a-zA-Z0-9]+)/,/dai\.ly\/([a-zA-Z0-9]+)/,/dailymotion\.com\/embed\/video\/([a-zA-Z0-9]+)/],getEmbedUrl:(e,t)=>`https://www.dailymotion.com/embed/video/${e}${t?"?autoplay=1":""}`}},pe={url:"",platform:"",videoId:"",width:560,autostart:!1,align:"center",borderStyle:"none",borderWidth:0,borderColor:"#000000",borderRadius:0};function me(e,t,n=!1){const o=ge[e];return o&&t?o.getEmbedUrl(t,n):null}function he(e={}){const t={...pe,...e},n=document.createElement("div");n.className="nge-video-modal-content";const o=document.createElement("div");o.className="nge-form-group";const r=document.createElement("label");r.className="nge-form-label",r.setAttribute("for","nge-video-url"),r.textContent=l("video.url");const a=document.createElement("input");a.type="url",a.id="nge-video-url",a.className="nge-form-input",a.placeholder=l("video.urlPlaceholder"),a.value=t.url,a.setAttribute("data-testid","nge-video-url");const i=document.createElement("span");i.className="nge-form-hint",i.textContent=l("video.supported"),o.appendChild(r),o.appendChild(a),o.appendChild(i);const s=document.createElement("div");s.className="nge-form-group nge-video-preview-section",s.id="nge-video-preview-section",s.style.display="none",s.setAttribute("data-testid","nge-video-preview-section");const d=document.createElement("label");d.className="nge-form-label",d.textContent=l("video.preview");const c=document.createElement("div");c.className="nge-video-preview",c.id="nge-video-preview",c.setAttribute("data-testid","nge-video-preview"),s.appendChild(d),s.appendChild(c);const u=document.createElement("div");u.className="nge-video-options-section",u.id="nge-video-options-section",u.style.display="none",u.setAttribute("data-testid","nge-video-options-section");const g=document.createElement("div");g.className="nge-form-group";const p=document.createElement("label");p.className="nge-form-label",p.setAttribute("for","nge-video-width"),p.textContent=l("video.width");const m=document.createElement("input");m.type="number",m.id="nge-video-width",m.className="nge-form-input",m.min="200",m.max="1920",m.value=t.width,m.setAttribute("data-testid","nge-video-width"),g.appendChild(p),g.appendChild(m);const h=document.createElement("div");h.className="nge-form-group nge-checkbox-wrapper";const b=document.createElement("input");b.type="checkbox",b.id="nge-video-autostart",b.className="nge-form-checkbox",b.checked=t.autostart,b.setAttribute("data-testid","nge-video-autostart");const f=document.createElement("label");f.className="nge-checkbox-label",f.setAttribute("for","nge-video-autostart"),f.textContent=l("video.autoplay"),h.appendChild(b),h.appendChild(f);const v=document.createElement("div");v.className="nge-form-group";const w=document.createElement("label");w.className="nge-form-label",w.textContent=l("video.alignment");const C=document.createElement("div");C.className="nge-radio-group nge-radio-group-horizontal",C.setAttribute("data-testid","nge-video-align-group");[{value:"left",label:l("video.alignLeft")},{value:"center",label:l("video.alignCenter")},{value:"right",label:l("video.alignRight")}].forEach(e=>{const n=document.createElement("div");n.className="nge-radio-wrapper";const o=document.createElement("input");o.type="radio",o.name="nge-video-align",o.id=`nge-video-align-${e.value}`,o.className="nge-form-radio",o.value=e.value,o.checked=t.align===e.value,o.setAttribute("data-testid",`nge-video-align-${e.value}`);const r=document.createElement("label");r.className="nge-radio-label",r.setAttribute("for",`nge-video-align-${e.value}`),r.textContent=e.label,n.appendChild(o),n.appendChild(r),C.appendChild(n)}),v.appendChild(w),v.appendChild(C);const y=document.createElement("div");y.className="nge-form-group nge-border-section";const x=document.createElement("label");x.className="nge-form-label",x.textContent=l("video.border"),y.appendChild(x);const E=document.createElement("div");E.className="nge-border-options";const S=document.createElement("div");S.className="nge-border-option-group";const k=document.createElement("label");k.className="nge-form-label-small",k.setAttribute("for","nge-video-border-style"),k.textContent=l("video.borderStyle");const A=document.createElement("select");A.id="nge-video-border-style",A.className="nge-form-select",A.setAttribute("data-testid","nge-video-border-style");[{value:"none",label:l("video.borderNone")},{value:"solid",label:l("video.borderSolid")},{value:"dashed",label:l("video.borderDashed")},{value:"dotted",label:l("video.borderDotted")},{value:"double",label:l("video.borderDouble")},{value:"groove",label:l("video.borderGroove")},{value:"ridge",label:l("video.borderRidge")},{value:"inset",label:l("video.borderInset")},{value:"outset",label:l("video.borderOutset")}].forEach(e=>{const n=document.createElement("option");n.value=e.value,n.textContent=e.label,e.value===t.borderStyle&&(n.selected=!0),A.appendChild(n)}),S.appendChild(k),S.appendChild(A);const L=document.createElement("div");L.className="nge-border-option-group";const T=document.createElement("label");T.className="nge-form-label-small",T.setAttribute("for","nge-video-border-width"),T.textContent=l("video.borderWidth");const M=document.createElement("input");M.type="number",M.id="nge-video-border-width",M.className="nge-form-input nge-form-input-small",M.min="0",M.max="20",M.value=t.borderWidth,M.setAttribute("data-testid","nge-video-border-width"),L.appendChild(T),L.appendChild(M);const N=document.createElement("div");N.className="nge-border-option-group";const R=document.createElement("label");R.className="nge-form-label-small",R.setAttribute("for","nge-video-border-color"),R.textContent=l("video.borderColor");const I=K({id:"nge-video-border-color",testId:"nge-video-border-color",value:t.borderColor});N.appendChild(R),N.appendChild(I);const q=document.createElement("div");q.className="nge-border-option-group";const $=document.createElement("label");$.className="nge-form-label-small",$.setAttribute("for","nge-video-border-radius"),$.textContent=l("video.borderRadius");const D=document.createElement("input");return D.type="number",D.id="nge-video-border-radius",D.className="nge-form-input nge-form-input-small",D.min="0",D.max="100",D.value=t.borderRadius,D.setAttribute("data-testid","nge-video-border-radius"),q.appendChild($),q.appendChild(D),E.appendChild(S),E.appendChild(L),E.appendChild(N),E.appendChild(q),y.appendChild(E),u.appendChild(g),u.appendChild(h),u.appendChild(v),u.appendChild(y),n.appendChild(o),n.appendChild(s),n.appendChild(u),n.dataset.platform=t.platform||"",n.dataset.videoId=t.videoId||"",function(e){const t=e.querySelector("#nge-video-url"),n=e.querySelector("#nge-video-width"),o=e.querySelector("#nge-video-border-style"),r=e.querySelector("#nge-video-border-width"),a=e.querySelector("#nge-video-border-color"),l=e.querySelector("#nge-video-border-radius");let i=null;t.addEventListener("input",()=>{clearTimeout(i),i=setTimeout(()=>{const n=t.value.trim();if(n){const t=function(e){if(!e||"string"!=typeof e)return null;const t=e.trim();for(const[e,n]of Object.entries(ge))for(const o of n.patterns){const n=t.match(o);if(n&&n[1])return{platform:e,videoId:n[1]}}return null}(n);t?(e.dataset.platform=t.platform,e.dataset.videoId=t.videoId,ve(e,t.platform,t.videoId)):(we(e),e.dataset.platform="",e.dataset.videoId="")}else we(e),e.dataset.platform="",e.dataset.videoId=""},500)}),n.addEventListener("input",()=>{const t=e.querySelector("#nge-video-preview").querySelector("iframe");if(t){const e=parseInt(n.value,10)||pe.width,o=Math.round(9*e/16);t.style.width=`${Math.min(e,480)}px`,t.style.height=`${Math.min(o,270)}px`}}),o&&o.addEventListener("change",()=>{fe(e)});r&&r.addEventListener("input",()=>{fe(e)});a&&a.addEventListener("input",()=>{fe(e)});l&&l.addEventListener("input",()=>{fe(e)})}(n),t.url&&t.platform&&t.videoId&&ve(n,t.platform,t.videoId),n}function be(e){const t=e.querySelector("#nge-video-border-style"),n=e.querySelector("#nge-video-border-width"),o=e.querySelector("#nge-video-border-color"),r=e.querySelector("#nge-video-border-radius");return{borderStyle:t?t.value:pe.borderStyle,borderWidth:n?parseInt(n.value,10)||0:pe.borderWidth,borderColor:o?o.value:pe.borderColor,borderRadius:r?parseInt(r.value,10)||0:pe.borderRadius}}function fe(e){const t=e.querySelector("#nge-video-preview"),n=t?t.querySelector("iframe"):null;if(!n)return;const{borderStyle:o,borderWidth:r,borderColor:a,borderRadius:l}=be(e);n.style.border=o&&"none"!==o&&r>0?`${r}px ${o} ${a}`:"",n.style.borderRadius=l>0?`${l}px`:""}function ve(e,t,n){const o=e.querySelector("#nge-video-preview-section"),r=e.querySelector("#nge-video-preview"),a=e.querySelector("#nge-video-options-section"),l=e.querySelector("#nge-video-width"),i=me(t,n,!1);if(!i)return void we(e);const s=parseInt(l.value,10)||pe.width,d=Math.min(s,480),c=Math.round(9*d/16),{borderStyle:u,borderWidth:g,borderColor:p,borderRadius:m}=be(e),h=document.createElement("iframe");h.src=i,h.style.width=`${d}px`,h.style.height=`${c}px`,h.frameBorder="0",h.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",h.allowFullscreen=!0,h.setAttribute("data-testid","nge-video-preview-iframe"),u&&"none"!==u&&g>0&&(h.style.border=`${g}px ${u} ${p}`),m>0&&(h.style.borderRadius=`${m}px`),r.innerHTML="",r.appendChild(h),o.style.display="block",a.style.display="block"}function we(e){const t=e.querySelector("#nge-video-preview-section"),n=e.querySelector("#nge-video-preview"),o=e.querySelector("#nge-video-options-section");n.innerHTML="",t.style.display="none",o.style.display="none"}function Ce(e={}){const t=he(e),n=e.url?l("modal.edit"):l("video.insertVideo");return w(v({id:"video-modal",title:e.url?l("video.editTitle"):l("video.title"),content:t,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:n,variant:"primary"}]})).then(e=>{if("confirm"===e){const e=function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector("#nge-video-url"),n=e.querySelector("#nge-video-width"),o=e.querySelector("#nge-video-autostart"),r=e.querySelector('input[name="nge-video-align"]:checked'),a=e.querySelector("#nge-video-border-style"),l=e.querySelector("#nge-video-border-width"),i=e.querySelector("#nge-video-border-color"),s=e.querySelector("#nge-video-border-radius");return{url:t?t.value.trim():"",platform:e.dataset.platform||"",videoId:e.dataset.videoId||"",width:n&&parseInt(n.value,10)||pe.width,autostart:o?o.checked:pe.autostart,align:r?r.value:pe.align,borderStyle:a?a.value:pe.borderStyle,borderWidth:l?parseInt(l.value,10)||0:pe.borderWidth,borderColor:i?i.value:pe.borderColor,borderRadius:s?parseInt(s.value,10)||0:pe.borderRadius}}(t),n=function(e){return e&&"object"==typeof e?e.url?e.platform&&e.videoId?{isValid:!0,error:null}:{isValid:!1,error:l("video.errorUnsupported")}:{isValid:!1,error:l("video.errorRequired")}:{isValid:!1,error:l("video.errorInvalid")}}(e);if(!n.isValid)throw new Error(n.error);return{action:"confirm",...e}}throw new Error("Modal cancelled")})}const ye={rows:3,columns:3,includeHeader:!0,sortable:!1,style:"standard",responsive:!0,tableWidth:"100%",tableAlign:"left",headerBgColor:"#E3F2FD",headerTransparent:!1,headerFont:"inherit",headerSize:14,headerWeight:"bold",headerTextColor:"#212529"};const xe=[{value:"25%",label:"25%"},{value:"33%",label:"33%"},{value:"50%",label:"50%"},{value:"75%",label:"75%"},{value:"100%",label:"100%"}];function Ee(e={}){const t={...ye,...e},n=document.createElement("div");n.className="nge-table-modal-content";const o=[{value:"standard",label:l("table.styleStandard")},{value:"bordered",label:l("table.styleBordered")},{value:"striped",label:l("table.styleStriped")},{value:"minimal",label:l("table.styleMinimal")}],r=[{value:"normal",label:l("table.weightNormal")},{value:"bold",label:l("table.weightBold")},{value:"500",label:l("table.weightMedium")},{value:"600",label:l("table.weightSemiBold")}],a=[{value:"inherit",label:l("table.inheritFont")},{value:"Arial, sans-serif",label:"Arial"},{value:"Georgia, serif",label:"Georgia"},{value:"monospace",label:"Monospace"}],i=[{value:"left",label:l("table.alignLeft"),icon:"&#x2190;"},{value:"center",label:l("table.alignCenter"),icon:"&#x2194;"},{value:"right",label:l("table.alignRight"),icon:"&#x2192;"}];return n.innerHTML=`\n    <div class="nge-table-modal-grid">\n      \x3c!-- Structure Section --\x3e\n      <div class="nge-table-section">\n        <h4 class="nge-table-section-title">\n          <span class="nge-table-section-icon">&#x2630;</span>\n          ${l("table.structure")}\n        </h4>\n\n        <div class="nge-form-group">\n          <label class="nge-form-label" for="nge-table-rows">\n            <span class="nge-label-icon">&#x2195;</span>\n            ${l("table.rows")}\n          </label>\n          <input type="number" id="nge-table-rows" class="nge-input"\n                 data-testid="nge-table-rows"\n                 min="1" max="50" value="${t.rows}">\n        </div>\n\n        <div class="nge-form-group">\n          <label class="nge-form-label" for="nge-table-columns">\n            <span class="nge-label-icon">&#x2194;</span>\n            ${l("table.columns")}\n          </label>\n          <input type="number" id="nge-table-columns" class="nge-input"\n                 data-testid="nge-table-columns"\n                 min="1" max="20" value="${t.columns}">\n        </div>\n\n        <div class="nge-form-group nge-checkbox-group">\n          <label class="nge-checkbox-label">\n            <input type="checkbox" id="nge-table-header"\n                   data-testid="nge-table-header"\n                   ${t.includeHeader?"checked":""}>\n            <span class="nge-checkbox-icon">&#x2630;</span>\n            ${l("table.includeHeader")}\n          </label>\n        </div>\n\n        <div class="nge-form-group nge-checkbox-group">\n          <label class="nge-checkbox-label">\n            <input type="checkbox" id="nge-table-sortable"\n                   data-testid="nge-table-sortable"\n                   ${t.sortable?"checked":""}>\n            <span class="nge-checkbox-icon">&#x21C5;</span>\n            ${l("table.sortable")}\n          </label>\n        </div>\n      </div>\n\n      \x3c!-- Style Section --\x3e\n      <div class="nge-table-section">\n        <h4 class="nge-table-section-title">\n          <span class="nge-table-section-icon">&#x2699;</span>\n          ${l("table.style")}\n        </h4>\n\n        <div class="nge-form-group">\n          <label class="nge-form-label" for="nge-table-style">\n            <span class="nge-label-icon">&#x270E;</span>\n            ${l("table.style")}\n          </label>\n          <select id="nge-table-style" class="nge-select" data-testid="nge-table-style">\n            ${o.map(e=>`<option value="${e.value}" ${t.style===e.value?"selected":""}>${e.label}</option>`).join("")}\n          </select>\n        </div>\n\n        <div class="nge-form-group nge-checkbox-group">\n          <label class="nge-checkbox-label">\n            <input type="checkbox" id="nge-table-responsive"\n                   data-testid="nge-table-responsive"\n                   ${t.responsive?"checked":""}>\n            <span class="nge-checkbox-icon">&#x1F4F1;</span>\n            ${l("table.responsive")}\n          </label>\n        </div>\n\n        <div class="nge-form-group">\n          <label class="nge-form-label" for="nge-table-width">\n            <span class="nge-label-icon">&#x2194;</span>\n            ${l("table.width")}\n          </label>\n          <select id="nge-table-width" class="nge-select" data-testid="nge-table-width">\n            ${xe.map(e=>`<option value="${e.value}" ${t.tableWidth===e.value?"selected":""}>${e.label}</option>`).join("")}\n          </select>\n        </div>\n\n        <div class="nge-form-group">\n          <label class="nge-form-label">\n            <span class="nge-label-icon">&#x2630;</span>\n            ${l("table.alignment")}\n          </label>\n          <div class="nge-table-align-buttons" data-testid="nge-table-align-buttons">\n            ${i.map(e=>`\n              <button type="button"\n                      class="nge-table-align-btn${t.tableAlign===e.value?" selected":""}"\n                      data-align="${e.value}"\n                      data-testid="nge-table-align-${e.value}"\n                      title="${e.label}">\n                <span class="nge-align-icon">${e.icon}</span>\n                <span class="nge-align-label">${e.label}</span>\n              </button>\n            `).join("")}\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Header Style Section --\x3e\n      <div class="nge-table-section">\n        <h4 class="nge-table-section-title">\n          <span class="nge-table-section-icon">&#x2699;</span>\n          ${l("table.headerStyle")}\n        </h4>\n\n        <div class="nge-form-group">\n          <label class="nge-form-label">\n            <span class="nge-label-icon">&#x1F3A8;</span>\n            ${l("table.headerBgColor")}\n          </label>\n          <div id="nge-table-header-bg-container" data-color-value="${t.headerBgColor}"></div>\n        </div>\n\n        <div class="nge-form-group nge-checkbox-group">\n          <label class="nge-checkbox-label">\n            <input type="checkbox" id="nge-table-header-transparent"\n                   data-testid="nge-table-header-transparent"\n                   ${t.headerTransparent?"checked":""}>\n            ${l("table.transparent")}\n          </label>\n        </div>\n\n        <div class="nge-form-group">\n          <label class="nge-form-label" for="nge-table-header-font">\n            <span class="nge-label-icon">T</span>\n            ${l("table.headerFont")}\n          </label>\n          <select id="nge-table-header-font" class="nge-select" data-testid="nge-table-header-font">\n            ${a.map(e=>`<option value="${e.value}" ${t.headerFont===e.value?"selected":""}>${e.label}</option>`).join("")}\n          </select>\n        </div>\n\n        <div class="nge-form-row">\n          <div class="nge-form-group nge-form-half">\n            <label class="nge-form-label" for="nge-table-header-size">${l("table.size")}</label>\n            <input type="text" id="nge-table-header-size" class="nge-input"\n                   data-testid="nge-table-header-size"\n                   value="${t.headerSize}px">\n          </div>\n          <div class="nge-form-group nge-form-half">\n            <label class="nge-form-label" for="nge-table-header-weight">${l("table.weight")}</label>\n            <select id="nge-table-header-weight" class="nge-select" data-testid="nge-table-header-weight">\n              ${r.map(e=>`<option value="${e.value}" ${t.headerWeight===e.value?"selected":""}>${e.label}</option>`).join("")}\n            </select>\n          </div>\n        </div>\n\n        <div class="nge-form-group">\n          <label class="nge-form-label">\n            ${l("table.textColor")}\n          </label>\n          <div id="nge-table-header-text-color-container" data-color-value="${t.headerTextColor}"></div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- Preview Section --\x3e\n    <div class="nge-table-preview-section">\n      <h4 class="nge-table-preview-title">\n        <span class="nge-preview-icon">&#x1F441;</span>\n        ${l("table.preview")}\n      </h4>\n      <div class="nge-table-preview-container" data-testid="nge-table-preview">\n        \x3c!-- Preview will be generated here --\x3e\n      </div>\n    </div>\n  `,function(e){const t=e.querySelector("#nge-table-header-bg-container"),n=e.querySelector("#nge-table-header-text-color-container");if(t){const n=K({id:"nge-table-header-bg",testId:"nge-table-header-bg",value:t.getAttribute("data-color-value")||"#4472C4",onChange:()=>Se(e)});t.replaceWith(n),e._bgColorInput=n}if(n){const t=K({id:"nge-table-header-text-color",testId:"nge-table-header-text-color",value:n.getAttribute("data-color-value")||"#FFFFFF",onChange:()=>Se(e)});n.replaceWith(t),e._textColorInput=t}const o=e.querySelector("#nge-table-header-transparent");o&&o.addEventListener("change",()=>{e.querySelectorAll("#nge-table-header-bg, #nge-table-header-bg-hex").forEach(e=>{e.disabled=o.checked}),Se(e)});const r=e.querySelector("#nge-table-header");r&&r.addEventListener("change",()=>{Se(e)});const a=e.querySelectorAll(".nge-table-align-btn");a.forEach(t=>{t.addEventListener("click",()=>{a.forEach(e=>e.classList.remove("selected")),t.classList.add("selected"),Se(e)})});const l=e.querySelectorAll("input, select");l.forEach(t=>{t.addEventListener("change",()=>Se(e)),"number"!==t.type&&"text"!==t.type||t.addEventListener("input",()=>Se(e))})}(n),Se(n),n}function Se(e){const t=e.querySelector('[data-testid="nge-table-preview"]');if(!t)return;const n=function(e,t=!1){const{rows:n,columns:o,includeHeader:r,sortable:a,style:l,responsive:i,tableWidth:s="100%",tableAlign:d="left",headerBgColor:c,headerTransparent:u,headerFont:g,headerSize:p,headerWeight:m,headerTextColor:h}=e,b=["nge-table",`nge-table-${l}`,i?"nge-table-responsive":"",a?"nge-table-sortable":""].filter(Boolean).join(" "),f=[];f.push(`width: ${s}`),"center"===d?(f.push("margin-left: auto"),f.push("margin-right: auto")):"right"===d&&(f.push("margin-left: auto"),f.push("margin-right: 0"));const v=` style="${f.join("; ")}"`,w=[];u||w.push(`background-color: ${c}`);"inherit"!==g&&w.push(`font-family: ${g}`);w.push(`font-size: ${p}px`),w.push(`font-weight: ${m}`),w.push(`color: ${h}`);const C=w.length>0?` style="${w.join("; ")}"`:"";let y="";i&&(y+='<div class="nge-table-wrapper">');if(y+=`<table class="${b}"${v} data-testid="nge-table">`,r){y+="<thead><tr>";for(let e=1;e<=o;e++){y+=`<th${C}${a?' data-sortable="true"':""}>${t?`<span class="nge-preview-sparkle">&#x2728;</span> En-tete ${e}`:`En-tete ${e}`}</th>`}y+="</tr></thead>"}const x=r?n-1:n;y+="<tbody>";for(let e=1;e<=Math.max(1,x);e++){y+="<tr>";for(let n=1;n<=o;n++){y+=`<td>${t?`<span class="nge-preview-cell-icon">&#x1F4C4;</span> Cellule ${e}.${n}`:""}</td>`}y+="</tr>"}y+="</tbody>",y+="</table>",i&&(y+="</div>");return y}(ke(e),!0);t.innerHTML=n}function ke(e){const t=parseInt(e.querySelector("#nge-table-rows")?.value,10)||ye.rows,n=parseInt(e.querySelector("#nge-table-columns")?.value,10)||ye.columns,o=e.querySelector("#nge-table-header")?.checked??ye.includeHeader,r=e.querySelector("#nge-table-sortable")?.checked??ye.sortable,a=e.querySelector("#nge-table-style")?.value||ye.style,l=e.querySelector("#nge-table-responsive")?.checked??ye.responsive,i=e.querySelector("#nge-table-width")?.value||ye.tableWidth,s=e.querySelector(".nge-table-align-btn.selected"),d=s?.dataset.align||ye.tableAlign,c=e.querySelector("#nge-table-header-bg")?.value||ye.headerBgColor,u=e.querySelector("#nge-table-header-transparent")?.checked??ye.headerTransparent,g=e.querySelector("#nge-table-header-font")?.value||ye.headerFont,p=e.querySelector("#nge-table-header-size")?.value||`${ye.headerSize}px`;return{rows:t,columns:n,includeHeader:o,sortable:r,style:a,responsive:l,tableWidth:i,tableAlign:d,headerBgColor:c,headerTransparent:u,headerFont:g,headerSize:parseInt(p,10)||ye.headerSize,headerWeight:e.querySelector("#nge-table-header-weight")?.value||ye.headerWeight,headerTextColor:e.querySelector("#nge-table-header-text-color")?.value||ye.headerTextColor}}function Ae(e={}){const t=Ee(e);return w(v({id:"table-modal",title:e.isEdit?l("table.editTitle"):l("table.title"),content:t,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:l("table.insertTable"),variant:"primary"}]})).then(e=>{if("confirm"===e){const e=ke(t),n=function(e){return e.rows<1?{isValid:!1,error:l("table.errorRowsMin")}:e.columns<1?{isValid:!1,error:l("table.errorColsMin")}:e.rows>50?{isValid:!1,error:l("table.errorRowsMax")}:e.columns>20?{isValid:!1,error:l("table.errorColsMax")}:{isValid:!0}}(e);if(!n.isValid)throw new Error(n.error);return{action:"confirm",...e}}throw new Error("Modal cancelled")})}function Le(e){if(!e)return null;if(e.startsWith("#"))return e;const t=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(!t)return null;return"#"+[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10)].map(e=>{const t=e.toString(16);return 1===t.length?"0"+t:t}).join("").toUpperCase()}function Te(e,t=!1,n=null){const{rows:o,columns:r,includeHeader:a,sortable:i,style:s,responsive:d,tableWidth:c="100%",tableAlign:u="left",headerBgColor:g,headerTransparent:p,headerFont:m,headerSize:h,headerWeight:b,headerTextColor:f}=e,v=["nge-table",`nge-table-${s}`,d?"nge-table-responsive":"",i?"nge-table-sortable":""].filter(Boolean).join(" "),w=[];t?(w.push(`width: ${c}`),"center"===u?(w.push("margin-left: auto"),w.push("margin-right: auto")):"right"===u&&(w.push("margin-left: auto"),w.push("margin-right: 0"))):w.push("width: 100%");const C=` style="${w.join("; ")}"`,y=[];p||y.push(`background-color: ${g}`),"inherit"!==m&&y.push(`font-family: ${m}`),y.push(`font-size: ${h}px`),y.push(`font-weight: ${b}`),y.push(`color: ${f}`);const x=y.length>0?` style="${y.join("; ")}"`:"";let E="";if(!t){const e=[];e.push(`width: ${c}`),"center"===u?(e.push("margin-left: auto"),e.push("margin-right: auto")):"right"===u&&(e.push("margin-left: auto"),e.push("margin-right: 0"));const t=` style="${e.join("; ")}"`,n=l("table.editTitle"),o=l("common.deleteTable");E+=`<div class="nge-table-edit-wrapper" contenteditable="false" data-testid="nge-table-edit-wrapper"${t}>`,E+=`<div class="nge-table-buttons"><button class="nge-table-edit-btn" data-testid="nge-table-edit-btn" title="${n}" aria-label="${n}"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">\n  <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="none" stroke="currentColor" stroke-width="2"/>\n  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" fill="none" stroke="currentColor" stroke-width="2"/>\n</svg></button><button class="nge-table-delete-btn" data-testid="nge-table-delete-btn" title="${o}" aria-label="${o}"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">\n  <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg></button></div>`}if(d&&(E+='<div class="nge-table-wrapper">'),E+=`<table class="${v}"${C} data-testid="nge-table">`,a){E+=`<thead${t?"":' contenteditable="true"'}><tr>`;for(let e=0;e<r;e++){let o="";o=t?`<span class="nge-preview-sparkle">&#x2728;</span> En-tete ${e+1}`:n?.headers?.[e]?n.headers[e]:`En-tete ${e+1}`;E+=`<th${x}${i?' data-sortable="true"':""}>${o}</th>`}E+="</tr></thead>"}const S=a?o-1:o;E+=`<tbody${t?"":' contenteditable="true"'}>`;for(let e=0;e<Math.max(1,S);e++){E+="<tr>";for(let o=0;o<r;o++){let r="";t?r=`<span class="nge-preview-cell-icon">&#x1F4C4;</span> Cellule ${e+1}.${o+1}`:n?.body?.[e]?.[o]&&(r=n.body[e][o]),E+=`<td>${r}</td>`}E+="</tr>"}return E+="</tbody>",E+="</table>",d&&(E+="</div>"),t||(E+="</div>"),E}function Me(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");e.addEventListener("click",e=>{Ne(e)})}function Ne(e){const t=e.target.closest('th[data-sortable="true"]');if(!t)return;const n=t.closest(".nge-table-sortable");if(!n)return;const o=t.closest(".nge-content");if(o&&"false"!==o.getAttribute("contenteditable"))return;e.preventDefault(),e.stopPropagation();const r="asc"===t.getAttribute("data-sort")?"desc":"asc";n.querySelectorAll('th[data-sortable="true"]').forEach(e=>e.removeAttribute("data-sort")),t.setAttribute("data-sort",r);!function(e,t,n){const o=e.querySelector("tbody");if(!o)return;const r=Array.from(o.querySelectorAll("tr"));r.sort((e,o)=>{const r=e.querySelectorAll("td")[t],a=o.querySelectorAll("td")[t];if(!r||!a)return 0;const l=r.textContent.trim(),i=a.textContent.trim(),s=parseFloat(l),d=parseFloat(i);if(!isNaN(s)&&!isNaN(d))return"asc"===n?s-d:d-s;const c=l.localeCompare(i,"fr",{numeric:!0,sensitivity:"base"});return"asc"===n?c:-c}),r.forEach(e=>o.appendChild(e))}(n,Array.from(t.parentElement.children).indexOf(t),r)}let Re=!1;function Ie(){Re||"undefined"!=typeof document&&(document.addEventListener("click",Ne),Re=!0)}"undefined"!=typeof document&&"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",Ie):Ie());const qe=["#FFFFFF","#F8F9FA","#E9ECEF","#DEE2E6","#CED4DA","#ADB5BD","#E8F5E9","#C8E6C9","#FFF3E0","#FFE0B2","#FFECB3","#FFF9C4","#E3F2FD","#BBDEFB","#E1F5FE","#B3E5FC","#F3E5F5","#E1BEE7"],$e=["#212529","#343A40","#495057","#6C757D","#868E96","#ADB5BD","#D32F2F","#F57C00","#FBC02D","#388E3C","#1976D2","#7B1FA2","#00897B","#43A047","#039BE5","#1E88E5","#8E24AA","#D81B60"],De={bgColor:"",textColor:"#212529",hAlign:"left",vAlign:"middle"};function Be(e={}){const t={bgColor:e.bgColor||De.bgColor,textColor:e.textColor||De.textColor,hAlign:e.hAlign||De.hAlign,vAlign:e.vAlign||De.vAlign},n=document.createElement("div");return n.className="nge-cell-format-content",n.innerHTML=`\n    <div class="nge-cell-format-columns">\n      \x3c!-- Colors Section --\x3e\n      <div class="nge-cell-format-section">\n        <div class="nge-cell-format-section-header">\n          <span class="nge-cell-format-section-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="4" fill="currentColor"/></svg></span>\n          <span class="nge-cell-format-section-title">Couleurs</span>\n        </div>\n\n        \x3c!-- Background Color --\x3e\n        <div class="nge-cell-format-group">\n          <label class="nge-cell-format-label">\n            <span class="nge-cell-format-label-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" fill="currentColor" opacity="0.3"/><path d="M7 21V3M17 21V3M3 7h18M3 17h18"/></svg></span>\n            Couleur de fond\n          </label>\n          <div class="nge-cell-format-color-input">\n            <input type="color"\n                   id="nge-cell-bg-color"\n                   class="nge-cell-format-color-picker"\n                   data-testid="nge-cell-bg-color"\n                   value="${t.bgColor||"#FFFFFF"}">\n            <input type="text"\n                   id="nge-cell-bg-color-hex"\n                   class="nge-cell-format-hex-input"\n                   data-testid="nge-cell-bg-color-hex"\n                   value="${t.bgColor||""}"\n                   placeholder="transparent">\n            <button type="button"\n                    class="nge-cell-format-transparent-btn"\n                    data-testid="nge-cell-bg-transparent"\n                    title="Transparent">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 3l18 18"/></svg>\n            </button>\n          </div>\n          <div class="nge-cell-format-predefined">\n            <span class="nge-cell-format-predefined-label">Couleurs prédéfinies :</span>\n            <div class="nge-cell-format-color-palette" data-target="bg">\n              ${qe.map(e=>`\n                <button type="button"\n                        class="nge-cell-format-color-swatch${t.bgColor===e?" selected":""}"\n                        style="background-color: ${e}"\n                        data-color="${e}"\n                        title="${e}">\n                </button>\n              `).join("")}\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Text Color --\x3e\n        <div class="nge-cell-format-group">\n          <label class="nge-cell-format-label">\n            <span class="nge-cell-format-label-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 20h16"/><path d="M12 4v12"/><path d="M8 8l4-4 4 4"/></svg></span>\n            Couleur du texte\n          </label>\n          <div class="nge-cell-format-color-input">\n            <input type="color"\n                   id="nge-cell-text-color"\n                   class="nge-cell-format-color-picker"\n                   data-testid="nge-cell-text-color"\n                   value="${t.textColor}">\n            <input type="text"\n                   id="nge-cell-text-color-hex"\n                   class="nge-cell-format-hex-input"\n                   data-testid="nge-cell-text-color-hex"\n                   value="${t.textColor}">\n          </div>\n          <div class="nge-cell-format-predefined">\n            <span class="nge-cell-format-predefined-label">Couleurs prédéfinies :</span>\n            <div class="nge-cell-format-color-palette" data-target="text">\n              ${$e.map(e=>`\n                <button type="button"\n                        class="nge-cell-format-color-swatch${t.textColor===e?" selected":""}"\n                        style="background-color: ${e}"\n                        data-color="${e}"\n                        title="${e}">\n                </button>\n              `).join("")}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Alignment Section --\x3e\n      <div class="nge-cell-format-section">\n        <div class="nge-cell-format-section-header">\n          <span class="nge-cell-format-section-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M3 12h18M3 18h18"/></svg></span>\n          <span class="nge-cell-format-section-title">Alignement</span>\n        </div>\n\n        \x3c!-- Horizontal Alignment --\x3e\n        <div class="nge-cell-format-group">\n          <label class="nge-cell-format-label">Alignement horizontal</label>\n          <div class="nge-cell-format-align-buttons" data-testid="nge-cell-halign-buttons">\n            <button type="button"\n                    class="nge-cell-format-align-btn${"left"===t.hAlign?" selected":""}"\n                    data-align="left"\n                    data-type="horizontal"\n                    title="Gauche">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M3 12h12M3 18h18"/></svg>\n            </button>\n            <button type="button"\n                    class="nge-cell-format-align-btn${"center"===t.hAlign?" selected":""}"\n                    data-align="center"\n                    data-type="horizontal"\n                    title="Centre">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M6 12h12M3 18h18"/></svg>\n            </button>\n            <button type="button"\n                    class="nge-cell-format-align-btn${"right"===t.hAlign?" selected":""}"\n                    data-align="right"\n                    data-type="horizontal"\n                    title="Droite">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M9 12h12M3 18h18"/></svg>\n            </button>\n            <button type="button"\n                    class="nge-cell-format-align-btn${"justify"===t.hAlign?" selected":""}"\n                    data-align="justify"\n                    data-type="horizontal"\n                    title="Justifié">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M3 12h18M3 18h18"/></svg>\n            </button>\n          </div>\n        </div>\n\n        \x3c!-- Vertical Alignment --\x3e\n        <div class="nge-cell-format-group">\n          <label class="nge-cell-format-label">Alignement vertical</label>\n          <div class="nge-cell-format-align-buttons" data-testid="nge-cell-valign-buttons">\n            <button type="button"\n                    class="nge-cell-format-align-btn${"top"===t.vAlign?" selected":""}"\n                    data-align="top"\n                    data-type="vertical"\n                    title="Haut">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="12" height="6" fill="currentColor" opacity="0.3"/><path d="M6 4h12M6 10h12M6 16h12"/></svg>\n            </button>\n            <button type="button"\n                    class="nge-cell-format-align-btn${"middle"===t.vAlign?" selected":""}"\n                    data-align="middle"\n                    data-type="vertical"\n                    title="Milieu">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="9" width="12" height="6" fill="currentColor" opacity="0.3"/><path d="M6 4h12M6 9h12M6 15h12M6 20h12"/></svg>\n            </button>\n            <button type="button"\n                    class="nge-cell-format-align-btn${"bottom"===t.vAlign?" selected":""}"\n                    data-align="bottom"\n                    data-type="vertical"\n                    title="Bas">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="14" width="12" height="6" fill="currentColor" opacity="0.3"/><path d="M6 8h12M6 14h12M6 20h12"/></svg>\n            </button>\n          </div>\n        </div>\n\n        \x3c!-- Preview --\x3e\n        <div class="nge-cell-format-group">\n          <label class="nge-cell-format-label nge-cell-format-preview-label">APERÇU</label>\n          <div class="nge-cell-format-preview"\n               id="nge-cell-format-preview"\n               data-testid="nge-cell-format-preview"\n               style="background-color: ${t.bgColor||"transparent"};\n                      color: ${t.textColor};\n                      text-align: ${t.hAlign};\n                      vertical-align: ${t.vAlign};">\n            Texte d'exemple\n          </div>\n        </div>\n      </div>\n    </div>\n  `,function(e,t){const n=e.querySelector("#nge-cell-bg-color"),o=e.querySelector("#nge-cell-bg-color-hex"),r=e.querySelector('[data-testid="nge-cell-bg-transparent"]'),a=e.querySelector("#nge-cell-text-color"),l=e.querySelector("#nge-cell-text-color-hex"),i=e.querySelector("#nge-cell-format-preview");n.addEventListener("input",n=>{t.bgColor=n.target.value,o.value=n.target.value,ze(i,t),He(e,"bg",t.bgColor)}),o.addEventListener("input",o=>{const r=o.target.value;/^#[0-9A-Fa-f]{6}$/.test(r)?(t.bgColor=r,n.value=r,ze(i,t),He(e,"bg",t.bgColor)):""!==r&&"transparent"!==r.toLowerCase()||(t.bgColor="",ze(i,t),He(e,"bg",""))}),r.addEventListener("click",()=>{t.bgColor="",o.value="",n.value="#FFFFFF",ze(i,t),He(e,"bg","")}),a.addEventListener("input",n=>{t.textColor=n.target.value,l.value=n.target.value,ze(i,t),He(e,"text",t.textColor)}),l.addEventListener("input",n=>{const o=n.target.value;/^#[0-9A-Fa-f]{6}$/.test(o)&&(t.textColor=o,a.value=o,ze(i,t),He(e,"text",t.textColor))}),e.querySelectorAll(".nge-cell-format-color-palette").forEach(r=>{r.addEventListener("click",s=>{const d=s.target.closest(".nge-cell-format-color-swatch");if(!d)return;const c=d.dataset.color;"bg"===r.dataset.target?(t.bgColor=c,n.value=c,o.value=c,He(e,"bg",c)):(t.textColor=c,a.value=c,l.value=c,He(e,"text",c)),ze(i,t)})}),e.querySelectorAll(".nge-cell-format-align-btn").forEach(e=>{e.addEventListener("click",()=>{const n=e.dataset.type,o=e.dataset.align;e.parentElement.querySelectorAll(".nge-cell-format-align-btn").forEach(e=>{e.classList.remove("selected")}),e.classList.add("selected"),"horizontal"===n?t.hAlign=o:t.vAlign=o,ze(i,t)})})}(n,t),n}function ze(e,t){e.style.backgroundColor=t.bgColor||"transparent",e.style.color=t.textColor;e.style.justifyContent={left:"flex-start",center:"center",right:"flex-end",justify:"flex-start"}[t.hAlign]||"flex-start";e.style.alignItems={top:"flex-start",middle:"center",bottom:"flex-end"}[t.vAlign]||"center"}function He(e,t,n){const o=e.querySelector(`.nge-cell-format-color-palette[data-target="${t}"]`);o&&o.querySelectorAll(".nge-cell-format-color-swatch").forEach(e=>{e.dataset.color===n?e.classList.add("selected"):e.classList.remove("selected")})}function Fe(e){if(!e)return"";if(e.startsWith("#"))return e;const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(!t)return"";return"#"+[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10)].map(e=>{const t=e.toString(16);return 1===t.length?"0"+t:t}).join("").toUpperCase()}function je(e={}){const t=Be(e),n=v({id:"cell-format",title:"Formater la cellule",content:t,buttons:[{id:"cancel",label:"Annuler",variant:"secondary"},{id:"reset",label:"Réinitialiser",variant:"outline"},{id:"confirm",label:"Appliquer",variant:"primary"}]}),o=n.querySelector('[data-action="reset"]');return o&&(o.onclick=e=>{e.preventDefault(),e.stopPropagation(),function(e){const t=e.querySelector("#nge-cell-bg-color"),n=e.querySelector("#nge-cell-bg-color-hex"),o=e.querySelector("#nge-cell-text-color"),r=e.querySelector("#nge-cell-text-color-hex"),a=e.querySelector("#nge-cell-format-preview");t.value="#FFFFFF",n.value="",o.value=De.textColor,r.value=De.textColor,e.querySelectorAll(".nge-cell-format-align-btn").forEach(e=>{e.classList.remove("selected"),"horizontal"===e.dataset.type&&e.dataset.align===De.hAlign&&e.classList.add("selected"),"vertical"===e.dataset.type&&e.dataset.align===De.vAlign&&e.classList.add("selected")}),e.querySelectorAll(".nge-cell-format-color-swatch").forEach(e=>{e.classList.remove("selected")}),ze(a,{...De})}(t)}),new Promise((e,o)=>{document.body.appendChild(n),n.offsetHeight,n.classList.add("nge-modal-visible");const r=n.querySelector("input");r&&r.focus();const a=n.querySelector(".nge-modal-close");a&&(a.onclick=()=>{C(n),o(new Error("Modal cancelled"))});const l=n.querySelector('[data-action="cancel"]');l&&(l.onclick=()=>{C(n),o(new Error("Modal cancelled"))});const i=n.querySelector('[data-action="confirm"]');i&&(i.onclick=()=>{const o=function(e){const t=e.querySelector("#nge-cell-bg-color-hex"),n=e.querySelector("#nge-cell-text-color-hex"),o=e.querySelector('.nge-cell-format-align-btn[data-type="horizontal"].selected'),r=e.querySelector('.nge-cell-format-align-btn[data-type="vertical"].selected');return{bgColor:t?.value||"",textColor:n?.value||De.textColor,hAlign:o?.dataset.align||De.hAlign,vAlign:r?.dataset.align||De.vAlign}}(t);C(n),e(o)}),n.onclick=e=>{e.target===n&&(C(n),o(new Error("Modal cancelled")))};const s=e=>{"Escape"===e.key&&(C(n),document.removeEventListener("keydown",s),o(new Error("Modal cancelled")))};document.addEventListener("keydown",s)})}const Pe=[{action:"add-row-above",label:"Ajouter une ligne au-dessus",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 14h18"/><path d="M3 10h18"/><path d="M3 6h18"/><path d="M3 18h18"/><path d="M12 2v4"/><path d="M9 4l3-2 3 2"/></svg>'},{action:"add-row-below",label:"Ajouter une ligne en-dessous",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M3 10h18"/><path d="M3 14h18"/><path d="M3 18h18"/><path d="M12 22v-4"/><path d="M9 20l3 2 3-2"/></svg>'},{action:"delete-row",label:"Supprimer la ligne",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M3 12h18"/><path d="M3 18h18"/><path d="M17 9l-5 5m0-5l5 5" stroke="red"/></svg>',danger:!0},{separator:!0},{action:"add-col-left",label:"Ajouter une colonne à gauche",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3v18"/><path d="M10 3v18"/><path d="M14 3v18"/><path d="M18 3v18"/><path d="M2 12h4"/><path d="M4 9l-2 3 2 3"/></svg>'},{action:"add-col-right",label:"Ajouter une colonne à droite",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3v18"/><path d="M10 3v18"/><path d="M14 3v18"/><path d="M18 3v18"/><path d="M22 12h-4"/><path d="M20 9l2 3-2 3"/></svg>'},{action:"delete-col",label:"Supprimer la colonne",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3v18"/><path d="M12 3v18"/><path d="M18 3v18"/><path d="M9 17l5-5m0 5l-5-5" stroke="red"/></svg>',danger:!0},{separator:!0},{action:"merge-cells",label:"Fusionner les cellules",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 3v18"/><path d="M15 3v18"/><path d="M3 9h18"/><path d="M3 15h18"/><path d="M9 9h6v6H9z" fill="currentColor" opacity="0.3"/></svg>',requiresSelection:!0},{action:"unmerge-cells",label:"Défusionner les cellules",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 3v18"/><path d="M15 3v18"/><path d="M3 9h18"/><path d="M3 15h18"/></svg>',requiresMerged:!0},{separator:!0},{action:"format-cell",label:"Formater la cellule",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 3v18"/><circle cx="15" cy="15" r="3" fill="currentColor" opacity="0.3"/></svg>'}];let We=null,Oe=new Set;function Ve(e,t,n={}){Ue(),We=function(e={}){const t=document.createElement("div");return t.className="nge-context-menu",t.setAttribute("data-testid","nge-context-menu"),Pe.forEach(n=>{if(n.separator){const e=document.createElement("div");e.className="nge-context-menu-separator",t.appendChild(e)}else{const o=document.createElement("button");o.className="nge-context-menu-item",n.danger&&o.classList.add("nge-context-menu-item-danger"),o.setAttribute("data-action",n.action),o.type="button";const r=document.createElement("span");r.className="nge-context-menu-icon",r.innerHTML=n.icon,o.appendChild(r),o.appendChild(document.createTextNode(n.label)),n.requiresSelection&&!e.canMerge&&(o.disabled=!0),n.requiresMerged&&!e.canUnmerge&&(o.disabled=!0),t.appendChild(o)}}),t}(n),document.body.appendChild(We);const o=We.getBoundingClientRect(),r=window.innerWidth,a=window.innerHeight;let l=e,i=t;return e+o.width>r&&(l=r-o.width-5),t+o.height>a&&(i=a-o.height-5),We.style.left=`${l}px`,We.style.top=`${i}px`,We}function Ue(){We&&We.parentNode&&We.parentNode.removeChild(We),We=null}function Ge(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container: must be an HTMLElement");if(!t||"object"!=typeof t)throw new Error("Invalid callbacks: must be an object");e.addEventListener("contextmenu",n=>{const o=n.target.closest("td, th"),r=n.target.closest(".nge-table");if(!o||!r)return;n.preventDefault();const a=Qe(Je(e)),l=et(o),i=Ve(n.clientX,n.clientY,{canMerge:a,canUnmerge:l});i.dataset.targetCell="",i._targetCell=o,i._targetTable=r,i.addEventListener("click",n=>{const o=n.target.closest(".nge-context-menu-item");if(!o||o.disabled)return;const r=o.dataset.action,a=i._targetCell,l=i._targetTable;switch(r){case"add-row-above":!function(e,t){const n=e.querySelector("tbody");if(!n)return;const o=Xe(e),r=document.createElement("tr");for(let e=0;e<o;e++){const e=document.createElement("td");e.innerHTML="&nbsp;",r.appendChild(e)}const a=n.rows[t];a?n.insertBefore(r,a):n.appendChild(r)}(l,Ke(a)),t.onContentChange&&t.onContentChange();break;case"add-row-below":!function(e,t){const n=e.querySelector("tbody");if(!n)return;const o=Xe(e),r=document.createElement("tr");for(let e=0;e<o;e++){const e=document.createElement("td");e.innerHTML="&nbsp;",r.appendChild(e)}const a=n.rows[t];a&&a.nextSibling?n.insertBefore(r,a.nextSibling):n.appendChild(r)}(l,Ke(a)),t.onContentChange&&t.onContentChange();break;case"delete-row":!function(e,t){if(!e||!t)return!1;const n=t.closest("tr");if(!n)return!1;const o=n.closest("thead");if(o)return!(o.rows.length<=1)&&(n.remove(),!0);const r=e.querySelector("tbody");!!r&&(!(r.rows.length<=1)&&n.remove())}(l,a),t.onContentChange&&t.onContentChange();break;case"add-col-left":!function(e,t){const n=e.querySelector("thead");n&&Array.from(n.rows).forEach(e=>{const n=document.createElement("th");n.innerHTML="&nbsp;";Ye(n,e.cells[t]||e.cells[0]),e.cells[t]?e.insertBefore(n,e.cells[t]):e.appendChild(n)});const o=e.querySelector("tbody");o&&Array.from(o.rows).forEach(e=>{const n=document.createElement("td");n.innerHTML="&nbsp;";const o=e.cells[t];o?e.insertBefore(n,o):e.appendChild(n)})}(l,Ze(a)),t.onContentChange&&t.onContentChange();break;case"add-col-right":!function(e,t){const n=e.querySelector("thead");n&&Array.from(n.rows).forEach(e=>{const n=document.createElement("th");n.innerHTML="&nbsp;";Ye(n,e.cells[t]||e.cells[0]),e.cells[t]&&e.cells[t].nextSibling?e.insertBefore(n,e.cells[t].nextSibling):e.appendChild(n)});const o=e.querySelector("tbody");o&&Array.from(o.rows).forEach(e=>{const n=document.createElement("td");n.innerHTML="&nbsp;";const o=e.cells[t];o&&o.nextSibling?e.insertBefore(n,o.nextSibling):e.appendChild(n)})}(l,Ze(a)),t.onContentChange&&t.onContentChange();break;case"delete-col":!function(e,t){if(!e||t<0)return!1;const n=Xe(e);if(n<=1)return!1;const o=e.querySelector("thead");o&&Array.from(o.rows).forEach(e=>{e.cells[t]&&e.cells[t].remove()});const r=e.querySelector("tbody");r&&Array.from(r.rows).forEach(e=>{e.cells[t]&&e.cells[t].remove()})}(l,Ze(a)),t.onContentChange&&t.onContentChange();break;case"merge-cells":const n=Je(e);n.length>=2&&(!function(e){if(!Qe(e))return!1;const t=e.map(e=>({row:Ke(e),col:Ze(e),cell:e}));t.sort((e,t)=>e.row!==t.row?e.row-t.row:e.col-t.col);const n=[...new Set(t.map(e=>e.row))].sort((e,t)=>e-t),o=[...new Set(t.map(e=>e.col))].sort((e,t)=>e-t),r=n.length,a=o.length,l=t[0].cell,i=t.map(e=>e.cell.textContent.trim()).filter(e=>e&&" "!==e);r>1&&(l.rowSpan=r);a>1&&(l.colSpan=a);l.innerHTML=i.length>0?i.join(" "):"&nbsp;",t.slice(1).forEach(e=>{e.cell.remove()})}(n),_e(e),t.onContentChange&&t.onContentChange());break;case"unmerge-cells":et(a)&&(!function(e,t){if(!e||!t)return!1;if(!et(e))return!1;const n=e.rowSpan||1,o=e.colSpan||1,r=e.closest("tr"),a=t.querySelector("tbody"),l=t.querySelector("thead");if(!r)return!1;const i="th"===e.tagName.toLowerCase(),s=i?"th":"td";let d=0;const c=Array.from(r.cells);for(let t=0;t<c.length&&c[t]!==e;t++)d+=c[t].colSpan||1;e.innerHTML,e.removeAttribute("rowspan"),e.removeAttribute("colspan");const u=l?.querySelector("th");let g=e;for(let e=1;e<o;e++){const e=document.createElement(s);e.innerHTML="&nbsp;",i&&u&&Ye(e,u),g.after(e),g=e}const p=i?l:a;if(!p)return!1;const m=Array.from(p.rows).indexOf(r);for(let e=1;e<n;e++){const t=p.rows[m+e];if(!t)continue;let n=0,r=0;const a=Array.from(t.cells);for(let e=0;e<a.length;e++){if(r>=d){n=e;break}r+=a[e].colSpan||1,n=e+1}for(let e=0;e<o;e++){const e=document.createElement(s);e.innerHTML="&nbsp;",i&&u&&Ye(e,u),t.cells[n]?t.insertBefore(e,t.cells[n]):t.appendChild(e)}}}(a,l),t.onContentChange&&t.onContentChange());break;case"format-cell":const o=Je(e),r=o.length>0?o:[a],i=function(e){if(!e)return{...De};const t=window.getComputedStyle(e);let n="";const o=t.backgroundColor;o&&"rgba(0, 0, 0, 0)"!==o&&"transparent"!==o&&(n=Fe(o));let r=De.textColor;const a=t.color;a&&(r=Fe(a)||De.textColor);let l=t.textAlign||De.hAlign;"start"===l&&(l="left"),"end"===l&&(l="right");let i=t.verticalAlign||De.vAlign;return"baseline"===i&&(i="middle"),{bgColor:n,textColor:r,hAlign:l,vAlign:i}}(r[0]);je(i).then(n=>{r.forEach(e=>function(e,t){e&&t&&(t.bgColor?e.style.backgroundColor=t.bgColor:e.style.backgroundColor="",t.textColor&&(e.style.color=t.textColor),t.hAlign&&(e.style.textAlign=t.hAlign),t.vAlign&&(e.style.verticalAlign=t.vAlign))}(e,n)),_e(e),t.onContentChange&&t.onContentChange()}).catch(()=>{})}Ue()})}),document.addEventListener("click",e=>{We&&!We.contains(e.target)&&Ue()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&We&&Ue()}),document.addEventListener("scroll",()=>{Ue()},!0)}function _e(e){if(e){e.querySelectorAll(".nge-cell-selected").forEach(e=>e.classList.remove("nge-cell-selected"))}Oe.clear()}function Je(e){return e?Array.from(e.querySelectorAll(".nge-cell-selected")):[]}function Ke(e){const t=e.closest("tr");if(!t)return-1;const n=t.closest("tbody");return t.closest("thead")?-1:n?Array.from(n.rows).indexOf(t):-1}function Ze(e){const t=e.closest("tr");return t?Array.from(t.cells).indexOf(e):-1}function Xe(e){const t=e.querySelector("tr");if(!t)return 0;let n=0;return Array.from(t.cells).forEach(e=>{n+=e.colSpan||1}),n}function Ye(e,t){t&&e&&(t.style.cssText&&(e.style.cssText=t.style.cssText),t.hasAttribute("data-sortable")&&e.setAttribute("data-sortable",t.getAttribute("data-sortable")))}function Qe(e){if(!e||e.length<2)return!1;if(1!==new Set(e.map(e=>e.closest("table"))).size)return!1;const t=e.map(e=>({row:Ke(e),col:Ze(e),cell:e})),n=[...new Set(t.map(e=>e.row))].sort((e,t)=>e-t),o=[...new Set(t.map(e=>e.col))].sort((e,t)=>e-t);for(let e=1;e<n.length;e++)if(n[e]-n[e-1]!==1)return!1;for(let e=1;e<o.length;e++)if(o[e]-o[e-1]!==1)return!1;const r=n.length*o.length;return e.length===r}function et(e){return!!e&&(e.rowSpan&&e.rowSpan>1||e.colSpan&&e.colSpan>1)}const tt={small:{label:"Petit (1rem)",value:"1rem"},medium:{label:"Moyen (2rem)",value:"2rem"},large:{label:"Grand (3rem)",value:"3rem"}},nt={auto:{label:"Indéfinie",value:"auto"},small:{label:"Petite",value:"200px"},medium:{label:"Moyenne",value:"400px"},large:{label:"Grande",value:"800px"}},ot=["25","50","75","100"],rt={left:{label:"Gauche",icon:"⊏"},center:{label:"Centre",icon:"⊡"},right:{label:"Droite",icon:"⊐"}},at={block:{label:"Retour à la ligne",description:"Le texte suivant commencera sous le bloc."},float:{label:"Texte englobant",description:"Le texte suivant entourera le bloc."}},lt={top:"Haut",middle:"Milieu",bottom:"Bas"},it={1:{label:"1px",value:"1px"},2:{label:"2px",value:"2px"},3:{label:"3px",value:"3px"},4:{label:"4px",value:"4px"}},st={solid:{label:"Solide",value:"solid"},dashed:{label:"Tirets",value:"dashed"},dotted:{label:"Points",value:"dotted"},double:{label:"Double",value:"double"}},dt={columns:2,gap:"medium",height:"auto",width:"100",align:"center",wrap:"block",valign:"top",border:!1,borderColor:"#dee2e6",borderWidth:"1",borderStyle:"solid",bgContainer:"",bgColumns:""};function ct(e,t,n,o){const r=document.createElement("div");return r.className="nge-button-group",r.setAttribute("role","radiogroup"),Object.entries(e).forEach(([e,t])=>{const a=document.createElement("button");a.type="button",a.className="nge-button-option",a.setAttribute("data-value",e),a.setAttribute("role","radio"),a.setAttribute("aria-checked",e===n?"true":"false"),e===n&&a.classList.add("nge-selected"),"object"==typeof t&&t.label?a.innerHTML=t.icon?`<span class="nge-option-icon">${t.icon}</span> ${t.label}`:t.label:a.textContent=t,a.addEventListener("click",()=>{r.querySelectorAll(".nge-button-option").forEach(e=>{e.classList.remove("nge-selected"),e.setAttribute("aria-checked","false")}),a.classList.add("nge-selected"),a.setAttribute("aria-checked","true"),o&&o(e)}),r.appendChild(a)}),r}function ut(e){if(!e)return{...dt};const t=e.querySelector('[data-testid="nge-column-count"]'),n=t?.querySelector(".nge-selected"),o=n?parseInt(n.getAttribute("data-value"),10):dt.columns,r=e.querySelector("#nge-column-gap"),a=r?.value||dt.gap,l=e.querySelector('[data-testid="nge-column-height"]'),i=l?.querySelector(".nge-selected"),s=i?.getAttribute("data-value")||dt.height,d=e.querySelector('[data-testid="nge-column-width"]'),c=d?.querySelector(".nge-selected"),u=c?.getAttribute("data-value")||dt.width,g=e.querySelector('[data-testid="nge-column-align"]'),p=g?.querySelector(".nge-selected"),m=p?.getAttribute("data-value")||dt.align,h=e.querySelector('[data-testid="nge-column-wrap"]'),b=h?.querySelector(".nge-selected"),f=b?.getAttribute("data-value")||dt.wrap,v=e.querySelector("#nge-column-valign"),w=v?.value||dt.valign,C=e.querySelector("#nge-column-border"),y=C?.checked||!1,x=e.querySelector("#nge-column-border-color"),E=x?.value||dt.borderColor,S=e.querySelector('[data-testid="nge-column-border-width"]'),k=S?.querySelector(".nge-selected"),A=k?.getAttribute("data-value")||dt.borderWidth,L=e.querySelector('[data-testid="nge-column-border-style"]'),T=L?.querySelector(".nge-selected"),M=T?.getAttribute("data-value")||dt.borderStyle,N=e.querySelector("#nge-column-bg-container"),R=N?.value||"",I=e.querySelector("#nge-column-bg-columns"),q=I?.value||"";return{columns:o,gap:a,height:s,width:u,align:m,wrap:f,valign:w,border:y,borderColor:E,borderWidth:A,borderStyle:M,bgContainer:"#ffffff"===R?"":R,bgColumns:"#ffffff"===q?"":q}}function gt(e){return e?!e.columns||e.columns<1||e.columns>3?{isValid:!1,error:l("columns.errorCount")}:tt[e.gap]?nt[e.height]?ot.includes(e.width)?rt[e.align]?{isValid:!0}:{isValid:!1,error:l("columns.errorAlignment")}:{isValid:!1,error:l("columns.errorWidth")}:{isValid:!1,error:l("columns.errorHeight")}:{isValid:!1,error:l("columns.errorSpacing")}:{isValid:!1,error:"No values provided"}}function pt(e){const t=[];return t.push(`width: ${e.width}%`),"center"===e.align?t.push("margin-left: auto","margin-right: auto"):"right"===e.align&&t.push("margin-left: auto"),"float"===e.wrap?t.push("float: left","margin-right: 16px","margin-bottom: 16px"):t.push("display: block","clear: both"),e.bgContainer&&t.push(`background-color: ${e.bgContainer}`,"padding: 12px","border-radius: 8px"),t.join("; ")}function mt(e){const t=[];t.push(`column-count: ${e.columns}`),t.push(`column-gap: ${tt[e.gap].value}`);const n=nt[e.height].value;if("auto"!==n&&t.push(`max-height: ${n}`,"overflow: auto"),e.border){const n=it[e.borderWidth]?.value||"1px",o=st[e.borderStyle]?.value||"solid",r=e.borderColor||"#dee2e6";t.push(`column-rule: ${n} ${o} ${r}`)}return e.bgColumns&&t.push(`background-color: ${e.bgColumns}`,"padding: 12px","border-radius: 4px"),t.join("; ")}function ht(e={}){const t=function(e={}){const t={...dt,...e},n=document.createElement("div");let o;n.className="nge-column-modal-content";const r=document.createElement("div");r.className="nge-form-group";const a=document.createElement("label");a.className="nge-form-label nge-form-label-with-icon",a.innerHTML=`<span class="nge-label-icon">⊞</span> ${l("columns.count")}`;const i=ct({1:`☐ ${l("columns.col1")}`,2:`⊟ ${l("columns.col2")}`,3:`⊞ ${l("columns.col3")}`},0,String(t.columns),e=>{o&&o()});i.setAttribute("data-testid","nge-column-count");const s=document.createElement("span");s.className="nge-form-hint",s.textContent=l("columns.countHint"),r.appendChild(a),r.appendChild(i),r.appendChild(s);const d=document.createElement("div");d.className="nge-form-group";const c=document.createElement("label");c.className="nge-form-label nge-form-label-with-icon",c.setAttribute("for","nge-column-gap"),c.innerHTML=`<span class="nge-label-icon">↔</span> ${l("columns.spacing")}`;const u=document.createElement("select");u.id="nge-column-gap",u.className="nge-form-select",u.setAttribute("data-testid","nge-column-gap"),Object.entries(tt).forEach(([e,n])=>{const o=document.createElement("option");o.value=e,o.textContent=n.label,e===t.gap&&(o.selected=!0),u.appendChild(o)}),u.addEventListener("change",()=>{o&&o()}),d.appendChild(c),d.appendChild(u);const g=document.createElement("div");g.className="nge-form-group";const p=document.createElement("label");p.className="nge-form-label nge-form-label-with-icon",p.innerHTML=`<span class="nge-label-icon">↕</span> ${l("columns.height")}`;const m={};Object.entries(nt).forEach(([e,t])=>{m[e]=t.label});const h=ct(m,0,t.height,e=>{o&&o()});h.setAttribute("data-testid","nge-column-height");const b=document.createElement("span");b.className="nge-form-hint",b.textContent=l("columns.heightHint"),g.appendChild(p),g.appendChild(h),g.appendChild(b);const f=document.createElement("div");f.className="nge-form-group";const v=document.createElement("label");v.className="nge-form-label nge-form-label-with-icon",v.innerHTML=`<span class="nge-label-icon">⊡</span> ${l("columns.blockWidth")}`;const w={};ot.forEach(e=>{w[e]=`${e}%`});const C=ct(w,0,t.width,e=>{o&&o()});C.setAttribute("data-testid","nge-column-width");const y=document.createElement("span");y.className="nge-form-hint",y.textContent=l("columns.widthHint"),f.appendChild(v),f.appendChild(C),f.appendChild(y);const x=document.createElement("div");x.className="nge-form-group";const E=document.createElement("label");E.className="nge-form-label nge-form-label-with-icon",E.innerHTML=`<span class="nge-label-icon">≡</span> ${l("columns.blockAlignment")}`;const S=ct(rt,0,t.align,e=>{o&&o()});S.setAttribute("data-testid","nge-column-align");const k=document.createElement("span");k.className="nge-form-hint",k.textContent=l("columns.alignHint"),x.appendChild(E),x.appendChild(S),x.appendChild(k);const A=document.createElement("div");A.className="nge-form-group";const L=document.createElement("label");L.className="nge-form-label nge-form-label-with-icon",L.innerHTML=`<span class="nge-label-icon">≋</span> ${l("columns.textWrap")}`;const T={};Object.entries(at).forEach(([e,t])=>{T[e]=`↵ ${t.label}`});const M=ct(T,0,t.wrap,e=>{const t=A.querySelector(".nge-form-hint");t&&(t.textContent=at[e].description),o&&o()});M.setAttribute("data-testid","nge-column-wrap");const N=document.createElement("span");N.className="nge-form-hint",N.textContent=at[t.wrap].description,A.appendChild(L),A.appendChild(M),A.appendChild(N);const R=document.createElement("div");R.className="nge-form-group";const I=document.createElement("label");I.className="nge-form-label nge-form-label-with-icon",I.setAttribute("for","nge-column-valign"),I.innerHTML=`<span class="nge-label-icon">T</span> ${l("columns.verticalAlign")}`;const q=document.createElement("select");q.id="nge-column-valign",q.className="nge-form-select",q.setAttribute("data-testid","nge-column-valign"),Object.entries(lt).forEach(([e,n])=>{const o=document.createElement("option");o.value=e,o.textContent=n,e===t.valign&&(o.selected=!0),q.appendChild(o)}),q.addEventListener("change",()=>{o&&o()}),R.appendChild(I),R.appendChild(q);const $=document.createElement("div");$.className="nge-form-group";const D=document.createElement("div");D.className="nge-form-group-inline";const B=document.createElement("label");B.className="nge-toggle-wrapper";const z=document.createElement("input");z.type="checkbox",z.id="nge-column-border",z.className="nge-toggle-input",z.checked=t.border,z.setAttribute("data-testid","nge-column-border");const H=document.createElement("span");H.className="nge-toggle-slider";const F=document.createElement("span");F.className="nge-form-label nge-form-label-with-icon",F.innerHTML=`<span class="nge-label-icon">⊡</span> ${l("columns.borders")}`,B.appendChild(z),B.appendChild(H),D.appendChild(B),D.appendChild(F),$.appendChild(D);const j=document.createElement("div");j.className="nge-border-options-panel",j.id="nge-border-options",j.style.display=t.border?"block":"none",j.setAttribute("data-testid","nge-border-options");const P=document.createElement("div");P.className="nge-border-option-group";const W=document.createElement("label");W.className="nge-border-option-label",W.setAttribute("for","nge-column-border-color"),W.textContent=l("columns.borderColor");const O=K({id:"nge-column-border-color",testId:"nge-column-border-color",value:t.borderColor||"#dee2e6",onChange:()=>{o&&o()}});P.appendChild(W),P.appendChild(O);const V=document.createElement("div");V.className="nge-border-option-group";const U=document.createElement("label");U.className="nge-border-option-label",U.textContent=l("columns.borderThickness");const G={};Object.entries(it).forEach(([e,t])=>{G[e]=t.label});const _=ct(G,0,t.borderWidth||"1",e=>{o&&o()});_.setAttribute("data-testid","nge-column-border-width"),_.className="nge-button-group nge-button-group-small",V.appendChild(U),V.appendChild(_);const J=document.createElement("div");J.className="nge-border-option-group";const Z=document.createElement("label");Z.className="nge-border-option-label",Z.textContent=l("columns.borderStyle");const X={};Object.entries(st).forEach(([e,t])=>{X[e]=t.label});const Y=ct(X,0,t.borderStyle||"solid",e=>{o&&o()});Y.setAttribute("data-testid","nge-column-border-style"),Y.className="nge-button-group nge-button-group-small",J.appendChild(Z),J.appendChild(Y),j.appendChild(P),j.appendChild(V),j.appendChild(J),$.appendChild(j),z.addEventListener("change",()=>{j.style.display=z.checked?"block":"none",o&&o()});const Q=document.createElement("div");Q.className="nge-form-group";const ee=document.createElement("label");ee.className="nge-form-label nge-form-label-with-icon",ee.innerHTML=`<span class="nge-label-icon">✎</span> ${l("columns.bgColors")}`;const te=document.createElement("div");te.className="nge-colors-row";const ne=document.createElement("div");ne.className="nge-color-group";const oe=document.createElement("label");oe.className="nge-color-label",oe.setAttribute("for","nge-column-bg-container"),oe.textContent=l("columns.bgArea");const re=K({id:"nge-column-bg-container",testId:"nge-column-bg-container",value:t.bgContainer||"#ffffff",onChange:()=>{o&&o()}});ne.appendChild(oe),ne.appendChild(re);const ae=document.createElement("div");ae.className="nge-color-group";const le=document.createElement("label");le.className="nge-color-label",le.setAttribute("for","nge-column-bg-columns"),le.textContent=l("columns.bgColumns");const ie=K({id:"nge-column-bg-columns",testId:"nge-column-bg-columns",value:t.bgColumns||"#ffffff",onChange:()=>{o&&o()}});ae.appendChild(le),ae.appendChild(ie),te.appendChild(ne),te.appendChild(ae),Q.appendChild(ee),Q.appendChild(te);const se=document.createElement("div");se.className="nge-form-group nge-column-preview-section";const de=document.createElement("label");de.className="nge-form-label nge-form-label-with-icon",de.innerHTML=`<span class="nge-label-icon">◉</span> ${l("columns.preview")}`;const ce=document.createElement("div");ce.className="nge-column-preview-container",ce.setAttribute("data-testid","nge-column-preview");const ue=document.createElement("div");return ue.className="nge-column-preview",ce.appendChild(ue),se.appendChild(de),se.appendChild(ce),o=()=>{const e=ut(n),t=e.columns,o=tt[e.gap].value,r=nt[e.height].value;let a=`column-count: ${t}; column-gap: ${o};`;"auto"!==r&&(a+=` max-height: ${r}; overflow: auto;`),e.border&&(a+=` column-rule: ${it[e.borderWidth]?.value||"1px"} ${st[e.borderStyle]?.value||"solid"} ${e.borderColor||"#dee2e6"};`),e.bgColumns&&"#ffffff"!==e.bgColumns&&(a+=` background-color: ${e.bgColumns}; padding: 12px;`),ue.setAttribute("style",a);let i=`width: ${e.width}%;`;"center"===e.align?i+=" margin-left: auto; margin-right: auto;":"right"===e.align&&(i+=" margin-left: auto;"),e.bgContainer&&"#ffffff"!==e.bgContainer&&(i+=` background-color: ${e.bgContainer}; padding: 8px;`),ce.setAttribute("style",i);let s="";for(let e=1;e<=t;e++)s+=`<strong>${l("columns.previewColumn")} ${e}</strong><br>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.<br><br>`;ue.innerHTML=s},n.appendChild(r),n.appendChild(d),n.appendChild(g),n.appendChild(f),n.appendChild(x),n.appendChild(A),n.appendChild(R),n.appendChild($),n.appendChild(Q),n.appendChild(se),setTimeout(()=>o(),0),n}(e);return w(v({id:"column-modal",title:l("columns.title"),content:t,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:l("columns.apply"),variant:"primary"}]})).then(e=>{if("confirm"===e){const n=ut(t),o=gt(n);return o.isValid?{action:e,...n}:Promise.reject(new Error(o.error))}return{action:e}})}const bt={smileys:{name:"Smileys & Émotions",icon:"😀",emojis:["😀","😃","😄","😁","😆","😅","🤣","😂","🙂","🙃","😉","😊","😇","🥰","😍","🤩","😘","😗","☺️","😚","😙","🥲","😋","😛","😜","🤪","😝","🤑","🤗","🤭","🤫","🤔","🤐","🤨","😐","😑","😶","😏","😒","🙄","😬","🤥","😌","😔","😪","🤤","😴","😷","🤒","🤕","🤢","🤮","🤧","🥵","🥶","🥴","😵","🤯","🤠","🥳","🥸","😎","🤓","🧐","😕","😟","🙁","☹️","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","🥱","😤","😡","😠","🤬","😈","👿","💀","☠️","💩","🤡","👹","👺","👻","👽","👾","🤖","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🙈","🙉","🙊","💋","💌","💘","💝","💖","💗","💓","💞","💕","💟","❣️","💔","❤️","🧡","💛","💚","💙","💜","🤎","🖤","🤍","💯","💢","💥","💫","💦","💨","🕳️","💣","💬","👁️‍🗨️","🗨️","🗯️","💭","💤"]},people:{name:"Personnes & Corps",icon:"👋",emojis:["👋","🤚","🖐️","✋","🖖","👌","🤌","🤏","✌️","🤞","🤟","🤘","🤙","👈","👉","👆","🖕","👇","☝️","👍","👎","✊","👊","🤛","🤜","👏","🙌","👐","🤲","🤝","🙏","✍️","💅","🤳","💪","🦾","🦿","🦵","🦶","👂","🦻","👃","🧠","🫀","🫁","🦷","🦴","👀","👁️","👅","👄","👶","🧒","👦","👧","🧑","👱","👨","🧔","👩","🧓","👴","👵","🙍","🙎","🙅","🙆","💁","🙋","🧏","🙇","🤦","🤷","👮","🕵️","💂","🥷","👷","🤴","👸","👳","👲","🧕","🤵","👰","🤰","🤱","👼","🎅","🤶","🦸","🦹","🧙","🧚","🧛","🧜","🧝","🧞","🧟","💆","💇","🚶","🧍","🧎","🏃","💃","🕺","🕴️","👯","🧖","🧗","🤸","🏌️","🏇","⛷️","🏂","🏋️","🤼","🤽","🤾","🤺","⛹️","🏊","🚣","🧘","🛀","🛌","👭","👫","👬","💏","💑","👪","👨‍👩‍👦","👨‍👩‍👧","👨‍👩‍👧‍👦","👨‍👩‍👦‍👦","👨‍👩‍👧‍👧"]},animals:{name:"Animaux & Nature",icon:"🐶",emojis:["🐶","🐕","🦮","🐕‍🦺","🐩","🐺","🦊","🦝","🐱","🐈","🐈‍⬛","🦁","🐯","🐅","🐆","🐴","🐎","🦄","🦓","🦌","🦬","🐮","🐂","🐃","🐄","🐷","🐖","🐗","🐽","🐏","🐑","🐐","🐪","🐫","🦙","🦒","🐘","🦣","🦏","🦛","🐭","🐁","🐀","🐹","🐰","🐇","🐿️","🦫","🦔","🦇","🐻","🐻‍❄️","🐨","🐼","🦥","🦦","🦨","🦘","🦡","🐾","🦃","🐔","🐓","🐣","🐤","🐥","🐦","🐧","🕊️","🦅","🦆","🦢","🦉","🦤","🪶","🦩","🦚","🦜","🐸","🐊","🐢","🦎","🐍","🐲","🐉","🦕","🦖","🐳","🐋","🐬","🦭","🐟","🐠","🐡","🦈","🐙","🐚","🐌","🦋","🐛","🐜","🐝","🪲","🐞","🦗","🪳","🕷️","🕸️","🦂","🦟","🪰","🪱","🦠","💐","🌸","💮","🏵️","🌹","🥀","🌺","🌻","🌼","🌷","🌱","🪴","🌲","🌳","🌴","🌵","🌾","🌿","☘️","🍀","🍁","🍂","🍃","🍄","🌰","🦀","🦞","🦐","🦑","🌍","🌎","🌏","🌐","🪨","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌛","🌜","☀️","🌝","🌞","🪐","⭐","🌟","✨","⚡","☄️","💥","🔥","🌪️","🌈","☁️","⛅","⛈️","🌤️","🌥️","🌦️","🌧️","🌨️","🌩️","🌫️","💨","💧","💦","☔","☂️","🌊","❄️","☃️","⛄","🌬️"]},food:{name:"Nourriture & Boissons",icon:"🍔",emojis:["🍇","🍈","🍉","🍊","🍋","🍌","🍍","🥭","🍎","🍏","🍐","🍑","🍒","🍓","🫐","🥝","🍅","🫒","🥥","🥑","🍆","🥔","🥕","🌽","🌶️","🫑","🥒","🥬","🥦","🧄","🧅","🍄","🥜","🌰","🍞","🥐","🥖","🫓","🥨","🥯","🥞","🧇","🧀","🍖","🍗","🥩","🥓","🍔","🍟","🍕","🌭","🥪","🌮","🌯","🫔","🥙","🧆","🥚","🍳","🥘","🍲","🫕","🥣","🥗","🍿","🧈","🧂","🥫","🍱","🍘","🍙","🍚","🍛","🍜","🍝","🍠","🍢","🍣","🍤","🍥","🥮","🍡","🥟","🥠","🥡","🦀","🦞","🦐","🦑","🦪","🍦","🍧","🍨","🍩","🍪","🎂","🍰","🧁","🥧","🍫","🍬","🍭","🍮","🍯","🍼","🥛","☕","🫖","🍵","🍶","🍾","🍷","🍸","🍹","🍺","🍻","🥂","🥃","🥤","🧋","🧃","🧉","🧊","🥢","🍽️","🍴","🥄","🔪","🏺"]},activities:{name:"Activités",icon:"⚽",emojis:["⚽","🏀","🏈","⚾","🥎","🎾","🏐","🏉","🥏","🎱","🪀","🏓","🏸","🏒","🏑","🥍","🏏","🪃","🥅","⛳","🪁","🏹","🎣","🤿","🥊","🥋","🎽","🛹","🛼","🛷","⛸️","🥌","🎿","⛷️","🏂","🪂","🏋️","🤼","🤸","⛹️","🤾","🏌️","🏇","🧘","🏄","🏊","🤽","🚣","🧗","🚴","🚵","🎖️","🏆","🥇","🥈","🥉","🏅","🎗️","🎫","🎟️","🎪","🤹","🎭","🩰","🎨","🎬","🎤","🎧","🎼","🎹","🥁","🪘","🎷","🎺","🪗","🎸","🪕","🎻","🎲","♟️","🎯","🎳","🎮","🎰","🧩"]},travel:{name:"Voyages & Lieux",icon:"✈️",emojis:["🚗","🚕","🚙","🚌","🚎","🏎️","🚓","🚑","🚒","🚐","🛻","🚚","🚛","🚜","🦯","🦽","🦼","🛴","🚲","🛵","🏍️","🛺","🚨","🚔","🚍","🚘","🚖","🚡","🚠","🚟","🚃","🚋","🚞","🚝","🚄","🚅","🚈","🚂","🚆","🚇","🚊","🚉","✈️","🛫","🛬","🛩️","💺","🛰️","🚀","🛸","🚁","🛶","⛵","🚤","🛥️","🛳️","⛴️","🚢","⚓","🪝","⛽","🚧","🚦","🚥","🚏","🗺️","🗿","🗽","🗼","🏰","🏯","🏟️","🎡","🎢","🎠","⛲","⛱️","🏖️","🏝️","🏜️","🌋","⛰️","🏔️","🗻","🏕️","⛺","🛖","🏠","🏡","🏘️","🏚️","🏗️","🏭","🏢","🏬","🏣","🏤","🏥","🏦","🏨","🏪","🏫","🏩","💒","🏛️","⛪","🕌","🕍","🛕","🕋","⛩️","🛤️","🛣️","🗾","🎑","🏞️","🌅","🌄","🌠","🎇","🎆","🌇","🌆","🏙️","🌃","🌌","🌉","🌁"]},objects:{name:"Objets",icon:"💡",emojis:["⌚","📱","📲","💻","⌨️","🖥️","🖨️","🖱️","🖲️","🕹️","🗜️","💽","💾","💿","📀","📼","📷","📸","📹","🎥","📽️","🎞️","📞","☎️","📟","📠","📺","📻","🎙️","🎚️","🎛️","🧭","⏱️","⏲️","⏰","🕰️","⌛","⏳","📡","🔋","🔌","💡","🔦","🕯️","🪔","🧯","🛢️","💸","💵","💴","💶","💷","🪙","💰","💳","💎","⚖️","🪜","🧰","🪛","🔧","🔨","⚒️","🛠️","⛏️","🪚","🔩","⚙️","🪤","🧱","⛓️","🧲","🔫","💣","🧨","🪓","🔪","🗡️","⚔️","🛡️","🚬","⚰️","🪦","⚱️","🏺","🔮","📿","🧿","💈","⚗️","🔭","🔬","🕳️","🩹","🩺","💊","💉","🩸","🧬","🦠","🧫","🧪","🌡️","🧹","🪠","🧺","🧻","🚽","🚰","🚿","🛁","🛀","🧼","🪥","🪒","🧽","🪣","🧴","🛎️","🔑","🗝️","🚪","🪑","🛋️","🛏️","🛌","🧸","🪆","🖼️","🪞","🪟","🛍️","🛒","🎁","🎈","🎏","🎀","🪄","🧧","🎐","🎋","🎍","🎎","🎑","🧧","📩","📨","📧","💌","📥","📤","📦","🏷️","📪","📫","📬","📭","📮","📯","📜","📃","📄","📑","🧾","📊","📈","📉","🗒️","🗓️","📆","📅","🗑️","📇","🗃️","🗳️","🗄️","📋","📁","📂","🗂️","🗞️","📰","📓","📔","📒","📕","📗","📘","📙","📚","📖","🔖","🧷","🔗","📎","🖇️","📐","📏","🧮","📌","📍","✂️","🖊️","🖋️","✒️","🖌️","🖍️","📝","✏️","🔍","🔎","🔏","🔐","🔒","🔓"]},symbols:{name:"Symboles",icon:"❤️",emojis:["❤️","🧡","💛","💚","💙","💜","🖤","🤍","🤎","💔","❣️","💕","💞","💓","💗","💖","💘","💝","💟","☮️","✝️","☪️","🕉️","☸️","✡️","🔯","🕎","☯️","☦️","🛐","⛎","♈","♉","♊","♋","♌","♍","♎","♏","♐","♑","♒","♓","🆔","⚛️","🉑","☢️","☣️","📴","📳","🈶","🈚","🈸","🈺","🈷️","✴️","🆚","💮","🉐","㊙️","㊗️","🈴","🈵","🈹","🈲","🅰️","🅱️","🆎","🆑","🅾️","🆘","❌","⭕","🛑","⛔","📛","🚫","💯","💢","♨️","🚷","🚯","🚳","🚱","🔞","📵","🚭","❗","❕","❓","❔","‼️","⁉️","🔅","🔆","〽️","⚠️","🚸","🔱","⚜️","🔰","♻️","✅","🈯","💹","❇️","✳️","❎","🌐","💠","Ⓜ️","🌀","💤","🏧","🚾","♿","🅿️","🛗","🈳","🈂️","🛂","🛃","🛄","🛅","🚹","🚺","🚼","⚧️","🚻","🚮","🎦","📶","🈁","🔣","ℹ️","🔤","🔡","🔠","🆖","🆗","🆙","🆒","🆕","🆓","0️⃣","1️⃣","2️⃣","3️⃣","4️⃣","5️⃣","6️⃣","7️⃣","8️⃣","9️⃣","🔟","🔢","#️⃣","*️⃣","⏏️","▶️","⏸️","⏯️","⏹️","⏺️","⏭️","⏮️","⏩","⏪","⏫","⏬","◀️","🔼","🔽","➡️","⬅️","⬆️","⬇️","↗️","↘️","↙️","↖️","↕️","↔️","↪️","↩️","⤴️","⤵️","🔀","🔁","🔂","🔄","🔃","🎵","🎶","➕","➖","➗","✖️","♾️","💲","💱","™️","©️","®️","👁️‍🗨️","🔚","🔙","🔛","🔝","🔜","〰️","➰","➿","✔️","☑️","🔘","🔴","🟠","🟡","🟢","🔵","🟣","⚫","⚪","🟤","🔺","🔻","🔸","🔹","🔶","🔷","🔳","🔲","▪️","▫️","◾","◽","◼️","◻️","🟥","🟧","🟨","🟩","🟦","🟪","⬛","⬜","🟫","🔈","🔇","🔉","🔊","🔔","🔕","📣","📢","💬","💭","🗯️","♠️","♣️","♥️","♦️","🃏","🎴","🀄","🕐","🕑","🕒","🕓","🕔","🕕","🕖","🕗","🕘","🕙","🕚","🕛","🕜","🕝","🕞","🕟","🕠","🕡","🕢","🕣","🕤","🕥","🕦","🕧"]},flags:{name:"Drapeaux",icon:"🏳️",emojis:["🏳️","🏴","🏴‍☠️","🏁","🚩","🎌","🏳️‍🌈","🏳️‍⚧️","🇦🇫","🇦🇱","🇩🇿","🇦🇩","🇦🇴","🇦🇬","🇦🇷","🇦🇲","🇦🇺","🇦🇹","🇦🇿","🇧🇸","🇧🇭","🇧🇩","🇧🇧","🇧🇾","🇧🇪","🇧🇿","🇧🇯","🇧🇹","🇧🇴","🇧🇦","🇧🇼","🇧🇷","🇧🇳","🇧🇬","🇧🇫","🇧🇮","🇰🇭","🇨🇲","🇨🇦","🇨🇻","🇨🇫","🇹🇩","🇨🇱","🇨🇳","🇨🇴","🇰🇲","🇨🇬","🇨🇩","🇨🇷","🇨🇮","🇭🇷","🇨🇺","🇨🇾","🇨🇿","🇩🇰","🇩🇯","🇩🇲","🇩🇴","🇪🇨","🇪🇬","🇸🇻","🇬🇶","🇪🇷","🇪🇪","🇸🇿","🇪🇹","🇫🇯","🇫🇮","🇫🇷","🇬🇦","🇬🇲","🇬🇪","🇩🇪","🇬🇭","🇬🇷","🇬🇩","🇬🇹","🇬🇳","🇬🇼","🇬🇾","🇭🇹","🇭🇳","🇭🇺","🇮🇸","🇮🇳","🇮🇩","🇮🇷","🇮🇶","🇮🇪","🇮🇱","🇮🇹","🇯🇲","🇯🇵","🇯🇴","🇰🇿","🇰🇪","🇰🇮","🇰🇵","🇰🇷","🇰🇼","🇰🇬","🇱🇦","🇱🇻","🇱🇧","🇱🇸","🇱🇷","🇱🇾","🇱🇮","🇱🇹","🇱🇺","🇲🇬","🇲🇼","🇲🇾","🇲🇻","🇲🇱","🇲🇹","🇲🇭","🇲🇷","🇲🇺","🇲🇽","🇫🇲","🇲🇩","🇲🇨","🇲🇳","🇲🇪","🇲🇦","🇲🇿","🇲🇲","🇳🇦","🇳🇷","🇳🇵","🇳🇱","🇳🇿","🇳🇮","🇳🇪","🇳🇬","🇲🇰","🇳🇴","🇴🇲","🇵🇰","🇵🇼","🇵🇸","🇵🇦","🇵🇬","🇵🇾","🇵🇪","🇵🇭","🇵🇱","🇵🇹","🇶🇦","🇷🇴","🇷🇺","🇷🇼","🇼🇸","🇸🇲","🇸🇹","🇸🇦","🇸🇳","🇷🇸","🇸🇨","🇸🇱","🇸🇬","🇸🇰","🇸🇮","🇸🇧","🇸🇴","🇿🇦","🇸🇸","🇪🇸","🇱🇰","🇸🇩","🇸🇷","🇸🇪","🇨🇭","🇸🇾","🇹🇼","🇹🇯","🇹🇿","🇹🇭","🇹🇱","🇹🇬","🇹🇴","🇹🇹","🇹🇳","🇹🇷","🇹🇲","🇹🇻","🇺🇬","🇺🇦","🇦🇪","🇬🇧","🇺🇸","🇺🇾","🇺🇿","🇻🇺","🇻🇦","🇻🇪","🇻🇳","🇾🇪","🇿🇲","🇿🇼"]}},ft="nge-emoji-usage";function vt(){try{const e=localStorage.getItem(ft);return e?JSON.parse(e):{}}catch{return{}}}function wt(e){const t=document.createElement("div");t.className="nge-emoji-picker",t.setAttribute("data-testid","nge-emoji-picker");const n=document.createElement("div");n.className="nge-emoji-search-container";const o=document.createElement("input");o.type="text",o.className="nge-emoji-search",o.placeholder=l("emoji.search"),o.setAttribute("data-testid","nge-emoji-search"),n.appendChild(o),t.appendChild(n);const r=document.createElement("div");r.className="nge-emoji-tabs",r.setAttribute("data-testid","nge-emoji-tabs");const a=document.createElement("button");a.type="button",a.className="nge-emoji-tab nge-emoji-tab-active",a.setAttribute("data-category","most-used"),a.setAttribute("title",l("emoji.mostUsed")),a.textContent="⏱️",r.appendChild(a),Object.entries(bt).forEach(([e,t])=>{const n=document.createElement("button");n.type="button",n.className="nge-emoji-tab",n.setAttribute("data-category",e),n.setAttribute("title",t.name),n.textContent=t.icon,r.appendChild(n)}),t.appendChild(r);const i=document.createElement("div");i.className="nge-emoji-grid-container",i.setAttribute("data-testid","nge-emoji-grid"),t.appendChild(i);const s=(t,n=null)=>{if(i.innerHTML="",n){const e=document.createElement("div");e.className="nge-emoji-category-title",e.textContent=n,i.appendChild(e)}if(0===t.length){const e=document.createElement("div");return e.className="nge-emoji-empty",e.textContent=n===l("emoji.mostUsed")?l("emoji.noRecentEmoji"):l("emoji.noResults"),void i.appendChild(e)}const o=document.createElement("div");o.className="nge-emoji-grid",t.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="nge-emoji-button",n.textContent=t,n.setAttribute("data-emoji",t),n.addEventListener("click",()=>{!function(e){try{const t=vt();t[e]=(t[e]||0)+1,localStorage.setItem(ft,JSON.stringify(t))}catch{}}(t),e&&e(t)}),o.appendChild(n)}),i.appendChild(o)},d=e=>{if(r.querySelectorAll(".nge-emoji-tab").forEach(t=>{t.classList.toggle("nge-emoji-tab-active",t.getAttribute("data-category")===e)}),"most-used"===e){const e=function(){const e=vt();return Object.entries(e).sort((e,t)=>t[1]-e[1]).slice(0,10).map(([e])=>e)}();s(e,l("emoji.mostUsed"))}else{const t=bt[e];t&&s(t.emojis,t.name)}};return r.addEventListener("click",e=>{const t=e.target.closest(".nge-emoji-tab");if(t){const e=t.getAttribute("data-category");d(e),o.value=""}}),o.addEventListener("input",()=>{const e=o.value.toLowerCase().trim();if(!e)return void d("most-used");const t=[];Object.values(bt).forEach(e=>{e.emojis.forEach(e=>{t.includes(e)||t.push(e)})});let n=[];Object.entries({sourire:["😀","😃","😄","😁","😊","🙂"],rire:["😂","🤣","😆","😅"],coeur:["❤️","🧡","💛","💚","💙","💜","🖤","🤍","💕","💖","💗","💘","💝"],triste:["😢","😭","😞","😔","🙁","☹️"],colere:["😠","😡","🤬","😤"],peur:["😨","😰","😱","😧"],bisou:["😘","😗","😙","😚","💋"],main:["👋","🤚","🖐️","✋","👌","✌️","🤞","👍","👎","👏","🙌"],soleil:["☀️","🌞","🌅","🌄"],lune:["🌙","🌛","🌜","🌝","🌚"],etoile:["⭐","🌟","✨","💫"],feu:["🔥","🧯"],eau:["💧","💦","🌊"],fleur:["🌸","💐","🌹","🌺","🌻","🌼","🌷"],animal:["🐶","🐱","🐭","🐹","🐰","🐻","🐼","🐨","🐯","🦁"],chien:["🐶","🐕","🦮","🐩"],chat:["🐱","🐈","😺","😸"],pizza:["🍕"],burger:["🍔"],cafe:["☕","🍵"],gateau:["🎂","🍰","🧁"],fete:["🎉","🎊","🥳","🎈","🎁"],musique:["🎵","🎶","🎤","🎧","🎸","🎹","🎷","🎺"],sport:["⚽","🏀","🏈","⚾","🎾","🏐"],voiture:["🚗","🚕","🚙","🏎️"],avion:["✈️","🛫","🛬","🛩️"],telephone:["📱","📲","☎️","📞"],ordinateur:["💻","🖥️","⌨️"],argent:["💰","💵","💴","💶","💷","💳"],temps:["⏰","⏱️","⌚","🕐"],ok:["👌","✅","👍","🆗"],non:["❌","🚫","⛔","👎"],question:["❓","❔","🤔"],exclamation:["❗","❕","‼️","⁉️"],france:["🇫🇷"],usa:["🇺🇸"],espagne:["🇪🇸"],italie:["🇮🇹"],allemagne:["🇩🇪"],japon:["🇯🇵"],chine:["🇨🇳"],royaume:["🇬🇧"],angleterre:["🇬🇧"],belgique:["🇧🇪"],suisse:["🇨🇭"],canada:["🇨🇦"]}).forEach(([t,o])=>{(t.includes(e)||e.includes(t))&&o.forEach(e=>{n.includes(e)||n.push(e)})}),0===n.length&&e.length>0&&(n=t.slice(0,50)),r.querySelectorAll(".nge-emoji-tab").forEach(e=>{e.classList.remove("nge-emoji-tab-active")}),s(n,`${l("emoji.resultsFor")} "${e}"`)}),d("most-used"),t}const Ct="nge-toolbar-config",yt=[{id:"font",title:"Selecteurs et couleurs",tools:[{id:"paragraph",label:"Style de paragraphe"},{id:"font-family",label:"Police"},{id:"font-size",label:"Taille"},{id:"line-height",label:"Interlignage"},{id:"text-color",label:"Couleur du texte"},{id:"bg-color",label:"Couleur de fond"}]},{id:"text-style",title:"Style de texte",tools:[{id:"bold",label:"Gras"},{id:"italic",label:"Italique"},{id:"underline",label:"Souligne"},{id:"strikethrough",label:"Barre"},{id:"text-case",label:"Changer la casse"},{id:"superscript",label:"Exposant"}]},{id:"alignment",title:"Alignement",tools:[{id:"align-left",label:"Aligner a gauche"},{id:"align-center",label:"Centrer"},{id:"align-right",label:"Aligner a droite"},{id:"align-justify",label:"Justifier"},{id:"indent",label:"Augmenter le retrait"},{id:"outdent",label:"Diminuer le retrait"}]},{id:"lists",title:"Listes",tools:[{id:"list-ul",label:"Liste a puces"},{id:"list-ol",label:"Liste numerotee"},{id:"list-todo",label:"Liste de taches"}]},{id:"insert",title:"Insertion",tools:[{id:"link",label:"Lien"},{id:"image",label:"Image"},{id:"video",label:"Video"},{id:"table",label:"Tableau"},{id:"columns",label:"Colonnes"},{id:"emoji",label:"Emoji"},{id:"quote",label:"Citation"},{id:"code",label:"Code"},{id:"hr",label:"Separateur"}]},{id:"action",title:"Actions",tools:[{id:"undo",label:"Annuler"},{id:"redo",label:"Retablir"},{id:"preview",label:"Apercu"},{id:"export-json",label:"Export JSON"},{id:"export-pdf",label:"Export PDF"},{id:"export-html",label:"Export HTML"}]}];function xt(){const e={};for(const t of function(){const e=[];for(const t of yt)for(const n of t.tools)e.push(n.id);return e}())e[t]=!0;return e}function Et(){try{const e=localStorage.getItem(Ct);if(e){const t=JSON.parse(e);if(t&&"object"==typeof t){if(6!==t._version)return localStorage.removeItem(Ct),xt();return{...xt(),...t}}}}catch(e){}return xt()}function St(e){const t=e.querySelectorAll("[data-tool]"),n=Array.from(t).filter(e=>e.checked).length,o=e.querySelector("#nge-toolbar-select-all"),r=e.querySelector("#nge-toolbar-select-all-text");o&&r&&(n>=2?(r.textContent=l("config.deselectAll"),o.checked=!0,o.indeterminate=!1):(r.textContent=l("config.selectAll"),o.checked=!1,o.indeterminate=1===n),function(e){const t=e.querySelectorAll("[data-group-checkbox]");t.forEach(e=>{e.getAttribute("data-group-checkbox");const t=e.closest(".nge-toolbar-config-group");if(!t)return;const n=t.querySelectorAll("[data-tool]:not(:disabled)"),o=Array.from(n).filter(e=>e.checked).length,r=n.length;0===o?(e.checked=!1,e.indeterminate=!1):o===r?(e.checked=!0,e.indeterminate=!1):(e.checked=!1,e.indeterminate=!0)})}(e))}function kt(e=null,t=[]){const n=e||xt(),r=document.createElement("div");r.className="nge-toolbar-config-content",r.setAttribute("data-testid","nge-toolbar-config-content");const i=document.createElement("div");i.className="nge-toolbar-config-language";const s=document.createElement("label");s.setAttribute("for","nge-language-select"),s.textContent=l("config.language");const d=document.createElement("select");d.id="nge-language-select",d.setAttribute("data-testid","nge-language-select");const c=a();o.forEach(e=>{const t=document.createElement("option");t.value=e.code,t.textContent=e.label,e.code===c&&(t.selected=!0),d.appendChild(t)}),i.appendChild(s),i.appendChild(d),r.appendChild(i);const u=document.createElement("div");u.className="nge-toolbar-config-theme";const g=document.createElement("label");g.setAttribute("for","nge-theme-select"),g.textContent=l("config.theme");const p=document.createElement("select");p.id="nge-theme-select",p.setAttribute("data-testid","nge-theme-select");const m=[{value:"light",label:l("config.themeLight")},{value:"dark",label:l("config.themeDark")},{value:"warm",label:l("config.themeWarm")},{value:"cold",label:l("config.themeCold")},{value:"taupe",label:l("config.themeTaupe")},{value:"pink",label:l("config.themePink")}],h=n.theme||"light";m.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,e.value===h&&(t.selected=!0),p.appendChild(t)}),u.appendChild(g),u.appendChild(p),r.appendChild(u);const b=document.createElement("div");b.className="nge-toolbar-config-icon-size";const f=document.createElement("label");f.setAttribute("for","nge-icon-size-select"),f.textContent=l("config.iconSize");const v=document.createElement("select");v.id="nge-icon-size-select",v.setAttribute("data-testid","nge-icon-size-select");const w=[{value:"small",label:l("config.iconSizeSmall")},{value:"large",label:l("config.iconSizeLarge")}],C=n.iconSize||"small";w.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,e.value===C&&(t.selected=!0),v.appendChild(t)}),b.appendChild(f),b.appendChild(v),r.appendChild(b);const y=document.createElement("div");y.className="nge-toolbar-config-toolbar-mode";const x=document.createElement("label");x.setAttribute("for","nge-toolbar-mode-select"),x.textContent=l("config.toolbarMode");const E=document.createElement("select");E.id="nge-toolbar-mode-select",E.setAttribute("data-testid","nge-toolbar-mode-select");const S=[{value:"integrated",label:l("config.toolbarModeIntegrated")},{value:"fullwidth-top",label:l("config.toolbarModeFullwidthTop")}],k=n.toolbarMode||"integrated";S.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,e.value===k&&(t.selected=!0),E.appendChild(t)}),y.appendChild(x),y.appendChild(E),r.appendChild(y);const A=document.createElement("div");A.className="nge-toolbar-config-custom-colors";const L=document.createElement("label");L.textContent=l("config.customColors");const T=document.createElement("small");T.className="nge-toolbar-config-help",T.textContent=l("config.customColorsHelp");const M=document.createElement("div");M.className="nge-toolbar-config-colors-input-row";const N=document.createElement("input");N.type="text",N.id="nge-custom-color-input",N.setAttribute("data-testid","nge-custom-color-input"),N.placeholder="#FF0000",N.maxLength=7;const R=document.createElement("button");R.type="button",R.className="nge-toolbar-config-add-color-btn",R.setAttribute("data-testid","nge-add-color-btn"),R.textContent="+",R.title=l("config.addColor"),M.appendChild(N),M.appendChild(R);const I=document.createElement("div");I.className="nge-toolbar-config-colors-list",I.id="nge-custom-colors-list",I.setAttribute("data-testid","nge-custom-colors-list"),A.appendChild(L),A.appendChild(T),A.appendChild(M),A.appendChild(I),r.appendChild(A);const q=n.customColors||[];function $(e){I.innerHTML="",e.forEach((e,t)=>{const n=document.createElement("div");n.className="nge-toolbar-config-color-item",n.setAttribute("data-color",e);const o=document.createElement("span");o.className="nge-toolbar-config-color-swatch",o.style.backgroundColor=e;const r=document.createElement("span");r.className="nge-toolbar-config-color-value",r.textContent=e;const a=document.createElement("button");a.type="button",a.className="nge-toolbar-config-remove-color-btn",a.setAttribute("data-testid",`nge-remove-color-${t}`),a.innerHTML="&times;",a.title=l("config.removeColor"),a.addEventListener("click",()=>{$(D().filter(t=>t!==e))}),n.appendChild(o),n.appendChild(r),n.appendChild(a),I.appendChild(n)})}function D(){const e=I.querySelectorAll(".nge-toolbar-config-color-item");return Array.from(e).map(e=>e.getAttribute("data-color"))}R.addEventListener("click",()=>{const e=N.value.trim();if(function(e){if(!e||"string"!=typeof e)return!1;const t=e.startsWith("#")?e:"#"+e;return/^#[0-9A-Fa-f]{6}$/.test(t)||/^#[0-9A-Fa-f]{3}$/.test(t)}(e)){const t=function(e){let t=e.startsWith("#")?e:"#"+e;return t=t.toUpperCase(),4===t.length&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),t}(e),n=D();n.includes(t)||(n.push(t),$(n)),N.value="",N.classList.remove("nge-input-error")}else N.classList.add("nge-input-error")}),N.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),R.click())}),N.addEventListener("input",()=>{N.classList.remove("nge-input-error")}),$(q),r._getCustomColors=D;const B=document.createElement("div");B.className="nge-toolbar-config-header";const z=document.createElement("label");z.className="nge-checkbox-label nge-select-all-label";const H=document.createElement("input");H.type="checkbox",H.id="nge-toolbar-select-all",H.setAttribute("data-testid","nge-toolbar-select-all");const F=document.createElement("span");F.id="nge-toolbar-select-all-text",F.textContent=l("config.selectAll"),z.appendChild(H),z.appendChild(F),B.appendChild(z),r.appendChild(B);const j=document.createElement("div");j.className="nge-toolbar-config-groups";const P=[{id:"font",title:l("config.groupFont"),tools:[{id:"paragraph",label:l("config.toolParagraph")},{id:"font-family",label:l("config.toolFontFamily")},{id:"font-size",label:l("config.toolFontSize")},{id:"line-height",label:l("config.toolLineHeight")},{id:"text-color",label:l("config.toolTextColor")},{id:"bg-color",label:l("config.toolBgColor")}]},{id:"text-style",title:l("config.groupTextStyle"),tools:[{id:"bold",label:l("config.toolBold")},{id:"italic",label:l("config.toolItalic")},{id:"underline",label:l("config.toolUnderline")},{id:"strikethrough",label:l("config.toolStrikethrough")},{id:"text-case",label:l("config.toolTextCase")},{id:"superscript",label:l("config.toolSuperscript")}]},{id:"alignment",title:l("config.groupAlignment"),tools:[{id:"align-left",label:l("config.toolAlignLeft")},{id:"align-center",label:l("config.toolAlignCenter")},{id:"align-right",label:l("config.toolAlignRight")},{id:"align-justify",label:l("config.toolAlignJustify")},{id:"indent",label:l("config.toolIndent")},{id:"outdent",label:l("config.toolOutdent")}]},{id:"lists",title:l("config.groupLists"),tools:[{id:"list-ul",label:l("config.toolListUl")},{id:"list-ol",label:l("config.toolListOl")},{id:"list-todo",label:l("config.toolListTodo")}]},{id:"media",title:l("config.groupMedia"),tools:[{id:"link",label:l("config.toolLink")},{id:"image",label:l("config.toolImage")},{id:"video",label:l("config.toolVideo")},{id:"table",label:l("config.toolTable")},{id:"columns",label:l("config.toolColumns")},{id:"emoji",label:l("config.toolEmoji")}]},{id:"insert",title:l("config.groupInsert"),tools:[{id:"quote",label:l("config.toolQuote")},{id:"code",label:l("config.toolCode")},{id:"hr",label:l("config.toolHr")}]},{id:"action",title:l("config.groupAction"),tools:[{id:"undo",label:l("config.toolUndo")},{id:"redo",label:l("config.toolRedo")},{id:"preview",label:l("config.toolPreview")},{id:"export-json",label:l("config.toolExportJson")},{id:"export-pdf",label:l("config.toolExportPdf")},{id:"export-html",label:l("config.toolExportHtml")}]}];for(const e of P){const o=document.createElement("div");o.className="nge-toolbar-config-group",o.setAttribute("data-testid",`nge-toolbar-config-group-${e.id}`);const r=document.createElement("label");r.className="nge-toolbar-config-group-title nge-checkbox-label";const a=document.createElement("input");a.type="checkbox",a.setAttribute("data-group-checkbox",e.id),a.setAttribute("data-testid",`nge-toolbar-config-group-checkbox-${e.id}`);const i=document.createElement("span");i.textContent=e.title,r.appendChild(a),r.appendChild(i),o.appendChild(r);const s=document.createElement("div");s.className="nge-toolbar-config-items";for(const o of e.tools){const e=document.createElement("label");e.className="nge-checkbox-label";const r=document.createElement("input");r.type="checkbox",r.setAttribute("data-tool",o.id),r.setAttribute("data-testid",`nge-toolbar-config-${o.id}`),r.checked=!1!==n[o.id];t.includes(o.id)&&(r.disabled=!0,e.classList.add("nge-tool-restricted"),e.setAttribute("title",l("status.restrictedTool"))),e.appendChild(r),e.appendChild(document.createTextNode(o.label)),s.appendChild(e)}o.appendChild(s),j.appendChild(o)}r.appendChild(j),H.addEventListener("click",()=>{!function(e){const t=e.querySelectorAll("[data-tool]"),n=Array.from(t).filter(e=>e.checked).length<2;t.forEach(e=>{e.checked=n}),St(e)}(r)});r.querySelectorAll("[data-tool]").forEach(e=>{e.addEventListener("change",()=>{St(r)})});return r.querySelectorAll("[data-group-checkbox]").forEach(e=>{e.addEventListener("click",t=>{const n=e.getAttribute("data-group-checkbox");!function(e,t,n){const o=e.querySelector(`[data-testid="nge-toolbar-config-group-${t}"]`);if(!o)return;o.querySelectorAll("[data-tool]:not(:disabled)").forEach(e=>{e.checked=n}),St(e)}(r,n,e.checked)})}),St(r),r}function At(e=null,t=[]){const n=kt(e,t);return w(v({id:"toolbar-config-modal",title:l("config.title"),content:n,buttons:[{id:"cancel",label:l("config.cancel"),variant:"secondary"},{id:"confirm",label:l("config.apply"),variant:"primary"}]})).then(e=>{if("confirm"===e){const e=function(e){const t={};return e.querySelectorAll("[data-tool]").forEach(e=>{const n=e.getAttribute("data-tool");n&&(t[n]=e.checked)}),t}(n),t=function(e){const t=e.querySelector("#nge-language-select");return t?t.value:a()}(n),o=function(e){const t=e.querySelector("#nge-theme-select");return t?t.value:"light"}(n),r=function(e){const t=e.querySelector("#nge-icon-size-select");return t?t.value:"small"}(n),l=function(e){const t=e.querySelector("#nge-toolbar-mode-select");return t?t.value:"integrated"}(n),i=function(e){return e._getCustomColors?e._getCustomColors():[]}(n);return{action:"confirm",config:e,language:t,theme:o,iconSize:r,toolbarMode:l,customColors:i}}throw new Error("Modal cancelled")})}const Lt="nge-license-cache",Tt=["paragraph","font-family","font-size","line-height","text-color","bg-color","bold","italic","underline","strikethrough","text-case","superscript","align-left","align-center","align-right","align-justify","indent","outdent","list-ul","list-ol","link","image","emoji","hr","undo","redo","toolbar-config"],Mt=["paragraph","font-family","font-size","line-height","text-color","bg-color","bold","italic","underline","strikethrough","text-case","superscript","align-left","align-center","align-right","align-justify","indent","outdent","list-ul","list-ol","list-todo","link","image","video","table","columns","emoji","quote","code","hr","undo","redo","preview","export-json","export-pdf","export-html","toolbar-config"];function Nt(e){try{const t={...e,cachedAt:Date.now(),domain:Rt(window.location.hostname)};localStorage.setItem(Lt,JSON.stringify(t))}catch(e){}}function Rt(e){return(e=(e||"").toLowerCase().trim()).startsWith("www.")&&(e=e.substring(4)),e}async function It(e,t=!1){const n=Rt(e);if(!t){const e=function(){try{const e=localStorage.getItem(Lt);if(!e)return null;const t=JSON.parse(e);if(t.cachedAt&&Date.now()-t.cachedAt>864e5)return localStorage.removeItem(Lt),null;const n=Rt(window.location.hostname);return t.domain!==n?(localStorage.removeItem(Lt),null):t}catch(e){return null}}();if(null!==e)return e}try{const e=await fetch(window.NGE_LICENSE_API_URL||"https://ngedition.fr/api/license/validate",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({domain:n})});if(!e.ok){const e={valid:!1,error:"api_error"};return Nt(e),e}const t=await e.json();return Nt(t),t}catch(e){return{valid:!1,error:"network_error"}}}function qt(e){return e?[]:Mt.filter(e=>!Tt.includes(e))}function $t(e){if(!e||"string"!=typeof e)return 0;const t=e.trim();return""===t?0:t.split(/\s+/).filter(e=>e.length>0).length}class Dt{constructor(e,t={}){if(!(e&&e instanceof HTMLElement))throw new Error("NGTextEditor requires a valid HTMLElement");this.element=e,this.options={autoSync:!0,syncInterval:1e3,initialFormat:"html",...t},this.structure=null,this.syncTimer=null,this.initialized=!1,this.toolbarConfig=null,this.savedSelection=null,this.isLocal=null,this.licenseValid=!1,this.licenseData=null,this.wordLimitReached=!1,this.init()}init(){if(this.initialized)throw new Error("Editor already initialized");try{this.isLocal=this.isLocalEnvironment(),this.isLocal&&(this.licenseValid=!0),this.toolbarConfig=Et();const n=this.isLocal?[]:qt(this.licenseValid);for(const e of n)this.toolbarConfig[e]=!1;this.structure=function(e,t=null,n="html"){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid target element");const o=document.createElement("div");o.className="nge-container",o.setAttribute("data-testid","nge-container");const r=u(t),a=document.createElement("div");a.className="nge-content",a.setAttribute("contenteditable","true"),a.setAttribute("role","textbox"),a.setAttribute("aria-multiline","true"),a.setAttribute("aria-label","Text editor content"),a.setAttribute("data-testid","nge-content"),e.value&&("html"===n?a.innerHTML=e.value:a.textContent=e.value),o._originalElement=e;const l=document.createElement("div");l.className="nge-counter",l.setAttribute("data-testid","nge-counter");const i=document.createElement("span");i.className="nge-counter-words",i.setAttribute("data-testid","nge-counter-words");const s=document.createElement("span");s.className="nge-counter-chars",s.setAttribute("data-testid","nge-counter-chars"),l.appendChild(i),l.appendChild(s);const d=document.createElement("div");return d.className="nge-statusbar",d.setAttribute("data-testid","nge-statusbar"),d.style.display="none",o.appendChild(r),o.appendChild(a),o.appendChild(l),o.appendChild(d),{container:o,toolbar:r,content:a,counter:l,wordCount:i,charCount:s,statusBar:d,originalElement:e}}(this.element,this.toolbarConfig,this.options.initialFormat),function(e,t){if(!e||!t||!t.container)throw new Error("Invalid parameters for replaceElement");if(e.style.display="none",!e.parentNode)throw new Error("Target element has no parent node");e.parentNode.insertBefore(t.container,e.nextSibling)}(this.element,this.structure),f(),this.setTheme(this.getCurrentTheme()),this.setIconSize(this.getCurrentIconSize()),this.setToolbarMode(this.getCurrentToolbarMode()),this.setupEventListeners(),function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");e.addEventListener("click",async e=>{const t=e.target.closest(".nge-code-copy-btn");if(!t)return;e.preventDefault(),e.stopPropagation();const n=t.closest(".nge-code-block");if(!n)return;const o=n.querySelector("pre");if(!o)return;const r=V(o);await U(r)&&(t.classList.add("nge-copied"),t.setAttribute("data-tooltip",l("code.copied")),setTimeout(()=>{t.classList.remove("nge-copied"),t.removeAttribute("data-tooltip")},1500))})}(this.structure.content),function(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onEdit callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-image-edit-btn");if(!n)return;e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-image-wrapper");o&&t(o)})}(this.structure.content,e=>{this.handleImageEdit(e)}),function(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onDelete callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-image-delete-btn");if(!n)return;e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-image-wrapper");o&&t(o)})}(this.structure.content,e=>{this.handleElementDelete(e)}),te(this.structure.content,(e,t)=>{this.handleImageRotate(e,t)}),ue(this.structure.content,(e,t,n)=>{this.handleImageResize(e,t,n)},(e,t)=>{this.handleImageRotate(e,t)}),function(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onEdit callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-video-edit-btn");if(!n)return;e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-video-wrapper");o&&t(o)})}(this.structure.content,e=>{this.handleVideoEdit(e)}),function(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onDelete callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-video-delete-btn");if(!n)return;e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-video-wrapper");o&&t(o)})}(this.structure.content,e=>{this.handleElementDelete(e)}),function(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onEdit callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-table-edit-btn");if(n){e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-table-edit-wrapper");o&&t(o)}})}(this.structure.content,e=>{this.handleTableEdit(e)}),function(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onDelete callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-table-delete-btn");if(!n)return;e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-table-edit-wrapper");o&&t(o)})}(this.structure.content,e=>{this.handleElementDelete(e)}),Me(this.structure.content),Ge(this.structure.content,{onContentChange:()=>this.handleContentChange()}),function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container: must be an HTMLElement");e.addEventListener("click",t=>{const n=t.target.closest("td, th"),o=t.target.closest(".nge-table");n&&o?t.target.closest(".nge-table-edit-btn, .nge-table-sort-btn")||(t.ctrlKey||t.metaKey?n.classList.contains("nge-cell-selected")?(n.classList.remove("nge-cell-selected"),Oe.delete(n)):(n.classList.add("nge-cell-selected"),Oe.add(n)):(_e(e),n.classList.add("nge-cell-selected"),Oe.add(n))):_e(e)})}(this.structure.content),e=this.structure.content,t=e=>{this.handleColumnEdit(e)},e&&"function"==typeof t&&e.addEventListener("click",e=>{const n=e.target.closest(".nge-column-edit-btn");if(n){e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-column-wrapper");o&&t(o)}}),function(e,t){e&&"function"==typeof t&&e.addEventListener("click",e=>{const n=e.target.closest(".nge-column-delete-btn");if(n){e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-column-wrapper");o&&t(o)}})}(this.structure.content,e=>{this.handleElementDelete(e)}),function(e,t){e&&"function"==typeof t&&e.addEventListener("click",e=>{const n=e.target.closest(".nge-quote-delete-btn");if(n){e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-quote-wrapper");o&&t(o)}})}(this.structure.content,e=>{this.handleElementDelete(e)}),function(e,t){e&&"function"==typeof t&&e.addEventListener("click",e=>{const n=e.target.closest(".nge-code-delete-btn");if(n){e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-code-block");o&&t(o)}})}(this.structure.content,e=>{this.handleElementDelete(e)}),this.options.autoSync&&this.startAutoSync(),this.updateCounter(),this.updateStatusBar(),this.initialized=!0,this.isLocal||this.validateLicenseAsync()}catch(e){throw new Error(`Failed to initialize NGTextEditor: ${e.message}`)}var e,t}async validateLicenseAsync(){try{const e=window.location.hostname;this.licenseData=await It(e,!0);const t=this.licenseValid;if(this.licenseValid=function(e){if(!e||!0!==e.valid)return!1;if(e.expiresAt&&new Date(e.expiresAt)<new Date)return!1;return!0}(this.licenseData),this.licenseValid!==t){if(this.toolbarConfig=Et(),!this.licenseValid){const e=qt(!1);for(const t of e)this.toolbarConfig[t]=!1}this.rebuildToolbar()}this.updateStatusBar(),this.checkWordLimit()}catch(e){console.warn("License validation failed:",e)}}checkWordLimit(){if(this.licenseValid||this.isLocal)return void(this.wordLimitReached=!1);const e=this.structure?.content?.textContent||"";this.wordLimitReached=function(e){return $t(e)>=500}(e),this.updateStatusBar()}setupEventListeners(){if(!this.structure)throw new Error("Editor structure not initialized");const{content:e,toolbar:t}=this.structure;e.addEventListener("input",()=>{this.handleContentChange()}),e.addEventListener("keydown",e=>{this.handleKeyDown(e)}),e.addEventListener("mouseup",()=>{this.updateToolbar()}),e.addEventListener("keyup",()=>{this.updateToolbar()}),this.setupToolbarEventListeners(t)}setupToolbarEventListeners(e){e.addEventListener("mousedown",e=>{e.target.closest(".nge-toolbar-button")&&e.preventDefault();e.target.closest(".nge-toolbar-select")&&this.saveSelection()}),e.addEventListener("click",e=>{const t=e.target.closest(".nge-toolbar-button");if(t){e.preventDefault();const n=t.getAttribute("data-command");n&&this.executeCommand(n)}}),e.addEventListener("change",e=>{const t=e.target.closest(".nge-toolbar-select");if(t){const e=t.getAttribute("data-command"),n=t.value;e&&(this.restoreSelection(),this.executeSelectCommand(e,n))}})}saveSelection(){const e=window.getSelection();e.rangeCount>0&&(this.savedSelection=e.getRangeAt(0).cloneRange())}restoreSelection(){if(this.savedSelection){const e=window.getSelection();e.removeAllRanges(),e.addRange(this.savedSelection),this.savedSelection=null}}handleContentChange(){this.updateCounter(),this.checkWordLimit();const e=new CustomEvent("nge:change",{detail:{content:this.getContent(),editor:this,wordLimitReached:this.wordLimitReached}});this.element.dispatchEvent(e)}updateCounter(){if(!this.structure||!this.structure.wordCount||!this.structure.charCount)return;const e=this.structure.content.textContent||"",t=e.length,n=e.trim().split(/\s+/).filter(e=>e.length>0).length,o=l("counter.words")||"{count} mot(s)",r=l("counter.chars")||"{count} caractère(s)";this.structure.wordCount.textContent=o.replace("{count}",n),this.structure.charCount.textContent=r.replace("{count}",t)}updateStatusBar(){if(!this.structure||!this.structure.statusBar)return;const e=this.structure.statusBar;if(e.classList.remove("nge-local","nge-licensed","nge-free","nge-word-limit"),this.isLocal)e.textContent=l("status.localMode"),e.classList.add("nge-local"),e.style.display="block";else if(this.licenseValid)e.style.display="none",e.classList.add("nge-licensed");else{const t=$t(this.structure.content?.textContent||""),n=l("status.freeVersion").replace("{current}",t.toString()).replace("{limit}",500..toString());e.textContent=n,e.classList.add("nge-free"),this.wordLimitReached&&e.classList.add("nge-word-limit"),e.style.display="block"}}handleKeyDown(e){if(!function(e){if("Tab"!==e.key)return!1;const t=window.getSelection();if(!t.rangeCount)return!1;const n=t.getRangeAt(0);let o=n.commonAncestorContainer;o.nodeType===Node.TEXT_NODE&&(o=o.parentElement);const r=o?.closest?.(".nge-code-block");if(!r)return!1;e.preventDefault(),n.deleteContents();const a=document.createTextNode("\t");return n.insertNode(a),n.setStartAfter(a),n.setEndAfter(a),t.removeAllRanges(),t.addRange(n),!0}(e)&&!function(e){if("Enter"!==e.key)return!1;const t=window.getSelection();if(!t.rangeCount)return!1;const n=t.getRangeAt(0);let o=n.commonAncestorContainer;o.nodeType===Node.TEXT_NODE&&(o=o.parentElement);const r=o?.closest?.(".nge-code-block");if(!r)return!1;e.preventDefault(),n.deleteContents();const a=document.createTextNode("\n");return n.insertNode(a),n.setStartAfter(a),n.setEndAfter(a),t.removeAllRanges(),t.addRange(n),!0}(e)){if("Enter"===e.key&&!e.shiftKey){if(this.handleTodoListEnter(e))return;if(this.handleListEnter(e))return}if(e.ctrlKey||e.metaKey)switch(e.key.toLowerCase()){case"b":e.preventDefault(),this.executeCommand("bold");break;case"i":e.preventDefault(),this.executeCommand("italic");break;case"u":e.preventDefault(),this.executeCommand("underline");break;case"z":e.preventDefault(),e.shiftKey?this.executeCommand("redo"):this.executeCommand("undo");break;case"y":e.preventDefault(),this.executeCommand("redo")}}}updateToolbar(){if(!this.structure)return;const e={bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikethrough:document.queryCommandState("strikethrough")};!function(e,t){if(!e||!t)throw new Error("Invalid toolbar or states");e.querySelectorAll(".nge-toolbar-button").forEach(e=>{const n=e.getAttribute("data-command");n&&t.hasOwnProperty(n)&&(t[n]?(e.classList.add("nge-active"),e.setAttribute("aria-pressed","true")):(e.classList.remove("nge-active"),e.setAttribute("aria-pressed","false")))})}(this.structure.toolbar,e);const t={paragraph:this.getCurrentParagraphStyle(),"font-family":this.getCurrentFontFamily(),"font-size":this.getCurrentFontSize(),"line-height":this.getCurrentLineHeight()};!function(e,t){if(!e||!t)return;e.querySelectorAll(".nge-toolbar-select").forEach(e=>{const n=e.getAttribute("data-command");n&&t.hasOwnProperty(n)&&(e.value=t[n]||"")})}(this.structure.toolbar,t)}saveSelection(){const e=window.getSelection();return e.rangeCount>0?e.getRangeAt(0).cloneRange():null}restoreSelection(e){if(e){const t=window.getSelection();t.removeAllRanges(),t.addRange(e)}}ensureSelectionInEditor(){if(!this.structure||!this.structure.content)return!1;const e=window.getSelection(),t=this.structure.content;if(e.rangeCount>0){const n=e.getRangeAt(0).commonAncestorContainer;if(t.contains(n))return!0}t.focus();const n=document.createRange();return t.lastChild?t.lastChild.nodeType===Node.TEXT_NODE?(n.setStart(t.lastChild,t.lastChild.textContent.length),n.setEnd(t.lastChild,t.lastChild.textContent.length)):"BR"===t.lastChild.nodeName?(n.setStartBefore(t.lastChild),n.setEndBefore(t.lastChild)):(n.selectNodeContents(t.lastChild),n.collapse(!1)):(n.setStart(t,0),n.setEnd(t,0)),e.removeAllRanges(),e.addRange(n),!1}isLocalEnvironment(){const e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e||"::1"===e||(""===e||(!!/^10\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(e)||(!!/^172\.(1[6-9]|2\d|3[01])\.\d{1,3}\.\d{1,3}$/.test(e)||!!/^192\.168\.\d{1,3}\.\d{1,3}$/.test(e))))}getRestrictedTools(){return this.isLocal||this.licenseValid?[]:qt(!1)}ensureElementAfterBlock(e){if(!e||!e.parentNode)return null;let t=e.nextSibling;for(;t&&t.nodeType===Node.TEXT_NODE&&!t.textContent.trim();)t=t.nextSibling;if(!t){const t=document.createElement("p");return t.innerHTML="<br>",e.parentNode.insertBefore(t,e.nextSibling),t}return t}ensureCursorAfterElement(e){const t=this.ensureElementAfterBlock(e);if(!t)return;const n=window.getSelection(),o=document.createRange();t.nodeType===Node.TEXT_NODE?(o.setStart(t,0),o.setEnd(t,0)):t.firstChild?(o.setStart(t.firstChild,0),o.setEnd(t.firstChild,0)):(o.setStart(t,0),o.setEnd(t,0)),n.removeAllRanges(),n.addRange(o)}executeCommand(e,t=null){if(!this.structure)throw new Error("Editor not initialized");if("text-color"===e||"bg-color"===e)return void this.handleColorCommand(e);if("link"===e)return void this.handleLinkCommand();if("quote"===e)return void this.handleQuoteCommand();if("code"===e)return void this.handleCodeCommand();if("hr"===e)return void this.handleHrCommand();if("image"===e)return void this.handleImageCommand();if("video"===e)return void this.handleVideoCommand();if("table"===e)return void this.handleTableCommand();if("columns"===e)return void this.handleColumnsCommand();if("emoji"===e)return void this.handleEmojiCommand();if("toolbar-config"===e)return void this.handleToolbarConfigCommand();if("preview"===e)return void this.handlePreviewCommand();if("text-case"===e)return void this.handleTextCaseCommand();if("list-todo"===e)return void this.handleTodoListCommand();if("export-json"===e)return void this.handleExportJsonCommand();if("export-pdf"===e)return void this.handleExportPdfCommand();if("export-html"===e)return void this.handleExportHtmlCommand();const n=window.getSelection();n.rangeCount>0&&this.structure.content.contains(n.getRangeAt(0).commonAncestorContainer)||this.structure.content.focus();const o={bold:"bold",italic:"italic",underline:"underline",strikethrough:"strikeThrough",superscript:"superscript","align-left":"justifyLeft","align-center":"justifyCenter","align-right":"justifyRight","align-justify":"justifyFull","list-ul":"insertUnorderedList","list-ol":"insertOrderedList",indent:"indent",outdent:"outdent",undo:"undo",redo:"redo"}[e]||e;try{document.execCommand(o,!1,t),this.updateToolbar(),this.handleContentChange()}catch(t){console.error(`Failed to execute command "${e}":`,t)}}executeSelectCommand(e,t){if(!this.structure)throw new Error("Editor not initialized");const n=window.getSelection();n.rangeCount>0&&this.structure.content.contains(n.getRangeAt(0).commonAncestorContainer)||this.structure.content.focus(),"paragraph"===e?this.applyParagraphStyle(t):"font-family"===e?this.applyFontFamily(t):"font-size"===e?this.applyFontSize(t):"line-height"===e?this.applyLineHeight(t):"list-ol"===e&&this.applyOrderedList(t),this.updateToolbar(),this.handleContentChange()}applyOrderedList(e){const t=window.getSelection();if(0===t.rangeCount)return;let n=t.getRangeAt(0).commonAncestorContainer,o=null,r=n;for(;r&&r!==this.structure.content;){if("OL"===r.nodeName){o=r;break}r=r.parentNode}if(o)o.style.listStyleType=e;else for(document.execCommand("insertOrderedList",!1,null),n=t.getRangeAt(0).commonAncestorContainer;n&&n!==this.structure.content;){if("OL"===n.nodeName){n.style.listStyleType=e;break}n=n.parentNode}}applyParagraphStyle(e){e&&document.execCommand("formatBlock",!1,e)}getCurrentParagraphStyle(){try{const e=window.getSelection();if(!e.rangeCount)return"p";let t=e.getRangeAt(0).commonAncestorContainer;for(t.nodeType===Node.TEXT_NODE&&(t=t.parentElement);t&&t!==this.structure?.content;){const e=t.tagName?.toLowerCase();if(["h1","h2","h3","h4","h5","p"].includes(e))return e;t=t.parentElement}}catch(e){}return"p"}applyFontFamily(e){const t=window.getSelection();if(!t.rangeCount)return;if(!e)return void document.execCommand("removeFormat",!1,null);const n=t.getRangeAt(0);if(n.collapsed)return;const o=n.extractContents(),r=document.createElement("span");r.style.fontFamily=e,r.appendChild(o),n.insertNode(r),n.selectNodeContents(r),t.removeAllRanges(),t.addRange(n)}applyFontSize(e){const t=window.getSelection();if(!t.rangeCount)return;const n=t.getRangeAt(0);if(n.collapsed)return;const o=n.extractContents(),r=document.createElement("span");r.style.fontSize=e,r.appendChild(o),n.insertNode(r),n.selectNodeContents(r),t.removeAllRanges(),t.addRange(n)}applyLineHeight(e){const t=window.getSelection();if(!t.rangeCount)return;let n=t.getRangeAt(0).commonAncestorContainer;for(n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);n&&n!==this.structure?.content;){const t=window.getComputedStyle(n).display;if("block"===t||"list-item"===t)return void(n.style.lineHeight=e);n=n.parentElement}this.structure?.content&&(this.structure.content.style.lineHeight=e)}getCurrentLineHeight(){try{const e=window.getSelection();if(!e.rangeCount)return"";let t=e.getRangeAt(0).commonAncestorContainer;if(t.nodeType===Node.TEXT_NODE&&(t=t.parentElement),t&&t.nodeType===Node.ELEMENT_NODE){const e=window.getComputedStyle(t),n=e.lineHeight;if("normal"===n)return"";const o=parseFloat(e.fontSize),r=parseFloat(n);if(o>0&&r>0){const e=r/o,t=["1","1.15","1.5","2","2.5","3"];for(const n of t)if(Math.abs(e-parseFloat(n))<.1)return n}}}catch(e){}return""}getCurrentFontFamily(){try{const e=window.getSelection();if(!e.rangeCount)return"";let t=e.getRangeAt(0).commonAncestorContainer;if(t.nodeType===Node.TEXT_NODE&&(t=t.parentElement),t&&t.nodeType===Node.ELEMENT_NODE){const e=window.getComputedStyle(t).fontFamily;for(const t of i)if(t.value&&e.includes(t.label))return t.value}}catch(e){}return""}getCurrentFontSize(){try{const e=window.getSelection();if(!e.rangeCount)return"";let t=e.getRangeAt(0).commonAncestorContainer;if(t.nodeType===Node.TEXT_NODE&&(t=t.parentElement),t&&t.nodeType===Node.ELEMENT_NODE){return window.getComputedStyle(t).fontSize}}catch(e){}return""}normalizeColor(e){return e?"transparent"===e||"rgba(0, 0, 0, 0)"===e?null:e.startsWith("rgb")?e:/^[0-9a-fA-F]{6}$/.test(e)?"#"+e:e.startsWith("#")?e:null:null}getCurrentColor(e){try{let t=document.queryCommandValue(e),n=this.normalizeColor(t);if(n)return n;if("hiliteColor"===e&&(t=document.queryCommandValue("backColor"),n=this.normalizeColor(t),n))return n;const o=window.getSelection();if(o.rangeCount>0){let r=o.getRangeAt(0).commonAncestorContainer;if(r.nodeType===Node.TEXT_NODE&&(r=r.parentElement),r&&r.nodeType===Node.ELEMENT_NODE){const o=window.getComputedStyle(r);if(t=o["foreColor"===e?"color":"backgroundColor"],n=this.normalizeColor(t),n)return n}}}catch(e){}return null}updateColorIndicator(e,t){if(!this.structure||!this.structure.toolbar)return;const n=this.structure.toolbar.querySelector(`[data-command="${e}"]`);if(n){const e=n.querySelector(".nge-color-indicator");e&&(e.style.fill=t)}}getSelectedText(){return window.getSelection().toString()||""}getCurrentTextStyles(){return{bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikethrough:document.queryCommandState("strikeThrough"),fontFamily:this.getCurrentFontFamily(),fontSize:this.getCurrentFontSize()}}getCurrentBgStyles(){const e={borderRadius:0,padding:0};try{const t=window.getSelection();if(!t.rangeCount)return e;let n=t.getRangeAt(0).commonAncestorContainer;if(n.nodeType===Node.TEXT_NODE&&(n=n.parentElement),!n||n.nodeType!==Node.ELEMENT_NODE)return e;let o=n;for(;o&&o!==this.structure?.content;){const t=o.style;if(t&&t.backgroundColor){const n=parseInt(t.borderRadius,10);isNaN(n)||(e.borderRadius=n);const o=t.padding;if(o){const t=o.split(" "),n=parseInt(t[0],10);isNaN(n)||(e.padding=n)}break}o=o.parentElement}}catch(e){}return e}async handleColorCommand(e){const t=this.saveSelection(),n="text-color"===e,o=n?"Couleur du texte":"Couleur de fond",r=n?"foreColor":"hiliteColor",a=this.getCurrentColor(r),l=this.getSelectedText(),i=this.getCurrentTextStyles(),s=n?null:this.getCurrentColor("foreColor"),d=n?this.getCurrentColor("hiliteColor"):null,c=n?null:this.getCurrentBgStyles(),u=this.getCustomColors();try{const g=await R({title:o,initialColor:a,showAlpha:!n&&0===u.length,selectedText:l,mode:e,textColor:s,bgColor:d,textStyles:i,initialBorderRadius:c?.borderRadius||0,initialPadding:c?.padding||0,restrictedColors:u});"confirm"===g.action&&g.color&&(this.structure.content.focus(),this.restoreSelection(t),this.ensureSelectionInEditor(),document.execCommand(r,!1,g.color),!n&&t&&this.applyBgColorStyles(t,g.borderRadius,g.padding),this.updateColorIndicator(e,g.color),this.updateToolbar(),this.handleContentChange())}catch(e){}}applyBgColorStyles(e,t,n){if(!e)return;const o=window.getSelection();if(!o.rangeCount)return;const r=o.getRangeAt(0).commonAncestorContainer;let a=r;r.nodeType===Node.TEXT_NODE&&(a=r.parentElement);const l=n>0||t>0?`${n}px ${t>0?4:2}px`:"",i=e=>{e.style.borderRadius=t>0?t+"px":"",e.style.padding=l};a.querySelectorAll('[style*="background"]').forEach(i),a.style&&a.style.backgroundColor&&i(a);let s=a.parentElement;for(;s&&s!==this.structure?.content;)s.style&&s.style.backgroundColor&&i(s),s=s.parentElement}getSelectedLink(){const e=window.getSelection();if(!e.rangeCount)return null;let t=e.getRangeAt(0).commonAncestorContainer;for(t.nodeType===Node.TEXT_NODE&&(t=t.parentElement);t&&t!==this.structure?.content;){if("A"===t.tagName)return t;t=t.parentElement}return null}extractLinkData(e){if(!e||"A"!==e.tagName)return null;const t=(e.rel||"").split(/\s+/).filter(Boolean);return{url:e.href||"",text:e.textContent||"",title:e.title||"",newWindow:"_blank"===e.target,nofollow:t.includes("nofollow")}}async handleLinkCommand(){const e=this.saveSelection(),t=this.getSelectedLink(),n=t?this.extractLinkData(t):null,o=this.getSelectedText();try{const r=n?{url:n.url,text:n.text,title:n.title,newWindow:n.newWindow,nofollow:n.nofollow}:{selectedText:o},a=await I(r);if("confirm"===a.action&&a.url){this.structure.content.focus(),this.restoreSelection(e),this.ensureSelectionInEditor();const n=a.text||a.url;if(t)if(t.href=a.url,t.textContent=n,a.title?t.title=a.title:t.removeAttribute("title"),a.newWindow){t.target="_blank";const e=["noopener","noreferrer"];a.nofollow&&e.push("nofollow"),t.rel=e.join(" ")}else t.removeAttribute("target"),a.nofollow?t.rel="nofollow":t.removeAttribute("rel");else{const e=window.getSelection();if(!e.rangeCount)return;const t=e.getRangeAt(0),o=document.createElement("a");if(o.href=a.url,o.textContent=n,a.title&&(o.title=a.title),a.newWindow){o.target="_blank";const e=["noopener","noreferrer"];a.nofollow&&e.push("nofollow"),o.rel=e.join(" ")}else a.nofollow&&(o.rel="nofollow");t.deleteContents(),t.insertNode(o),t.setStartAfter(o),t.setEndAfter(o),e.removeAllRanges(),e.addRange(t)}this.updateToolbar(),this.handleContentChange()}}catch(e){}}async handleQuoteCommand(){const e=this.saveSelection(),t=this.getSelectedText();try{const n=await B();if("confirm"===n.action&&n.templateId){this.structure.content.focus(),this.restoreSelection(e),this.ensureSelectionInEditor();const o=D(n.templateId,t),r=window.getSelection();if(!r.rangeCount)return;const a=r.getRangeAt(0);a.deleteContents();const l=document.createElement("div");l.innerHTML=o;const i=l.firstChild;a.insertNode(i),this.ensureCursorAfterElement(i),this.updateToolbar(),this.handleContentChange()}}catch(e){}}handleTodoListEnter(e){const t=window.getSelection();if(!t.rangeCount)return!1;const n=t.getRangeAt(0),o=n.startContainer.closest?n.startContainer.closest(".nge-todo-item"):n.startContainer.parentElement?.closest(".nge-todo-item");if(!o)return!1;const r=o.closest(".nge-todo-list");if(!r)return!1;const a=o.querySelector(".nge-todo-text");if(""===(a?a.textContent.trim():"")){e.preventDefault();const n=o.nextSibling;if(o.remove(),0===r.children.length){const e=document.createElement("p");e.innerHTML="<br>",r.parentNode.insertBefore(e,r),r.remove();const n=document.createRange();n.setStart(e,0),n.setEnd(e,0),t.removeAllRanges(),t.addRange(n)}else{const e=document.createElement("p");if(e.innerHTML="<br>",n){const t=document.createElement("div");for(t.className="nge-todo-list";n&&r.contains(n);){const e=n.nextSibling;if(t.appendChild(n),!e)break}r.parentNode.insertBefore(e,r.nextSibling),t.children.length>0&&e.parentNode.insertBefore(t,e.nextSibling)}else r.parentNode.insertBefore(e,r.nextSibling);const o=document.createRange();o.setStart(e,0),o.setEnd(e,0),t.removeAllRanges(),t.addRange(o)}return this.handleContentChange(),!0}e.preventDefault();let l="";if(a&&a.contains(n.startContainer)){const e=n.startContainer;e.nodeType===Node.TEXT_NODE&&(l=e.textContent.substring(n.startOffset),e.textContent=e.textContent.substring(0,n.startOffset))}const i=this.createTodoItem(l);o.nextSibling?r.insertBefore(i,o.nextSibling):r.appendChild(i);const s=i.querySelector(".nge-todo-text");if(s){const e=document.createRange();e.setStart(s,0),e.setEnd(s,0),t.removeAllRanges(),t.addRange(e)}return this.handleContentChange(),!0}handleListEnter(e){const t=window.getSelection();if(!t.rangeCount)return!1;let n=t.getRangeAt(0).startContainer;n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);const o=n?.closest("li");if(!o)return!1;const r=o.closest("ul, ol");if(!r||r.classList.contains("nge-todo-list"))return!1;const a=o.textContent.trim(),l=1===o.childNodes.length&&"BR"===o.firstChild.nodeName;if(!(""===a||l))return!1;e.preventDefault();const i=o.nextSibling;if(o.previousSibling,o.remove(),0===r.children.length){const e=document.createElement("p");e.innerHTML="<br>",r.parentNode.insertBefore(e,r),r.remove();const n=document.createRange();n.setStart(e,0),n.setEnd(e,0),t.removeAllRanges(),t.addRange(n)}else{const e=document.createElement("p");if(e.innerHTML="<br>",i){const t=document.createElement(r.tagName);for(t.style.cssText=r.style.cssText;r.contains(i)&&i;){const e=i.nextSibling;if(t.appendChild(i),!e||!r.contains(e))break}r.parentNode.insertBefore(e,r.nextSibling),t.children.length>0&&e.parentNode.insertBefore(t,e.nextSibling)}else r.parentNode.insertBefore(e,r.nextSibling);const n=document.createRange();n.setStart(e,0),n.setEnd(e,0),t.removeAllRanges(),t.addRange(n)}return this.handleContentChange(),!0}handleTodoListCommand(){this.structure.content.focus();const e=window.getSelection();if(!e.rangeCount)return;const t=e.getRangeAt(0),n=this.getSelectedText()||"Nouvelle tâche";t.deleteContents();const o=document.createElement("ul");o.className="nge-todo-list",o.setAttribute("data-testid","nge-todo-list");const r=this.createTodoItem(n);o.appendChild(r),t.insertNode(o);const a=r.querySelector(".nge-todo-text");a&&(t.setStart(a,a.childNodes.length||0),t.setEnd(a,a.childNodes.length||0),e.removeAllRanges(),e.addRange(t)),this.updateToolbar(),this.handleContentChange()}createTodoItem(e="",t=!1){const n=document.createElement("li");n.className="nge-todo-item",t&&n.classList.add("nge-todo-checked");const o=document.createElement("input");o.type="checkbox",o.className="nge-todo-checkbox",o.checked=t,o.setAttribute("data-testid","nge-todo-checkbox"),o.addEventListener("change",e=>{const t=e.target.closest(".nge-todo-item");t&&(e.target.checked?t.classList.add("nge-todo-checked"):t.classList.remove("nge-todo-checked"),this.handleContentChange())});const r=document.createElement("span");return r.className="nge-todo-text",r.textContent=e,n.appendChild(o),n.appendChild(r),n}handleCodeCommand(){this.structure.content.focus();const e=window.getSelection();if(!e.rangeCount)return;const t=e.getRangeAt(0);t.deleteContents();const n=function(){const e=document.createElement("div");e.className="nge-code-block",e.setAttribute("data-testid","nge-code-block");const t=document.createElement("div");t.className="nge-code-buttons",t.setAttribute("contenteditable","false");const n=document.createElement("button");n.type="button",n.className="nge-code-copy-btn",n.setAttribute("title",l("code.copy")),n.setAttribute("aria-label",l("code.copyCode")),n.setAttribute("data-testid","nge-code-copy-btn"),n.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <rect x="9" y="9" width="11" height="11" rx="2" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>\n  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n</svg>';const o=document.createElement("button");o.type="button",o.className="nge-code-delete-btn",o.setAttribute("title",l("common.deleteCode")),o.setAttribute("aria-label",l("common.deleteCode")),o.setAttribute("data-testid","nge-code-delete-btn"),o.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',t.appendChild(n),t.appendChild(o);const r=document.createElement("pre"),a=document.createElement("code");return a.setAttribute("data-placeholder",l("code.placeholder")),r.appendChild(a),e.appendChild(t),e.appendChild(r),e}();t.insertNode(n),this.ensureElementAfterBlock(n);const o=n.querySelector("code");o&&(t.setStart(o,0),t.setEnd(o,0),e.removeAllRanges(),e.addRange(t)),this.updateToolbar(),this.handleContentChange()}async handleHrCommand(){const e=this.saveSelection();try{const t=await O();if("confirm"===t.action&&t.templateId){this.structure.content.focus(),this.restoreSelection(e),this.ensureSelectionInEditor();const n=function(e,t=1,n=100){const o=H(e);if(!o)throw new Error(`Template "${e}" not found`);const r=j(o.styles,t);if(n<100&&(r.width=`${n}%`,r.marginLeft="auto",r.marginRight="auto"),o.beforeContent)return`<div style="${W({...o.beforeStyles?j(o.beforeStyles,t):{},...r})}" data-hr-template="${e}">${o.beforeContent}</div>`;return`<hr style="${W(r)}" data-hr-template="${e}">`}(t.templateId,t.opacity,t.width),o=window.getSelection();if(!o.rangeCount)return;const r=o.getRangeAt(0);r.deleteContents();const a=document.createElement("div");a.innerHTML=n;const l=a.firstChild;r.insertNode(l),r.setStartAfter(l),r.setEndAfter(l),o.removeAllRanges(),o.addRange(r),this.updateToolbar(),this.handleContentChange()}}catch(e){}}async handleImageCommand(){const e=this.saveSelection();try{const t=await ee();if("confirm"===t.action&&t.src){this.structure.content.focus(),this.restoreSelection(e),this.ensureSelectionInEditor();const n=function(e){const{src:t,width:n=Z.width,height:o=Z.height,rotation:r=Z.rotation,opacity:a=Z.opacity,wrap:i=Z.wrap,align:s=Z.align,borderStyle:d=Z.borderStyle,borderWidth:c=Z.borderWidth,borderColor:u=Z.borderColor,borderRadius:g=Z.borderRadius}=e,p=[`width: ${n}px`,"height: "+("auto"===o?"auto":`${o}px`),`transform: rotate(${r}deg)`,"opacity: "+a/100];d&&"none"!==d&&c>0&&p.push(`border: ${c}px ${d} ${u}`),g>0&&p.push(`border-radius: ${g}px`);const m=p.join("; "),h=l("image.rotate90"),b=l("image.editImage"),f=l("common.deleteImage");return`<span class="nge-image-wrapper" data-testid="nge-image-wrapper" data-width="${n}" data-height="${o}" data-rotation="${r}" data-opacity="${a}" data-wrap="${i}" data-align="${s}" data-border-style="${d}" data-border-width="${c}" data-border-color="${u}" data-border-radius="${g}" contenteditable="false"><img src="${t}" alt="" style="${m}"><div class="nge-image-buttons"><button type="button" class="nge-image-rotate-btn" data-testid="nge-image-rotate-btn" title="${h}" aria-label="${h}"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n  <path d="M21 3v5h-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n</svg></button><button type="button" class="nge-image-edit-btn" data-testid="nge-image-edit-btn" title="${b}" aria-label="${b}"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1.08-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1.08 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n</svg></button><button type="button" class="nge-image-delete-btn" data-testid="nge-image-delete-btn" title="${f}" aria-label="${f}"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg></button></div></span>`}(t),o=window.getSelection();if(!o.rangeCount)return;const r=o.getRangeAt(0);r.deleteContents();const a=document.createElement("div");a.innerHTML=n;const i=a.firstChild;r.insertNode(i),r.setStartAfter(i),r.setEndAfter(i),o.removeAllRanges(),o.addRange(r),this.updateToolbar(),this.handleContentChange()}}catch(e){}}async handleImageEdit(e){const t=function(e){if(!e||!e.classList.contains("nge-image-wrapper"))return null;const t=e.querySelector("img");return t?{src:t.src||"",width:parseInt(e.dataset.width,10)||Z.width,height:"auto"===e.dataset.height?"auto":parseInt(e.dataset.height,10)||"auto",rotation:parseInt(e.dataset.rotation,10)||Z.rotation,opacity:parseInt(e.dataset.opacity,10)||Z.opacity,wrap:e.dataset.wrap||Z.wrap,align:e.dataset.align||Z.align,borderStyle:e.dataset.borderStyle||Z.borderStyle,borderWidth:parseInt(e.dataset.borderWidth,10)||Z.borderWidth,borderColor:e.dataset.borderColor||Z.borderColor,borderRadius:parseInt(e.dataset.borderRadius,10)||Z.borderRadius,naturalWidth:t.naturalWidth||0,naturalHeight:t.naturalHeight||0}:null}(e);if(t)try{const n=await ee(t);"confirm"===n.action&&n.src&&(!function(e,t){if(!e||!e.classList.contains("nge-image-wrapper"))return;const n=e.querySelector("img");if(!n)return;const{src:o,width:r=Z.width,height:a=Z.height,rotation:l=Z.rotation,opacity:i=Z.opacity,wrap:s=Z.wrap,align:d=Z.align,borderStyle:c=Z.borderStyle,borderWidth:u=Z.borderWidth,borderColor:g=Z.borderColor,borderRadius:p=Z.borderRadius}=t;e.dataset.width=r,e.dataset.height=a,e.dataset.rotation=l,e.dataset.opacity=i,e.dataset.wrap=s,e.dataset.align=d,e.dataset.borderStyle=c,e.dataset.borderWidth=u,e.dataset.borderColor=g,e.dataset.borderRadius=p,n.src=o,n.style.width=`${r}px`,n.style.height="auto"===a?"auto":`${a}px`,n.style.transform=`rotate(${l}deg)`,n.style.opacity=i/100,n.style.border=c&&"none"!==c&&u>0?`${u}px ${c} ${g}`:"none",n.style.borderRadius=p>0?`${p}px`:"0"}(e,n),this.handleContentChange())}catch(e){}}handleImageResize(e,t,n){this.handleContentChange()}handleImageRotate(e,t){this.handleContentChange()}handleElementDelete(e){e&&e.parentNode&&(e.parentNode.removeChild(e),this.handleContentChange())}async handleVideoCommand(){const e=this.saveSelection();try{const t=await Ce();if("confirm"===t.action&&t.videoId){this.structure.content.focus(),this.restoreSelection(e),this.ensureSelectionInEditor();const n=function(e){const{url:t=pe.url,platform:n=pe.platform,videoId:o=pe.videoId,width:r=pe.width,autostart:a=pe.autostart,align:i=pe.align,borderStyle:s=pe.borderStyle,borderWidth:d=pe.borderWidth,borderColor:c=pe.borderColor,borderRadius:u=pe.borderRadius}=e,g=me(n,o,a);if(!g)return"";const p=Math.round(9*r/16);let m="";s&&"none"!==s&&d>0&&(m=`border: ${d}px ${s} ${c};`),u>0&&(m+=` border-radius: ${u}px; overflow: hidden;`);const h=l("video.editTitle"),b=l("common.deleteVideo");return`<span class="nge-video-wrapper" data-testid="nge-video-wrapper" data-url="${t}" data-platform="${n}" data-video-id="${o}" data-width="${r}" data-autostart="${a}" data-align="${i}" data-border-style="${s}" data-border-width="${d}" data-border-color="${c}" data-border-radius="${u}" contenteditable="false" style="${m}"><iframe src="${g}" width="${r}" height="${p}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><div class="nge-video-buttons"><button type="button" class="nge-video-edit-btn" data-testid="nge-video-edit-btn" title="${h}" aria-label="${h}"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1.08-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1.08 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n</svg></button><button type="button" class="nge-video-delete-btn" data-testid="nge-video-delete-btn" title="${b}" aria-label="${b}"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg></button></div></span>`}(t),o=window.getSelection();if(!o.rangeCount)return;const r=o.getRangeAt(0);r.deleteContents();const a=document.createElement("div");a.innerHTML=n;const i=a.firstChild;r.insertNode(i),r.setStartAfter(i),r.setEndAfter(i),o.removeAllRanges(),o.addRange(r),this.updateToolbar(),this.handleContentChange()}}catch(e){}}async handleVideoEdit(e){const t=function(e){return e&&e.classList.contains("nge-video-wrapper")?{url:e.dataset.url||"",platform:e.dataset.platform||"",videoId:e.dataset.videoId||"",width:parseInt(e.dataset.width,10)||pe.width,autostart:"true"===e.dataset.autostart,align:e.dataset.align||pe.align,borderStyle:e.dataset.borderStyle||pe.borderStyle,borderWidth:parseInt(e.dataset.borderWidth,10)||pe.borderWidth,borderColor:e.dataset.borderColor||pe.borderColor,borderRadius:parseInt(e.dataset.borderRadius,10)||pe.borderRadius}:null}(e);if(t)try{const n=await Ce(t);"confirm"===n.action&&n.videoId&&(!function(e,t){if(!e||!e.classList.contains("nge-video-wrapper"))return;const{url:n=pe.url,platform:o=pe.platform,videoId:r=pe.videoId,width:a=pe.width,autostart:l=pe.autostart,align:i=pe.align,borderStyle:s=pe.borderStyle,borderWidth:d=pe.borderWidth,borderColor:c=pe.borderColor,borderRadius:u=pe.borderRadius}=t,g=me(o,r,l);if(!g)return;e.dataset.url=n,e.dataset.platform=o,e.dataset.videoId=r,e.dataset.width=a,e.dataset.autostart=l,e.dataset.align=i,e.dataset.borderStyle=s,e.dataset.borderWidth=d,e.dataset.borderColor=c,e.dataset.borderRadius=u,e.style.border=s&&"none"!==s&&d>0?`${d}px ${s} ${c}`:"",u>0?(e.style.borderRadius=`${u}px`,e.style.overflow="hidden"):(e.style.borderRadius="",e.style.overflow="");const p=e.querySelector("iframe");if(p){const e=Math.round(9*a/16);p.src=g,p.width=a,p.height=e}}(e,n),this.handleContentChange())}catch(e){}}async handleTableCommand(){const e=this.saveSelection();try{const t=await Ae();if("confirm"===t.action){this.structure.content.focus(),this.restoreSelection(e),this.ensureSelectionInEditor();const n=Te(t,!1),o=window.getSelection();if(!o.rangeCount)return;const r=o.getRangeAt(0);r.deleteContents();const a=document.createElement("div");a.innerHTML=n;const l=a.firstChild;r.insertNode(l),this.ensureCursorAfterElement(l),this.updateToolbar(),this.handleContentChange()}}catch(e){}}async handleTableEdit(e){const t=function(e){if(!(e&&e instanceof HTMLElement))return null;const t=e.classList.contains("nge-table")?e:e.querySelector(".nge-table");if(!t)return null;const n=t.className.match(/nge-table-(\w+)/);let o="standard";n&&["standard","bordered","striped","minimal"].includes(n[1])&&(o=n[1]);let r=ye.tableWidth,a=ye.tableAlign;const l=e.closest(".nge-table-edit-wrapper")||(e.classList.contains("nge-table-edit-wrapper")?e:null)||t,i=l.style.width;i&&xe.some(e=>e.value===i)&&(r=i);const s=l.style.marginLeft,d=l.style.marginRight;"auto"===s&&"auto"===d?a="center":"auto"!==s||"0"!==d&&"0px"!==d||(a="right");const c=t.querySelector("thead"),u=t.querySelector("tbody"),g=!!c,p=t.classList.contains("nge-table-sortable"),m=e.classList.contains("nge-table-wrapper"),h=c?c.querySelector("tr"):u?.querySelector("tr"),b=h?h.querySelectorAll("th, td").length:0,f=(g?1:0)+(u?u.querySelectorAll("tr").length:0),v=c?.querySelector("th");let w=ye.headerBgColor,C=!1,y=ye.headerFont,x=ye.headerSize,E=ye.headerWeight,S=ye.headerTextColor;if(v){const e=v.style;e.backgroundColor?w=Le(e.backgroundColor)||w:C=!0,e.fontFamily&&"inherit"!==e.fontFamily&&(y=e.fontFamily),e.fontSize&&(x=parseInt(e.fontSize,10)||x),e.fontWeight&&(E=e.fontWeight),e.color&&(S=Le(e.color)||S)}const k={headers:[],body:[]};c&&c.querySelectorAll("th").forEach(e=>{k.headers.push(e.textContent.trim())});u&&u.querySelectorAll("tr").forEach(e=>{const t=[];e.querySelectorAll("td").forEach(e=>{t.push(e.textContent.trim())}),k.body.push(t)});return{rows:f,columns:b,includeHeader:g,sortable:p,style:o,responsive:m,tableWidth:r,tableAlign:a,headerBgColor:w,headerTransparent:C,headerFont:y,headerSize:x,headerWeight:E,headerTextColor:S,cellData:k}}(e);if(t)try{const n=await Ae({rows:t.rows,columns:t.columns,includeHeader:t.includeHeader,sortable:t.sortable,style:t.style,responsive:t.responsive,headerBgColor:t.headerBgColor,headerTransparent:t.headerTransparent,headerFont:t.headerFont,headerSize:t.headerSize,headerWeight:t.headerWeight,headerTextColor:t.headerTextColor});"confirm"===n.action&&(!function(e,t,n=null){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid wrapper element");const o=Te(t,!1,n),r=document.createElement("div");r.innerHTML=o;const a=r.firstChild;e.replaceWith(a)}(e,n,t.cellData),this.updateToolbar(),this.handleContentChange())}catch(e){}}async handleColumnsCommand(){const e=this.saveSelection();try{const t=await ht();if("confirm"===t.action){this.structure.content.focus(),this.restoreSelection(e),this.ensureSelectionInEditor();const n=function(e,t=""){const n=gt(e);if(!n.isValid)throw new Error(n.error);const o=pt(e),r=mt(e),a=t||"<p>Commencez à écrire ici...</p>";return`<div class="nge-column-wrapper"\n    data-columns="${e.columns}"\n    data-gap="${e.gap}"\n    data-height="${e.height}"\n    data-width="${e.width}"\n    data-align="${e.align}"\n    data-wrap="${e.wrap}"\n    data-valign="${e.valign}"\n    data-border="${e.border}"\n    data-border-color="${e.borderColor||"#dee2e6"}"\n    data-border-width="${e.borderWidth||"1"}"\n    data-border-style="${e.borderStyle||"solid"}"\n    data-bg-container="${e.bgContainer||""}"\n    data-bg-columns="${e.bgColumns||""}"\n    contenteditable="false"\n    style="${o}">\n  <div class="nge-column-content" contenteditable="true" style="${r}">${a}</div>\n  <div class="nge-column-buttons"><button class="nge-column-edit-btn" title="${l("columns.editTitle")}" type="button"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="none" stroke="currentColor" stroke-width="2"/>\n  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1.08-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1.08 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" fill="none" stroke="currentColor" stroke-width="2"/>\n</svg></button><button class="nge-column-delete-btn" title="${l("common.deleteColumn")}" type="button"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg></button></div>\n</div>`}(t),o=window.getSelection();if(!o.rangeCount)return;const r=o.getRangeAt(0);r.deleteContents();const a=document.createElement("div");a.innerHTML=n;const i=a.firstChild;r.insertNode(i),this.ensureCursorAfterElement(i),this.updateToolbar(),this.handleContentChange()}}catch(e){}}handleEmojiCommand(){const e=this.structure.toolbar.querySelector('[data-command="emoji"]');if(!e)return;const t=this.saveSelection();!function(e,t){const n=document.querySelector(".nge-emoji-picker-dropdown");n&&n.remove();const o=document.createElement("div");o.className="nge-emoji-picker-dropdown";const r=wt(e=>{t&&t(e),o.remove(),document.removeEventListener("click",d)});o.appendChild(r),document.body.appendChild(o);const a=e.getBoundingClientRect(),l=window.innerHeight-a.bottom,i=a.top;o.style.top=l>=400||l>i?`${a.bottom+window.scrollY+4}px`:a.top+window.scrollY-400-4+"px";let s=a.left+window.scrollX;s+380>window.innerWidth&&(s=window.innerWidth-380-10),o.style.left=`${s}px`;const d=t=>{o.contains(t.target)||e.contains(t.target)||(o.remove(),document.removeEventListener("click",d))};setTimeout(()=>{document.addEventListener("click",d)},0);const c=r.querySelector(".nge-emoji-search");c&&setTimeout(()=>c.focus(),50)}(e,e=>{this.structure.content.focus(),this.restoreSelection(t),this.ensureSelectionInEditor();const n=window.getSelection();if(n.rangeCount>0){const t=n.getRangeAt(0);t.deleteContents();const o=document.createTextNode(e);t.insertNode(o),t.setStartAfter(o),t.setEndAfter(o),n.removeAllRanges(),n.addRange(t)}else this.structure.content.innerHTML+=e;this.updateToolbar(),this.handleContentChange()})}handleTextCaseCommand(){const e=window.getSelection();if(!e.rangeCount)return;const t=e.getRangeAt(0),n=e.toString();if(!n||0===n.length)return;let o;const r=n===n.toUpperCase()&&n!==n.toLowerCase();o=n===n.toLowerCase()&&n!==n.toUpperCase()?n.toUpperCase():r?n.toLowerCase().replace(/(?:^|\s|[-'])\S/g,e=>e.toUpperCase()):n.toLowerCase(),t.deleteContents();const a=document.createTextNode(o);t.insertNode(a),t.selectNodeContents(a),e.removeAllRanges(),e.addRange(t),this.updateToolbar(),this.handleContentChange()}async handleColumnEdit(e){const t=function(e){return e&&e.classList.contains("nge-column-wrapper")?{columns:parseInt(e.getAttribute("data-columns"),10)||dt.columns,gap:e.getAttribute("data-gap")||dt.gap,height:e.getAttribute("data-height")||dt.height,width:e.getAttribute("data-width")||dt.width,align:e.getAttribute("data-align")||dt.align,wrap:e.getAttribute("data-wrap")||dt.wrap,valign:e.getAttribute("data-valign")||dt.valign,border:"true"===e.getAttribute("data-border"),borderColor:e.getAttribute("data-border-color")||dt.borderColor,borderWidth:e.getAttribute("data-border-width")||dt.borderWidth,borderStyle:e.getAttribute("data-border-style")||dt.borderStyle,bgContainer:e.getAttribute("data-bg-container")||"",bgColumns:e.getAttribute("data-bg-columns")||""}:{...dt}}(e);if(!t)return;const n=e.querySelector(".nge-column-content");n&&n.innerHTML;try{const n=await ht(t);"confirm"===n.action&&(!function(e,t){if(!e||!e.classList.contains("nge-column-wrapper"))throw new Error("Invalid column wrapper element");const n=gt(t);if(!n.isValid)throw new Error(n.error);e.setAttribute("data-columns",t.columns),e.setAttribute("data-gap",t.gap),e.setAttribute("data-height",t.height),e.setAttribute("data-width",t.width),e.setAttribute("data-align",t.align),e.setAttribute("data-wrap",t.wrap),e.setAttribute("data-valign",t.valign),e.setAttribute("data-border",t.border),e.setAttribute("data-border-color",t.borderColor||"#dee2e6"),e.setAttribute("data-border-width",t.borderWidth||"1"),e.setAttribute("data-border-style",t.borderStyle||"solid"),e.setAttribute("data-bg-container",t.bgContainer||""),e.setAttribute("data-bg-columns",t.bgColumns||""),e.setAttribute("style",pt(t));const o=e.querySelector(".nge-column-content");o&&o.setAttribute("style",mt(t))}(e,n),this.updateToolbar(),this.handleContentChange())}catch(e){}}async handleToolbarConfigCommand(){try{const e=this.getRestrictedTools(),o={...Et(),theme:this.getCurrentTheme(),iconSize:this.getCurrentIconSize(),toolbarMode:this.getCurrentToolbarMode(),customColors:this.getCustomColors()},l=await At(o,e);if("confirm"===l.action){!function(e){if(!e||"object"!=typeof e)throw new Error("Invalid configuration object");try{const t={_version:6};for(const[n,o]of Object.entries(e))"_version"!==n&&(t[n]=o);localStorage.setItem(Ct,JSON.stringify(t))}catch(e){}}(l.config);const o={...l.config};for(const t of e)o[t]=!1;this.toolbarConfig=o;const i=a();l.language&&l.language!==i&&function(e){if(!r[e])return!1;if(n=e,"undefined"!=typeof localStorage)try{localStorage.setItem(t,e)}catch(e){}}(l.language),l.theme&&this.setTheme(l.theme),l.iconSize&&this.setIconSize(l.iconSize),void 0!==l.customColors&&this.setCustomColors(l.customColors),l.toolbarMode&&this.setToolbarMode(l.toolbarMode),this.rebuildToolbar()}}catch(e){}}handlePreviewCommand(){const e=document.createElement("div");e.className="nge-modal-overlay nge-preview-overlay",e.setAttribute("data-testid","nge-preview-overlay");const t=document.createElement("div");t.className="nge-modal nge-preview-modal",t.setAttribute("data-testid","nge-preview-modal");const n=document.createElement("div");n.className="nge-modal-header";const o=document.createElement("h3");o.className="nge-modal-title",o.textContent=l("preview.title");const r=document.createElement("button");r.type="button",r.className="nge-modal-close",r.setAttribute("data-testid","nge-preview-close"),r.innerHTML='<span class="nge-icon nge-icon-close"></span>',r.setAttribute("title",l("preview.close")),n.appendChild(o),n.appendChild(r);const a=document.createElement("div");a.className="nge-modal-body nge-preview-body";const i=document.createElement("div");i.className="nge-preview-content",i.setAttribute("data-testid","nge-preview-content"),i.innerHTML=this.structure.content.innerHTML,a.appendChild(i);const s=document.createElement("div");s.className="nge-modal-footer";const d=document.createElement("button");function c(){document.removeEventListener("keydown",u),e.classList.remove("nge-modal-visible"),setTimeout(()=>{e.remove()},300)}function u(e){"Escape"===e.key&&c()}d.type="button",d.className="nge-modal-btn nge-modal-btn-secondary",d.setAttribute("data-testid","nge-preview-close-btn"),d.textContent=l("preview.close"),s.appendChild(d),t.appendChild(n),t.appendChild(a),t.appendChild(s),e.appendChild(t),document.body.appendChild(e),f(),requestAnimationFrame(()=>{e.classList.add("nge-modal-visible")}),r.addEventListener("click",c),d.addEventListener("click",c),e.addEventListener("click",t=>{t.target===e&&c()}),document.addEventListener("keydown",u)}getCurrentTheme(){try{return localStorage.getItem("nge-theme")||"light"}catch(e){return"light"}}setTheme(e){["light","dark","warm","cold","taupe","pink"].includes(e)||(e="light"),this.structure.container.setAttribute("data-theme",e);try{localStorage.setItem("nge-theme",e)}catch(e){}}getCurrentIconSize(){try{return localStorage.getItem("nge-icon-size")||"small"}catch(e){return"small"}}setIconSize(e){["small","large"].includes(e)||(e="small"),this.structure.container.setAttribute("data-icon-size",e);try{localStorage.setItem("nge-icon-size",e)}catch(e){}}getCurrentToolbarMode(){try{return localStorage.getItem("nge-toolbar-mode")||"integrated"}catch(e){return"integrated"}}setToolbarMode(e){["integrated","fullwidth-top"].includes(e)||(e="integrated"),this.structure.container.setAttribute("data-toolbar-mode",e);try{localStorage.setItem("nge-toolbar-mode",e)}catch(e){}}getCustomColors(){try{const e=localStorage.getItem("nge-custom-colors");if(e){const t=JSON.parse(e);if(Array.isArray(t))return t}}catch(e){}return[]}setCustomColors(e){Array.isArray(e)||(e=[]);try{localStorage.setItem("nge-custom-colors",JSON.stringify(e))}catch(e){}}rebuildToolbar(){const e=this.structure.toolbar,t=u(this.toolbarConfig);e.replaceWith(t),this.structure.toolbar=t,this.setupToolbarEventListeners(t),f(),this.updateToolbar()}startAutoSync(){this.syncTimer||(this.syncTimer=setInterval(()=>{this.sync()},this.options.syncInterval))}stopAutoSync(){this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null)}sync(){this.structure&&h(this.structure.content,this.element)}getContent(e="html"){if(!this.structure)throw new Error("Editor not initialized");return function(e,t="text"){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid editor content element");if("html"===t)return e.innerHTML;if("text"===t)return e.textContent||"";throw new Error('Invalid format: must be "text" or "html"')}(this.structure.content,e)}setContent(e,t="html"){if(!this.structure)throw new Error("Editor not initialized");!function(e,t,n="text"){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid editor content element");if("string"!=typeof t)throw new Error("Content must be a string");if("html"===n)e.innerHTML=t;else{if("text"!==n)throw new Error('Invalid format: must be "text" or "html"');e.textContent=t}}(this.structure.content,e,t),this.handleContentChange()}handleExportJsonCommand(){if(!this.structure)return;const e=this.getContent("text"),t=this.parseContentStructure(),n={version:"1.0",exportedAt:(new Date).toISOString(),metadata:{wordCount:$t(e),charCount:e.length,charCountNoSpaces:e.replace(/\s/g,"").length},content:{text:e},structure:t},o=JSON.stringify(n,null,2),r=new Blob([o],{type:"application/json"}),a=URL.createObjectURL(r),l=`export-${(new Date).toISOString().replace(/[:.]/g,"-").slice(0,19)}.json`,i=document.createElement("a");i.href=a,i.download=l,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)}handleExportPdfCommand(){if(!this.structure)return;const e=zt(this.getContent("html")),t=window.open("","_blank","width=800,height=600");if(!t)return void window.print();const n=`\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>Export PDF</title>\n  <style>\n    * {\n      box-sizing: border-box;\n    }\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;\n      font-size: 12pt;\n      line-height: 1.6;\n      color: #000;\n      background: #fff;\n      max-width: 100%;\n      margin: 0;\n      padding: 20mm;\n    }\n    h1, h2, h3, h4, h5, h6 {\n      margin-top: 1em;\n      margin-bottom: 0.5em;\n      font-weight: 600;\n    }\n    h1 { font-size: 24pt; }\n    h2 { font-size: 20pt; }\n    h3 { font-size: 16pt; }\n    h4 { font-size: 14pt; }\n    h5 { font-size: 12pt; }\n    h6 { font-size: 10pt; }\n    p {\n      margin: 0.5em 0;\n    }\n    ul, ol {\n      margin: 0.5em 0;\n      padding-left: 2em;\n    }\n    li {\n      margin: 0.25em 0;\n    }\n    img {\n      max-width: 100%;\n      height: auto;\n    }\n    table {\n      border-collapse: collapse;\n      width: 100%;\n      margin: 1em 0;\n    }\n    th, td {\n      border: 1px solid #000;\n      padding: 8px;\n      text-align: left;\n    }\n    th {\n      background: #f0f0f0;\n      font-weight: 600;\n    }\n    blockquote, .nge-quote {\n      margin: 1em 0;\n      padding: 0.5em 1em;\n      border-left: 4px solid #ccc;\n      background: #f9f9f9;\n    }\n    pre, .nge-code-block {\n      background: #f4f4f4;\n      padding: 1em;\n      overflow-x: auto;\n      font-family: 'Courier New', monospace;\n      font-size: 10pt;\n      border-radius: 4px;\n    }\n    code {\n      font-family: 'Courier New', monospace;\n      background: #f4f4f4;\n      padding: 0.2em 0.4em;\n      border-radius: 3px;\n    }\n    hr, .nge-hr {\n      border: none;\n      border-top: 1px solid #ccc;\n      margin: 1em 0;\n    }\n    .nge-columns {\n      display: flex;\n      gap: 1em;\n    }\n    .nge-column {\n      flex: 1;\n    }\n    .nge-todo-list {\n      list-style: none;\n      padding-left: 0;\n    }\n    .nge-todo-item {\n      display: flex;\n      align-items: flex-start;\n      gap: 0.5em;\n      margin: 0.25em 0;\n    }\n    .nge-todo-checkbox {\n      margin-top: 0.3em;\n    }\n    .nge-todo-checked .nge-todo-text {\n      text-decoration: line-through;\n      color: #666;\n    }\n    /* Hide editor UI elements */\n    .nge-image-edit-btn,\n    .nge-image-rotate-btn,\n    .nge-image-delete-btn,\n    .nge-image-buttons,\n    .nge-video-edit-btn,\n    .nge-video-delete-btn,\n    .nge-video-buttons,\n    .nge-table-edit-btn,\n    .nge-table-delete-btn,\n    .nge-table-buttons,\n    .nge-column-edit-btn,\n    .nge-column-delete-btn,\n    .nge-column-buttons,\n    .nge-quote-delete-btn,\n    .nge-code-delete-btn,\n    .nge-code-buttons,\n    .nge-code-copy-btn,\n    .nge-resize-handle {\n      display: none !important;\n    }\n    @media print {\n      body {\n        padding: 0;\n      }\n      @page {\n        margin: 20mm;\n      }\n    }\n  </style>\n</head>\n<body>\n  ${e}\n</body>\n</html>`;t.document.write(n),t.document.close(),t.onload=()=>{t.focus(),t.print(),t.onafterprint=()=>{t.close()}}}handleExportHtmlCommand(){if(!this.structure)return;const e=zt(this.getContent("html")),t=new Blob([`<!DOCTYPE html>\n<html lang="fr">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Export HTML</title>\n  <style>\n    * {\n      box-sizing: border-box;\n    }\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;\n      font-size: 16px;\n      line-height: 1.6;\n      color: #333;\n      background: #fff;\n      max-width: 900px;\n      margin: 0 auto;\n      padding: 20px;\n    }\n    h1, h2, h3, h4, h5, h6 {\n      margin-top: 1em;\n      margin-bottom: 0.5em;\n      font-weight: 600;\n    }\n    h1 { font-size: 2em; }\n    h2 { font-size: 1.5em; }\n    h3 { font-size: 1.25em; }\n    h4 { font-size: 1.1em; }\n    h5 { font-size: 1em; }\n    h6 { font-size: 0.9em; }\n    p {\n      margin: 0.5em 0;\n    }\n    ul, ol {\n      margin: 0.5em 0;\n      padding-left: 2em;\n    }\n    li {\n      margin: 0.25em 0;\n    }\n    img {\n      max-width: 100%;\n      height: auto;\n    }\n    table {\n      border-collapse: collapse;\n      width: 100%;\n      margin: 1em 0;\n    }\n    th, td {\n      border: 1px solid #ddd;\n      padding: 8px;\n    }\n    th {\n      background: #f5f5f5;\n      font-weight: 600;\n    }\n    blockquote, .nge-quote {\n      margin: 1em 0;\n      padding: 0.5em 1em;\n      border-left: 4px solid #ccc;\n      background: #f9f9f9;\n    }\n    pre, .nge-code-block {\n      background: #f4f4f4;\n      padding: 1em;\n      overflow-x: auto;\n      font-family: 'Courier New', monospace;\n      font-size: 14px;\n      border-radius: 4px;\n    }\n    code {\n      font-family: 'Courier New', monospace;\n      background: #f4f4f4;\n      padding: 0.2em 0.4em;\n      border-radius: 3px;\n    }\n    hr, .nge-hr {\n      border: none;\n      border-top: 1px solid #ccc;\n      margin: 1em 0;\n    }\n    .nge-columns {\n      display: flex;\n      gap: 1em;\n    }\n    .nge-column {\n      flex: 1;\n    }\n    .nge-todo-list {\n      list-style: none;\n      padding-left: 0;\n    }\n    .nge-todo-item {\n      display: flex;\n      align-items: flex-start;\n      gap: 0.5em;\n      margin: 0.25em 0;\n    }\n    .nge-todo-checkbox {\n      margin-top: 0.3em;\n      width: 16px;\n      height: 16px;\n      flex-shrink: 0;\n    }\n    .nge-todo-text {\n      flex: 1;\n    }\n    .nge-todo-checked .nge-todo-text {\n      text-decoration: line-through;\n      color: #666;\n    }\n    /* Image wrapper alignment */\n    .nge-image-wrapper {\n      display: block;\n      margin: 1em 0;\n    }\n    .nge-image-wrapper[data-wrap="block"] {\n      clear: both;\n    }\n    .nge-image-wrapper[data-wrap="left"] {\n      float: left;\n      margin-right: 1em;\n    }\n    .nge-image-wrapper[data-wrap="right"] {\n      float: right;\n      margin-left: 1em;\n    }\n    .nge-image-wrapper[data-wrap="block"][data-align="left"] {\n      text-align: left;\n    }\n    .nge-image-wrapper[data-wrap="block"][data-align="center"] {\n      text-align: center;\n    }\n    .nge-image-wrapper[data-wrap="block"][data-align="right"] {\n      text-align: right;\n    }\n    .nge-image-wrapper img {\n      max-width: 100%;\n      height: auto;\n      display: inline-block;\n    }\n    a {\n      color: #0066cc;\n      text-decoration: none;\n    }\n    a:hover {\n      text-decoration: underline;\n    }\n    iframe {\n      max-width: 100%;\n    }\n    /* Ensure all elements can inherit text-align */\n    p, div, h1, h2, h3, h4, h5, h6, li, td, th, blockquote {\n      text-align: inherit;\n    }\n    /* Respect inline text-align styles (with or without space after colon) */\n    [style*="text-align:center"], [style*="text-align: center"] {\n      text-align: center !important;\n    }\n    [style*="text-align:right"], [style*="text-align: right"] {\n      text-align: right !important;\n    }\n    [style*="text-align:justify"], [style*="text-align: justify"] {\n      text-align: justify !important;\n    }\n    [style*="text-align:left"], [style*="text-align: left"] {\n      text-align: left !important;\n    }\n    /* Support for align attribute */\n    [align="center"] {\n      text-align: center !important;\n    }\n    [align="right"] {\n      text-align: right !important;\n    }\n    [align="justify"] {\n      text-align: justify !important;\n    }\n    [align="left"] {\n      text-align: left !important;\n    }\n    /* Support for deprecated center tag */\n    center {\n      text-align: center;\n    }\n  </style>\n</head>\n<body>\n  ${e}\n</body>\n</html>`],{type:"text/html;charset=utf-8"}),n=URL.createObjectURL(t),o=`export-${(new Date).toISOString().replace(/[:.]/g,"-").slice(0,19)}.html`,r=document.createElement("a");r.href=n,r.download=o,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}parseContentStructure(){if(!this.structure)return[];const e=[],t=this.structure.content,n=e=>{if(e.nodeType===Node.TEXT_NODE){const t=e.textContent.trim();return t?{type:"text",content:t}:null}if(e.nodeType!==Node.ELEMENT_NODE)return null;const t=e.tagName.toLowerCase();if(/^h[1-6]$/.test(t))return{type:"heading",level:parseInt(t.charAt(1)),content:e.textContent.trim()};if("p"===t){const t=[];if(e.childNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE&&(e.classList.contains("nge-image-wrapper")||e.classList.contains("nge-video-wrapper"))){const o=n(e);o&&t.push(o)}}),t.length>0){const n=e.textContent.trim();return n&&t.length!==e.childNodes.length?{type:"paragraph",content:n,embedded:t}:1===t.length?t[0]:{type:"container",children:t}}return{type:"paragraph",content:e.textContent.trim()}}if(e.classList.contains("nge-todo-list")){return{type:"todolist",items:Array.from(e.querySelectorAll(":scope > .nge-todo-item")).map(e=>{const t=e.querySelector(".nge-todo-checkbox"),n=e.querySelector(".nge-todo-text");return{text:n?n.textContent.trim():e.textContent.trim(),checked:t?t.checked:e.classList.contains("nge-todo-checked")}})}}if("ul"===t||"ol"===t){const n={type:"list",listType:"ul"===t?"unordered":"ordered",items:Array.from(e.querySelectorAll(":scope > li")).map(e=>e.textContent.trim())};return"ol"===t&&(n.listStyleType=e.style.listStyleType||"decimal"),n}if("img"===t||e.classList.contains("nge-image-wrapper")){const n="img"===t?e:e.querySelector("img");if(n)return{type:"img",src:n.src,alt:n.alt||"",width:n.width||null,height:n.height||null}}if(e.classList.contains("nge-video-wrapper")){const t=e.querySelector("iframe");if(t)return{type:"video",src:t.src,width:t.width||null}}if("table"===t||e.classList.contains("nge-table-wrapper")){const n="table"===t?e:e.querySelector("table");if(n){return{type:"table",rows:Array.from(n.querySelectorAll("tr")).map(e=>Array.from(e.querySelectorAll("th, td")).map(e=>e.textContent.trim()))}}}if("blockquote"===t||e.classList.contains("nge-quote"))return{type:"quote",content:e.textContent.trim()};if("pre"===t||e.classList.contains("nge-code-block")){const t=e.querySelector("code")||e;return{type:"code",content:t.textContent.trim(),language:t.className.replace("language-","")||null}}if("hr"===t||e.classList.contains("nge-hr"))return{type:"hr"};if(e.classList.contains("nge-columns")){const t=Array.from(e.querySelectorAll(".nge-column")).map(e=>e.innerHTML);return{type:"columns",count:t.length,columns:t}}if("div"===t||"span"===t){const t=[];if(e.childNodes.forEach(e=>{const o=n(e);o&&t.push(o)}),1===t.length)return t[0];if(t.length>1)return{type:"container",children:t}}return null};return t.childNodes.forEach(t=>{const o=n(t);o&&e.push(o)}),e}destroy(){this.initialized&&(this.stopAutoSync(),this.structure&&(!function(e){if(!(e&&e.container&&e.originalElement&&e.content))throw new Error("Invalid editor structure");h(e.content,e.originalElement),e.originalElement.style.display="",e.container.parentNode&&e.container.parentNode.removeChild(e.container)}(this.structure),this.structure=null),this.initialized=!1)}}function Bt(){const e=document.querySelectorAll(".ngeditor"),t=[];return e.forEach(e=>{if(!e._ngeditor)try{const n=new Dt(e);e._ngeditor=n,t.push(n)}catch(e){console.error("Failed to initialize NGTextEditor:",e)}}),t}function zt(e){const t=document.createElement("div");if("string"==typeof e)t.innerHTML=e;else{if(!(e instanceof HTMLElement))throw new Error("Content must be a string or HTMLElement");t.innerHTML=e.innerHTML}t.querySelectorAll(".nge-image-edit-btn, .nge-image-rotate-btn, .nge-image-delete-btn, .nge-image-buttons, .nge-video-edit-btn, .nge-video-delete-btn, .nge-video-buttons, .nge-table-edit-btn, .nge-table-delete-btn, .nge-table-buttons, .nge-column-edit-btn, .nge-column-delete-btn, .nge-column-buttons, .nge-quote-delete-btn, .nge-code-delete-btn, .nge-code-buttons, .nge-resize-handle").forEach(e=>e.remove());return t.querySelectorAll("[contenteditable]").forEach(e=>{e.removeAttribute("contenteditable")}),t.innerHTML}return"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",Bt):Bt()),e.NGTextEditor=Dt,e.autoInit=Bt,e.default=Dt,e.initGlobalCodeBlockCopy=J,e.initGlobalTableSorting=Ie,e.sanitizeForReadOnly=zt,e.setupTableSorting=Me,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=NGTextEditor.min.js.map
