var NGTextEditor=function(e){"use strict";const t="nge-language";let n="fr";const o=[{code:"fr",label:"Français"},{code:"en",label:"English"},{code:"de",label:"Deutsch"},{code:"es",label:"Español"}],r={fr:{toolbar:{paragraph:"Style de paragraphe",fontFamily:"Police de caractères",fontSize:"Taille de police",lineHeight:"Interlignage",textColor:"Couleur du texte",bgColor:"Couleur de fond",bold:"Gras (Ctrl+B)",italic:"Italique (Ctrl+I)",underline:"Souligner (Ctrl+U)",strikethrough:"Barrer",textCase:"Changer la casse",superscript:"Exposant",alignLeft:"Aligner à gauche",alignCenter:"Centrer",alignRight:"Aligner à droite",alignJustify:"Justifier",indent:"Augmenter le retrait",outdent:"Diminuer le retrait",listUl:"Liste à puces",listOl:"Liste numérotée",listTodo:"Liste de tâches",listStyleDecimal:"Nombres",listStyleLowerAlpha:"Alpha (min.)",listStyleUpperAlpha:"Alpha (MAJ.)",listStyleUpperRoman:"Romain",listStyleGreek:"Grec",link:"Insérer un lien",image:"Insérer une image",video:"Insérer une vidéo",table:"Insérer un tableau",columns:"Insérer des colonnes",emoji:"Insérer un emoji",quote:"Insérer une citation",code:"Insérer un bloc de code",hr:"Insérer un séparateur",config:"Configuration de la toolbar",undo:"Annuler (Ctrl+Z)",redo:"Rétablir (Ctrl+Y)",preview:"Prévisualisation",blockOutlines:"Voir les blocs",importJson:"Importer un JSON",exportJson:"Exporter en JSON",exportPdf:"Exporter en PDF",exportHtml:"Exporter en HTML"},importJson:{title:"Importer un document JSON",dropzone:"Glissez-déposez un fichier JSON ici",chooseFile:"Choisir un fichier",orDrop:"ou glissez-déposez ici",preview:"Aperçu du document",version:"Version",exportedAt:"Exporté le",rows:"Lignes",blocks:"Blocs",words:"Mots",chars:"Caractères",contentPreview:"Aperçu du contenu",warning:"Attention : l'import remplacera tout le contenu actuel",import:"Importer",errorInvalidFormat:"Format JSON invalide",errorNoVersion:"Version du document non spécifiée",errorUnsupportedVersion:"Version du document non supportée",errorReadFailed:"Échec de la lecture du fichier",errorInvalidFile:"Fichier invalide",noFile:"Aucun fichier sélectionné"},preview:{title:"Prévisualisation",close:"Fermer"},counter:{words:"{count} mot(s)",chars:"{count} caractère(s)"},common:{delete:"Supprimer",deleteImage:"Supprimer l'image",deleteVideo:"Supprimer la vidéo",deleteTable:"Supprimer le tableau",deleteColumn:"Supprimer les colonnes",deleteQuote:"Supprimer la citation",deleteCode:"Supprimer le bloc de code"},paragraphStyles:{p:"Paragraphe",h1:"Titre 1",h2:"Titre 2",h3:"Titre 3",h4:"Titre 4",h5:"Titre 5"},fonts:{default:"Police par défaut",siteFonts:"Polices du site",standardFonts:"Polices standard"},config:{title:"Configuration de la toolbar",language:"Langue / Language",selectAll:"Tout cocher",deselectAll:"Tout décocher",cancel:"Annuler",apply:"Appliquer",groupFont:"Sélecteurs et couleurs",groupTextStyle:"Style de texte",groupAlignment:"Alignement",groupLists:"Listes",groupMedia:"Médias",groupInsert:"Insertion",toolParagraph:"Style de paragraphe",toolFontFamily:"Police",toolFontSize:"Taille",toolLineHeight:"Interlignage",toolTextColor:"Couleur du texte",toolBgColor:"Couleur de fond",toolBold:"Gras",toolItalic:"Italique",toolUnderline:"Souligné",toolStrikethrough:"Barré",toolTextCase:"Changer la casse",toolSuperscript:"Exposant",toolAlignLeft:"Aligner à gauche",toolAlignCenter:"Centrer",toolAlignRight:"Aligner à droite",toolAlignJustify:"Justifier",toolIndent:"Augmenter le retrait",toolOutdent:"Diminuer le retrait",toolListUl:"Liste à puces",toolListOl:"Liste numérotée",toolListTodo:"Liste de tâches",toolLink:"Lien",toolImage:"Image",toolVideo:"Vidéo",toolTable:"Tableau",toolColumns:"Colonnes",toolEmoji:"Emoji",toolQuote:"Citation",toolCode:"Code",toolHr:"Séparateur",toolImportJson:"Import JSON",toolExportJson:"Export JSON",toolExportPdf:"Export PDF",toolExportHtml:"Export HTML",groupAction:"Actions",toolUndo:"Annuler",toolRedo:"Rétablir",toolPreview:"Aperçu",toolBlockOutlines:"Voir les blocs",toolConfig:"Configuration",showBlockOutlines:"Voir les blocs",showBlockOutlinesHelp:"Affiche les blocs en transparence : bleu pour texte, vert pour média, orange pour conteneur",theme:"Thème",themeLight:"Clair",themeDark:"Sombre",themeWarm:"Chaud",themeCold:"Froid",themeTaupe:"Taupe",themePink:"Rose",iconSize:"Taille des icônes",iconSizeSmall:"Petites",iconSizeLarge:"Grandes",toolbarMode:"Position de la toolbar",toolbarModeIntegrated:"Intégré",toolbarModeFullwidthTop:"Pleine largeur en haut de l'écran",customColors:"Couleurs personnalisées",customColorsHelp:"Si des couleurs sont définies, seules celles-ci seront disponibles",addColor:"Ajouter une couleur",detectColors:"Détecter",detectColorsHelp:"Détecter automatiquement les couleurs du site",removeColor:"Supprimer",invalidColor:"Couleur invalide",customFonts:"Restreindre les polices",customFontsHelp:"Cochez pour limiter le choix aux polices sélectionnées ci-dessous",requiresLicense:"Nécessite une licence"},modal:{cancel:"Annuler",ok:"OK",apply:"Appliquer",insert:"Insérer",edit:"Modifier",close:"Fermer",validate:"Valider",clear:"Effacer",none:"Aucune"},table:{title:"Créer un tableau avancé",editTitle:"Modifier le tableau",structure:"Structure du tableau",rows:"Nombre de lignes",columns:"Nombre de colonnes",includeHeader:"Inclure une ligne d'en-tête",sortable:"Ajouter le tri sur les colonnes",style:"Style du tableau",styleStandard:"Standard",styleBordered:"Bordures complètes",styleStriped:"Lignes alternées",styleMinimal:"Minimal",responsive:"Tableau responsive",width:"Largeur du tableau",alignment:"Alignement du tableau",alignLeft:"Gauche",alignCenter:"Centre",alignRight:"Droite",headerStyle:"Style de l'en-tête",headerBgColor:"Couleur de fond de l'en-tête",transparent:"Transparent",headerFont:"Police de l'en-tête",inheritFont:"Hériter du tableau",size:"Taille",weight:"Graisse",weightNormal:"Normal",weightMedium:"Medium",weightSemiBold:"Semi-gras",weightBold:"Gras",textColor:"Couleur du texte",preview:"Aperçu en temps réel",previewHeader:"En-tête",previewCell:"Cellule",insertTable:"Insérer ce tableau",errorRowsMin:"Le nombre de lignes doit être au moins 1",errorRowsMax:"Le nombre de lignes ne peut pas dépasser 50",errorColsMin:"Le nombre de colonnes doit être au moins 1",errorColsMax:"Le nombre de colonnes ne peut pas dépasser 20"},image:{title:"Insérer une image",editTitle:"Modifier l'image",source:"Source de l'image",chooseFile:"Choisir un fichier",dragDrop:"ou glisser-déposer ici",preview:"Aperçu",noImage:"Aucune image",invalidImage:"Image invalide",readError:"Erreur de lecture",invalidFile:"Fichier invalide",width:"Largeur (px)",height:"Hauteur",auto:"auto",keepRatio:"Conserver les proportions",rotation:"Rotation",rotate90:"Rotation 90°",wrapping:"Habillage",wrapBlock:"Texte en dessous (bloc)",wrapLeft:"Flottant gauche",wrapRight:"Flottant droite",alignment:"Alignement",alignLeft:"Gauche",alignCenter:"Centre",alignRight:"Droite",opacity:"Transparence",border:"Bordure",borderStyle:"Style",borderWidth:"Epaisseur",borderColor:"Couleur",borderRadius:"Arrondis",borderNone:"Aucune",borderSolid:"Continue",borderDashed:"Tirets",borderDotted:"Pointilles",borderDouble:"Double",borderGroove:"Rainure",borderRidge:"Crete",borderInset:"Incrust.",borderOutset:"Relief",insertImage:"Insérer l'image",editImage:"Modifier",errorRequired:"Une source d'image est requise",errorInvalid:"Valeurs invalides",urlPlaceholder:"https://example.com/image.jpg"},video:{title:"Insérer une vidéo",editTitle:"Modifier la vidéo",url:"URL de la vidéo",urlPlaceholder:"https://www.youtube.com/watch?v=...",supported:"Supporte YouTube, Vimeo et Dailymotion",preview:"Aperçu",width:"Largeur (px)",autoplay:"Lecture automatique",alignment:"Alignement",alignLeft:"Gauche",alignCenter:"Centre",alignRight:"Droite",border:"Bordure",borderStyle:"Style",borderWidth:"Epaisseur",borderColor:"Couleur",borderRadius:"Arrondis",borderNone:"Aucune",borderSolid:"Continue",borderDashed:"Tirets",borderDotted:"Pointillés",borderDouble:"Double",borderGroove:"Rainure",borderRidge:"Crête",borderInset:"Incrust.",borderOutset:"Relief",insertVideo:"Insérer la vidéo",errorRequired:"Une URL de vidéo est requise",errorInvalid:"Valeurs invalides",errorUnsupported:"URL de vidéo non reconnue. Utilisez YouTube, Vimeo ou Dailymotion."},link:{title:"Insérer un lien",url:"URL",urlPlaceholder:"https://example.com",text:"Texte à afficher",textPlaceholder:"Texte du lien (optionnel)",tooltip:"Info-bulle",tooltipPlaceholder:"Description au survol (optionnel)",newWindow:"Ouvrir dans une nouvelle fenêtre",nofollow:'Ajouter rel="nofollow" (référencement)',insert:"Insérer",errorRequired:"L'URL est obligatoire",errorInvalid:"URL invalide",emailSeparator:"ou envoyer un email",email:"Adresse email",emailPlaceholder:"contact@example.com",subject:"Sujet du mail",subjectPlaceholder:"Objet du message (optionnel)"},columns:{title:"Configuration des colonnes",editTitle:"Modifier les colonnes",count:"Nombre de colonnes",countHint:"Choisissez le nombre de colonnes pour votre texte",col1:"1 colonne",col2:"2 colonnes",col3:"3 colonnes",spacing:"Espacement entre colonnes",spacingSmall:"Petit (1rem)",spacingMedium:"Moyen (2rem)",spacingLarge:"Grand (3rem)",height:"Hauteur des colonnes",heightHint:"Définissez la hauteur fixe ou automatique des colonnes",heightAuto:"Indéfinie",heightSmall:"Petite",heightMedium:"Moyenne",heightLarge:"Grande",blockWidth:"Largeur du bloc",widthHint:"Choisissez la largeur du bloc de colonnes dans votre article",blockAlignment:"Alignement du bloc",alignHint:"Définissez l'alignement horizontal du bloc de colonnes",alignLeft:"Gauche",alignCenter:"Centre",alignRight:"Droite",textWrap:"Habillage du texte",wrapBlock:"Retour à la ligne",wrapBlockDesc:"Le texte suivant commencera sous le bloc.",wrapFloat:"Texte englobant",wrapFloatDesc:"Le texte suivant entourera le bloc.",verticalAlign:"Alignement vertical",vAlignTop:"Haut",vAlignMiddle:"Milieu",vAlignBottom:"Bas",borders:"Bordures entre les colonnes",borderRadius:"Arrondi des bords",borderThickness:"Épaisseur",borderStyle:"Style",borderColor:"Couleur",styleSolid:"Solide",styleDashed:"Tirets",styleDotted:"Points",styleDouble:"Double",bgColors:"Couleurs de fond",bgArea:"Zone des colonnes",bgColumns:"Colonnes",preview:"Aperçu",previewColumn:"Colonne",apply:"Appliquer les colonnes",errorCount:"Le nombre de colonnes doit être entre 1 et 3",errorSpacing:"Espacement invalide",errorHeight:"Hauteur invalide",errorWidth:"Largeur invalide",errorAlignment:"Alignement invalide"},hr:{title:"Insérer un séparateur",selectStyle:"Sélectionnez un style de séparateur :",opacity:"Transparence :",width:"Largeur :",insert:"Insérer",simple:"Simple",simpleDesc:"Ligne fine classique",thick:"Épaisse",thickDesc:"Ligne épaisse",double:"Double",doubleDesc:"Double ligne",dashed:"Tirets",dashedDesc:"Ligne en tirets",dotted:"Pointillés",dottedDesc:"Ligne en pointillés",gradient:"Dégradé",gradientDesc:"Dégradé bleu",shadow:"Ombre",shadowDesc:"Ligne avec ombre",ornament:"Ornement",ornamentDesc:"Avec symbole central",wavy:"Ondulée",wavyDesc:"Forme ondulée",fade:"Fondu",fadeDesc:"Fondu vers les bords"},quote:{title:"Insérer une citation",selectStyle:"Sélectionnez un style de citation :",insert:"Insérer",previewText:"Votre citation ici...",classic:"Classique",classicDesc:"Bordure gauche bleue traditionnelle",modern:"Moderne",modernDesc:"Carte flottante avec accent",elegant:"Élégant",elegantDesc:"Guillemets dorés décoratifs",minimal:"Minimaliste",minimalDesc:"Épuré avec lignes fines",boxed:"Encadré",boxedDesc:"Double bordure distinctive",shadow:"Ombre profonde",shadowDesc:"Effet carte surélevée",gradient:"Dégradé vif",gradientDesc:"Fond coloré dynamique",retro:"Rétro",retroDesc:"Style machine à écrire",academic:"Académique",academicDesc:"Style citation universitaire",callout:"Mise en avant",calloutDesc:"Bloc d'attention coloré"},colorPicker:{title:"Choisir une couleur",preview:"Aperçu",opacity:"Transparence",savedColors:"Couleurs sauvegardées",noSavedColors:"Aucune couleur sauvegardée",saveColor:"Sauvegarder la couleur actuelle",remove:"Supprimer",eyedropper:"Pipette - Capturer une couleur à l'écran",eyedropperUnavailable:"Pipette non disponible dans ce navigateur",borderRadius:"Arrondi des bords",highlightThickness:"Épaisseur du surlignage",hex:"Hex"},emoji:{search:"Rechercher un emoji...",noResults:"Aucun emoji trouvé",resultsFor:"Résultats pour",mostUsed:"Les plus utilisés",noRecentEmoji:"Aucun emoji utilisé récemment",catSmileys:"Smileys & Émotions",catPeople:"Personnes & Corps",catAnimals:"Animaux & Nature",catFood:"Nourriture & Boissons",catActivities:"Activités",catTravel:"Voyages & Lieux",catObjects:"Objets",catSymbols:"Symboles",catFlags:"Drapeaux"},code:{placeholder:"Entrez votre code ici...",copy:"Copier",copyCode:"Copier le code",copied:"Copié !"},cellFormat:{title:"Format de cellule",bgColor:"Couleur de fond",textColor:"Couleur du texte",border:"Bordure",padding:"Marge intérieure",alignment:"Alignement"},status:{localMode:"Utilisation en local, toutes les fonctionnalités sont disponibles",restrictedTool:"Fonctionnalité disponible avec une licence",freeVersion:"Version gratuite - {current}/{limit} mots",wordLimitReached:"Limite de mots atteinte ({limit} mots max)",licensePro:"Licence Pro",licenseEnterprise:"Licence Enterprise",licenseTrial:"Version d'essai"},gridBlock:{title:"Ajouter un bloc",editTitle:"Modifier le bloc",blockType:"Type de bloc",blockTypeHint:"Texte pour du contenu textuel, Média pour images/vidéos/tableaux",typeText:"Texte",typeMedia:"Média",width:"Largeur du bloc",widthHint:"Choisissez la largeur du bloc dans la grille 12 colonnes",bgImage:"Image de fond",bgImagePlaceholder:"https://example.com/image.jpg",bgImageHint:"URL optionnelle pour une image de fond",bgImageDropHint:"Déposez une image ici ou cliquez pour télécharger",bgOpacity:"Opacité de l'image",bgColor:"Couleur de fond",bgColorHint:"Couleur de fond du bloc (optionnel)",preview:"Aperçu",insert:"Insérer le bloc",edit:"Modifier le bloc",addTextBlock:"Ajouter un bloc texte",addMediaBlock:"Ajouter un bloc média",maxNestingReached:"Niveau d'imbrication maximum atteint",deleteConfirm:"Supprimer ce bloc et son contenu ?",defaultTextContent:"Commencez à écrire ici...",defaultMediaContent:"Cliquez pour insérer du contenu média...",dragHandle:"Déplacer le bloc",configure:"Configurer le bloc",errorBlockType:"Type de bloc invalide",errorWidth:"Largeur invalide",errorNesting:"Niveau d'imbrication invalide",newRow:"+ Nouvelle ligne",insertRowHere:"Insérer une ligne ici",mainDropZone:"Grille principale",spacing:"Espacement",padding:"Marge intérieure",margin:"Marge extérieure",spacingHint:"Ajustez les marges intérieures et extérieures du bloc",paddingHint:"Ajustez la marge intérieure du bloc",marginTop:"Haut",marginRight:"Droite",marginBottom:"Bas",marginLeft:"Gauche",marginHint:"Les marges réduisent l'espace du bloc sans affecter les blocs voisins",blockLabel:"Bloc",decreaseSpacing:"Diminuer",increaseSpacing:"Augmenter"},blockPlacement:{title:"Placement du bloc",mainGrid:"Grille principale",textBlock:"Bloc Texte",mediaBlock:"Bloc Média",exitZone:"Cliquez pour sortir le bloc de ce conteneur",exitZoneLabel:"Sortir du conteneur",emptyCell:"Vide",tooSmall:"Trop petit",newRow:"+ Nouvelle ligne",rowLabel:"Ligne",clickToPlace:"Cliquez pour placer ici",clickToInsertAfter:"Cliquer pour insérer après",confirm:"Confirmer",cancel:"Annuler",movingBlock:"En déplacement",moveBlock:"Déplacer le bloc",breadcrumbLabel:"Hiérarchie des conteneurs",gridLabel:"Grille de placement des blocs",moveRowUp:"Monter la ligne",moveRowDown:"Descendre la ligne",insertIntoBlock:"Le bloc sera inséré à la fin de ce bloc"},blockConfig:{title:"Configuration du bloc",width:"Largeur du bloc :",position:"Position sur la grille :",delete:"Supprimer le bloc"}},en:{toolbar:{paragraph:"Paragraph style",fontFamily:"Font family",fontSize:"Font size",lineHeight:"Line height",textColor:"Text color",bgColor:"Background color",bold:"Bold (Ctrl+B)",italic:"Italic (Ctrl+I)",underline:"Underline (Ctrl+U)",strikethrough:"Strikethrough",textCase:"Change case",superscript:"Superscript",alignLeft:"Align left",alignCenter:"Center",alignRight:"Align right",alignJustify:"Justify",indent:"Increase indent",outdent:"Decrease indent",listUl:"Bullet list",listOl:"Numbered list",listTodo:"Todo list",listStyleDecimal:"Numbers",listStyleLowerAlpha:"Alpha (lower)",listStyleUpperAlpha:"Alpha (UPPER)",listStyleUpperRoman:"Roman",listStyleGreek:"Greek",link:"Insert link",image:"Insert image",video:"Insert video",table:"Insert table",columns:"Insert columns",emoji:"Insert emoji",quote:"Insert quote",code:"Insert code block",hr:"Insert separator",config:"Toolbar configuration",undo:"Undo (Ctrl+Z)",redo:"Redo (Ctrl+Y)",preview:"Preview",blockOutlines:"View blocks",importJson:"Import JSON",exportJson:"Export as JSON",exportPdf:"Export as PDF",exportHtml:"Export as HTML"},importJson:{title:"Import JSON Document",dropzone:"Drag and drop a JSON file here",chooseFile:"Choose file",orDrop:"or drag and drop here",preview:"Document Preview",version:"Version",exportedAt:"Exported on",rows:"Rows",blocks:"Blocks",words:"Words",chars:"Characters",contentPreview:"Content Preview",warning:"Warning: importing will replace all current content",import:"Import",errorInvalidFormat:"Invalid JSON format",errorNoVersion:"Document version not specified",errorUnsupportedVersion:"Unsupported document version",errorReadFailed:"Failed to read file",errorInvalidFile:"Invalid file",noFile:"No file selected"},preview:{title:"Preview",close:"Close"},counter:{words:"{count} word(s)",chars:"{count} character(s)"},common:{delete:"Delete",deleteImage:"Delete image",deleteVideo:"Delete video",deleteTable:"Delete table",deleteColumn:"Delete columns",deleteQuote:"Delete quote",deleteCode:"Delete code block"},paragraphStyles:{p:"Paragraph",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5"},fonts:{default:"Default font",siteFonts:"Site fonts",standardFonts:"Standard fonts"},config:{title:"Toolbar configuration",language:"Language / Langue",selectAll:"Select all",deselectAll:"Deselect all",cancel:"Cancel",apply:"Apply",groupFont:"Selectors and colors",groupTextStyle:"Text style",groupAlignment:"Alignment",groupLists:"Lists",groupMedia:"Media",groupInsert:"Insert",toolParagraph:"Paragraph style",toolFontFamily:"Font",toolFontSize:"Size",toolLineHeight:"Line height",toolTextColor:"Text color",toolBgColor:"Background color",toolBold:"Bold",toolItalic:"Italic",toolUnderline:"Underline",toolStrikethrough:"Strikethrough",toolTextCase:"Change case",toolSuperscript:"Superscript",toolAlignLeft:"Align left",toolAlignCenter:"Center",toolAlignRight:"Align right",toolAlignJustify:"Justify",toolIndent:"Increase indent",toolOutdent:"Decrease indent",toolListUl:"Bullet list",toolListOl:"Numbered list",toolListTodo:"Todo list",toolLink:"Link",toolImage:"Image",toolVideo:"Video",toolTable:"Table",toolColumns:"Columns",toolEmoji:"Emoji",toolQuote:"Quote",toolCode:"Code",toolHr:"Separator",toolImportJson:"JSON Import",toolExportJson:"JSON Export",toolExportPdf:"PDF Export",toolExportHtml:"HTML Export",groupAction:"Actions",toolUndo:"Undo",toolRedo:"Redo",toolPreview:"Preview",toolBlockOutlines:"View blocks",toolConfig:"Configuration",showBlockOutlines:"View blocks",showBlockOutlinesHelp:"Shows blocks with transparency: blue for text, green for media, orange for container",theme:"Theme",themeLight:"Light",themeDark:"Dark",themeWarm:"Warm",themeCold:"Cold",themeTaupe:"Taupe",themePink:"Pink",iconSize:"Icon size",iconSizeSmall:"Small",iconSizeLarge:"Large",toolbarMode:"Toolbar position",toolbarModeIntegrated:"Integrated",toolbarModeFullwidthTop:"Full width at top of screen",customColors:"Custom colors",customColorsHelp:"If colors are defined, only these will be available",addColor:"Add a color",detectColors:"Detect",detectColorsHelp:"Automatically detect site colors",removeColor:"Remove",invalidColor:"Invalid color",customFonts:"Restrict fonts",customFontsHelp:"Check to limit the choice to the fonts selected below",requiresLicense:"Requires a license"},modal:{cancel:"Cancel",ok:"OK",apply:"Apply",insert:"Insert",edit:"Edit",close:"Close",validate:"Confirm",clear:"Clear",none:"None"},table:{title:"Create advanced table",editTitle:"Edit table",structure:"Table structure",rows:"Number of rows",columns:"Number of columns",includeHeader:"Include header row",sortable:"Add column sorting",style:"Table style",styleStandard:"Standard",styleBordered:"Full borders",styleStriped:"Striped rows",styleMinimal:"Minimal",responsive:"Responsive table",width:"Table width",alignment:"Table alignment",alignLeft:"Left",alignCenter:"Center",alignRight:"Right",headerStyle:"Header style",headerBgColor:"Header background color",transparent:"Transparent",headerFont:"Header font",inheritFont:"Inherit from table",size:"Size",weight:"Weight",weightNormal:"Normal",weightMedium:"Medium",weightSemiBold:"Semi-bold",weightBold:"Bold",textColor:"Text color",preview:"Live preview",previewHeader:"Header",previewCell:"Cell",insertTable:"Insert this table",errorRowsMin:"Number of rows must be at least 1",errorRowsMax:"Number of rows cannot exceed 50",errorColsMin:"Number of columns must be at least 1",errorColsMax:"Number of columns cannot exceed 20"},image:{title:"Insert image",editTitle:"Edit image",source:"Image source",chooseFile:"Choose file",dragDrop:"or drag & drop here",preview:"Preview",noImage:"No image",invalidImage:"Invalid image",readError:"Read error",invalidFile:"Invalid file",width:"Width (px)",height:"Height",auto:"auto",keepRatio:"Keep aspect ratio",rotation:"Rotation",rotate90:"Rotate 90°",wrapping:"Text wrapping",wrapBlock:"Text below (block)",wrapLeft:"Float left",wrapRight:"Float right",alignment:"Alignment",alignLeft:"Left",alignCenter:"Center",alignRight:"Right",opacity:"Opacity",border:"Border",borderStyle:"Style",borderWidth:"Width",borderColor:"Color",borderRadius:"Radius",borderNone:"None",borderSolid:"Solid",borderDashed:"Dashed",borderDotted:"Dotted",borderDouble:"Double",borderGroove:"Groove",borderRidge:"Ridge",borderInset:"Inset",borderOutset:"Outset",insertImage:"Insert image",editImage:"Edit",errorRequired:"Image source is required",errorInvalid:"Invalid values",urlPlaceholder:"https://example.com/image.jpg"},video:{title:"Insert video",editTitle:"Edit video",url:"Video URL",urlPlaceholder:"https://www.youtube.com/watch?v=...",supported:"Supports YouTube, Vimeo and Dailymotion",preview:"Preview",width:"Width (px)",autoplay:"Autoplay",alignment:"Alignment",alignLeft:"Left",alignCenter:"Center",alignRight:"Right",border:"Border",borderStyle:"Style",borderWidth:"Width",borderColor:"Color",borderRadius:"Radius",borderNone:"None",borderSolid:"Solid",borderDashed:"Dashed",borderDotted:"Dotted",borderDouble:"Double",borderGroove:"Groove",borderRidge:"Ridge",borderInset:"Inset",borderOutset:"Outset",insertVideo:"Insert video",errorRequired:"Video URL is required",errorInvalid:"Invalid values",errorUnsupported:"Unrecognized video URL. Use YouTube, Vimeo or Dailymotion."},link:{title:"Insert link",url:"URL",urlPlaceholder:"https://example.com",text:"Display text",textPlaceholder:"Link text (optional)",tooltip:"Tooltip",tooltipPlaceholder:"Hover description (optional)",newWindow:"Open in new window",nofollow:'Add rel="nofollow" (SEO)',insert:"Insert",errorRequired:"URL is required",errorInvalid:"Invalid URL",emailSeparator:"or send an email",email:"Email address",emailPlaceholder:"contact@example.com",subject:"Email subject",subjectPlaceholder:"Message subject (optional)"},columns:{title:"Column configuration",editTitle:"Edit columns",count:"Number of columns",countHint:"Choose the number of columns for your text",col1:"1 column",col2:"2 columns",col3:"3 columns",spacing:"Column spacing",spacingSmall:"Small (1rem)",spacingMedium:"Medium (2rem)",spacingLarge:"Large (3rem)",height:"Column height",heightHint:"Set the fixed or automatic height of columns",heightAuto:"Auto",heightSmall:"Small",heightMedium:"Medium",heightLarge:"Large",blockWidth:"Block width",widthHint:"Choose the column block width in your article",blockAlignment:"Block alignment",alignHint:"Set the horizontal alignment of the column block",alignLeft:"Left",alignCenter:"Center",alignRight:"Right",textWrap:"Text wrapping",wrapBlock:"Line break",wrapBlockDesc:"The following text will start below the block.",wrapFloat:"Surrounding text",wrapFloatDesc:"The following text will wrap around the block.",verticalAlign:"Vertical alignment",vAlignTop:"Top",vAlignMiddle:"Middle",vAlignBottom:"Bottom",borders:"Column borders",borderRadius:"Border radius",borderThickness:"Thickness",borderStyle:"Style",borderColor:"Color",styleSolid:"Solid",styleDashed:"Dashed",styleDotted:"Dotted",styleDouble:"Double",bgColors:"Background colors",bgArea:"Column area",bgColumns:"Columns",preview:"Preview",previewColumn:"Column",apply:"Apply columns",errorCount:"Number of columns must be between 1 and 3",errorSpacing:"Invalid spacing",errorHeight:"Invalid height",errorWidth:"Invalid width",errorAlignment:"Invalid alignment"},hr:{title:"Insert separator",selectStyle:"Select a separator style:",opacity:"Opacity:",width:"Width:",insert:"Insert",simple:"Simple",simpleDesc:"Classic thin line",thick:"Thick",thickDesc:"Thick line",double:"Double",doubleDesc:"Double line",dashed:"Dashed",dashedDesc:"Dashed line",dotted:"Dotted",dottedDesc:"Dotted line",gradient:"Gradient",gradientDesc:"Blue gradient",shadow:"Shadow",shadowDesc:"Line with shadow",ornament:"Ornament",ornamentDesc:"With central symbol",wavy:"Wavy",wavyDesc:"Wavy shape",fade:"Fade",fadeDesc:"Fade to edges"},quote:{title:"Insert quote",selectStyle:"Select a quote style:",insert:"Insert",previewText:"Your quote here...",classic:"Classic",classicDesc:"Traditional blue left border",modern:"Modern",modernDesc:"Floating card with accent",elegant:"Elegant",elegantDesc:"Golden decorative quotes",minimal:"Minimal",minimalDesc:"Clean with thin lines",boxed:"Boxed",boxedDesc:"Double distinctive border",shadow:"Deep shadow",shadowDesc:"Elevated card effect",gradient:"Vivid gradient",gradientDesc:"Dynamic colored background",retro:"Retro",retroDesc:"Typewriter style",academic:"Academic",academicDesc:"University citation style",callout:"Callout",calloutDesc:"Colored attention block"},colorPicker:{title:"Choose a color",preview:"Preview",opacity:"Opacity",savedColors:"Saved colors",noSavedColors:"No saved colors",saveColor:"Save current color",remove:"Remove",eyedropper:"Eyedropper - Pick color from screen",eyedropperUnavailable:"Eyedropper not available in this browser",borderRadius:"Border radius",highlightThickness:"Highlight thickness",hex:"Hex"},emoji:{search:"Search emoji...",noResults:"No emoji found",resultsFor:"Results for",mostUsed:"Most used",noRecentEmoji:"No recently used emojis",catSmileys:"Smileys & Emotions",catPeople:"People & Body",catAnimals:"Animals & Nature",catFood:"Food & Drinks",catActivities:"Activities",catTravel:"Travel & Places",catObjects:"Objects",catSymbols:"Symbols",catFlags:"Flags"},code:{placeholder:"Enter your code here...",copy:"Copy",copyCode:"Copy code",copied:"Copied!"},cellFormat:{title:"Cell format",bgColor:"Background color",textColor:"Text color",border:"Border",padding:"Padding",alignment:"Alignment"},status:{localMode:"Running locally, all features are available",restrictedTool:"Feature available with a license",freeVersion:"Free version - {current}/{limit} words",wordLimitReached:"Word limit reached ({limit} words max)",licensePro:"Pro License",licenseEnterprise:"Enterprise License",licenseTrial:"Trial version"},gridBlock:{title:"Add a block",editTitle:"Edit block",blockType:"Block type",blockTypeHint:"Text for textual content, Media for images/videos/tables",typeText:"Text",typeMedia:"Media",width:"Block width",widthHint:"Choose the block width in the 12-column grid",bgImage:"Background image",bgImagePlaceholder:"https://example.com/image.jpg",bgImageHint:"Optional URL for a background image",bgImageDropHint:"Drop an image here or click to upload",bgOpacity:"Image opacity",bgColor:"Background color",bgColorHint:"Block background color (optional)",preview:"Preview",insert:"Insert block",edit:"Edit block",addTextBlock:"Add text block",addMediaBlock:"Add media block",maxNestingReached:"Maximum nesting level reached",deleteConfirm:"Delete this block and its content?",defaultTextContent:"Start writing here...",defaultMediaContent:"Click to insert media content...",dragHandle:"Move block",configure:"Configure block",errorBlockType:"Invalid block type",errorWidth:"Invalid width",errorNesting:"Invalid nesting level",newRow:"+ New row",insertRowHere:"Insert row here",mainDropZone:"Main grid",spacing:"Spacing",padding:"Inner margin",margin:"Outer margin",spacingHint:"Adjust the inner and outer margins of the block",paddingHint:"Adjust the inner margin of the block",marginTop:"Top",marginRight:"Right",marginBottom:"Bottom",marginLeft:"Left",marginHint:"Margins reduce block space without affecting neighboring blocks",blockLabel:"Block",decreaseSpacing:"Decrease",increaseSpacing:"Increase"},blockPlacement:{title:"Block Placement",mainGrid:"Main Grid",textBlock:"Text Block",mediaBlock:"Media Block",exitZone:"Click to move block out of this container",exitZoneLabel:"Exit container",emptyCell:"Empty",tooSmall:"Too small",newRow:"+ New Row",rowLabel:"Row",clickToPlace:"Click to place here",clickToInsertAfter:"Click to insert after",confirm:"Confirm",cancel:"Cancel",movingBlock:"Moving",moveBlock:"Move block",breadcrumbLabel:"Container hierarchy",gridLabel:"Block placement grid",moveRowUp:"Move row up",moveRowDown:"Move row down",insertIntoBlock:"Block will be inserted at the end of this block"},blockConfig:{title:"Block Configuration",width:"Block Width:",position:"Position on Grid:",delete:"Delete Block"}},de:{toolbar:{paragraph:"Absatzformat",fontFamily:"Schriftart",fontSize:"Schriftgröße",lineHeight:"Zeilenabstand",textColor:"Textfarbe",bgColor:"Hintergrundfarbe",bold:"Fett (Strg+B)",italic:"Kursiv (Strg+I)",underline:"Unterstrichen (Strg+U)",strikethrough:"Durchgestrichen",textCase:"Groß-/Kleinschreibung",superscript:"Hochgestellt",alignLeft:"Linksbündig",alignCenter:"Zentriert",alignRight:"Rechtsbündig",alignJustify:"Blocksatz",indent:"Einzug vergrößern",outdent:"Einzug verkleinern",listUl:"Aufzählung",listOl:"Nummerierung",listTodo:"Aufgabenliste",listStyleDecimal:"Zahlen",listStyleLowerAlpha:"Alpha (klein)",listStyleUpperAlpha:"Alpha (GROSS)",listStyleUpperRoman:"Römisch",listStyleGreek:"Griechisch",link:"Link einfügen",image:"Bild einfügen",video:"Video einfügen",table:"Tabelle einfügen",columns:"Spalten einfügen",emoji:"Emoji einfügen",quote:"Zitat einfügen",code:"Codeblock einfügen",hr:"Trennlinie einfügen",config:"Symbolleiste konfigurieren",undo:"Rückgängig (Strg+Z)",redo:"Wiederherstellen (Strg+Y)",preview:"Vorschau",blockOutlines:"Blöcke anzeigen",importJson:"JSON importieren",exportJson:"Als JSON exportieren",exportPdf:"Als PDF exportieren",exportHtml:"Als HTML exportieren"},importJson:{title:"JSON-Dokument importieren",dropzone:"Ziehen Sie eine JSON-Datei hierher",chooseFile:"Datei auswählen",orDrop:"oder hierher ziehen",preview:"Dokumentvorschau",version:"Version",exportedAt:"Exportiert am",rows:"Zeilen",blocks:"Blöcke",words:"Wörter",chars:"Zeichen",contentPreview:"Inhaltsvorschau",warning:"Achtung: Der Import ersetzt den gesamten aktuellen Inhalt",import:"Importieren",errorInvalidFormat:"Ungültiges JSON-Format",errorNoVersion:"Dokumentversion nicht angegeben",errorUnsupportedVersion:"Nicht unterstützte Dokumentversion",errorReadFailed:"Datei konnte nicht gelesen werden",errorInvalidFile:"Ungültige Datei",noFile:"Keine Datei ausgewählt"},preview:{title:"Vorschau",close:"Schließen"},counter:{words:"{count} Wort(e)",chars:"{count} Zeichen"},common:{delete:"Löschen",deleteImage:"Bild löschen",deleteVideo:"Video löschen",deleteTable:"Tabelle löschen",deleteColumn:"Spalten löschen",deleteQuote:"Zitat löschen",deleteCode:"Codeblock löschen"},paragraphStyles:{p:"Absatz",h1:"Überschrift 1",h2:"Überschrift 2",h3:"Überschrift 3",h4:"Überschrift 4",h5:"Überschrift 5"},fonts:{default:"Standardschrift",siteFonts:"Website-Schriftarten",standardFonts:"Standardschriftarten"},config:{title:"Symbolleiste konfigurieren",language:"Sprache / Language",selectAll:"Alle auswählen",deselectAll:"Alle abwählen",cancel:"Abbrechen",apply:"Anwenden",groupFont:"Auswahl und Farben",groupTextStyle:"Textformat",groupAlignment:"Ausrichtung",groupLists:"Listen",groupMedia:"Medien",groupInsert:"Einfügen",toolParagraph:"Absatzformat",toolFontFamily:"Schriftart",toolFontSize:"Größe",toolLineHeight:"Zeilenabstand",toolTextColor:"Textfarbe",toolBgColor:"Hintergrundfarbe",toolBold:"Fett",toolItalic:"Kursiv",toolUnderline:"Unterstrichen",toolStrikethrough:"Durchgestrichen",toolTextCase:"Groß-/Kleinschreibung",toolSuperscript:"Hochgestellt",toolAlignLeft:"Linksbündig",toolAlignCenter:"Zentriert",toolAlignRight:"Rechtsbündig",toolAlignJustify:"Blocksatz",toolIndent:"Einzug vergrößern",toolOutdent:"Einzug verkleinern",toolListUl:"Aufzählung",toolListOl:"Nummerierung",toolListTodo:"Aufgabenliste",toolLink:"Link",toolImage:"Bild",toolVideo:"Video",toolTable:"Tabelle",toolColumns:"Spalten",toolEmoji:"Emoji",toolQuote:"Zitat",toolCode:"Code",toolHr:"Trennlinie",toolImportJson:"JSON-Import",toolExportJson:"JSON-Export",toolExportPdf:"PDF-Export",toolExportHtml:"HTML-Export",groupAction:"Aktionen",toolUndo:"Rückgängig",toolRedo:"Wiederherstellen",toolPreview:"Vorschau",toolBlockOutlines:"Blöcke anzeigen",toolConfig:"Konfiguration",showBlockOutlines:"Blöcke anzeigen",showBlockOutlinesHelp:"Zeigt Blöcke mit Transparenz: blau für Text, grün für Medien, orange für Container",theme:"Thema",themeLight:"Hell",themeDark:"Dunkel",themeWarm:"Warm",themeCold:"Kalt",themeTaupe:"Taupe",themePink:"Rosa",iconSize:"Symbolgröße",iconSizeSmall:"Klein",iconSizeLarge:"Groß",toolbarMode:"Toolbar-Position",toolbarModeIntegrated:"Integriert",toolbarModeFullwidthTop:"Volle Breite oben am Bildschirm",customColors:"Benutzerdefinierte Farben",customColorsHelp:"Wenn Farben definiert sind, sind nur diese verfügbar",addColor:"Farbe hinzufügen",detectColors:"Erkennen",detectColorsHelp:"Website-Farben automatisch erkennen",removeColor:"Entfernen",invalidColor:"Ungültige Farbe",customFonts:"Schriftarten einschränken",customFontsHelp:"Aktivieren, um die Auswahl auf die unten ausgewählten Schriftarten zu beschränken",requiresLicense:"Erfordert eine Lizenz"},modal:{cancel:"Abbrechen",ok:"OK",apply:"Anwenden",insert:"Einfügen",edit:"Bearbeiten",close:"Schließen",validate:"Bestätigen",clear:"Löschen",none:"Keine"},table:{title:"Erweiterte Tabelle erstellen",editTitle:"Tabelle bearbeiten",structure:"Tabellenstruktur",rows:"Anzahl Zeilen",columns:"Anzahl Spalten",includeHeader:"Kopfzeile einschließen",sortable:"Spaltensortierung hinzufügen",style:"Tabellenstil",styleStandard:"Standard",styleBordered:"Volle Rahmen",styleStriped:"Gestreifte Zeilen",styleMinimal:"Minimal",responsive:"Responsive Tabelle",width:"Tabellenbreite",alignment:"Tabellenausrichtung",alignLeft:"Links",alignCenter:"Mitte",alignRight:"Rechts",headerStyle:"Kopfzeilenstil",headerBgColor:"Kopfzeilen-Hintergrundfarbe",transparent:"Transparent",headerFont:"Kopfzeilen-Schriftart",inheritFont:"Von Tabelle erben",size:"Größe",weight:"Stärke",weightNormal:"Normal",weightMedium:"Mittel",weightSemiBold:"Halbfett",weightBold:"Fett",textColor:"Textfarbe",preview:"Live-Vorschau",previewHeader:"Kopfzeile",previewCell:"Zelle",insertTable:"Diese Tabelle einfügen",errorRowsMin:"Die Anzahl der Zeilen muss mindestens 1 sein",errorRowsMax:"Die Anzahl der Zeilen darf 50 nicht überschreiten",errorColsMin:"Die Anzahl der Spalten muss mindestens 1 sein",errorColsMax:"Die Anzahl der Spalten darf 20 nicht überschreiten"},image:{title:"Bild einfügen",editTitle:"Bild bearbeiten",source:"Bildquelle",chooseFile:"Datei wählen",dragDrop:"oder hierher ziehen",preview:"Vorschau",noImage:"Kein Bild",invalidImage:"Ungültiges Bild",readError:"Lesefehler",invalidFile:"Ungültige Datei",width:"Breite (px)",height:"Höhe",auto:"auto",keepRatio:"Seitenverhältnis beibehalten",rotation:"Drehung",rotate90:"90° drehen",wrapping:"Textumbruch",wrapBlock:"Text darunter (Block)",wrapLeft:"Links fließend",wrapRight:"Rechts fließend",alignment:"Ausrichtung",alignLeft:"Links",alignCenter:"Mitte",alignRight:"Rechts",opacity:"Transparenz",border:"Rahmen",borderStyle:"Stil",borderWidth:"Breite",borderColor:"Farbe",borderRadius:"Radius",borderNone:"Keine",borderSolid:"Durchgehend",borderDashed:"Gestrichelt",borderDotted:"Gepunktet",borderDouble:"Doppelt",borderGroove:"Rille",borderRidge:"Grat",borderInset:"Eingelassen",borderOutset:"Erhaben",insertImage:"Bild einfügen",editImage:"Bearbeiten",errorRequired:"Bildquelle ist erforderlich",errorInvalid:"Ungültige Werte",urlPlaceholder:"https://example.com/image.jpg"},video:{title:"Video einfügen",editTitle:"Video bearbeiten",url:"Video-URL",urlPlaceholder:"https://www.youtube.com/watch?v=...",supported:"Unterstützt YouTube, Vimeo und Dailymotion",preview:"Vorschau",width:"Breite (px)",autoplay:"Automatische Wiedergabe",alignment:"Ausrichtung",alignLeft:"Links",alignCenter:"Mitte",alignRight:"Rechts",border:"Rahmen",borderStyle:"Stil",borderWidth:"Breite",borderColor:"Farbe",borderRadius:"Radius",borderNone:"Keine",borderSolid:"Durchgehend",borderDashed:"Gestrichelt",borderDotted:"Gepunktet",borderDouble:"Doppelt",borderGroove:"Rille",borderRidge:"Grat",borderInset:"Eingelassen",borderOutset:"Erhaben",insertVideo:"Video einfügen",errorRequired:"Video-URL ist erforderlich",errorInvalid:"Ungültige Werte",errorUnsupported:"Unbekannte Video-URL. Verwenden Sie YouTube, Vimeo oder Dailymotion."},link:{title:"Link einfügen",url:"URL",urlPlaceholder:"https://example.com",text:"Anzeigetext",textPlaceholder:"Linktext (optional)",tooltip:"Tooltip",tooltipPlaceholder:"Hover-Beschreibung (optional)",newWindow:"In neuem Fenster öffnen",nofollow:'rel="nofollow" hinzufügen (SEO)',insert:"Einfügen",errorRequired:"URL ist erforderlich",errorInvalid:"Ungültige URL",emailSeparator:"oder E-Mail senden",email:"E-Mail-Adresse",emailPlaceholder:"kontakt@example.com",subject:"E-Mail-Betreff",subjectPlaceholder:"Nachrichtenbetreff (optional)"},columns:{title:"Spaltenkonfiguration",editTitle:"Spalten bearbeiten",count:"Anzahl Spalten",countHint:"Wählen Sie die Anzahl der Spalten für Ihren Text",col1:"1 Spalte",col2:"2 Spalten",col3:"3 Spalten",spacing:"Spaltenabstand",spacingSmall:"Klein (1rem)",spacingMedium:"Mittel (2rem)",spacingLarge:"Groß (3rem)",height:"Spaltenhöhe",heightHint:"Legen Sie eine feste oder automatische Höhe für die Spalten fest",heightAuto:"Automatisch",heightSmall:"Klein",heightMedium:"Mittel",heightLarge:"Groß",blockWidth:"Blockbreite",widthHint:"Wählen Sie die Breite des Spaltenblocks in Ihrem Artikel",blockAlignment:"Blockausrichtung",alignHint:"Legen Sie die horizontale Ausrichtung des Spaltenblocks fest",alignLeft:"Links",alignCenter:"Mitte",alignRight:"Rechts",textWrap:"Textumbruch",wrapBlock:"Zeilenumbruch",wrapBlockDesc:"Der folgende Text beginnt unter dem Block.",wrapFloat:"Umfließender Text",wrapFloatDesc:"Der folgende Text umfließt den Block.",verticalAlign:"Vertikale Ausrichtung",vAlignTop:"Oben",vAlignMiddle:"Mitte",vAlignBottom:"Unten",borders:"Spaltenrahmen",borderRadius:"Eckenradius",borderThickness:"Stärke",borderStyle:"Stil",borderColor:"Farbe",styleSolid:"Durchgehend",styleDashed:"Gestrichelt",styleDotted:"Gepunktet",styleDouble:"Doppelt",bgColors:"Hintergrundfarben",bgArea:"Spaltenbereich",bgColumns:"Spalten",preview:"Vorschau",previewColumn:"Spalte",apply:"Spalten anwenden",errorCount:"Anzahl der Spalten muss zwischen 1 und 3 liegen",errorSpacing:"Ungültiger Abstand",errorHeight:"Ungültige Höhe",errorWidth:"Ungültige Breite",errorAlignment:"Ungültige Ausrichtung"},hr:{title:"Trennlinie einfügen",selectStyle:"Wählen Sie einen Trennlinienstil:",opacity:"Transparenz:",width:"Breite:",insert:"Einfügen",simple:"Einfach",simpleDesc:"Klassische dünne Linie",thick:"Dick",thickDesc:"Dicke Linie",double:"Doppelt",doubleDesc:"Doppelte Linie",dashed:"Gestrichelt",dashedDesc:"Gestrichelte Linie",dotted:"Gepunktet",dottedDesc:"Gepunktete Linie",gradient:"Verlauf",gradientDesc:"Blauer Verlauf",shadow:"Schatten",shadowDesc:"Linie mit Schatten",ornament:"Ornament",ornamentDesc:"Mit zentralem Symbol",wavy:"Wellig",wavyDesc:"Wellige Form",fade:"Ausblenden",fadeDesc:"Ausblenden zu den Rändern"},quote:{title:"Zitat einfügen",selectStyle:"Wählen Sie einen Zitatstil:",insert:"Einfügen",previewText:"Ihr Zitat hier...",classic:"Klassisch",classicDesc:"Traditioneller blauer linker Rand",modern:"Modern",modernDesc:"Schwebende Karte mit Akzent",elegant:"Elegant",elegantDesc:"Goldene dekorative Anführungszeichen",minimal:"Minimal",minimalDesc:"Sauber mit dünnen Linien",boxed:"Gerahmt",boxedDesc:"Doppelter markanter Rahmen",shadow:"Tiefer Schatten",shadowDesc:"Erhöhter Karteneffekt",gradient:"Lebhafter Verlauf",gradientDesc:"Dynamischer farbiger Hintergrund",retro:"Retro",retroDesc:"Schreibmaschinenstil",academic:"Akademisch",academicDesc:"Universitärer Zitierstil",callout:"Hervorhebung",calloutDesc:"Farbiger Aufmerksamkeitsblock"},colorPicker:{title:"Farbe wählen",preview:"Vorschau",opacity:"Transparenz",savedColors:"Gespeicherte Farben",noSavedColors:"Keine gespeicherten Farben",saveColor:"Aktuelle Farbe speichern",remove:"Entfernen",eyedropper:"Pipette - Farbe vom Bildschirm aufnehmen",eyedropperUnavailable:"Pipette in diesem Browser nicht verfügbar",borderRadius:"Eckenradius",highlightThickness:"Hervorhebungsdicke",hex:"Hex"},emoji:{search:"Emoji suchen...",noResults:"Kein Emoji gefunden",resultsFor:"Ergebnisse für",mostUsed:"Am häufigsten verwendet",noRecentEmoji:"Keine kürzlich verwendeten Emojis",catSmileys:"Smileys & Emotionen",catPeople:"Personen & Körper",catAnimals:"Tiere & Natur",catFood:"Essen & Trinken",catActivities:"Aktivitäten",catTravel:"Reisen & Orte",catObjects:"Objekte",catSymbols:"Symbole",catFlags:"Flaggen"},code:{placeholder:"Geben Sie Ihren Code hier ein...",copy:"Kopieren",copyCode:"Code kopieren",copied:"Kopiert!"},cellFormat:{title:"Zellenformat",bgColor:"Hintergrundfarbe",textColor:"Textfarbe",border:"Rahmen",padding:"Innenabstand",alignment:"Ausrichtung"},status:{localMode:"Lokaler Betrieb, alle Funktionen sind verfügbar",restrictedTool:"Funktion mit Lizenz verfügbar",freeVersion:"Kostenlose Version - {current}/{limit} Wörter",wordLimitReached:"Wortlimit erreicht ({limit} Wörter max)",licensePro:"Pro-Lizenz",licenseEnterprise:"Enterprise-Lizenz",licenseTrial:"Testversion"},gridBlock:{title:"Block hinzufügen",editTitle:"Block bearbeiten",blockType:"Blocktyp",blockTypeHint:"Text für Textinhalte, Medien für Bilder/Videos/Tabellen",typeText:"Text",typeMedia:"Medien",width:"Blockbreite",widthHint:"Wählen Sie die Blockbreite im 12-Spalten-Raster",bgImage:"Hintergrundbild",bgImagePlaceholder:"https://example.com/image.jpg",bgImageHint:"Optionale URL für ein Hintergrundbild",bgImageDropHint:"Bild hier ablegen oder klicken zum Hochladen",bgOpacity:"Bildtransparenz",bgColor:"Hintergrundfarbe",bgColorHint:"Hintergrundfarbe des Blocks (optional)",preview:"Vorschau",insert:"Block einfügen",edit:"Block bearbeiten",addTextBlock:"Textblock hinzufügen",addMediaBlock:"Medienblock hinzufügen",maxNestingReached:"Maximale Verschachtelungsebene erreicht",deleteConfirm:"Diesen Block und seinen Inhalt löschen?",defaultTextContent:"Beginnen Sie hier zu schreiben...",defaultMediaContent:"Klicken Sie, um Medieninhalte einzufügen...",dragHandle:"Block verschieben",configure:"Block konfigurieren",errorBlockType:"Ungültiger Blocktyp",errorWidth:"Ungültige Breite",errorNesting:"Ungültige Verschachtelungsebene",newRow:"+ Neue Zeile",insertRowHere:"Zeile hier einfügen",mainDropZone:"Hauptraster",spacing:"Abstand",padding:"Innenabstand",margin:"Außenabstand",spacingHint:"Passen Sie die Innen- und Außenabstände des Blocks an",paddingHint:"Passen Sie den Innenabstand des Blocks an",marginTop:"Oben",marginRight:"Rechts",marginBottom:"Unten",marginLeft:"Links",marginHint:"Ränder reduzieren den Blockbereich ohne Nachbarblöcke zu beeinflussen",blockLabel:"Block",decreaseSpacing:"Verringern",increaseSpacing:"Erhöhen"},blockPlacement:{title:"Block platzieren",mainGrid:"Hauptraster",textBlock:"Textblock",mediaBlock:"Medienblock",exitZone:"Klicken Sie, um den Block aus diesem Container zu entfernen",exitZoneLabel:"Container verlassen",emptyCell:"Leer",tooSmall:"Zu klein",newRow:"+ Neue Zeile",rowLabel:"Zeile",clickToPlace:"Klicken Sie hier, um zu platzieren",clickToInsertAfter:"Klicken Sie, um danach einzufügen",confirm:"Bestätigen",cancel:"Abbrechen",movingBlock:"Wird verschoben",moveBlock:"Block verschieben",breadcrumbLabel:"Container-Hierarchie",gridLabel:"Block-Platzierungsraster",moveRowUp:"Zeile nach oben",moveRowDown:"Zeile nach unten",insertIntoBlock:"Block wird am Ende dieses Blocks eingefügt"},blockConfig:{title:"Block-Konfiguration",width:"Blockbreite:",position:"Position im Raster:",delete:"Block löschen"}},es:{toolbar:{paragraph:"Estilo de párrafo",fontFamily:"Tipo de letra",fontSize:"Tamaño de fuente",lineHeight:"Interlineado",textColor:"Color del texto",bgColor:"Color de fondo",bold:"Negrita (Ctrl+B)",italic:"Cursiva (Ctrl+I)",underline:"Subrayado (Ctrl+U)",strikethrough:"Tachado",textCase:"Cambiar mayúsculas",superscript:"Superíndice",alignLeft:"Alinear a la izquierda",alignCenter:"Centrar",alignRight:"Alinear a la derecha",alignJustify:"Justificar",indent:"Aumentar sangría",outdent:"Reducir sangría",listUl:"Lista con viñetas",listOl:"Lista numerada",listTodo:"Lista de tareas",listStyleDecimal:"Números",listStyleLowerAlpha:"Alfa (min.)",listStyleUpperAlpha:"Alfa (MAY.)",listStyleUpperRoman:"Romano",listStyleGreek:"Griego",link:"Insertar enlace",image:"Insertar imagen",video:"Insertar vídeo",table:"Insertar tabla",columns:"Insertar columnas",emoji:"Insertar emoji",quote:"Insertar cita",code:"Insertar bloque de código",hr:"Insertar separador",config:"Configuración de la barra",undo:"Deshacer (Ctrl+Z)",redo:"Rehacer (Ctrl+Y)",preview:"Vista previa",blockOutlines:"Ver bloques",importJson:"Importar JSON",exportJson:"Exportar como JSON",exportPdf:"Exportar como PDF",exportHtml:"Exportar como HTML"},importJson:{title:"Importar documento JSON",dropzone:"Arrastra y suelta un archivo JSON aquí",chooseFile:"Seleccionar archivo",orDrop:"o arrastra y suelta aquí",preview:"Vista previa del documento",version:"Versión",exportedAt:"Exportado el",rows:"Filas",blocks:"Bloques",words:"Palabras",chars:"Caracteres",contentPreview:"Vista previa del contenido",warning:"Advertencia: la importación reemplazará todo el contenido actual",import:"Importar",errorInvalidFormat:"Formato JSON no válido",errorNoVersion:"Versión del documento no especificada",errorUnsupportedVersion:"Versión del documento no compatible",errorReadFailed:"Error al leer el archivo",errorInvalidFile:"Archivo no válido",noFile:"Ningún archivo seleccionado"},preview:{title:"Vista previa",close:"Cerrar"},counter:{words:"{count} palabra(s)",chars:"{count} carácter(es)"},common:{delete:"Eliminar",deleteImage:"Eliminar imagen",deleteVideo:"Eliminar vídeo",deleteTable:"Eliminar tabla",deleteColumn:"Eliminar columnas",deleteQuote:"Eliminar cita",deleteCode:"Eliminar bloque de código"},paragraphStyles:{p:"Párrafo",h1:"Título 1",h2:"Título 2",h3:"Título 3",h4:"Título 4",h5:"Título 5"},fonts:{default:"Fuente predeterminada",siteFonts:"Fuentes del sitio",standardFonts:"Fuentes estándar"},config:{title:"Configuración de la barra",language:"Idioma / Language",selectAll:"Seleccionar todo",deselectAll:"Deseleccionar todo",cancel:"Cancelar",apply:"Aplicar",groupFont:"Selectores y colores",groupTextStyle:"Estilo de texto",groupAlignment:"Alineación",groupLists:"Listas",groupMedia:"Medios",groupInsert:"Insertar",toolParagraph:"Estilo de párrafo",toolFontFamily:"Fuente",toolFontSize:"Tamaño",toolLineHeight:"Interlineado",toolTextColor:"Color del texto",toolBgColor:"Color de fondo",toolBold:"Negrita",toolItalic:"Cursiva",toolUnderline:"Subrayado",toolStrikethrough:"Tachado",toolTextCase:"Cambiar mayúsculas",toolSuperscript:"Superíndice",toolAlignLeft:"Alinear a la izquierda",toolAlignCenter:"Centrar",toolAlignRight:"Alinear a la derecha",toolAlignJustify:"Justificar",toolIndent:"Aumentar sangría",toolOutdent:"Reducir sangría",toolListUl:"Lista con viñetas",toolListOl:"Lista numerada",toolListTodo:"Lista de tareas",toolLink:"Enlace",toolImage:"Imagen",toolVideo:"Vídeo",toolTable:"Tabla",toolColumns:"Columnas",toolEmoji:"Emoji",toolQuote:"Cita",toolCode:"Código",toolHr:"Separador",toolImportJson:"Importar JSON",toolExportJson:"Exportar JSON",toolExportPdf:"Exportar PDF",toolExportHtml:"Exportar HTML",groupAction:"Acciones",toolUndo:"Deshacer",toolRedo:"Rehacer",toolPreview:"Vista previa",toolBlockOutlines:"Ver bloques",toolConfig:"Configuración",showBlockOutlines:"Ver bloques",showBlockOutlinesHelp:"Muestra bloques con transparencia: azul para texto, verde para multimedia, naranja para contenedor",theme:"Tema",themeLight:"Claro",themeDark:"Oscuro",themeWarm:"Cálido",themeCold:"Frío",themeTaupe:"Topo",themePink:"Rosa",iconSize:"Tamaño de iconos",iconSizeSmall:"Pequeños",iconSizeLarge:"Grandes",toolbarMode:"Posición de la toolbar",toolbarModeIntegrated:"Integrado",toolbarModeFullwidthTop:"Ancho completo arriba de la pantalla",customColors:"Colores personalizados",customColorsHelp:"Si se definen colores, solo estos estarán disponibles",addColor:"Añadir un color",detectColors:"Detectar",detectColorsHelp:"Detectar automáticamente los colores del sitio",removeColor:"Eliminar",invalidColor:"Color no válido",customFonts:"Restringir fuentes",customFontsHelp:"Marcar para limitar la selección a las fuentes elegidas abajo",requiresLicense:"Requiere una licencia"},modal:{cancel:"Cancelar",ok:"OK",apply:"Aplicar",insert:"Insertar",edit:"Editar",close:"Cerrar",validate:"Confirmar",clear:"Borrar",none:"Ninguno"},table:{title:"Crear tabla avanzada",editTitle:"Editar tabla",structure:"Estructura de la tabla",rows:"Número de filas",columns:"Número de columnas",includeHeader:"Incluir fila de encabezado",sortable:"Añadir ordenación de columnas",style:"Estilo de tabla",styleStandard:"Estándar",styleBordered:"Bordes completos",styleStriped:"Filas alternas",styleMinimal:"Minimal",responsive:"Tabla responsive",width:"Ancho de tabla",alignment:"Alineación de tabla",alignLeft:"Izquierda",alignCenter:"Centro",alignRight:"Derecha",headerStyle:"Estilo del encabezado",headerBgColor:"Color de fondo del encabezado",transparent:"Transparente",headerFont:"Fuente del encabezado",inheritFont:"Heredar de la tabla",size:"Tamaño",weight:"Grosor",weightNormal:"Normal",weightMedium:"Medio",weightSemiBold:"Semi-negrita",weightBold:"Negrita",textColor:"Color del texto",preview:"Vista previa en tiempo real",previewHeader:"Encabezado",previewCell:"Celda",insertTable:"Insertar esta tabla",errorRowsMin:"El número de filas debe ser al menos 1",errorRowsMax:"El número de filas no puede superar 50",errorColsMin:"El número de columnas debe ser al menos 1",errorColsMax:"El número de columnas no puede superar 20"},image:{title:"Insertar imagen",editTitle:"Editar imagen",source:"Fuente de imagen",chooseFile:"Elegir archivo",dragDrop:"o arrastrar y soltar aquí",preview:"Vista previa",noImage:"Sin imagen",invalidImage:"Imagen no válida",readError:"Error de lectura",invalidFile:"Archivo no válido",width:"Ancho (px)",height:"Alto",auto:"auto",keepRatio:"Mantener proporciones",rotation:"Rotación",rotate90:"Rotar 90°",wrapping:"Ajuste de texto",wrapBlock:"Texto debajo (bloque)",wrapLeft:"Flotante izquierda",wrapRight:"Flotante derecha",alignment:"Alineación",alignLeft:"Izquierda",alignCenter:"Centro",alignRight:"Derecha",opacity:"Opacidad",border:"Borde",borderStyle:"Estilo",borderWidth:"Grosor",borderColor:"Color",borderRadius:"Radio",borderNone:"Ninguno",borderSolid:"Solido",borderDashed:"Guiones",borderDotted:"Puntos",borderDouble:"Doble",borderGroove:"Ranura",borderRidge:"Cresta",borderInset:"Hundido",borderOutset:"Relieve",insertImage:"Insertar imagen",editImage:"Editar",errorRequired:"Se requiere una fuente de imagen",errorInvalid:"Valores no válidos",urlPlaceholder:"https://example.com/image.jpg"},video:{title:"Insertar vídeo",editTitle:"Editar vídeo",url:"URL del vídeo",urlPlaceholder:"https://www.youtube.com/watch?v=...",supported:"Soporta YouTube, Vimeo y Dailymotion",preview:"Vista previa",width:"Ancho (px)",autoplay:"Reproducción automática",alignment:"Alineación",alignLeft:"Izquierda",alignCenter:"Centro",alignRight:"Derecha",border:"Borde",borderStyle:"Estilo",borderWidth:"Grosor",borderColor:"Color",borderRadius:"Radio",borderNone:"Ninguno",borderSolid:"Sólido",borderDashed:"Rayas",borderDotted:"Puntos",borderDouble:"Doble",borderGroove:"Ranura",borderRidge:"Cresta",borderInset:"Hundido",borderOutset:"Relieve",insertVideo:"Insertar vídeo",errorRequired:"Se requiere una URL de vídeo",errorInvalid:"Valores no válidos",errorUnsupported:"URL de vídeo no reconocida. Use YouTube, Vimeo o Dailymotion."},link:{title:"Insertar enlace",url:"URL",urlPlaceholder:"https://example.com",text:"Texto a mostrar",textPlaceholder:"Texto del enlace (opcional)",tooltip:"Información emergente",tooltipPlaceholder:"Descripción al pasar (opcional)",newWindow:"Abrir en nueva ventana",nofollow:'Añadir rel="nofollow" (SEO)',insert:"Insertar",errorRequired:"La URL es obligatoria",errorInvalid:"URL no válida",emailSeparator:"o enviar un correo",email:"Dirección de correo",emailPlaceholder:"contacto@example.com",subject:"Asunto del correo",subjectPlaceholder:"Asunto del mensaje (opcional)"},columns:{title:"Configuración de columnas",editTitle:"Editar columnas",count:"Número de columnas",countHint:"Elija el número de columnas para su texto",col1:"1 columna",col2:"2 columnas",col3:"3 columnas",spacing:"Espaciado entre columnas",spacingSmall:"Pequeño (1rem)",spacingMedium:"Medio (2rem)",spacingLarge:"Grande (3rem)",height:"Altura de columnas",heightHint:"Defina una altura fija o automática para las columnas",heightAuto:"Automática",heightSmall:"Pequeña",heightMedium:"Media",heightLarge:"Grande",blockWidth:"Ancho del bloque",widthHint:"Elija el ancho del bloque de columnas en su artículo",blockAlignment:"Alineación del bloque",alignHint:"Defina la alineación horizontal del bloque de columnas",alignLeft:"Izquierda",alignCenter:"Centro",alignRight:"Derecha",textWrap:"Ajuste de texto",wrapBlock:"Salto de línea",wrapBlockDesc:"El texto siguiente comenzará debajo del bloque.",wrapFloat:"Texto envolvente",wrapFloatDesc:"El texto siguiente rodeará el bloque.",verticalAlign:"Alineación vertical",vAlignTop:"Arriba",vAlignMiddle:"Medio",vAlignBottom:"Abajo",borders:"Bordes entre columnas",borderRadius:"Radio de borde",borderThickness:"Grosor",borderStyle:"Estilo",borderColor:"Color",styleSolid:"Sólido",styleDashed:"Guiones",styleDotted:"Puntos",styleDouble:"Doble",bgColors:"Colores de fondo",bgArea:"Área de columnas",bgColumns:"Columnas",preview:"Vista previa",previewColumn:"Columna",apply:"Aplicar columnas",errorCount:"El número de columnas debe estar entre 1 y 3",errorSpacing:"Espaciado no válido",errorHeight:"Altura no válida",errorWidth:"Ancho no válido",errorAlignment:"Alineación no válida"},hr:{title:"Insertar separador",selectStyle:"Seleccione un estilo de separador:",opacity:"Opacidad:",width:"Ancho:",insert:"Insertar",simple:"Simple",simpleDesc:"Línea fina clásica",thick:"Gruesa",thickDesc:"Línea gruesa",double:"Doble",doubleDesc:"Línea doble",dashed:"Guiones",dashedDesc:"Línea de guiones",dotted:"Puntos",dottedDesc:"Línea de puntos",gradient:"Degradado",gradientDesc:"Degradado azul",shadow:"Sombra",shadowDesc:"Línea con sombra",ornament:"Ornamento",ornamentDesc:"Con símbolo central",wavy:"Ondulada",wavyDesc:"Forma ondulada",fade:"Difuminado",fadeDesc:"Difuminado hacia los bordes"},quote:{title:"Insertar cita",selectStyle:"Seleccione un estilo de cita:",insert:"Insertar",previewText:"Tu cita aquí...",classic:"Clásico",classicDesc:"Borde izquierdo azul tradicional",modern:"Moderno",modernDesc:"Tarjeta flotante con acento",elegant:"Elegante",elegantDesc:"Comillas doradas decorativas",minimal:"Minimalista",minimalDesc:"Limpio con líneas finas",boxed:"Enmarcado",boxedDesc:"Doble borde distintivo",shadow:"Sombra profunda",shadowDesc:"Efecto de tarjeta elevada",gradient:"Degradado vivo",gradientDesc:"Fondo de color dinámico",retro:"Retro",retroDesc:"Estilo máquina de escribir",academic:"Académico",academicDesc:"Estilo de cita universitaria",callout:"Destacado",calloutDesc:"Bloque de atención coloreado"},colorPicker:{title:"Elegir un color",preview:"Vista previa",opacity:"Opacidad",savedColors:"Colores guardados",noSavedColors:"Sin colores guardados",saveColor:"Guardar color actual",remove:"Eliminar",eyedropper:"Cuentagotas - Capturar color de pantalla",eyedropperUnavailable:"Cuentagotas no disponible en este navegador",borderRadius:"Radio de borde",highlightThickness:"Grosor del resaltado",hex:"Hex"},emoji:{search:"Buscar emoji...",noResults:"No se encontró emoji",resultsFor:"Resultados para",mostUsed:"Más usados",noRecentEmoji:"No hay emojis usados recientemente",catSmileys:"Smileys y emociones",catPeople:"Personas y cuerpo",catAnimals:"Animales y naturaleza",catFood:"Comida y bebida",catActivities:"Actividades",catTravel:"Viajes y lugares",catObjects:"Objetos",catSymbols:"Símbolos",catFlags:"Banderas"},code:{placeholder:"Ingrese su código aquí...",copy:"Copiar",copyCode:"Copiar código",copied:"¡Copiado!"},cellFormat:{title:"Formato de celda",bgColor:"Color de fondo",textColor:"Color del texto",border:"Borde",padding:"Relleno",alignment:"Alineación"},status:{localMode:"Uso local, todas las funciones están disponibles",restrictedTool:"Función disponible con licencia",freeVersion:"Versión gratuita - {current}/{limit} palabras",wordLimitReached:"Límite de palabras alcanzado ({limit} palabras máx)",licensePro:"Licencia Pro",licenseEnterprise:"Licencia Enterprise",licenseTrial:"Versión de prueba"},gridBlock:{title:"Añadir un bloque",editTitle:"Editar bloque",blockType:"Tipo de bloque",blockTypeHint:"Texto para contenido textual, Media para imágenes/vídeos/tablas",typeText:"Texto",typeMedia:"Media",width:"Ancho del bloque",widthHint:"Elija el ancho del bloque en la cuadrícula de 12 columnas",bgImage:"Imagen de fondo",bgImagePlaceholder:"https://example.com/image.jpg",bgImageHint:"URL opcional para una imagen de fondo",bgImageDropHint:"Suelta una imagen aquí o haz clic para subir",bgOpacity:"Opacidad de imagen",bgColor:"Color de fondo",bgColorHint:"Color de fondo del bloque (opcional)",preview:"Vista previa",insert:"Insertar bloque",edit:"Editar bloque",addTextBlock:"Añadir bloque de texto",addMediaBlock:"Añadir bloque de media",maxNestingReached:"Nivel máximo de anidación alcanzado",deleteConfirm:"¿Eliminar este bloque y su contenido?",defaultTextContent:"Comience a escribir aquí...",defaultMediaContent:"Haga clic para insertar contenido multimedia...",dragHandle:"Mover bloque",configure:"Configurar bloque",errorBlockType:"Tipo de bloque inválido",errorWidth:"Ancho inválido",errorNesting:"Nivel de anidación inválido",newRow:"+ Nueva línea",insertRowHere:"Insertar línea aquí",mainDropZone:"Cuadrícula principal",spacing:"Espaciado",padding:"Margen interior",margin:"Margen exterior",spacingHint:"Ajuste los márgenes interiores y exteriores del bloque",paddingHint:"Ajuste el margen interior del bloque",marginTop:"Arriba",marginRight:"Derecha",marginBottom:"Abajo",marginLeft:"Izquierda",marginHint:"Los márgenes reducen el espacio del bloque sin afectar a los bloques vecinos",blockLabel:"Bloque",decreaseSpacing:"Disminuir",increaseSpacing:"Aumentar"},blockPlacement:{title:"Colocación del bloque",mainGrid:"Cuadrícula principal",textBlock:"Bloque de texto",mediaBlock:"Bloque multimedia",exitZone:"Haz clic para sacar el bloque de este contenedor",exitZoneLabel:"Salir del contenedor",emptyCell:"Vacío",tooSmall:"Muy pequeño",newRow:"+ Nueva fila",rowLabel:"Fila",clickToPlace:"Haz clic para colocar aquí",clickToInsertAfter:"Haz clic para insertar después",confirm:"Confirmar",cancel:"Cancelar",movingBlock:"Moviendo",moveBlock:"Mover bloque",breadcrumbLabel:"Jerarquía de contenedores",gridLabel:"Cuadrícula de colocación de bloques",moveRowUp:"Subir fila",moveRowDown:"Bajar fila",insertIntoBlock:"El bloque se insertará al final de este bloque"},blockConfig:{title:"Configuración del bloque",width:"Ancho del bloque:",position:"Posición en la cuadrícula:",delete:"Eliminar bloque"}}};function a(){if("undefined"!=typeof localStorage)try{const e=localStorage.getItem(t);e&&r[e]&&(n=e)}catch(e){}return n}function i(e,o=!0){if(!r[e])return!1;if(n=e,o&&"undefined"!=typeof localStorage)try{localStorage.setItem(t,e)}catch(e){}return!0}function l(e){const t=a(),n=e.split(".");let o=r[t];for(const t of n){if(!o||"object"!=typeof o)return e;o=o[t]}return o||e}let s=null,c=null;function d(){if(null!==c)return c;const e=new Set;try{const t=document.styleSheets;for(let n=0;n<t.length;n++){const o=t[n];try{const t=o.cssRules||o.rules;if(!t)continue;for(let n=0;n<t.length;n++){const o=t[n];if(o.style){const t=o.style.fontFamily||o.style["font-family"];t&&u(t,e)}if(o.cssRules)for(let t=0;t<o.cssRules.length;t++){const n=o.cssRules[t];if(n.style){const t=n.style.fontFamily||n.style["font-family"];t&&u(t,e)}}}}catch(e){continue}}}catch(e){return c=[],c}const t=["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","inherit","initial","unset"],n=Array.from(e).filter(e=>!t.includes(e.toLowerCase())).sort((e,t)=>e.localeCompare(t)).map(e=>({value:e,label:e}));return c=n,c}function u(e,t){if(!e||"string"!=typeof e)return;const n=e.split(",");for(const e of n){let n=e.trim().replace(/^["']|["']$/g,"");n&&(n=n.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),t.add(n))}}const g=[{value:"",label:"fonts.default"},{value:"Arial, sans-serif",label:"Arial"},{value:"Helvetica, Arial, sans-serif",label:"Helvetica"},{value:"Georgia, serif",label:"Georgia"},{value:"Times New Roman, Times, serif",label:"Times New Roman"},{value:"Courier New, Courier, monospace",label:"Courier New"},{value:"Verdana, Geneva, sans-serif",label:"Verdana"},{value:"Trebuchet MS, sans-serif",label:"Trebuchet MS"},{value:"Impact, sans-serif",label:"Impact"},{value:"Comic Sans MS, cursive",label:"Comic Sans MS"},{value:"Palatino Linotype, Book Antiqua, Palatino, serif",label:"Palatino"},{value:"Lucida Sans Unicode, Lucida Grande, sans-serif",label:"Lucida Sans"},{value:"Tahoma, Geneva, sans-serif",label:"Tahoma"},{value:"Century Gothic, sans-serif",label:"Century Gothic"},{value:"Garamond, serif",label:"Garamond"},{value:"Bookman Old Style, serif",label:"Bookman"},{value:"Arial Black, sans-serif",label:"Arial Black"},{value:"Brush Script MT, cursive",label:"Brush Script"},{value:"Copperplate, Copperplate Gothic Light, fantasy",label:"Copperplate"},{value:"Rockwell, serif",label:"Rockwell"}];function p(e){s=e}function m(){return s&&Array.isArray(s)&&s.length>0?s:null}let h={};function b(){return function(e=!0,t=!0){const n=m();if(n&&n.length>0)return e?[{value:"",label:l("fonts.default")},...n]:n;const o=g.map(e=>({value:e.value,label:"fonts.default"===e.label?l("fonts.default"):e.label}));if(t){const t=d();if(t.length>0){const n=new Set(g.map(e=>e.label.toLowerCase())),r=t.filter(e=>!n.has(e.label.toLowerCase()));if(r.length>0){const t=[];return e&&t.push({value:"",label:l("fonts.default")}),t.push({value:"",label:"── "+l("fonts.siteFonts")+" ──",disabled:!0}),t.push(...r),t.push({value:"",label:"── "+l("fonts.standardFonts")+" ──",disabled:!0}),t.push(...o.filter(e=>""!==e.value)),t}}}return o}(!0)}const f=[{value:"",label:"Police par défaut"},{value:"Arial, sans-serif",label:"Arial"},{value:"Helvetica, Arial, sans-serif",label:"Helvetica"},{value:"Georgia, serif",label:"Georgia"},{value:"Times New Roman, Times, serif",label:"Times New Roman"},{value:"Courier New, Courier, monospace",label:"Courier New"},{value:"Verdana, Geneva, sans-serif",label:"Verdana"},{value:"Trebuchet MS, sans-serif",label:"Trebuchet MS"},{value:"Impact, sans-serif",label:"Impact"},{value:"Comic Sans MS, cursive",label:"Comic Sans MS"},{value:"Palatino Linotype, Book Antiqua, Palatino, serif",label:"Palatino"},{value:"Lucida Sans Unicode, Lucida Grande, sans-serif",label:"Lucida Sans"},{value:"Tahoma, Geneva, sans-serif",label:"Tahoma"},{value:"Century Gothic, sans-serif",label:"Century Gothic"},{value:"Garamond, serif",label:"Garamond"},{value:"Bookman Old Style, serif",label:"Bookman"},{value:"Arial Black, sans-serif",label:"Arial Black"},{value:"Brush Script MT, cursive",label:"Brush Script"},{value:"Copperplate, Copperplate Gothic Light, fantasy",label:"Copperplate"},{value:"Rockwell, serif",label:"Rockwell"}],v=[{value:"9px",label:"9"},{value:"10px",label:"10"},{value:"11px",label:"11"},{value:"12px",label:"12"},{value:"14px",label:"14"},{value:"16px",label:"16"},{value:"18px",label:"18"},{value:"20px",label:"20"},{value:"24px",label:"24"},{value:"28px",label:"28"},{value:"32px",label:"32"},{value:"36px",label:"36"},{value:"42px",label:"42"},{value:"48px",label:"48"}],y=[{value:"1",label:"1"},{value:"1.15",label:"1.15"},{value:"1.5",label:"1.5"},{value:"2",label:"2"},{value:"2.5",label:"2.5"},{value:"3",label:"3"}],w=[{value:"decimal",label:"toolbar.listStyleDecimal"},{value:"lower-alpha",label:"toolbar.listStyleLowerAlpha"},{value:"upper-alpha",label:"toolbar.listStyleUpperAlpha"},{value:"upper-roman",label:"toolbar.listStyleUpperRoman"},{value:"lower-greek",label:"toolbar.listStyleGreek"}];function C(e){h=e||{}}function k(){const e=h["list-ol"];return e&&e.styles&&Array.isArray(e.styles)?w.filter(t=>e.styles.includes(t.value)).map(e=>({value:e.value,label:l(e.label)})):w.map(e=>({value:e.value,label:l(e.label)}))}function x(e,t){if(!t)return!0;const n=t[e];return void 0===n||("boolean"==typeof n?n:"object"!=typeof n||null===n||!1!==n.activate)}function E(e=null){const t=document.createElement("div");t.className="nge-toolbar",t.setAttribute("role","toolbar"),t.setAttribute("data-testid","nge-toolbar");const n=document.createElement("div");if(n.className="nge-toolbar-group",n.setAttribute("data-group","font"),x("paragraph",e)){const e=L({id:"paragraph",title:l("toolbar.paragraph"),options:[{value:"p",label:l("paragraphStyles.p")},{value:"h1",label:l("paragraphStyles.h1")},{value:"h2",label:l("paragraphStyles.h2")},{value:"h3",label:l("paragraphStyles.h3")},{value:"h4",label:l("paragraphStyles.h4")},{value:"h5",label:l("paragraphStyles.h5")}],showFontPreview:!1,showParagraphPreview:!0,width:"110px"});n.appendChild(e)}if(x("font-family",e)){const e=L({id:"font-family",title:l("toolbar.fontFamily"),options:b(),showFontPreview:!0,width:"140px"});n.appendChild(e)}if(x("font-size",e)){const e=L({id:"font-size",title:l("toolbar.fontSize"),options:v,showFontPreview:!1,width:"65px"});n.appendChild(e)}if(x("line-height",e)){const e=document.createElement("div");e.className="nge-toolbar-select-with-icon",e.setAttribute("title",l("toolbar.lineHeight"));const t=document.createElement("span");t.className="nge-icon nge-icon-line-height",e.appendChild(t);const o=L({id:"line-height",title:l("toolbar.lineHeight"),options:y,showFontPreview:!1,width:"55px"});e.appendChild(o),n.appendChild(e)}if(x("text-color",e)){const e=S({id:"text-color",title:l("toolbar.textColor"),icon:"text-color"});n.appendChild(e)}if(x("bg-color",e)){const e=S({id:"bg-color",title:l("toolbar.bgColor"),icon:"bg-color"});n.appendChild(e)}n.children.length>0&&t.appendChild(n);return[{name:"text-style",buttons:[{id:"bold",title:l("toolbar.bold"),icon:"bold"},{id:"italic",title:l("toolbar.italic"),icon:"italic"},{id:"underline",title:l("toolbar.underline"),icon:"underline"},{id:"strikethrough",title:l("toolbar.strikethrough"),icon:"strikethrough"},{id:"text-case",title:l("toolbar.textCase"),icon:"text-case"},{id:"superscript",title:l("toolbar.superscript"),icon:"superscript"}]},{name:"alignment",buttons:[{id:"align-left",title:l("toolbar.alignLeft"),icon:"align-left"},{id:"align-center",title:l("toolbar.alignCenter"),icon:"align-center"},{id:"align-right",title:l("toolbar.alignRight"),icon:"align-right"},{id:"align-justify",title:l("toolbar.alignJustify"),icon:"align-justify"},{id:"indent",title:l("toolbar.indent"),icon:"indent"},{id:"outdent",title:l("toolbar.outdent"),icon:"outdent"}]},{name:"lists",buttons:[{id:"list-ul",title:l("toolbar.listUl"),icon:"list-ul"},{id:"list-ol",title:l("toolbar.listOl"),icon:"list-ol"},{id:"list-todo",title:l("toolbar.listTodo"),icon:"list-todo"}]},{name:"media",buttons:[{id:"link",title:l("toolbar.link"),icon:"link"},{id:"image",title:l("toolbar.image"),icon:"image"},{id:"video",title:l("toolbar.video"),icon:"video"},{id:"table",title:l("toolbar.table"),icon:"table"},{id:"columns",title:l("toolbar.columns"),icon:"columns"},{id:"emoji",title:l("toolbar.emoji"),icon:"emoji"}]},{name:"insert",buttons:[{id:"quote",title:l("toolbar.quote"),icon:"quote"},{id:"code",title:l("toolbar.code"),icon:"code"},{id:"hr",title:l("toolbar.hr"),icon:"hr"}]},{name:"action",buttons:[{id:"undo",title:l("toolbar.undo"),icon:"undo"},{id:"redo",title:l("toolbar.redo"),icon:"redo"},{id:"preview",title:l("toolbar.preview"),icon:"preview"},{id:"block-outlines",title:l("toolbar.blockOutlines"),icon:"block-outlines"},{id:"import-json",title:l("toolbar.importJson"),icon:"import-json"},{id:"export-json",title:l("toolbar.exportJson"),icon:"export-json"},{id:"export-pdf",title:l("toolbar.exportPdf"),icon:"export-pdf"},{id:"export-html",title:l("toolbar.exportHtml"),icon:"export-html"},{id:"toolbar-config",title:l("toolbar.config"),icon:"settings"}]}].forEach(n=>{const o=document.createElement("div");o.className="nge-toolbar-group",o.setAttribute("data-group",n.name),n.buttons.forEach(t=>{if(x(t.id,e))if("list-ol"===t.id){const e=document.createElement("div");e.className="nge-toolbar-select-with-icon",e.setAttribute("title",l("toolbar.listOl"));const t=document.createElement("span");t.className="nge-icon nge-icon-list-ol",e.appendChild(t);const n=L({id:"list-ol",title:l("toolbar.listOl"),options:k(),showFontPreview:!1,width:"90px"});e.appendChild(n),o.appendChild(e)}else{const e=S(t);o.appendChild(e)}}),o.children.length>0&&t.appendChild(o)}),t}function S(e){if(!(e&&e.id&&e.title&&e.icon))throw new Error("Invalid toolbar button configuration");const t=document.createElement("button");return t.type="button",t.className="nge-toolbar-button",t.setAttribute("data-command",e.id),t.setAttribute("data-testid","nge-button-"+e.id),t.setAttribute("title",e.title),t.setAttribute("aria-label",e.title),t.innerHTML='<span class="nge-icon nge-icon-'+e.icon+'"></span>',t}const A={h1:{fontSize:"18px",fontWeight:"bold"},h2:{fontSize:"16px",fontWeight:"bold"},h3:{fontSize:"14px",fontWeight:"bold"},h4:{fontSize:"13px",fontWeight:"bold"},h5:{fontSize:"12px",fontWeight:"bold"},p:{fontSize:"13px",fontWeight:"normal"}};function L(e){if(!(e&&e.id&&e.title&&e.options))throw new Error("Invalid toolbar select configuration");const t=document.createElement("select");return t.className="nge-toolbar-select",t.setAttribute("data-command",e.id),t.setAttribute("data-testid","nge-select-"+e.id),t.setAttribute("title",e.title),t.setAttribute("aria-label",e.title),e.width&&(t.style.width=e.width),e.options.forEach(n=>{const o=document.createElement("option");if(o.value=n.value,o.textContent=n.label,e.showFontPreview&&n.value&&(o.style.fontFamily=n.value),e.showParagraphPreview&&n.value){const e=A[n.value];e&&(o.style.fontSize=e.fontSize,o.style.fontWeight=e.fontWeight)}t.appendChild(o)}),t}const T=["undo","redo","preview","block-outlines","import-json","export-json","export-pdf","export-html","toolbar-config"],N=["bold","italic","underline","strikethrough","text-case","superscript","align-left","align-center","align-right","align-justify","indent","outdent","list-ul","list-ol","list-todo","quote","code","hr","text-color","bg-color","link","emoji","paragraph","font-family","font-size","line-height"],M=["image","video","table","columns"];function I(e,t){if(!e||!t)throw new Error("Invalid parameters for syncContent");const n=document.createElement("div");n.innerHTML=e.innerHTML||"",n.querySelectorAll(".nge-cell-selected").forEach(e=>{e.classList.remove("nge-cell-selected")}),t.value=n.innerHTML}function R(e,t="text"){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid editor content element");if("html"===t){return function(e){const t=document.createElement("div");t.innerHTML=e;const n=(e,t)=>{const n=e.getAttribute("style")||"",o=n?n+"; "+t:t;e.setAttribute("style",o)};t.querySelectorAll(".nge-image-wrapper").forEach(e=>{const t=e.dataset.align||"center",o=parseInt(e.dataset.borderRadius,10)||0;let r="position: relative; display: block; width: fit-content; max-width: 100%; margin-top: "+(e.closest(".nge-grid-block")?"0":"8px")+"; margin-bottom: 0; line-height: 0; overflow: visible";"left"===t?r+="; margin-left: 0; margin-right: auto":"center"===t?r+="; margin-left: auto; margin-right: auto":"right"===t&&(r+="; margin-left: auto; margin-right: 0"),n(e,r);const a=e.querySelector("img");if(a){let e="max-width: 100%; height: auto; display: block";o>0&&(e+="; border-radius: "+((i=o)<=0?"0":i>=100?"50%":i+"px")),n(a,e)}var i}),t.querySelectorAll(".nge-todo-list").forEach(e=>{n(e,"list-style: none; padding: 0; padding-left: 0; margin: 8px 0")}),t.querySelectorAll(".nge-todo-item").forEach(e=>{n(e,"display: flex; align-items: flex-start; gap: 8px; padding: 2px 0; margin: 0; list-style: none")}),t.querySelectorAll(".nge-todo-checkbox").forEach(e=>{n(e,"width: 16px; height: 16px; margin-top: 3px; flex-shrink: 0")}),t.querySelectorAll(".nge-todo-text").forEach(e=>{n(e,"flex: 1; line-height: 1.5")}),t.querySelectorAll(".nge-todo-item.nge-todo-checked .nge-todo-text").forEach(e=>{n(e,"text-decoration: line-through; color: #6c757d")}),t.querySelectorAll(".nge-quote").forEach(e=>{n(e,"margin: 1em 0; padding: 0.5em 1em; border-left: 4px solid #ccc; background: #f9f9f9")}),t.querySelectorAll(".nge-code-block").forEach(e=>{n(e,"background: #1e1e1e; color: #d4d4d4; overflow: hidden; font-family: monospace; font-size: 14px; border-radius: 8px; margin: 1em 0")}),t.querySelectorAll(".nge-code-block pre").forEach(e=>{n(e,"background: transparent; margin: 0; padding: 12px 16px; overflow-x: auto")}),t.querySelectorAll(".nge-code-block code").forEach(e=>{n(e,"display: block; font-family: inherit; background: transparent; color: #d4d4d4; padding: 0; white-space: pre-wrap; line-height: 1.5")}),Object.entries({"nge-sh-keyword":"#569cd6","nge-sh-builtin":"#4ec9b0","nge-sh-string":"#ce9178","nge-sh-comment":"#6a9955","nge-sh-number":"#b5cea8","nge-sh-function":"#dcdcaa","nge-sh-operator":"#d4d4d4","nge-sh-variable":"#9cdcfe","nge-sh-decorator":"#dcdcaa","nge-sh-tag":"#808080","nge-sh-tagname":"#569cd6","nge-sh-attribute":"#9cdcfe","nge-sh-doctype":"#808080","nge-sh-selector":"#d7ba7d","nge-sh-property":"#9cdcfe","nge-sh-value":"#ce9178","nge-sh-color":"#ce9178","nge-sh-important":"#569cd6","nge-sh-key":"#9cdcfe","nge-sh-boolean":"#569cd6","nge-sh-null":"#569cd6"}).forEach(([e,n])=>{t.querySelectorAll(".nge-code-block ."+e).forEach(t=>{t.style.color=n,t.style.background="transparent","nge-sh-comment"===e&&(t.style.fontStyle="italic"),"nge-sh-important"===e&&(t.style.fontWeight="bold")})}),t.querySelectorAll(".nge-hr").forEach(e=>{const t=e.dataset.style||"solid",o=e.dataset.width||"100",r=e.dataset.color||"#cccccc",a=e.dataset.thickness||"1";n(e,"border: none; border-top: "+a+"px "+t+" "+r+"; width: "+o+"%; margin: 1em auto")}),t.querySelectorAll(".nge-columns").forEach(e=>{n(e,"display: flex; gap: 1em; margin: 1em 0")}),t.querySelectorAll(".nge-column").forEach(e=>{n(e,"flex: 1; min-width: 0")}),t.querySelectorAll(".nge-column-wrapper").forEach(e=>{const t=e.dataset.width||"100",o=e.dataset.align||"center",r=e.dataset.bgContainer||"transparent";let a="width: "+t+"%; "+(parseInt(t,10)<100?"display: inline-block; vertical-align: top":"display: block")+"; "+(e.closest(".nge-grid-block")?"margin: 0":"margin: 16px 0")+"; padding: 12px; border-radius: 8px";"transparent"!==r&&(a+="; background-color: "+r),"left"===o?a+="; margin-left: 0; margin-right: auto":"center"===o?a+="; margin-left: auto; margin-right: auto":"right"===o&&(a+="; margin-left: auto; margin-right: 0"),n(e,a)}),t.querySelectorAll(".nge-column-content").forEach(e=>{const t=e.closest(".nge-column-wrapper"),o=t&&t.dataset.columns||"2",r=t&&t.dataset.gap||"medium",a=t&&t.dataset.bgColumns||"transparent";let i="column-count: "+o+"; column-gap: "+({small:"1rem",medium:"2rem",large:"3rem"}[r]||r)+"; padding: 12px; border-radius: 4px";"transparent"!==a&&(i+="; background-color: "+a),n(e,i),e.querySelectorAll("p, div").forEach((e,t)=>{n(e,"margin: "+(0===t?"0":"0.5em")+" 0 0 0; padding: 0; line-height: 1.5")})});const o={1:"8.33%",3:"25%",4:"33.33%",6:"50%",8:"66.66%",9:"75%",12:"100%"};return t.querySelectorAll(".nge-grid-block").forEach(e=>{const t=e.dataset.gridCols||"12",r=e.dataset.bgImage||"",a=parseFloat(e.dataset.bgOpacity)||1,i=e.dataset.bgColor||"",l="media"===(e.dataset.blockType||"text")?"overflow: visible":"";let s="display: inline-block; vertical-align: top; width: "+(o[t]||"100%")+"; min-height: 20px; margin: 0; padding: 0; box-sizing: border-box; position: relative"+(l?"; "+l:"");if(i&&(s+="; background-color: "+i),n(e,s),r){const t=document.createElement("div");t.className="nge-bg-image-overlay",t.setAttribute("style","position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 0; background-image: url('"+r+"'); background-size: contain; background-position: center; background-repeat: no-repeat; opacity: "+a+"; pointer-events: none; border-radius: inherit"),e.insertBefore(t,e.firstChild)}e.removeAttribute("contenteditable"),e.classList.remove("nge-grid-block-visible")}),t.querySelectorAll(".nge-grid-block-content").forEach(e=>{const t=e.closest(".nge-grid-block"),o=t&&"media"===t.dataset.blockType?"overflow: visible":"overflow: hidden",r=t&&parseInt(t.dataset.padding,10)||0;n(e,"display: block; min-height: 20px; padding: "+({0:"0",1:"8px",2:"16px",3:"24px",4:"32px"}[r]||"0")+"; "+o+"; max-width: 100%; width: 100%; box-sizing: border-box; position: relative; z-index: 1"),e.removeAttribute("contenteditable"),e.querySelectorAll("img, video, iframe, .nge-image-wrapper, .nge-video-wrapper, .nge-column-wrapper").forEach(e=>{n(e,"vertical-align: top")}),e.querySelectorAll("p").forEach((e,t,o)=>{n(e,"margin: "+(0===t?"0":"0.15em")+" 0 0 0; line-height: 1.5")})}),t.querySelectorAll(".nge-video-wrapper").forEach(e=>{const t=e.dataset.borderStyle||"none",o=e.dataset.borderWidth||"0",r=e.dataset.borderColor||"#000000",a=e.dataset.borderRadius||"0",i=e.dataset.align||"center";let l="display: block; max-width: 100%; "+(e.closest(".nge-grid-block")?"margin: 0":"margin: 16px 0")+"; overflow: hidden";"none"!==t&&parseInt(o,10)>0&&(l+="; border: "+o+"px "+t+" "+r),parseInt(a,10)>0&&(l+="; border-radius: "+a+"px"),n(e,l);const s=e.closest("p");s&&"center"===i&&n(s,"text-align: center")}),t.querySelectorAll(".nge-table-edit-wrapper").forEach(e=>{const t=e.getAttribute("style")||"",o=e.style.width||"100%",r=parseInt(o,10);let a=(!isNaN(r)&&r<100?"display: inline-block; vertical-align: top":"display: block")+"; "+(e.closest(".nge-grid-block")?"margin: 0":"margin: 16px 0");!t.includes("width")&&(a+="; width: 100%"),n(e,a)}),t.querySelectorAll(".nge-table-wrapper").forEach(e=>{n(e,"overflow-x: auto; max-width: 100%")}),t.querySelectorAll(".nge-quote-wrapper").forEach(e=>{n(e,"margin: 1em 0; display: block")}),t.querySelectorAll("table").forEach(e=>{if(!e.closest(".nge-code-block")){const t=e.closest(".nge-grid-block")?"margin: 0":"margin: 1em 0";n(e,"border-collapse: collapse; width: 100%; "+t)}}),t.querySelectorAll("th, td").forEach(e=>{e.closest(".nge-code-block")||!(e.getAttribute("style")||"").includes("border")&&n(e,"border: 1px solid #ddd; padding: 8px")}),t.querySelectorAll("th").forEach(e=>{e.closest(".nge-code-block")||!(e.getAttribute("style")||"").includes("background")&&n(e,"background: #f5f5f5; font-weight: 600")}),t.querySelectorAll("ul:not(.nge-todo-list)").forEach(e=>{n(e,"margin: 0.5em 0; padding-left: 2em; list-style-type: disc")}),t.querySelectorAll("ol").forEach(e=>{const t=e.style.listStyleType||"decimal";n(e,"margin: 0.5em 0; padding-left: 2em; list-style-type: "+t)}),t.querySelectorAll("li:not(.nge-todo-item)").forEach(e=>{n(e,"margin: 0.25em 0")}),t.querySelectorAll(".nge-image-buttons, .nge-image-edit-btn, .nge-image-rotate-btn, .nge-image-delete-btn, .nge-video-buttons, .nge-video-edit-btn, .nge-video-delete-btn, .nge-table-buttons, .nge-table-edit-btn, .nge-table-delete-btn, .nge-column-buttons, .nge-column-edit-btn, .nge-column-delete-btn, .nge-grid-block-buttons, .nge-grid-block-edit-btn, .nge-grid-block-delete-btn, .nge-quote-delete-btn, .nge-code-delete-btn, .nge-resize-handle, .nge-resize-handles, .nge-rotate-handle").forEach(e=>e.remove()),t.querySelectorAll("[contenteditable]").forEach(e=>{e.removeAttribute("contenteditable")}),t.querySelectorAll(".nge-cell-selected").forEach(e=>{e.classList.remove("nge-cell-selected")}),t.innerHTML}(e.innerHTML)}if("text"===t)return e.textContent||"";throw new Error('Invalid format: must be "text" or "html"')}const q={bold:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="6" y="18" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="currentColor">B</text>\n  </svg>',italic:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="8" y="18" font-family="Times New Roman, serif" font-size="16" font-style="italic" fill="currentColor">I</text>\n  </svg>',underline:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="6" y="16" font-family="Arial, sans-serif" font-size="14" fill="currentColor">U</text>\n    <path d="M6 19h12" stroke="currentColor" stroke-width="1.5"/>\n  </svg>',strikethrough:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="7" y="17" font-family="Arial, sans-serif" font-size="14" fill="currentColor">S</text>\n    <path d="M5 12h14" stroke="currentColor" stroke-width="1.5"/>\n  </svg>',"align-left":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 5h16M4 9h10M4 13h16M4 17h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"align-center":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 5h16M7 9h10M4 13h16M7 17h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"align-right":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 5h16M10 9h10M4 13h16M10 17h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"align-justify":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 5h16M4 9h16M4 13h16M4 17h16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"list-ul":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <circle cx="5" cy="6" r="1.5" fill="currentColor"/>\n    <circle cx="5" cy="12" r="1.5" fill="currentColor"/>\n    <circle cx="5" cy="18" r="1.5" fill="currentColor"/>\n    <path d="M10 6h10M10 12h10M10 18h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"list-ol":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="3" y="8" font-family="Arial, sans-serif" font-size="8" fill="currentColor">1.</text>\n    <text x="3" y="14" font-family="Arial, sans-serif" font-size="8" fill="currentColor">2.</text>\n    <text x="3" y="20" font-family="Arial, sans-serif" font-size="8" fill="currentColor">3.</text>\n    <path d="M10 6h10M10 12h10M10 18h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"list-todo":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="3" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M4.5 6l1.5 1.5 3-3" stroke="#22c55e" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <rect x="3" y="9" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <rect x="3" y="15" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M12 6h8M12 12h8M12 18h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',indent:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 5h16M12 9h8M12 13h8M4 17h16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M4 8l4 3.5-4 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n  </svg>',outdent:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 5h16M12 9h8M12 13h8M4 17h16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M8 8l-4 3.5 4 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n  </svg>',link:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M15 7h2a5 5 0 0 1 0 10h-2m-6 0H7a5 5 0 0 1 0-10h2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M8 12h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',image:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="3" y="4" width="18" height="16" rx="2" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <circle cx="8" cy="9" r="2" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M3 16l5-5 4 4 3-3 6 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',video:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M10 8v8l6-4-6-4z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n  </svg>',"text-color":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M5 17l3-8h1l3 8M6 14h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <rect x="4" y="19" width="16" height="2" rx="0.5" fill="currentColor" class="nge-color-indicator"/>\n  </svg>',"bg-color":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M14 3l7 7-9 9H5v-7l9-9z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n    <path d="M5 19l4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <rect x="4" y="20" width="16" height="2" rx="0.5" fill="currentColor" class="nge-color-indicator"/>\n  </svg>',close:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',eyedropper:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M20 4l-1.5 1.5M14 6l4 4M4 20l2-6 8-8 4 4-8 8-6 2z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n    <circle cx="18.5" cy="5.5" r="2.5" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  </svg>',quote:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="3" y="16" font-family="Georgia, serif" font-size="20" fill="currentColor">"</text>\n    <text x="13" y="16" font-family="Georgia, serif" font-size="20" fill="currentColor">"</text>\n  </svg>',hr:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 12h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n  </svg>',code:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M8 6l-5 6 5 6M16 6l5 6-5 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',copy:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="8" y="8" width="12" height="12" rx="1.5" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M16 8V5a1.5 1.5 0 0 0-1.5-1.5H5A1.5 1.5 0 0 0 3.5 5v9.5A1.5 1.5 0 0 0 5 16h3" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  </svg>',gear:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c.26.604.852.997 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n  </svg>',settings:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c.26.604.852.997 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n  </svg>',rotate:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M21 12a9 9 0 1 1-3-6.7L21 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M21 3v5h-5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',table:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <path d="M3 9h18M3 15h18M9 3v18M15 3v18" stroke="currentColor" stroke-width="1.5"/>\n  </svg>',columns:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="3" y="3" width="7" height="18" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <rect x="14" y="3" width="7" height="18" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>\n  </svg>',emoji:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5" fill="none"/>\n    <circle cx="9" cy="10" r="1" fill="currentColor"/>\n    <circle cx="15" cy="10" r="1" fill="currentColor"/>\n    <path d="M8 14s1.5 2 4 2 4-2 4-2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',"line-height":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M11 6h9M11 12h9M11 18h9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M5 7v10M3 9l2-3 2 3M3 15l2 3 2-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',"text-case":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="2" y="18" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="currentColor">A</text>\n    <text x="12" y="18" font-family="Arial, sans-serif" font-size="11" fill="currentColor">a</text>\n  </svg>',superscript:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <text x="3" y="18" font-family="Arial, sans-serif" font-size="14" fill="currentColor">X</text>\n    <text x="14" y="10" font-family="Arial, sans-serif" font-size="9" fill="currentColor">2</text>\n  </svg>',trash:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',undo:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M3 9h13a5 5 0 0 1 0 10H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M7 5L3 9l4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',redo:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M21 9H8a5 5 0 0 0 0 10h9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M17 5l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',preview:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',"import-json":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M12 18v-6M9 15l3-3 3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',"export-json":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <text x="7" y="17" font-family="monospace" font-size="7" font-weight="bold" fill="currentColor">{}</text>\n  </svg>',"export-pdf":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <text x="5" y="17" font-family="sans-serif" font-size="6" font-weight="bold" fill="currentColor">PDF</text>\n  </svg>',"export-html":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <text x="5" y="17" font-family="sans-serif" font-size="6" font-weight="bold" fill="currentColor">HTML</text>\n  </svg>',"block-outlines":'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="3" y="3" width="8" height="8" rx="1" stroke="currentColor" stroke-width="1.5" stroke-dasharray="2 1" fill="none"/>\n    <rect x="13" y="3" width="8" height="8" rx="1" stroke="#3b82f6" stroke-width="1.5" fill="none"/>\n    <rect x="3" y="13" width="8" height="8" rx="1" stroke="#22c55e" stroke-width="1.5" fill="none"/>\n    <rect x="13" y="13" width="8" height="8" rx="1" stroke="#f59e0b" stroke-width="1.5" fill="none"/>\n  </svg>'};function B(){document.querySelectorAll(".nge-icon").forEach(e=>{const t=Array.from(e.classList).find(e=>e.startsWith("nge-icon-"));if(t){const n=t.replace("nge-icon-","");try{const t=function(e){if(!e||"string"!=typeof e)throw new Error("Icon name must be a string");if(!q[e])throw new Error('Icon "'+e+'" not found');return q[e]}(n);t&&(e.innerHTML=t)}catch(e){}}})}function D(e){if(!e||!e.id||!e.title)throw new Error("Invalid modal configuration: id and title are required");const t=document.createElement("div");t.className="nge-modal-overlay",t.setAttribute("data-testid","nge-modal-overlay-"+e.id),t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),t.setAttribute("aria-labelledby","nge-modal-title-"+e.id);const n=document.createElement("div");n.className="nge-modal",n.setAttribute("data-modal-id",e.id),n.setAttribute("data-testid","nge-modal-"+e.id);const o=document.createElement("div");o.className="nge-modal-header";const r=document.createElement("h3");r.className="nge-modal-title",r.id="nge-modal-title-"+e.id,r.textContent=e.title;const a=document.createElement("button");a.type="button",a.className="nge-modal-close",a.setAttribute("data-testid","nge-modal-close-"+e.id),a.setAttribute("aria-label","Close modal"),a.innerHTML='<span class="nge-icon nge-icon-close">&times;</span>',o.appendChild(r),o.appendChild(a);const i=document.createElement("div");i.className="nge-modal-body",i.setAttribute("data-testid","nge-modal-body-"+e.id),e.content&&("string"==typeof e.content?i.innerHTML=e.content:e.content instanceof HTMLElement&&i.appendChild(e.content));const l=document.createElement("div");l.className="nge-modal-footer";return(e.buttons||[{id:"cancel",label:"Cancel",variant:"secondary"},{id:"confirm",label:"OK",variant:"primary"}]).forEach(e=>{const t=document.createElement("button");t.type="button",t.className="nge-modal-button nge-modal-button-"+(e.variant||"secondary"),t.setAttribute("data-action",e.id),t.setAttribute("data-testid","nge-modal-button-"+e.id),t.textContent=e.label,l.appendChild(t)}),n.appendChild(o),n.appendChild(i),n.appendChild(l),t.appendChild(n),t._onClose=e.onClose,t}function H(e){return new Promise((t,n)=>{if(!(e&&e instanceof HTMLElement))return void n(new Error("Invalid modal element"));document.body.appendChild(e),e.offsetHeight,e.classList.add("nge-modal-visible");const o=e.querySelector("input, textarea, select"),r=e.querySelector(".nge-modal-button");o?o.focus():r&&r.focus();const a=e.querySelector(".nge-modal-close");a&&(a.onclick=()=>{j(e),t("close")});e.querySelectorAll(".nge-modal-button").forEach(n=>{n.onclick=()=>{const o=n.getAttribute("data-action");j(e),t(o)}}),e.onclick=n=>{n.target===e&&(j(e),t("overlay"))};const i=n=>{"Escape"===n.key&&(j(e),document.removeEventListener("keydown",i),t("escape"))};document.addEventListener("keydown",i)})}function j(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid modal element");e.classList.remove("nge-modal-visible"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),"function"==typeof e._onClose&&e._onClose()},300)}const z="nge-saved-colors";function F(e,t,n){e=(e%360+360)%360,t=Math.max(0,Math.min(1,t));const o=(n=Math.max(0,Math.min(1,n)))*t,r=o*(1-Math.abs(e/60%2-1)),a=n-o;let i,l,s;return[i,l,s]=e<60?[o,r,0]:e<120?[r,o,0]:e<180?[0,o,r]:e<240?[0,r,o]:e<300?[r,0,o]:[o,0,r],{r:Math.round(255*(i+a)),g:Math.round(255*(l+a)),b:Math.round(255*(s+a))}}function O(e,t,n){e=Math.max(0,Math.min(255,e))/255,t=Math.max(0,Math.min(255,t))/255,n=Math.max(0,Math.min(255,n))/255;const o=Math.max(e,t,n),r=o-Math.min(e,t,n);let a=0;return 0!==r&&(a=o===e?60*((t-n)/r+(t<n?6:0)):o===t?60*((n-e)/r+2):60*((e-t)/r+4)),{h:a,s:0===o?0:r/o,v:o}}function P(e){return e&&"string"==typeof e?(3===(e=e.replace(/^#/,"")).length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),6===e.length&&/^[0-9A-Fa-f]{6}$/.test(e)?{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}:null):null}function V(e,t,n,o){return e=Math.max(0,Math.min(255,Math.round(e))),t=Math.max(0,Math.min(255,Math.round(t))),n=Math.max(0,Math.min(255,Math.round(n))),1===(o=Math.max(0,Math.min(1,o)))?"rgb("+e+", "+t+", "+n+")":"rgba("+e+", "+t+", "+n+", "+o+")"}function W(e){if(!e||"string"!=typeof e)return null;if((e=e.trim().toLowerCase()).startsWith("#")){const t=P(e);return t?{...t,a:1}:null}const t=e.match(/^rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d.]+)\s*)?\)$/);return t?{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10),a:void 0!==t[4]?parseFloat(t[4]):1}:null}function U(){try{const e=localStorage.getItem(z);if(e){const t=JSON.parse(e);if(Array.isArray(t))return t.slice(0,8)}}catch(e){}return[]}function _(e){let t=U();t=t.filter(t=>t!==e);try{localStorage.setItem(z,JSON.stringify(t))}catch(e){}return t}function G(e,t={}){const n=document.createElement("div");n.className="nge-color-picker",n.setAttribute("data-testid","nge-color-picker");const o=t.selectedText||"",r="bg-color"===(t.mode||"text-color"),a=t.restrictedColors||[],i=a.length>0,s=o.length>150?o.substring(0,150)+"...":o,c=s?'\n    <div class="nge-cp-text-preview-section">\n      <label class="nge-cp-label">'+l("colorPicker.preview")+'</label>\n      <div class="nge-cp-text-preview-container" data-testid="nge-cp-text-preview-container">\n        <span class="nge-cp-text-preview" data-testid="nge-cp-text-preview">'+function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}(s)+"</span>\n      </div>\n    </div>\n  ":"",d=r?'\n    <div class="nge-cp-style-sliders">\n      <div class="nge-cp-slider-group">\n        <label class="nge-cp-label">'+l("colorPicker.borderRadius")+'</label>\n        <div class="nge-cp-slider-row">\n          <input type="range" class="nge-cp-range nge-cp-border-radius-range" data-testid="nge-cp-border-radius-range" min="0" max="20" value="0" />\n          <span class="nge-cp-slider-value nge-cp-border-radius-value" data-testid="nge-cp-border-radius-value">0px</span>\n        </div>\n      </div>\n      <div class="nge-cp-slider-group">\n        <label class="nge-cp-label">'+l("colorPicker.highlightThickness")+'</label>\n        <div class="nge-cp-slider-row">\n          <input type="range" class="nge-cp-range nge-cp-padding-range" data-testid="nge-cp-padding-range" min="0" max="10" value="0" />\n          <span class="nge-cp-slider-value nge-cp-padding-value" data-testid="nge-cp-padding-value">0px</span>\n        </div>\n      </div>\n    </div>\n  ':"",u=i?'\n    <div class="nge-cp-restricted-colors" data-testid="nge-cp-restricted-colors">\n      '+a.map(e=>'\n        <div class="nge-cp-restricted-swatch" data-testid="nge-cp-restricted-swatch" data-color="'+e+'" title="'+e+'">\n          <div class="nge-cp-restricted-swatch-inner" style="background-color: '+e+'"></div>\n        </div>\n      ').join("")+"\n    </div>\n  ":"";return n.innerHTML=i?'\n      <div class="nge-cp-main nge-cp-restricted-mode">\n        '+c+'\n\n        <div class="nge-cp-restricted-section">\n          '+u+"\n        </div>\n\n        "+d+'\n\n        <div class="nge-cp-preview-only">\n          <div class="nge-cp-preview-container">\n            <div class="nge-cp-preview-bg"></div>\n            <div class="nge-cp-preview" data-testid="nge-cp-preview"></div>\n          </div>\n          <span class="nge-cp-hex-display" data-testid="nge-cp-hex-display"></span>\n        </div>\n      </div>\n    ':'\n      <div class="nge-cp-main">\n        <div class="nge-cp-spectrum-area">\n          <div class="nge-cp-sv-container">\n            <canvas class="nge-cp-sv-canvas" data-testid="nge-cp-sv-canvas" width="200" height="200"></canvas>\n            <div class="nge-cp-sv-cursor" data-testid="nge-cp-sv-cursor"></div>\n          </div>\n          <div class="nge-cp-hue-container">\n            <canvas class="nge-cp-hue-canvas" data-testid="nge-cp-hue-canvas" width="24" height="200"></canvas>\n            <div class="nge-cp-hue-cursor" data-testid="nge-cp-hue-cursor"></div>\n          </div>\n        </div>\n\n        <div class="nge-cp-alpha-container">\n          <label class="nge-cp-label">'+l("colorPicker.transparency")+'</label>\n          <div class="nge-cp-alpha-slider-container">\n            <div class="nge-cp-alpha-bg"></div>\n            <canvas class="nge-cp-alpha-canvas" data-testid="nge-cp-alpha-canvas" width="200" height="16"></canvas>\n            <div class="nge-cp-alpha-cursor" data-testid="nge-cp-alpha-cursor"></div>\n          </div>\n          <span class="nge-cp-alpha-value" data-testid="nge-cp-alpha-value">100%</span>\n        </div>\n\n        '+c+"\n\n        "+d+'\n\n        <div class="nge-cp-inputs-row">\n          <div class="nge-cp-preview-eyedropper">\n            <div class="nge-cp-preview-container">\n              <div class="nge-cp-preview-bg"></div>\n              <div class="nge-cp-preview" data-testid="nge-cp-preview"></div>\n            </div>\n            <button type="button" class="nge-cp-eyedropper-btn" data-testid="nge-cp-eyedropper-btn" title="'+l("colorPicker.eyedropper")+'">'+q.eyedropper+'</button>\n          </div>\n          <div class="nge-cp-inputs">\n            <div class="nge-cp-input-group nge-cp-hex-group">\n              <label class="nge-cp-input-label">Hex</label>\n              <input type="text" class="nge-cp-input nge-cp-hex-input" data-testid="nge-cp-hex-input" maxlength="7" placeholder="#000000" />\n            </div>\n            <div class="nge-cp-rgb-inputs">\n              <div class="nge-cp-input-group">\n                <label class="nge-cp-input-label">R</label>\n                <input type="number" class="nge-cp-input nge-cp-r-input" data-testid="nge-cp-r-input" min="0" max="255" />\n              </div>\n              <div class="nge-cp-input-group">\n                <label class="nge-cp-input-label">G</label>\n                <input type="number" class="nge-cp-input nge-cp-g-input" data-testid="nge-cp-g-input" min="0" max="255" />\n              </div>\n              <div class="nge-cp-input-group">\n                <label class="nge-cp-input-label">B</label>\n                <input type="number" class="nge-cp-input nge-cp-b-input" data-testid="nge-cp-b-input" min="0" max="255" />\n              </div>\n              <div class="nge-cp-input-group">\n                <label class="nge-cp-input-label">A%</label>\n                <input type="number" class="nge-cp-input nge-cp-a-input" data-testid="nge-cp-a-input" min="0" max="100" />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="nge-cp-saved">\n        <div class="nge-cp-saved-header">\n          <label class="nge-cp-label">'+l("colorPicker.savedColors")+'</label>\n          <button type="button" class="nge-cp-save-btn" data-testid="nge-cp-save-btn" title="'+l("colorPicker.saveColor")+'">+</button>\n        </div>\n        <div class="nge-cp-saved-colors" data-testid="nge-cp-saved-colors"></div>\n      </div>\n    ',n}function J(e,t,n){const o=U();if(e.innerHTML="",o.forEach(o=>{const r=document.createElement("div");r.className="nge-cp-saved-swatch",r.setAttribute("data-testid","nge-cp-saved-swatch"),r.setAttribute("data-color",o),r.title=o;const a=document.createElement("div");a.className="nge-cp-saved-swatch-inner",a.style.backgroundColor=o,r.appendChild(a);const i=document.createElement("button");i.type="button",i.className="nge-cp-saved-remove",i.setAttribute("data-testid","nge-cp-saved-remove"),i.innerHTML="&times;",i.title=l("colorPicker.remove"),r.appendChild(i),r.addEventListener("click",e=>{!e.target.classList.contains("nge-cp-saved-remove")&&t(o)}),i.addEventListener("click",e=>{e.stopPropagation(),n(o)}),e.appendChild(r)}),0===o.length){const t=document.createElement("span");t.className="nge-cp-saved-empty",t.textContent=l("colorPicker.noSavedColors"),e.appendChild(t)}}function Z(e={}){const t=e.title||l("colorPicker.title"),n=!1!==e.showAlpha,o=e.selectedText||"",r=e.mode||"text-color",a="bg-color"===r,i=e.textColor||"#212529",s=e.bgColor||null,c=e.textStyles||{},d=e.initialBorderRadius||0,u=e.initialPadding||0,g=e.restrictedColors||[],p=g.length>0;let m=W(e.initialColor);!m&&(m={r:0,g:0,b:0,a:1});const h=O(m.r,m.g,m.b),b={h:h.h,s:h.s,v:h.v,a:m.a,borderRadius:d,padding:u},f=G(0,{selectedText:o,mode:r,restrictedColors:g}),v=D({id:"color-picker",title:t,content:f,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:l("modal.apply"),variant:"primary"}]}),y=f.querySelector(".nge-cp-sv-canvas"),w=f.querySelector(".nge-cp-sv-cursor"),C=f.querySelector(".nge-cp-hue-canvas"),k=f.querySelector(".nge-cp-hue-cursor"),x=f.querySelector(".nge-cp-alpha-container"),E=f.querySelector(".nge-cp-alpha-canvas"),S=f.querySelector(".nge-cp-alpha-cursor"),A=f.querySelector(".nge-cp-alpha-value"),L=f.querySelector(".nge-cp-preview"),T=f.querySelector(".nge-cp-hex-input"),N=f.querySelector(".nge-cp-r-input"),M=f.querySelector(".nge-cp-g-input"),I=f.querySelector(".nge-cp-b-input"),R=f.querySelector(".nge-cp-a-input"),q=f.querySelector(".nge-cp-save-btn"),B=f.querySelector(".nge-cp-saved-colors"),j=f.querySelector(".nge-cp-eyedropper-btn"),Z=f.querySelector(".nge-cp-hex-display"),X=f.querySelectorAll(".nge-cp-restricted-swatch"),K=f.querySelector(".nge-cp-text-preview"),$=f.querySelector(".nge-cp-text-preview-container"),Y=f.querySelector(".nge-cp-border-radius-range"),Q=f.querySelector(".nge-cp-border-radius-value"),ee=f.querySelector(".nge-cp-padding-range"),te=f.querySelector(".nge-cp-padding-value");Y&&Q&&(Y.value=d,Q.textContent=d+"px"),ee&&te&&(ee.value=u,te.textContent=u+"px"),!p&&!n&&x&&R&&(x.style.display="none",R.parentElement.style.display="none",b.a=1),p&&(b.a=1);const ne="undefined"!=typeof window&&"EyeDropper"in window;!ne&&j&&(j.disabled=!0,j.title=l("colorPicker.eyedropperUnavailable"));const oe=y?y.getContext("2d"):null,re=C?C.getContext("2d"):null,ae=E?E.getContext("2d"):null;function ie(){const e=F(b.h,b.s,b.v),t=function(e,t,n){const o=e=>{const t=Math.max(0,Math.min(255,Math.round(e))).toString(16);return 1===t.length?"0"+t:t};return"#"+o(e)+o(t)+o(n)}(e.r,e.g,e.b),o=V(e.r,e.g,e.b,b.a);if(L&&(L.style.backgroundColor=o),Z&&(Z.textContent=t),p&&X.forEach(e=>{const n=e.getAttribute("data-color");n&&n.toUpperCase()===t.toUpperCase()?e.classList.add("nge-cp-swatch-selected"):e.classList.remove("nge-cp-swatch-selected")}),!p){if(oe&&y&&function(e,t,n,o){const r=F(o,1,1),a=e.createLinearGradient(0,0,t,0);a.addColorStop(0,"#ffffff"),a.addColorStop(1,"rgb("+r.r+", "+r.g+", "+r.b+")"),e.fillStyle=a,e.fillRect(0,0,t,n);const i=e.createLinearGradient(0,0,0,n);i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(1,"rgba(0, 0, 0, 1)"),e.fillStyle=i,e.fillRect(0,0,t,n)}(oe,y.width,y.height,b.h),w&&y){const e=b.s*y.width,t=(1-b.v)*y.height;w.style.left=e+"px",w.style.top=t+"px"}if(k&&C){const e=b.h/360*C.height;k.style.top=e+"px"}if(n&&ae&&E&&S&&A){!function(e,t,n,o,r,a){e.clearRect(0,0,t,n);const i=e.createLinearGradient(0,0,t,0);i.addColorStop(0,"rgba("+o+", "+r+", "+a+", 0)"),i.addColorStop(1,"rgba("+o+", "+r+", "+a+", 1)"),e.fillStyle=i,e.fillRect(0,0,t,n)}(ae,E.width,E.height,e.r,e.g,e.b);const t=E.getBoundingClientRect().width||E.width,n=b.a*t;S.style.left=n+"px",A.textContent=Math.round(100*b.a)+"%"}T&&(T.value=t),N&&(N.value=e.r),M&&(M.value=e.g),I&&(I.value=e.b),R&&(R.value=Math.round(100*b.a))}if(K&&$)if(K.style.fontWeight=c.bold?"bold":"normal",K.style.fontStyle=c.italic?"italic":"normal",K.style.textDecoration=[c.underline?"underline":"",c.strikethrough?"line-through":""].filter(Boolean).join(" ")||"none",c.fontFamily&&(K.style.fontFamily=c.fontFamily),c.fontSize&&(K.style.fontSize=c.fontSize),a){K.style.backgroundColor=o,K.style.color=i,K.style.borderRadius=b.borderRadius+"px";const e=b.borderRadius>0?4:2;K.style.padding=b.padding+"px "+e+"px"}else K.style.color=o,K.style.backgroundColor=s||"transparent",s&&(K.style.padding="2px 4px",K.style.borderRadius="3px")}function le(e,t,n,o){const r=O(e,t,n);b.h=r.h,b.s=r.s,b.v=r.v,void 0!==o&&(b.a=o),ie()}function se(){const e=F(b.h,b.s,b.v);return V(e.r,e.g,e.b,b.a)}let ce=!1,de=!1,ue=!1;function ge(e){ce&&y&&me(e),de&&C&&he(e),ue&&E&&be(e)}function pe(){ce=!1,de=!1,ue=!1}function me(e){const t=y.getBoundingClientRect(),n=Math.max(0,Math.min(y.width,e.clientX-t.left)),o=Math.max(0,Math.min(y.height,e.clientY-t.top));b.s=n/y.width,b.v=1-o/y.height,ie()}function he(e){const t=C.getBoundingClientRect(),n=Math.max(0,Math.min(C.height,e.clientY-t.top));b.h=n/C.height*360,ie()}function be(e){const t=E.getBoundingClientRect(),n=t.width,o=Math.max(0,Math.min(n,e.clientX-t.left));b.a=o/n,ie()}if(p)X.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-color");if(t){const e=P(t);e&&le(e.r,e.g,e.b,1)}})}),ie();else{function fe(){le(parseInt(N.value,10)||0,parseInt(M.value,10)||0,parseInt(I.value,10)||0)}re&&C&&function(e,t,n){const o=e.createLinearGradient(0,0,0,n);[{pos:0,color:"#ff0000"},{pos:.17,color:"#ffff00"},{pos:.33,color:"#00ff00"},{pos:.5,color:"#00ffff"},{pos:.67,color:"#0000ff"},{pos:.83,color:"#ff00ff"},{pos:1,color:"#ff0000"}].forEach(e=>{o.addColorStop(e.pos,e.color)}),e.fillStyle=o,e.fillRect(0,0,t,n)}(re,C.width,C.height),ie(),y&&y.addEventListener("mousedown",e=>{ce=!0,me(e)}),C&&C.addEventListener("mousedown",e=>{de=!0,he(e)}),n&&E&&E.addEventListener("mousedown",e=>{ue=!0,be(e)}),document.addEventListener("mousemove",ge),document.addEventListener("mouseup",pe),T&&T.addEventListener("input",()=>{const e=P(T.value);e&&le(e.r,e.g,e.b)}),N&&N.addEventListener("input",fe),M&&M.addEventListener("input",fe),I&&I.addEventListener("input",fe),R&&R.addEventListener("input",()=>{const e=parseInt(R.value,10)||0;b.a=Math.max(0,Math.min(100,e))/100,ie()}),q&&B&&q.addEventListener("click",()=>{(function(e){if(!e||"string"!=typeof e)return U();let t=U();t=t.filter(t=>t!==e),t.unshift(e),t=t.slice(0,8);try{localStorage.setItem(z,JSON.stringify(t))}catch(e){}})(se()),J(B,e=>{const t=W(e);t&&le(t.r,t.g,t.b,t.a)},e=>{_(e),J(B,e=>{const t=W(e);t&&le(t.r,t.g,t.b,t.a)},e=>{_(e),J(B,()=>{},()=>{})})})}),ne&&j&&j.addEventListener("click",async()=>{try{const e=new window.EyeDropper,t=await e.open();if(t&&t.sRGBHex){const e=P(t.sRGBHex);e&&le(e.r,e.g,e.b,b.a)}}catch(e){}}),B&&J(B,e=>{const t=W(e);t&&le(t.r,t.g,t.b,t.a)},e=>{_(e),J(B,e=>{const t=W(e);t&&le(t.r,t.g,t.b,t.a)},()=>{})})}return Y&&Q&&Y.addEventListener("input",()=>{b.borderRadius=parseInt(Y.value,10),Q.textContent=b.borderRadius+"px",ie()}),ee&&te&&ee.addEventListener("input",()=>{b.padding=parseInt(ee.value,10),te.textContent=b.padding+"px",ie()}),H(v).then(e=>{if(document.removeEventListener("mousemove",ge),document.removeEventListener("mouseup",pe),"confirm"===e){const t={action:e,color:se()};return a&&(t.borderRadius=b.borderRadius,t.padding=b.padding),t}throw new Error("Color picker cancelled")})}function X(e={}){const t=function(e={}){const t=document.createElement("div");t.className="nge-link-modal-content";const n=document.createElement("div");n.className="nge-form-group";const o=document.createElement("label");o.className="nge-form-label",o.setAttribute("for","nge-link-url"),o.textContent=l("link.url");const r=document.createElement("input");r.type="url",r.id="nge-link-url",r.className="nge-form-input",r.placeholder=l("link.urlPlaceholder"),r.value=e.url||"",r.setAttribute("data-testid","nge-link-url"),n.appendChild(o),n.appendChild(r);const a=document.createElement("div");a.className="nge-link-separator",a.textContent=l("link.emailSeparator");const i=document.createElement("div");i.className="nge-form-group";const s=document.createElement("label");s.className="nge-form-label",s.setAttribute("for","nge-link-email"),s.textContent=l("link.email");const c=document.createElement("input");c.type="email",c.id="nge-link-email",c.className="nge-form-input",c.placeholder=l("link.emailPlaceholder"),c.value=e.email||"",c.setAttribute("data-testid","nge-link-email"),i.appendChild(s),i.appendChild(c);const d=document.createElement("div");d.className="nge-form-group";const u=document.createElement("label");u.className="nge-form-label",u.setAttribute("for","nge-link-subject"),u.textContent=l("link.subject");const g=document.createElement("input");g.type="text",g.id="nge-link-subject",g.className="nge-form-input",g.placeholder=l("link.subjectPlaceholder"),g.value=e.subject||"",g.setAttribute("data-testid","nge-link-subject"),d.appendChild(u),d.appendChild(g),r.addEventListener("input",()=>{r.value.trim()?(c.disabled=!0,g.disabled=!0,c.classList.add("nge-input-disabled"),g.classList.add("nge-input-disabled")):(c.disabled=!1,g.disabled=!1,c.classList.remove("nge-input-disabled"),g.classList.remove("nge-input-disabled"))}),c.addEventListener("input",()=>{c.value.trim()?(r.disabled=!0,r.classList.add("nge-input-disabled")):(r.disabled=!1,r.classList.remove("nge-input-disabled"))}),e.url?(c.disabled=!0,g.disabled=!0,c.classList.add("nge-input-disabled"),g.classList.add("nge-input-disabled")):e.email&&(r.disabled=!0,r.classList.add("nge-input-disabled"));const p=document.createElement("div");p.className="nge-form-group";const m=document.createElement("label");m.className="nge-form-label",m.setAttribute("for","nge-link-text"),m.textContent=l("link.text");const h=document.createElement("input");h.type="text",h.id="nge-link-text",h.className="nge-form-input",h.placeholder=l("link.textPlaceholder"),h.value=e.text||"",h.setAttribute("data-testid","nge-link-text"),p.appendChild(m),p.appendChild(h);const b=document.createElement("div");b.className="nge-form-group";const f=document.createElement("label");f.className="nge-form-label",f.setAttribute("for","nge-link-title"),f.textContent=l("link.tooltip");const v=document.createElement("input");v.type="text",v.id="nge-link-title",v.className="nge-form-input",v.placeholder=l("link.tooltipPlaceholder"),v.value=e.title||"",v.setAttribute("data-testid","nge-link-title"),b.appendChild(f),b.appendChild(v);const y=document.createElement("div");y.className="nge-form-group nge-checkbox-group";const w=document.createElement("div");w.className="nge-checkbox-wrapper";const C=document.createElement("input");C.type="checkbox",C.id="nge-link-new-window",C.className="nge-form-checkbox",C.checked=e.newWindow||!1,C.setAttribute("data-testid","nge-link-new-window");const k=document.createElement("label");k.className="nge-checkbox-label",k.setAttribute("for","nge-link-new-window"),k.textContent=l("link.newWindow"),w.appendChild(C),w.appendChild(k);const x=document.createElement("div");x.className="nge-checkbox-wrapper";const E=document.createElement("input");E.type="checkbox",E.id="nge-link-nofollow",E.className="nge-form-checkbox",E.checked=e.nofollow||!1,E.setAttribute("data-testid","nge-link-nofollow");const S=document.createElement("label");return S.className="nge-checkbox-label",S.setAttribute("for","nge-link-nofollow"),S.textContent=l("link.nofollow"),x.appendChild(E),x.appendChild(S),y.appendChild(w),y.appendChild(x),t.appendChild(n),t.appendChild(a),t.appendChild(i),t.appendChild(d),t.appendChild(p),t.appendChild(b),t.appendChild(y),t}({...e,text:e.text||e.selectedText||""});return H(D({id:"link-modal",title:l("link.title"),content:t,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:l("link.insert"),variant:"primary"}]})).then(e=>{if("confirm"===e){const e=function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector("#nge-link-url"),n=e.querySelector("#nge-link-text"),o=e.querySelector("#nge-link-title"),r=e.querySelector("#nge-link-new-window"),a=e.querySelector("#nge-link-nofollow"),i=e.querySelector("#nge-link-email"),l=e.querySelector("#nge-link-subject"),s=i?i.value.trim():"",c=l?l.value.trim():"";let d=t?t.value.trim():"";return s&&(d="mailto:"+s,c&&(d+="?subject="+encodeURIComponent(c))),{url:d,text:n?n.value.trim():"",title:o?o.value.trim():"",newWindow:!!r&&r.checked,nofollow:!!a&&a.checked,email:s,subject:c}}(t),n=function(e){if(!e||"object"!=typeof e)return{isValid:!1,error:l("link.errorInvalid")};if(!e.url)return{isValid:!1,error:l("link.errorRequired")};if(e.email)return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)?{isValid:!0,error:null}:{isValid:!1,error:l("link.errorInvalid")};if(!/^(https?:\/\/|mailto:|tel:|\/|#)/i.test(e.url)){if(!e.url.includes(".")||e.url.includes(" "))return{isValid:!1,error:l("link.errorInvalid")};e.url="https://"+e.url}return{isValid:!0,error:null}}(e);if(!n.isValid)throw new Error(n.error);return{action:"confirm",...e}}throw new Error("Modal cancelled")})}const K=[{id:"classic",name:"Classique",description:"Bordure gauche bleue traditionnelle",styles:{borderLeft:"5px solid #3b82f6",paddingLeft:"20px",paddingTop:"12px",paddingBottom:"12px",marginLeft:"0",marginRight:"0",fontStyle:"italic",color:"#374151",background:"#eff6ff"}},{id:"modern",name:"Moderne",description:"Carte flottante avec accent",styles:{background:"#ffffff",borderRadius:"12px",padding:"24px 28px",marginLeft:"0",marginRight:"0",borderLeft:"6px solid #8b5cf6",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",color:"#1f2937"}},{id:"elegant",name:"Élégant",description:"Guillemets dorés décoratifs",styles:{paddingLeft:"50px",paddingRight:"24px",paddingTop:"16px",paddingBottom:"16px",marginLeft:"0",marginRight:"0",fontStyle:"italic",fontFamily:"Georgia, serif",fontSize:"1.1em",lineHeight:"1.7",color:"#44403c",background:"linear-gradient(to right, #fef3c7, #fefbf3)",borderLeft:"4px solid #d97706",borderRadius:"0 8px 8px 0"}},{id:"minimal",name:"Minimaliste",description:"Épuré avec lignes fines",styles:{textAlign:"center",padding:"32px 48px",marginLeft:"40px",marginRight:"40px",color:"#6b7280",borderLeft:"none",borderTop:"1px solid #e5e7eb",borderBottom:"1px solid #e5e7eb",fontWeight:"300",letterSpacing:"0.025em"}},{id:"boxed",name:"Encadré",description:"Double bordure distinctive",styles:{border:"3px double #059669",borderRadius:"0",padding:"20px 24px",marginLeft:"0",marginRight:"0",background:"#ecfdf5",borderLeft:"3px double #059669",color:"#065f46",fontWeight:"500"}},{id:"shadow",name:"Ombre profonde",description:"Effet carte surélevée",styles:{background:"linear-gradient(145deg, #ffffff 0%, #f9fafb 100%)",padding:"28px 32px",marginLeft:"8px",marginRight:"8px",borderRadius:"16px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04), 0 0 0 1px rgba(0, 0, 0, 0.05)",borderLeft:"none",color:"#111827"}},{id:"gradient",name:"Dégradé vif",description:"Fond coloré dynamique",styles:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"24px 28px",marginLeft:"0",marginRight:"0",borderRadius:"10px",borderLeft:"none",color:"#ffffff",fontWeight:"500",textShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"}},{id:"retro",name:"Rétro",description:"Style machine à écrire",styles:{fontFamily:"Courier New, Courier, monospace",fontSize:"0.95em",padding:"20px 24px",marginLeft:"0",marginRight:"0",background:"#fefce8",border:"2px dashed #ca8a04",borderLeft:"5px solid #ca8a04",color:"#713f12",letterSpacing:"0.05em"}},{id:"academic",name:"Académique",description:"Style citation universitaire",styles:{fontFamily:"Georgia, Times New Roman, serif",fontSize:"1.05em",lineHeight:"2",padding:"20px 48px",marginLeft:"32px",marginRight:"32px",borderLeft:"3px solid #78716c",color:"#1c1917",background:"#fafaf9",textIndent:"2em",textAlign:"justify"}},{id:"callout",name:"Mise en avant",description:"Bloc d'attention coloré",styles:{background:"#fef2f2",padding:"20px 24px 20px 56px",marginLeft:"0",marginRight:"0",borderRadius:"8px",borderLeft:"4px solid #ef4444",color:"#991b1b",position:"relative"}}],$={classic:!0,modern:!0,elegant:!0,minimal:!0,boxed:!0,shadow:!0,gradient:!0,retro:!0,academic:!0,callout:!0};let Y={...$};function Q(e){Y={...$,...e}}function ee(){const e=document.createElement("div");e.className="nge-quote-modal-content";const t=document.createElement("p");t.className="nge-quote-instructions",t.textContent=l("quote.selectStyle"),e.appendChild(t);const n=document.createElement("div");n.className="nge-quote-grid",n.setAttribute("data-testid","nge-quote-grid");const o=K.filter(e=>!1!==Y[e.id]).map(e=>e.id);return K.map(e=>({...e,name:l("quote."+e.id),description:l("quote."+e.id+"Desc")})).filter(e=>o.includes(e.id)).forEach(e=>{const t=function(e){if(!e||!e.id)throw new Error("Invalid template");const t=document.createElement("div");t.className="nge-quote-preview",t.setAttribute("data-template-id",e.id),t.setAttribute("data-testid","nge-quote-template-"+e.id);const n=document.createElement("blockquote");n.className="nge-quote-preview-block",Object.assign(n.style,e.styles),n.style.fontSize="11px",n.style.padding="8px 10px",n.style.margin="0",n.textContent="Aperçu du texte...";const o=document.createElement("div");return o.className="nge-quote-preview-label",o.textContent=e.name,t.appendChild(n),t.appendChild(o),t}(e);n.appendChild(t)}),e.appendChild(n),e}function te(e,t){const n=(o=e)&&"string"==typeof o&&K.find(e=>e.id===o)||null;var o;if(!n)throw new Error('Template "'+e+'" not found');const r=Object.entries(n.styles).map(([e,t])=>e.replace(/([A-Z])/g,"-$1").toLowerCase()+": "+t).join("; "),a=t||l("quote.previewText"),i=l("common.deleteQuote");return'<div class="nge-quote-wrapper" contenteditable="false" data-testid="nge-quote-wrapper"><blockquote style="'+r+'" data-quote-template="'+e+'" contenteditable="true">'+a+'</blockquote><button type="button" class="nge-quote-delete-btn" data-testid="nge-quote-delete-btn" title="'+i+'" aria-label="'+i+'"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg></button></div>'}function ne(e,t){e&&"function"==typeof t&&e.addEventListener("click",e=>{const n=e.target.closest(".nge-quote-delete-btn");if(n){e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-quote-wrapper");o&&t(o)}})}function oe(){const e=ee(),t=D({id:"quote-modal",title:l("quote.title"),content:e,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:l("quote.insert"),variant:"primary"}]}),n=e.querySelectorAll(".nge-quote-preview");return n.forEach(e=>{e.addEventListener("click",()=>{n.forEach(e=>e.classList.remove("nge-selected")),e.classList.add("nge-selected")})}),n.length>0&&n[0].classList.add("nge-selected"),H(t).then(t=>{if("confirm"===t){const t=function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector(".nge-quote-preview.nge-selected");return t?t.getAttribute("data-template-id"):null}(e);if(!t)throw new Error("No template selected");return{action:"confirm",templateId:t}}throw new Error("Modal cancelled")})}const re=[{id:"simple",name:"Simple",description:"Ligne fine classique",styles:{height:"1px",background:"#dee2e6",border:"none",margin:"16px 0"}},{id:"thick",name:"Épaisse",description:"Ligne épaisse",styles:{height:"4px",background:"#6c757d",border:"none",borderRadius:"2px",margin:"16px 0"}},{id:"double",name:"Double",description:"Double ligne",styles:{height:"6px",background:"transparent",border:"none",borderTop:"2px solid #6c757d",borderBottom:"2px solid #6c757d",margin:"16px 0"}},{id:"dashed",name:"Tirets",description:"Ligne en tirets",styles:{height:"0",background:"transparent",border:"none",borderTop:"2px dashed #6c757d",margin:"16px 0"}},{id:"dotted",name:"Pointillés",description:"Ligne en pointillés",styles:{height:"0",background:"transparent",border:"none",borderTop:"3px dotted #6c757d",margin:"16px 0"}},{id:"gradient",name:"Dégradé",description:"Dégradé bleu",styles:{height:"3px",background:"linear-gradient(90deg, #0d6efd, #6610f2, #0d6efd)",border:"none",borderRadius:"2px",margin:"16px 0"}},{id:"shadow",name:"Ombre",description:"Ligne avec ombre",styles:{height:"2px",background:"#495057",border:"none",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)",margin:"16px 0"}},{id:"ornament",name:"Ornement",description:"Avec symbole central",styles:{width:"100%",height:"20px",background:"transparent",border:"none",margin:"16px 0",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},beforeContent:"─────────────────────────────── ◆ ───────────────────────────────",beforeStyles:{color:"#6c757d",fontSize:"14px",letterSpacing:"0px",fontFamily:"serif",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"clip"}},{id:"wave",name:"Ondulée",description:"Forme ondulée",styles:{width:"100%",height:"20px",background:"transparent",border:"none",margin:"16px 0",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},beforeContent:"∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿",beforeStyles:{color:"#6c757d",fontSize:"20px",lineHeight:"1",letterSpacing:"-2px",whiteSpace:"nowrap"}},{id:"fade",name:"Fondu",description:"Fondu vers les bords",styles:{height:"2px",background:"linear-gradient(90deg, transparent, #6c757d 20%, #6c757d 80%, transparent)",border:"none",margin:"16px 0"}}];function ae(e){return e&&"string"==typeof e&&re.find(t=>t.id===e)||null}function ie(e,t){if(t>=1)return e;if(e.startsWith("#")){const n=e.slice(1);let o,r,a;return 3===n.length?(o=parseInt(n[0]+n[0],16),r=parseInt(n[1]+n[1],16),a=parseInt(n[2]+n[2],16)):(o=parseInt(n.slice(0,2),16),r=parseInt(n.slice(2,4),16),a=parseInt(n.slice(4,6),16)),"rgba("+o+", "+r+", "+a+", "+t+")"}const n=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(n)return"rgba("+n[1]+", "+n[2]+", "+n[3]+", "+t+")";const o=e.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*[\d.]+\)/);return o?"rgba("+o[1]+", "+o[2]+", "+o[3]+", "+t+")":e}function le(e,t){if(t>=1)return{...e};const n={...e},o=n.background||"",r=n.backgroundImage;if(o.includes("gradient")||o.includes("url(")||r?n.opacity=t.toString():n.background&&"transparent"!==n.background&&(n.background=ie(n.background,t)),n.borderTop){const e=n.borderTop.match(/^(\d+px\s+\w+\s+)(.+)$/);e&&(n.borderTop=e[1]+ie(e[2],t))}if(n.borderBottom){const e=n.borderBottom.match(/^(\d+px\s+\w+\s+)(.+)$/);e&&(n.borderBottom=e[1]+ie(e[2],t))}return n}function se(){const e=document.createElement("div");e.className="nge-hr-modal-content";const t=document.createElement("p");t.className="nge-hr-instructions",t.textContent=l("hr.selectStyle"),e.appendChild(t);const n=document.createElement("div");n.className="nge-hr-grid",n.setAttribute("data-testid","nge-hr-grid");re.map(e=>({...e,name:l("hr."+e.id),description:l("hr."+e.id+"Desc")})).forEach(e=>{const t=function(e,t=1){if(!e||!e.id)throw new Error("Invalid template");const n=document.createElement("div");let o;if(n.className="nge-hr-preview",n.setAttribute("data-template-id",e.id),n.setAttribute("data-testid","nge-hr-template-"+e.id),e.beforeContent){if(o=document.createElement("div"),o.className="nge-hr-preview-line nge-hr-ornament",o.textContent=e.beforeContent,e.beforeStyles){const n=le(e.beforeStyles,t);Object.assign(o.style,n)}const n=le(e.styles,t);Object.assign(o.style,n)}else{o=document.createElement("hr"),o.className="nge-hr-preview-line";const n=le(e.styles,t);Object.assign(o.style,n)}o.style.margin="8px 0";const r=document.createElement("div");return r.className="nge-hr-preview-label",r.textContent=e.name,n.appendChild(o),n.appendChild(r),n}(e,1);n.appendChild(t)}),e.appendChild(n);const o=document.createElement("div");o.className="nge-hr-opacity-control";const r=document.createElement("label");r.className="nge-hr-opacity-label",r.setAttribute("for","nge-hr-opacity-slider");const a=document.createElement("span");a.textContent=l("hr.opacity"),r.appendChild(a);const i=document.createElement("span");i.className="nge-hr-opacity-value",i.setAttribute("data-testid","nge-hr-opacity-value"),i.textContent="0%",r.appendChild(i);const s=document.createElement("input");s.type="range",s.id="nge-hr-opacity-slider",s.className="nge-hr-opacity-slider",s.setAttribute("data-testid","nge-hr-opacity-slider"),s.min="0",s.max="100",s.step="5",s.value="0",o.appendChild(r),o.appendChild(s),e.appendChild(o);const c=document.createElement("div");c.className="nge-hr-width-control";const d=document.createElement("label");d.className="nge-hr-width-label",d.setAttribute("for","nge-hr-width-slider");const u=document.createElement("span");u.textContent=l("hr.width"),d.appendChild(u);const g=document.createElement("span");g.className="nge-hr-width-value",g.setAttribute("data-testid","nge-hr-width-value"),g.textContent="100%",d.appendChild(g);const p=document.createElement("input");return p.type="range",p.id="nge-hr-width-slider",p.className="nge-hr-width-slider",p.setAttribute("data-testid","nge-hr-width-slider"),p.min="10",p.max="100",p.step="5",p.value="100",c.appendChild(d),c.appendChild(p),e.appendChild(c),e}function ce(e){return Object.entries(e).map(([e,t])=>e.replace(/([A-Z])/g,"-$1").toLowerCase()+": "+t).join("; ")}function de(){const e=se(),t=D({id:"hr-modal",title:l("hr.title"),content:e,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:l("hr.insert"),variant:"primary"}]}),n=e.querySelectorAll(".nge-hr-preview");n.forEach(e=>{e.addEventListener("click",()=>{n.forEach(e=>e.classList.remove("nge-selected")),e.classList.add("nge-selected")})}),n.length>0&&n[0].classList.add("nge-selected");const o=e.querySelector(".nge-hr-opacity-slider"),r=e.querySelector(".nge-hr-opacity-value"),a=e.querySelector(".nge-hr-width-slider"),i=e.querySelector(".nge-hr-width-value"),s=()=>{const t=1-(o?parseInt(o.value,10):0)/100,n=a?parseInt(a.value,10):100;!function(e,t,n=100){e.querySelectorAll(".nge-hr-preview").forEach(e=>{const o=ae(e.getAttribute("data-template-id"));if(o){const r=e.querySelector("hr")||e.querySelector(".nge-hr-ornament");if(r){if(r.style.cssText="",o.beforeContent){if(o.beforeStyles){const e=le(o.beforeStyles,t);Object.assign(r.style,e)}const e=le(o.styles,t);Object.assign(r.style,e)}else{const e=le(o.styles,t);Object.assign(r.style,e)}n<100&&(r.style.width=n+"%",r.style.marginLeft="auto",r.style.marginRight="auto"),r.style.margin="8px 0"}}})}(e,t,n)};return o&&o.addEventListener("input",()=>{const e=parseInt(o.value,10);r&&(r.textContent=e+"%"),s()}),a&&a.addEventListener("input",()=>{const e=parseInt(a.value,10);i&&(i.textContent=e+"%"),s()}),H(t).then(t=>{if("confirm"===t){const t=function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector(".nge-hr-preview.nge-selected");return t?t.getAttribute("data-template-id"):null}(e);if(!t)throw new Error("No template selected");return{action:"confirm",templateId:t,opacity:function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector(".nge-hr-opacity-slider");if(t)return 1-parseInt(t.value,10)/100;return 1}(e),width:function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector(".nge-hr-width-slider");return t?parseInt(t.value,10):100}(e)}}throw new Error("Modal cancelled")})}function ue(e){if(!e)return"";const t=e.cloneNode(!0);t.querySelectorAll("br").forEach(e=>{e.replaceWith("\n")});return t.querySelectorAll("div, p").forEach(e=>{e.previousSibling&&e.before("\n")}),t.textContent||""}async function ge(e){if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(e),!0}catch{}try{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",t.style.top="0",document.body.appendChild(t),t.focus(),t.select();const n=document.execCommand("copy");return document.body.removeChild(t),n}catch{return!1}}function pe(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");e.addEventListener("click",async e=>{const t=e.target.closest(".nge-code-copy-btn");if(!t)return;e.preventDefault(),e.stopPropagation();const n=t.closest(".nge-code-block");if(!n)return;const o=n.querySelector("pre");if(!o)return;const r=ue(o);await ge(r)&&(t.classList.add("nge-copied"),t.setAttribute("data-tooltip",l("code.copied")),setTimeout(()=>{t.classList.remove("nge-copied"),t.removeAttribute("data-tooltip")},1500))})}function me(e,t){e&&"function"==typeof t&&e.addEventListener("click",e=>{const n=e.target.closest(".nge-code-delete-btn");if(n){e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-code-block");o&&t(o)}})}let he=!1;async function be(e){const t=e.target.closest(".nge-code-copy-btn");if(!t)return;e.preventDefault(),e.stopPropagation();const n=t.closest(".nge-code-block");if(!n)return;const o=n.querySelector("pre");if(!o)return;const r=ue(o);await ge(r)&&(t.classList.add("nge-copied"),t.setAttribute("data-tooltip",l("code.copied")),setTimeout(()=>{t.classList.remove("nge-copied"),t.removeAttribute("data-tooltip")},1500))}function fe(){he||"undefined"!=typeof document&&(document.addEventListener("click",be),he=!0)}"undefined"!=typeof document&&"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",fe):fe());let ve=null;function ye(e){ve=e}function we(){if(ve&&Array.isArray(ve))return ve;try{const e=localStorage.getItem("nge-custom-colors");if(e){const t=JSON.parse(e);if(Array.isArray(t))return t}}catch(e){}return[]}function Ce(e={}){const{id:t,testId:n,value:o="#000000",onChange:r}=e,a=we(),i=a.length>0,l=document.createElement("div");if(l.className="nge-color-input-group",i){l.className="nge-color-input-group nge-restricted-color-picker";const e=document.createElement("input");e.type="hidden",e.id=t,n&&e.setAttribute("data-testid",n),e.value=o;const i=document.createElement("button");i.type="button",i.className="nge-restricted-color-trigger",i.setAttribute("data-testid",n?n+"-trigger":null);const s=document.createElement("span");s.className="nge-restricted-color-preview",s.style.backgroundColor=o;const c=document.createElement("span");c.className="nge-restricted-color-code",c.textContent=o.toUpperCase();const d=document.createElement("span");d.className="nge-restricted-color-arrow",d.innerHTML="&#9662;",i.appendChild(s),i.appendChild(c),i.appendChild(d);const u=document.createElement("div");u.className="nge-restricted-color-dropdown";const g=document.createElement("div");g.className="nge-restricted-color-grid",a.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="nge-restricted-color-swatch",t.toUpperCase()===o.toUpperCase()&&n.classList.add("selected"),n.style.backgroundColor=t,n.setAttribute("data-color",t),n.setAttribute("title",t),n.addEventListener("click",o=>{o.stopPropagation(),g.querySelectorAll(".nge-restricted-color-swatch").forEach(e=>{e.classList.remove("selected")}),n.classList.add("selected"),e.value=t,s.style.backgroundColor=t,c.textContent=t.toUpperCase(),u.classList.remove("open"),i.classList.remove("open"),r&&r(t)}),g.appendChild(n)}),u.appendChild(g),i.addEventListener("click",e=>{e.stopPropagation();const t=u.classList.contains("open");document.querySelectorAll(".nge-restricted-color-dropdown.open").forEach(e=>{e.classList.remove("open"),e.previousElementSibling?.classList.remove("open")}),!t&&(u.classList.add("open"),i.classList.add("open"))});const p=e=>{!l.contains(e.target)&&(u.classList.remove("open"),i.classList.remove("open"))};document.addEventListener("click",p),l._cleanup=()=>{document.removeEventListener("click",p)},l.appendChild(e),l.appendChild(i),l.appendChild(u),l._getValue=()=>e.value,l._setValue=t=>{e.value=t,s.style.backgroundColor=t,c.textContent=t.toUpperCase(),g.querySelectorAll(".nge-restricted-color-swatch").forEach(e=>{e.classList.toggle("selected",e.getAttribute("data-color").toUpperCase()===t.toUpperCase())})}}else{const e=document.createElement("input");e.type="color",e.id=t,e.className="nge-color-picker",n&&e.setAttribute("data-testid",n),e.value=o;const a=document.createElement("input");a.type="text",a.id=t+"-hex",a.className="nge-input nge-color-hex",n&&a.setAttribute("data-testid",n+"-hex"),a.value=o.toUpperCase(),e.addEventListener("input",()=>{a.value=e.value.toUpperCase(),r&&r(e.value)}),a.addEventListener("input",()=>{/^#[0-9A-Fa-f]{6}$/.test(a.value)&&(e.value=a.value,r&&r(a.value))}),l.appendChild(e),l.appendChild(a),l._getValue=()=>e.value,l._setValue=t=>{e.value=t,a.value=t.toUpperCase()}}return l}const ke={src:"",width:300,height:"auto",rotation:0,opacity:100,keepAspectRatio:!0,borderStyle:"none",borderWidth:0,borderColor:"#000000",borderRadius:0,align:"center"};function xe(e){return e<=0?"0":e>=100?"50%":e+"px"}const Ee={allowImageUrl:!0,allowDragNDrop:!0,allowRotation:!0,allowOpacity:!0,allowBorder:!0};let Se={...Ee};function Ae(e){Se={...Ee,...e}}function Le(){return{...Se}}function Te(e={}){const t={...ke,...e},n={...Se,...e.restrictions},o=document.createElement("div");o.className="nge-image-modal-content";const r=n.allowImageUrl,a=n.allowDragNDrop,i=document.createElement("div");i.className="nge-form-group";const s=document.createElement("label");s.className="nge-form-label",s.textContent=l("image.source");let c=null,d=null;r&&(d=document.createElement("div"),d.className="nge-image-url-group",c=document.createElement("input"),c.type="url",c.id="nge-image-url",c.className="nge-form-input",c.placeholder=l("image.urlPlaceholder"),c.value=t.src&&!t.src.startsWith("data:")?t.src:"",c.setAttribute("data-testid","nge-image-url"),d.appendChild(c)),t.src&&t.src.startsWith("data:")&&(o.dataset.base64Src=t.src);let u=null;r&&a&&(u=document.createElement("div"),u.className="nge-image-separator",u.textContent="—");let g=null,p=null,m=null,h=null;if(a){g=document.createElement("div"),g.className="nge-image-file-group",p=document.createElement("div"),p.className="nge-image-dropzone",p.id="nge-image-dropzone",p.setAttribute("data-testid","nge-image-dropzone"),m=document.createElement("input"),m.type="file",m.id="nge-image-file",m.className="nge-form-file",m.accept="image/*",m.setAttribute("data-testid","nge-image-file");const e=document.createElement("label");e.className="nge-file-label",e.setAttribute("for","nge-image-file"),e.textContent=l("image.chooseFile");const t=document.createElement("span");t.className="nge-dropzone-text",t.textContent=l("image.dragDrop"),h=document.createElement("span"),h.className="nge-file-name",h.id="nge-image-file-name",h.textContent="",p.appendChild(m),p.appendChild(e),p.appendChild(t),p.appendChild(h),g.appendChild(p)}(r||a)&&(i.appendChild(s),d&&i.appendChild(d),u&&i.appendChild(u),g&&i.appendChild(g));const b=document.createElement("div");b.className="nge-form-group";const f=document.createElement("label");f.className="nge-form-label",f.textContent=l("image.preview");const v=document.createElement("div");v.className="nge-image-preview",v.id="nge-image-preview",v.setAttribute("data-testid","nge-image-preview");const y=document.createElement("img");y.id="nge-image-preview-img",y.className="nge-image-preview-img",y.setAttribute("data-testid","nge-image-preview-img"),y.style.display="none";const w=document.createElement("div");w.className="nge-image-preview-placeholder",w.id="nge-image-preview-placeholder",w.textContent=l("image.noImage"),v.appendChild(y),v.appendChild(w),b.appendChild(f),b.appendChild(v);const C=document.createElement("div");C.className="nge-form-group nge-image-dimensions";const k=document.createElement("div");k.className="nge-dimension-group";const x=document.createElement("label");x.className="nge-form-label",x.setAttribute("for","nge-image-width"),x.textContent=l("image.width");const E=document.createElement("input");E.type="number",E.id="nge-image-width",E.className="nge-form-input",E.min="1",E.max="2000",E.value=t.width,E.setAttribute("data-testid","nge-image-width"),k.appendChild(x),k.appendChild(E);const S=document.createElement("div");S.className="nge-dimension-group";const A=document.createElement("label");A.className="nge-form-label",A.setAttribute("for","nge-image-height"),A.textContent=l("image.height");const L=document.createElement("input");L.type="text",L.id="nge-image-height",L.className="nge-form-input",L.placeholder="auto",L.value="auto"===t.height?"":t.height,L.setAttribute("data-testid","nge-image-height"),S.appendChild(A),S.appendChild(L),C.appendChild(k),C.appendChild(S);const T=document.createElement("div");T.className="nge-form-group nge-checkbox-wrapper";const N=document.createElement("input");N.type="checkbox",N.id="nge-image-aspect-ratio",N.className="nge-form-checkbox",N.checked=t.keepAspectRatio,N.setAttribute("data-testid","nge-image-aspect-ratio");const M=document.createElement("label");M.className="nge-checkbox-label",M.setAttribute("for","nge-image-aspect-ratio"),M.textContent=l("image.keepRatio"),T.appendChild(N),T.appendChild(M);let I=null;if(n.allowRotation){I=document.createElement("div"),I.className="nge-form-group";const e=document.createElement("label");e.className="nge-form-label",e.setAttribute("for","nge-image-rotation"),e.textContent=l("image.rotation");const n=document.createElement("div");n.className="nge-range-container";const o=document.createElement("input");o.type="range",o.id="nge-image-rotation",o.className="nge-range-input",o.min="0",o.max="360",o.step="1",o.value=t.rotation,o.setAttribute("data-testid","nge-image-rotation");const r=document.createElement("span");r.className="nge-range-value",r.id="nge-image-rotation-value",r.textContent=t.rotation+"°",n.appendChild(o),n.appendChild(r),I.appendChild(e),I.appendChild(n)}let R=null;if(n.allowOpacity){R=document.createElement("div"),R.className="nge-form-group";const e=document.createElement("label");e.className="nge-form-label",e.setAttribute("for","nge-image-opacity"),e.textContent=l("image.opacity");const n=document.createElement("div");n.className="nge-range-container";const o=document.createElement("input");o.type="range",o.id="nge-image-opacity",o.className="nge-range-input",o.min="0",o.max="100",o.step="1",o.value=t.opacity,o.setAttribute("data-testid","nge-image-opacity");const r=document.createElement("span");r.className="nge-range-value",r.id="nge-image-opacity-value",r.textContent=t.opacity+"%",n.appendChild(o),n.appendChild(r),R.appendChild(e),R.appendChild(n)}let q=null;if(n.allowBorder){q=document.createElement("div"),q.className="nge-form-group nge-border-section";const e=document.createElement("label");e.className="nge-form-label",e.textContent=l("image.border"),q.appendChild(e);const n=document.createElement("div");n.className="nge-border-options";const o=document.createElement("div");o.className="nge-border-option-group";const r=document.createElement("label");r.className="nge-form-label-small",r.setAttribute("for","nge-image-border-style"),r.textContent=l("image.borderStyle");const a=document.createElement("select");a.id="nge-image-border-style",a.className="nge-form-select",a.setAttribute("data-testid","nge-image-border-style");[{value:"none",label:l("image.borderNone")},{value:"solid",label:l("image.borderSolid")},{value:"dashed",label:l("image.borderDashed")},{value:"dotted",label:l("image.borderDotted")},{value:"double",label:l("image.borderDouble")},{value:"groove",label:l("image.borderGroove")},{value:"ridge",label:l("image.borderRidge")},{value:"inset",label:l("image.borderInset")},{value:"outset",label:l("image.borderOutset")}].forEach(e=>{const n=document.createElement("option");n.value=e.value,n.textContent=e.label,e.value===t.borderStyle&&(n.selected=!0),a.appendChild(n)}),o.appendChild(r),o.appendChild(a);const i=document.createElement("div");i.className="nge-border-option-group";const s=document.createElement("label");s.className="nge-form-label-small",s.setAttribute("for","nge-image-border-width"),s.textContent=l("image.borderWidth");const c=document.createElement("input");c.type="number",c.id="nge-image-border-width",c.className="nge-form-input nge-form-input-small",c.min="0",c.max="20",c.value=t.borderWidth,c.setAttribute("data-testid","nge-image-border-width"),i.appendChild(s),i.appendChild(c);const d=document.createElement("div");d.className="nge-border-option-group";const u=document.createElement("label");u.className="nge-form-label-small",u.setAttribute("for","nge-image-border-color"),u.textContent=l("image.borderColor");const g=Ce({id:"nge-image-border-color",testId:"nge-image-border-color",value:t.borderColor});d.appendChild(u),d.appendChild(g);const p=document.createElement("div");p.className="nge-border-option-group";const m=document.createElement("label");m.className="nge-form-label-small",m.setAttribute("for","nge-image-border-radius"),m.textContent=l("image.borderRadius");const h=document.createElement("input");h.type="number",h.id="nge-image-border-radius",h.className="nge-form-input nge-form-input-small",h.min="0",h.max="100",h.value=t.borderRadius,h.setAttribute("data-testid","nge-image-border-radius"),p.appendChild(m),p.appendChild(h),n.appendChild(o),n.appendChild(i),n.appendChild(d),n.appendChild(p),q.appendChild(n)}const B=document.createElement("div");B.className="nge-form-group";const D=document.createElement("label");D.className="nge-form-label",D.textContent=l("image.alignment");const H=document.createElement("div");H.className="nge-radio-group nge-radio-group-horizontal",H.setAttribute("data-testid","nge-image-align-group");[{value:"left",label:l("image.alignLeft")},{value:"center",label:l("image.alignCenter")},{value:"right",label:l("image.alignRight")}].forEach(e=>{const n=document.createElement("div");n.className="nge-radio-wrapper";const o=document.createElement("input");o.type="radio",o.name="nge-image-align",o.id="nge-image-align-"+e.value,o.className="nge-form-radio",o.value=e.value,o.checked=t.align===e.value,o.setAttribute("data-testid","nge-image-align-"+e.value);const r=document.createElement("label");r.className="nge-radio-label",r.setAttribute("for","nge-image-align-"+e.value),r.textContent=e.label,n.appendChild(o),n.appendChild(r),H.appendChild(n)}),B.appendChild(D),B.appendChild(H);const j=document.createElement("div");j.className="nge-image-modal-columns";const z=document.createElement("div");z.className="nge-image-modal-left-column";const F=document.createElement("div");return F.className="nge-image-modal-right-column",(r||a)&&z.appendChild(i),z.appendChild(C),z.appendChild(T),I&&z.appendChild(I),R&&z.appendChild(R),q&&z.appendChild(q),z.appendChild(B),F.appendChild(b),j.appendChild(z),j.appendChild(F),o.appendChild(j),function(e,t){const n=e.querySelector("#nge-image-url"),o=e.querySelector("#nge-image-file"),r=e.querySelector("#nge-image-file-name"),a=e.querySelector("#nge-image-dropzone"),i=e.querySelector("#nge-image-width"),s=e.querySelector("#nge-image-height"),c=e.querySelector("#nge-image-aspect-ratio"),d=e.querySelector("#nge-image-rotation"),u=e.querySelector("#nge-image-rotation-value"),g=e.querySelector("#nge-image-opacity"),p=e.querySelector("#nge-image-opacity-value"),m=e.querySelector("#nge-image-border-style"),h=e.querySelector("#nge-image-border-width"),b=e.querySelector("#nge-image-border-color"),f=e.querySelector("#nge-image-border-radius");let v=t.naturalWidth||0,y=t.naturalHeight||0;function w(){return{borderStyle:m?m.value:"none",borderWidth:h&&parseInt(h.value,10)||0,borderColor:b?b.value:"#000000",borderRadius:f&&parseInt(f.value,10)||0}}function C(){return d?d.value:"0"}function k(){return g?g.value:"100"}async function x(t){if(t&&t.type.startsWith("image/")){r&&(r.textContent=t.name),n&&(n.value="");try{const n=await(o=t,new Promise((e,t)=>{if(!(o&&o instanceof File))return void t(new Error("Invalid file"));const n=new FileReader;n.onload=()=>e(n.result),n.onerror=()=>t(new Error("Failed to read file")),n.readAsDataURL(o)}));Ne(e,n,C(),k()),e.dataset.base64Src=n;const r=new Image;r.onload=()=>{v=r.naturalWidth,y=r.naturalHeight},r.src=n}catch(e){r&&(r.textContent=l("image.readError"))}var o}else r&&(r.textContent=l("image.invalidFile"))}let E=null;n&&n.addEventListener("input",()=>{clearTimeout(E),E=setTimeout(()=>{const t=n.value.trim();if(t){o&&(o.value=""),r&&(r.textContent=""),Ne(e,t,C(),k());const n=new Image;n.onload=()=>{v=n.naturalWidth,y=n.naturalHeight},n.src=t}},500)}),o&&o.addEventListener("change",async()=>{const e=o.files[0];e&&await x(e)}),a&&(a.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation(),a.classList.add("nge-dropzone-dragover")}),a.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),a.classList.remove("nge-dropzone-dragover")}),a.addEventListener("drop",async e=>{e.preventDefault(),e.stopPropagation(),a.classList.remove("nge-dropzone-dragover");const t=e.dataTransfer.files;t.length>0&&await x(t[0])})),i.addEventListener("input",()=>{if(c.checked&&v&&y){const e=parseInt(i.value,10);if(!isNaN(e)&&e>0){const t=y/v;s.value=Math.round(e*t)}}}),s.addEventListener("input",()=>{if(c.checked&&v&&y){const e=parseInt(s.value,10);if(!isNaN(e)&&e>0){const t=v/y;i.value=Math.round(e*t)}}}),d&&u&&d.addEventListener("input",()=>{u.textContent=d.value+"°",Me(e,C(),k(),w())}),g&&p&&g.addEventListener("input",()=>{p.textContent=g.value+"%",Me(e,C(),k(),w())}),m&&m.addEventListener("change",()=>{Me(e,C(),k(),w())}),h&&h.addEventListener("input",()=>{Me(e,C(),k(),w())}),b&&b.addEventListener("input",()=>{Me(e,C(),k(),w())}),f&&f.addEventListener("input",()=>{Me(e,C(),k(),w())})}(o,t),t.src&&Ne(o,t.src,t.rotation,t.opacity),o}function Ne(e,t,n,o){const r=e.querySelector("#nge-image-preview-img"),a=e.querySelector("#nge-image-preview-placeholder"),i=e.querySelector("#nge-image-border-style"),s=e.querySelector("#nge-image-border-width"),c=e.querySelector("#nge-image-border-color"),d=e.querySelector("#nge-image-border-radius"),u={borderStyle:i?i.value:"none",borderWidth:s&&parseInt(s.value,10)||0,borderColor:c?c.value:"#000000",borderRadius:d&&parseInt(d.value,10)||0};if(!t)return r.style.display="none",void(a.style.display="block");r.onload=()=>{r.style.display="block",a.style.display="none",Me(e,n,o,u)},r.onerror=()=>{r.style.display="none",a.style.display="block",a.textContent=l("image.invalidImage")},r.src=t}function Me(e,t,n,o={}){const r=e.querySelector("#nge-image-preview-img");if(r){r.style.transform="rotate("+t+"deg)",r.style.opacity=n/100;const{borderStyle:e="none",borderWidth:a=0,borderColor:i="#000000",borderRadius:l=0}=o;r.style.border=e&&"none"!==e&&a>0?a+"px "+e+" "+i:"none",r.style.borderRadius=xe(l)}}function Ie(e){const{src:t,width:n=ke.width,height:o=ke.height,rotation:r=ke.rotation,opacity:a=ke.opacity,borderStyle:i=ke.borderStyle,borderWidth:s=ke.borderWidth,borderColor:c=ke.borderColor,borderRadius:d=ke.borderRadius,align:u=ke.align}=e,g=["width: "+n+"px","height: "+("auto"===o?"auto":o+"px"),"transform: rotate("+r+"deg)","opacity: "+a/100];i&&"none"!==i&&s>0&&g.push("border: "+s+"px "+i+" "+c),d>0&&g.push("border-radius: "+xe(d));const p=g.join("; "),m=l("image.editImage"),h=l("common.deleteImage");let b="";if(Se.allowRotation){const e=l("image.rotate90");b+='<button type="button" class="nge-image-rotate-btn" data-testid="nge-image-rotate-btn" title="'+e+'" aria-label="'+e+'"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n  <path d="M21 3v5h-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n</svg></button>'}return b+='<button type="button" class="nge-image-edit-btn" data-testid="nge-image-edit-btn" title="'+m+'" aria-label="'+m+'"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1.08-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1.08 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n</svg></button>',b+='<button type="button" class="nge-image-delete-btn" data-testid="nge-image-delete-btn" title="'+h+'" aria-label="'+h+'"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg></button>','<div class="nge-image-wrapper" data-testid="nge-image-wrapper" data-width="'+n+'" data-height="'+o+'" data-rotation="'+r+'" data-opacity="'+a+'" data-border-style="'+i+'" data-border-width="'+s+'" data-border-color="'+c+'" data-border-radius="'+d+'" data-align="'+u+'" contenteditable="false"><img src="'+t+'" alt="" style="'+p+'"><div class="nge-image-buttons">'+b+"</div></div>"}function Re(e={}){const t=Te(e),n=e.src?l("image.editImage"):l("modal.insert");return H(D({id:"image-modal",title:e.src?l("image.editTitle"):l("image.title"),content:t,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:n,variant:"primary"}]})).then(e=>{if("confirm"===e){const e=function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector("#nge-image-url"),n=e.querySelector("#nge-image-width"),o=e.querySelector("#nge-image-height"),r=e.querySelector("#nge-image-aspect-ratio"),a=e.querySelector("#nge-image-rotation"),i=e.querySelector("#nge-image-opacity"),l=e.querySelector("#nge-image-border-style"),s=e.querySelector("#nge-image-border-width"),c=e.querySelector("#nge-image-border-color"),d=e.querySelector("#nge-image-border-radius"),u=e.querySelector('input[name="nge-image-align"]:checked');let g=t?t.value.trim():"";e.dataset.base64Src&&(g=e.dataset.base64Src);const p=o?o.value.trim():"";return{src:g,width:n&&parseInt(n.value,10)||ke.width,height:p&&parseInt(p,10)||"auto",rotation:a?parseInt(a.value,10):ke.rotation,opacity:i?parseInt(i.value,10):ke.opacity,keepAspectRatio:r?r.checked:ke.keepAspectRatio,borderStyle:l?l.value:ke.borderStyle,borderWidth:s?parseInt(s.value,10)||0:ke.borderWidth,borderColor:c?c.value:ke.borderColor,borderRadius:d?parseInt(d.value,10)||0:ke.borderRadius,align:u?u.value:"center"}}(t),o=(n=e)&&"object"==typeof n?n.src?{isValid:!0,error:null}:{isValid:!1,error:"Une source d'image est requise"}:{isValid:!1,error:"Valeurs invalides"};if(!o.isValid)throw new Error(o.error);return{action:"confirm",...e}}throw new Error("Modal cancelled");var n})}function qe(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onEdit callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-image-edit-btn");if(!n)return;e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-image-wrapper");o&&t(o)})}function Be(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onRotate callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-image-rotate-btn");if(!n)return;e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-image-wrapper");if(o){const e=function(e){if(!e||!e.classList.contains("nge-image-wrapper"))return 0;const t=e.querySelector("img");if(!t)return 0;const n=((parseInt(e.dataset.rotation,10)||0)+90)%360;return e.dataset.rotation=n,t.style.transform="rotate("+n+"deg)",n}(o);t(o,e)}})}function De(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onDelete callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-image-delete-btn");if(!n)return;e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-image-wrapper");o&&t(o)})}const He=["nw","n","ne","e","se","s","sw","w"],je=["nw","ne","se","sw"];let ze=null,Fe=null,Oe=null;function Pe(e){e&&e.classList.contains("nge-image-wrapper")&&(ze&&ze!==e&&Ve(ze),function(e){if(!e||!e.classList.contains("nge-image-wrapper"))throw new Error("Invalid wrapper element");let t=e.querySelector(".nge-resize-handles");t||(t=document.createElement("div"),t.className="nge-resize-handles",t.setAttribute("data-testid","nge-resize-handles"),He.forEach(e=>{const n=document.createElement("div");n.className="nge-resize-handle nge-resize-handle-"+e,n.setAttribute("data-handle",e),n.setAttribute("data-testid","nge-resize-handle-"+e),t.appendChild(n)}),Le().allowRotation&&je.forEach(e=>{const n=document.createElement("div");n.className="nge-rotate-handle nge-rotate-handle-"+e,n.setAttribute("data-rotate",e),n.setAttribute("data-testid","nge-rotate-handle-"+e),t.appendChild(n)}),e.appendChild(t))}(e),e.classList.add("nge-image-selected"),ze=e)}function Ve(e){e&&(e.classList.remove("nge-image-selected"),ze===e&&(ze=null))}function We(e,t,n){if(!Fe)return null;const o=e-Fe.startX,r=t-Fe.startY,a=function(e,t,n,o,r,a){let i=t,l=n;const s=t/n;switch(e){case"e":i=t+o,a&&(l=i/s);break;case"w":i=t-o,a&&(l=i/s);break;case"s":l=n+r,a&&(i=l*s);break;case"n":l=n-r,a&&(i=l*s);break;case"se":a?(i=t+Math.max(o,r),l=i/s):(i=t+o,l=n+r);break;case"sw":a?(i=t+Math.max(-o,r),l=i/s):(i=t-o,l=n+r);break;case"ne":a?(i=t+Math.max(o,-r),l=i/s):(i=t+o,l=n-r);break;case"nw":a?(i=t+Math.max(-o,-r),l=i/s):(i=t-o,l=n-r)}return i=Math.max(20,i),l=Math.max(20,l),{width:Math.round(i),height:Math.round(l)}}(Fe.handle,Fe.startWidth,Fe.startHeight,o,r,n);return function(e,t,n){if(!e||!e.classList.contains("nge-image-wrapper"))return;const o=e.querySelector("img");o&&(e.dataset.width=t,e.dataset.height=n,o.style.width=t+"px",o.style.height=n+"px")}(Fe.wrapper,a.width,a.height),a}function Ue(e,t,n){const o=e.getBoundingClientRect(),r=t-(o.left+o.width/2),a=n-(o.top+o.height/2);let i=Math.atan2(a,r)*(180/Math.PI);return i=(i+90+360)%360,i}function _e(e,t,n){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onResize callback is required");e.addEventListener("click",e=>{const t=e.target.closest(".nge-image-wrapper");if(t){if(e.target.closest(".nge-image-edit-btn")||e.target.closest(".nge-image-rotate-btn"))return;e.preventDefault(),e.stopPropagation(),Pe(t)}}),e.addEventListener("mousedown",e=>{const n=e.target.closest(".nge-resize-handle");if(!n)return;const o=n.closest(".nge-image-wrapper");if(!o)return;e.preventDefault(),e.stopPropagation();!function(e,t,n,o){if(!e||!He.includes(t))return null;const r=e.querySelector("img");r&&(Fe={wrapper:e,handle:t,startX:n,startY:o,startWidth:parseInt(e.dataset.width,10)||r.offsetWidth,startHeight:parseInt(e.dataset.height,10)||r.offsetHeight},e.classList.add("nge-image-resizing"),document.body.classList.add("nge-resizing"))}(o,n.getAttribute("data-handle"),e.clientX,e.clientY);const r=e=>{if(null===Fe)return;e.preventDefault();const t=e.altKey;We(e.clientX,e.clientY,t)},a=()=>{const e=function(){if(!Fe)return null;const{wrapper:e}=Fe;e.classList.remove("nge-image-resizing"),document.body.classList.remove("nge-resizing");const t={wrapper:e,width:parseInt(e.dataset.width,10),height:parseInt(e.dataset.height,10)};return Fe=null,t}();e&&t&&t(e.wrapper,e.width,e.height),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)}),e.addEventListener("mousedown",e=>{const t=e.target.closest(".nge-rotate-handle");if(!t)return;const o=t.closest(".nge-image-wrapper");if(!o)return;e.preventDefault(),e.stopPropagation(),function(e,t,n){if(!Le().allowRotation)return null;if(!e||!e.classList.contains("nge-image-wrapper"))return null;if(!e.querySelector("img"))return null;const o=parseInt(e.dataset.rotation,10)||0,r=Ue(e,t,n);Oe={wrapper:e,startX:t,startY:n,startRotation:o,startAngle:r},e.classList.add("nge-image-rotating"),document.body.classList.add("nge-rotating")}(o,e.clientX,e.clientY);const r=e=>{if(null===Oe)return;e.preventDefault();const t=e.shiftKey;!function(e,t,n=!1){if(!Oe)return null;let o=Ue(Oe.wrapper,e,t)-Oe.startAngle,r=(Oe.startRotation+o+360)%360;n&&(r=45*Math.round(r/45)),r=Math.round(r),function(e,t){if(!e||!e.classList.contains("nge-image-wrapper"))return;const n=e.querySelector("img");if(!n)return;e.dataset.rotation=t;const o=e.dataset.opacity||100;n.style.transform="rotate("+t+"deg)",n.style.opacity=o/100}(Oe.wrapper,r)}(e.clientX,e.clientY,t)},a=()=>{const e=function(){if(!Oe)return null;const{wrapper:e}=Oe;e.classList.remove("nge-image-rotating"),document.body.classList.remove("nge-rotating");const t={wrapper:e,rotation:parseInt(e.dataset.rotation,10)};return Oe=null,t}();e&&n&&n(e.wrapper,e.rotation),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)}),document.addEventListener("click",e=>{e.target.closest(".nge-image-wrapper")||e.target.closest(".nge-modal-overlay")||ze&&(Ve(ze),ze=null)})}const Ge={youtube:{name:"YouTube",patterns:[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/,/youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/],getEmbedUrl:(e,t)=>"https://www.youtube.com/embed/"+e+(t?"?autoplay=1":"")},vimeo:{name:"Vimeo",patterns:[/vimeo\.com\/(\d+)/,/player\.vimeo\.com\/video\/(\d+)/],getEmbedUrl:(e,t)=>"https://player.vimeo.com/video/"+e+(t?"?autoplay=1":"")},dailymotion:{name:"Dailymotion",patterns:[/dailymotion\.com\/video\/([a-zA-Z0-9]+)/,/dai\.ly\/([a-zA-Z0-9]+)/,/dailymotion\.com\/embed\/video\/([a-zA-Z0-9]+)/],getEmbedUrl:(e,t)=>"https://www.dailymotion.com/embed/video/"+e+(t?"?autoplay=1":"")}},Je={url:"",platform:"",videoId:"",width:560,autostart:!1,align:"center",borderStyle:"none",borderWidth:0,borderColor:"#000000",borderRadius:0},Ze={allowBorder:!0};let Xe={...Ze};function Ke(e){Xe={...Ze,...e}}function $e(e,t,n=!1){const o=Ge[e];return o&&t?o.getEmbedUrl(t,n):null}function Ye(e={}){const t={...Je,...e},n={...Xe,...e.restrictions},o=document.createElement("div");o.className="nge-video-modal-content";const r=document.createElement("div");r.className="nge-form-group";const a=document.createElement("label");a.className="nge-form-label",a.setAttribute("for","nge-video-url"),a.textContent=l("video.url");const i=document.createElement("input");i.type="url",i.id="nge-video-url",i.className="nge-form-input",i.placeholder=l("video.urlPlaceholder"),i.value=t.url,i.setAttribute("data-testid","nge-video-url");const s=document.createElement("span");s.className="nge-form-hint",s.textContent=l("video.supported"),r.appendChild(a),r.appendChild(i),r.appendChild(s);const c=document.createElement("div");c.className="nge-form-group nge-video-preview-section",c.id="nge-video-preview-section",c.style.display="none",c.setAttribute("data-testid","nge-video-preview-section");const d=document.createElement("label");d.className="nge-form-label",d.textContent=l("video.preview");const u=document.createElement("div");u.className="nge-video-preview",u.id="nge-video-preview",u.setAttribute("data-testid","nge-video-preview"),c.appendChild(d),c.appendChild(u);const g=document.createElement("div");g.className="nge-video-options-section",g.id="nge-video-options-section",g.style.display="none",g.setAttribute("data-testid","nge-video-options-section");const p=document.createElement("div");p.className="nge-form-group";const m=document.createElement("label");m.className="nge-form-label",m.setAttribute("for","nge-video-width"),m.textContent=l("video.width");const h=document.createElement("input");h.type="number",h.id="nge-video-width",h.className="nge-form-input",h.min="200",h.max="1920",h.value=t.width,h.setAttribute("data-testid","nge-video-width"),p.appendChild(m),p.appendChild(h);const b=document.createElement("div");b.className="nge-form-group nge-checkbox-wrapper";const f=document.createElement("input");f.type="checkbox",f.id="nge-video-autostart",f.className="nge-form-checkbox",f.checked=t.autostart,f.setAttribute("data-testid","nge-video-autostart");const v=document.createElement("label");v.className="nge-checkbox-label",v.setAttribute("for","nge-video-autostart"),v.textContent=l("video.autoplay"),b.appendChild(f),b.appendChild(v);const y=document.createElement("div");y.className="nge-form-group";const w=document.createElement("label");w.className="nge-form-label",w.textContent=l("video.alignment");const C=document.createElement("div");C.className="nge-radio-group nge-radio-group-horizontal",C.setAttribute("data-testid","nge-video-align-group");[{value:"left",label:l("video.alignLeft")},{value:"center",label:l("video.alignCenter")},{value:"right",label:l("video.alignRight")}].forEach(e=>{const n=document.createElement("div");n.className="nge-radio-wrapper";const o=document.createElement("input");o.type="radio",o.name="nge-video-align",o.id="nge-video-align-"+e.value,o.className="nge-form-radio",o.value=e.value,o.checked=t.align===e.value,o.setAttribute("data-testid","nge-video-align-"+e.value);const r=document.createElement("label");r.className="nge-radio-label",r.setAttribute("for","nge-video-align-"+e.value),r.textContent=e.label,n.appendChild(o),n.appendChild(r),C.appendChild(n)}),y.appendChild(w),y.appendChild(C);let k=null;if(n.allowBorder){k=document.createElement("div"),k.className="nge-form-group nge-border-section";const e=document.createElement("label");e.className="nge-form-label",e.textContent=l("video.border"),k.appendChild(e);const n=document.createElement("div");n.className="nge-border-options";const o=document.createElement("div");o.className="nge-border-option-group";const r=document.createElement("label");r.className="nge-form-label-small",r.setAttribute("for","nge-video-border-style"),r.textContent=l("video.borderStyle");const a=document.createElement("select");a.id="nge-video-border-style",a.className="nge-form-select",a.setAttribute("data-testid","nge-video-border-style");[{value:"none",label:l("video.borderNone")},{value:"solid",label:l("video.borderSolid")},{value:"dashed",label:l("video.borderDashed")},{value:"dotted",label:l("video.borderDotted")},{value:"double",label:l("video.borderDouble")},{value:"groove",label:l("video.borderGroove")},{value:"ridge",label:l("video.borderRidge")},{value:"inset",label:l("video.borderInset")},{value:"outset",label:l("video.borderOutset")}].forEach(e=>{const n=document.createElement("option");n.value=e.value,n.textContent=e.label,e.value===t.borderStyle&&(n.selected=!0),a.appendChild(n)}),o.appendChild(r),o.appendChild(a);const i=document.createElement("div");i.className="nge-border-option-group";const s=document.createElement("label");s.className="nge-form-label-small",s.setAttribute("for","nge-video-border-width"),s.textContent=l("video.borderWidth");const c=document.createElement("input");c.type="number",c.id="nge-video-border-width",c.className="nge-form-input nge-form-input-small",c.min="0",c.max="20",c.value=t.borderWidth,c.setAttribute("data-testid","nge-video-border-width"),i.appendChild(s),i.appendChild(c);const d=document.createElement("div");d.className="nge-border-option-group";const u=document.createElement("label");u.className="nge-form-label-small",u.setAttribute("for","nge-video-border-color"),u.textContent=l("video.borderColor");const g=Ce({id:"nge-video-border-color",testId:"nge-video-border-color",value:t.borderColor});d.appendChild(u),d.appendChild(g);const p=document.createElement("div");p.className="nge-border-option-group";const m=document.createElement("label");m.className="nge-form-label-small",m.setAttribute("for","nge-video-border-radius"),m.textContent=l("video.borderRadius");const h=document.createElement("input");h.type="number",h.id="nge-video-border-radius",h.className="nge-form-input nge-form-input-small",h.min="0",h.max="100",h.value=t.borderRadius,h.setAttribute("data-testid","nge-video-border-radius"),p.appendChild(m),p.appendChild(h),n.appendChild(o),n.appendChild(i),n.appendChild(d),n.appendChild(p),k.appendChild(n)}return g.appendChild(p),g.appendChild(b),g.appendChild(y),k&&g.appendChild(k),o.appendChild(r),o.appendChild(c),o.appendChild(g),o.dataset.platform=t.platform||"",o.dataset.videoId=t.videoId||"",function(e){const t=e.querySelector("#nge-video-url"),n=e.querySelector("#nge-video-width"),o=e.querySelector("#nge-video-border-style"),r=e.querySelector("#nge-video-border-width"),a=e.querySelector("#nge-video-border-color"),i=e.querySelector("#nge-video-border-radius");let l=null;t.addEventListener("input",()=>{clearTimeout(l),l=setTimeout(()=>{const n=t.value.trim();if(n){const t=function(e){if(!e||"string"!=typeof e)return null;const t=e.trim();for(const[e,n]of Object.entries(Ge))for(const o of n.patterns){const n=t.match(o);if(n&&n[1])return{platform:e,videoId:n[1]}}return null}(n);t?(e.dataset.platform=t.platform,e.dataset.videoId=t.videoId,tt(e,t.platform,t.videoId)):(nt(e),e.dataset.platform="",e.dataset.videoId="")}else nt(e),e.dataset.platform="",e.dataset.videoId=""},500)}),n.addEventListener("input",()=>{const t=e.querySelector("#nge-video-preview").querySelector("iframe");if(t){const e=parseInt(n.value,10)||Je.width,o=Math.round(9*e/16);t.style.width=Math.min(e,480)+"px",t.style.height=Math.min(o,270)+"px"}}),o&&o.addEventListener("change",()=>{et(e)}),r&&r.addEventListener("input",()=>{et(e)}),a&&a.addEventListener("input",()=>{et(e)}),i&&i.addEventListener("input",()=>{et(e)})}(o),t.url&&t.platform&&t.videoId&&tt(o,t.platform,t.videoId),o}function Qe(e){const t=e.querySelector("#nge-video-border-style"),n=e.querySelector("#nge-video-border-width"),o=e.querySelector("#nge-video-border-color"),r=e.querySelector("#nge-video-border-radius");return{borderStyle:t?t.value:Je.borderStyle,borderWidth:n?parseInt(n.value,10)||0:Je.borderWidth,borderColor:o?o.value:Je.borderColor,borderRadius:r?parseInt(r.value,10)||0:Je.borderRadius}}function et(e){const t=e.querySelector("#nge-video-preview"),n=t?t.querySelector("iframe"):null;if(!n)return;const{borderStyle:o,borderWidth:r,borderColor:a,borderRadius:i}=Qe(e);n.style.border=o&&"none"!==o&&r>0?r+"px "+o+" "+a:"",n.style.borderRadius=i>0?i+"px":""}function tt(e,t,n){const o=e.querySelector("#nge-video-preview-section"),r=e.querySelector("#nge-video-preview"),a=e.querySelector("#nge-video-options-section"),i=e.querySelector("#nge-video-width"),l=$e(t,n,!1);if(!l)return void nt(e);const s=parseInt(i.value,10)||Je.width,c=Math.min(s,480),d=Math.round(9*c/16),{borderStyle:u,borderWidth:g,borderColor:p,borderRadius:m}=Qe(e),h=document.createElement("iframe");h.src=l,h.style.width=c+"px",h.style.height=d+"px",h.frameBorder="0",h.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",h.allowFullscreen=!0,h.setAttribute("data-testid","nge-video-preview-iframe"),u&&"none"!==u&&g>0&&(h.style.border=g+"px "+u+" "+p),m>0&&(h.style.borderRadius=m+"px"),r.innerHTML="",r.appendChild(h),o.style.display="block",a.style.display="block"}function nt(e){const t=e.querySelector("#nge-video-preview-section"),n=e.querySelector("#nge-video-preview"),o=e.querySelector("#nge-video-options-section");n.innerHTML="",t.style.display="none",o.style.display="none"}function ot(e={}){const t=Ye(e),n=e.url?l("modal.edit"):l("video.insertVideo");return H(D({id:"video-modal",title:e.url?l("video.editTitle"):l("video.title"),content:t,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:n,variant:"primary"}]})).then(e=>{if("confirm"===e){const e=function(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid content element");const t=e.querySelector("#nge-video-url"),n=e.querySelector("#nge-video-width"),o=e.querySelector("#nge-video-autostart"),r=e.querySelector('input[name="nge-video-align"]:checked'),a=e.querySelector("#nge-video-border-style"),i=e.querySelector("#nge-video-border-width"),l=e.querySelector("#nge-video-border-color"),s=e.querySelector("#nge-video-border-radius");return{url:t?t.value.trim():"",platform:e.dataset.platform||"",videoId:e.dataset.videoId||"",width:n&&parseInt(n.value,10)||Je.width,autostart:o?o.checked:Je.autostart,align:r?r.value:Je.align,borderStyle:a?a.value:Je.borderStyle,borderWidth:i?parseInt(i.value,10)||0:Je.borderWidth,borderColor:l?l.value:Je.borderColor,borderRadius:s?parseInt(s.value,10)||0:Je.borderRadius}}(t),o=(n=e)&&"object"==typeof n?n.url?n.platform&&n.videoId?{isValid:!0,error:null}:{isValid:!1,error:l("video.errorUnsupported")}:{isValid:!1,error:l("video.errorRequired")}:{isValid:!1,error:l("video.errorInvalid")};if(!o.isValid)throw new Error(o.error);return{action:"confirm",...e}}throw new Error("Modal cancelled");var n})}function rt(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onEdit callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-video-edit-btn");if(!n)return;e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-video-wrapper");o&&t(o)})}function at(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onDelete callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-video-delete-btn");if(!n)return;e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-video-wrapper");o&&t(o)})}function it(e={}){const t=document.createElement("div");if(t.className="nge-form-group"+(e.className?" "+e.className:""),e.label){const n=document.createElement("label");n.className=e.icon?"nge-form-label nge-form-label-with-icon":"nge-form-label",n.innerHTML=e.icon?'<span class="nge-label-icon">'+e.icon+"</span> "+e.label:e.label,t.appendChild(n)}if(t._addContent=n=>{e.hint?t.insertBefore(n,t.lastChild):t.appendChild(n)},e.hint){const n=document.createElement("span");n.className="nge-form-hint",n.textContent=e.hint,t.appendChild(n)}return t}function lt(e={}){const t=document.createElement("select");return t.className="nge-form-select"+(e.className?" "+e.className:""),e.testId&&t.setAttribute("data-testid",e.testId),(e.options||[]).forEach(n=>{const o=document.createElement("option");o.value=n.value,o.textContent=n.label,e.value&&n.value===e.value&&(o.selected=!0),t.appendChild(o)}),t}function st(e={}){const t=document.createElement("input");return t.type=e.type||"text",t.className="nge-form-input"+(e.className?" "+e.className:""),void 0!==e.value&&(t.value=e.value),e.placeholder&&(t.placeholder=e.placeholder),e.testId&&t.setAttribute("data-testid",e.testId),t}function ct(e={}){const t=document.createElement("label");t.className="nge-checkbox-label";const n=document.createElement("input");n.type="checkbox",n.className="nge-form-checkbox",n.checked=e.checked||!1,e.testId&&n.setAttribute("data-testid",e.testId);const o=document.createElement("span");return o.textContent=e.label||"",t.appendChild(n),t.appendChild(o),t._checkbox=n,t}const dt={rows:3,columns:3,includeHeader:!0,sortable:!1,style:"standard",responsive:!0,tableWidth:"100%",tableAlign:"left",headerBgColor:"#E3F2FD",headerTransparent:!1,headerFont:"inherit",headerSize:14,headerWeight:"bold",headerTextColor:"#212529"};function ut(){return function(){const e=m(),t={value:"inherit",label:l("table.inheritFont")};return e&&e.length>0?[t,...e]:[t,{value:"Arial, sans-serif",label:"Arial"},{value:"Georgia, serif",label:"Georgia"},{value:"monospace",label:"Monospace"}]}()}const gt=[{value:"25%",label:"25%"},{value:"33%",label:"33%"},{value:"50%",label:"50%"},{value:"75%",label:"75%"},{value:"100%",label:"100%"}];function pt(e,t){const n=document.createElement("h4");return n.className="nge-table-section-title",n.innerHTML='<span class="nge-table-section-icon">'+e+"</span>"+t,n}function mt(e={}){const t={...dt,...e},n=document.createElement("div");n.className="nge-table-modal-content";const o=[{value:"standard",label:l("table.styleStandard")},{value:"bordered",label:l("table.styleBordered")},{value:"striped",label:l("table.styleStriped")},{value:"minimal",label:l("table.styleMinimal")}],r=[{value:"normal",label:l("table.weightNormal")},{value:"bold",label:l("table.weightBold")},{value:"500",label:l("table.weightMedium")},{value:"600",label:l("table.weightSemiBold")}],a=ut(),i=[{value:"left",label:l("table.alignLeft"),icon:"&#x2190;"},{value:"center",label:l("table.alignCenter"),icon:"&#x2194;"},{value:"right",label:l("table.alignRight"),icon:"&#x2192;"}],s=document.createElement("div");s.className="nge-table-modal-grid";const c=document.createElement("div");c.className="nge-table-section",c.appendChild(pt("☰",l("table.structure")));const d=it({label:l("table.rows"),icon:"↕"}),u=st({type:"number",value:t.rows,testId:"nge-table-rows"});u.id="nge-table-rows",u.className="nge-input",u.min="1",u.max="50",d.appendChild(u),c.appendChild(d);const g=it({label:l("table.columns"),icon:"↔"}),p=st({type:"number",value:t.columns,testId:"nge-table-columns"});p.id="nge-table-columns",p.className="nge-input",p.min="1",p.max="20",g.appendChild(p),c.appendChild(g);const m=ct({label:"☰ "+l("table.includeHeader"),checked:t.includeHeader,testId:"nge-table-header"});m._checkbox.id="nge-table-header";const h=document.createElement("div");h.className="nge-form-group nge-checkbox-group",h.appendChild(m),c.appendChild(h);const b=ct({label:"⇅ "+l("table.sortable"),checked:t.sortable,testId:"nge-table-sortable"});b._checkbox.id="nge-table-sortable";const f=document.createElement("div");f.className="nge-form-group nge-checkbox-group",f.appendChild(b),c.appendChild(f),s.appendChild(c);const v=document.createElement("div");v.className="nge-table-section",v.appendChild(pt("⚙",l("table.style")));const y=it({label:l("table.style"),icon:"✎"}),w=lt({options:o,value:t.style,testId:"nge-table-style"});w.id="nge-table-style",w.className="nge-select",y.appendChild(w),v.appendChild(y);const C=ct({label:"📱 "+l("table.responsive"),checked:t.responsive,testId:"nge-table-responsive"});C._checkbox.id="nge-table-responsive";const k=document.createElement("div");k.className="nge-form-group nge-checkbox-group",k.appendChild(C),v.appendChild(k);const x=it({label:l("table.width"),icon:"↔"}),E=lt({options:gt,value:t.tableWidth,testId:"nge-table-width"});E.id="nge-table-width",E.className="nge-select",x.appendChild(E),v.appendChild(x);const S=it({label:l("table.alignment"),icon:"☰"});S.appendChild(function(e,t){const n=document.createElement("div");return n.className="nge-table-align-buttons",n.setAttribute("data-testid","nge-table-align-buttons"),e.forEach(e=>{const o=document.createElement("button");o.type="button",o.className="nge-table-align-btn"+(t===e.value?" selected":""),o.setAttribute("data-align",e.value),o.setAttribute("data-testid","nge-table-align-"+e.value),o.title=e.label,o.innerHTML='<span class="nge-align-icon">'+e.icon+'</span><span class="nge-align-label">'+e.label+"</span>",n.appendChild(o)}),n}(i,t.tableAlign)),v.appendChild(S),s.appendChild(v);const A=document.createElement("div");A.className="nge-table-section",A.appendChild(pt("⚙",l("table.headerStyle")));const L=it({label:l("table.headerBgColor"),icon:"🎨"}),T=document.createElement("div");T.id="nge-table-header-bg-container",T.setAttribute("data-color-value",t.headerBgColor),L.appendChild(T),A.appendChild(L);const N=ct({label:l("table.transparent"),checked:t.headerTransparent,testId:"nge-table-header-transparent"});N._checkbox.id="nge-table-header-transparent";const M=document.createElement("div");M.className="nge-form-group nge-checkbox-group",M.appendChild(N),A.appendChild(M);const I=it({label:l("table.headerFont"),icon:"T"}),R=lt({options:a,value:t.headerFont,testId:"nge-table-header-font"});R.id="nge-table-header-font",R.className="nge-select",I.appendChild(R),A.appendChild(I);const q=document.createElement("div");q.className="nge-form-row";const B=it({label:l("table.size"),className:"nge-form-half"}),D=st({value:t.headerSize+"px",testId:"nge-table-header-size"});D.id="nge-table-header-size",D.className="nge-input",B.appendChild(D),q.appendChild(B);const H=it({label:l("table.weight"),className:"nge-form-half"}),j=lt({options:r,value:t.headerWeight,testId:"nge-table-header-weight"});j.id="nge-table-header-weight",j.className="nge-select",H.appendChild(j),q.appendChild(H),A.appendChild(q);const z=it({label:l("table.textColor")}),F=document.createElement("div");F.id="nge-table-header-text-color-container",F.setAttribute("data-color-value",t.headerTextColor),z.appendChild(F),A.appendChild(z),s.appendChild(A),n.appendChild(s);const O=document.createElement("div");O.className="nge-table-preview-section";const P=document.createElement("h4");P.className="nge-table-preview-title",P.innerHTML='<span class="nge-preview-icon">👁</span>'+l("table.preview"),O.appendChild(P);const V=document.createElement("div");return V.className="nge-table-preview-container",V.setAttribute("data-testid","nge-table-preview"),O.appendChild(V),n.appendChild(O),function(e){const t=e.querySelector("#nge-table-header-bg-container"),n=e.querySelector("#nge-table-header-text-color-container");if(t){const n=Ce({id:"nge-table-header-bg",testId:"nge-table-header-bg",value:t.getAttribute("data-color-value")||"#4472C4",onChange:()=>ht(e)});t.replaceWith(n),e._bgColorInput=n}if(n){const t=Ce({id:"nge-table-header-text-color",testId:"nge-table-header-text-color",value:n.getAttribute("data-color-value")||"#FFFFFF",onChange:()=>ht(e)});n.replaceWith(t),e._textColorInput=t}const o=e.querySelector("#nge-table-header-transparent");o&&o.addEventListener("change",()=>{e.querySelectorAll("#nge-table-header-bg, #nge-table-header-bg-hex").forEach(e=>{e.disabled=o.checked}),ht(e)});const r=e.querySelector("#nge-table-header");r&&r.addEventListener("change",()=>{ht(e)});const a=e.querySelectorAll(".nge-table-align-btn");a.forEach(t=>{t.addEventListener("click",()=>{a.forEach(e=>e.classList.remove("selected")),t.classList.add("selected"),ht(e)})});e.querySelectorAll("input, select").forEach(t=>{t.addEventListener("change",()=>ht(e)),("number"===t.type||"text"===t.type)&&t.addEventListener("input",()=>ht(e))})}(n),ht(n),n}function ht(e){const t=e.querySelector('[data-testid="nge-table-preview"]');if(!t)return;const n=function(e,t=!1){const{rows:n,columns:o,includeHeader:r,sortable:a,style:i,responsive:l,tableWidth:s="100%",tableAlign:c="left",headerBgColor:d,headerTransparent:u,headerFont:g,headerSize:p,headerWeight:m,headerTextColor:h}=e,b=["nge-table","nge-table-"+i,l?"nge-table-responsive":"",a?"nge-table-sortable":""].filter(Boolean).join(" "),f=[];f.push("width: "+s),"center"===c?(f.push("margin-left: auto"),f.push("margin-right: auto")):"right"===c&&(f.push("margin-left: auto"),f.push("margin-right: 0"));const v=' style="'+f.join("; ")+'"',y=[];!u&&y.push("background-color: "+d),"inherit"!==g&&y.push("font-family: "+g),y.push("font-size: "+p+"px"),y.push("font-weight: "+m),y.push("color: "+h);const w=y.length>0?' style="'+y.join("; ")+'"':"";let C="";if(l&&(C+='<div class="nge-table-wrapper">'),C+='<table class="'+b+'"'+v+' data-testid="nge-table">',r){C+="<thead><tr>";for(let e=1;e<=o;e++){C+="<th"+w+(a?' data-sortable="true"':"")+">"+("En-tete "+e)+"</th>"}C+="</tr></thead>"}const k=r?n-1:n;C+="<tbody>";for(let e=1;e<=Math.max(1,k);e++){C+="<tr>";for(let n=1;n<=o;n++){C+="<td>"+(t?'<span class="nge-preview-cell-icon">&#x1F4C4;</span> Cellule '+e+"."+n:"")+"</td>"}C+="</tr>"}return C+="</tbody>",C+="</table>",l&&(C+="</div>"),C}(bt(e),!0);t.innerHTML=n}function bt(e){const t=parseInt(e.querySelector("#nge-table-rows")?.value,10)||dt.rows,n=parseInt(e.querySelector("#nge-table-columns")?.value,10)||dt.columns,o=e.querySelector("#nge-table-header")?.checked??dt.includeHeader,r=e.querySelector("#nge-table-sortable")?.checked??dt.sortable,a=e.querySelector("#nge-table-style")?.value||dt.style,i=e.querySelector("#nge-table-responsive")?.checked??dt.responsive,l=e.querySelector("#nge-table-width")?.value||dt.tableWidth,s=e.querySelector(".nge-table-align-btn.selected"),c=s?.dataset.align||dt.tableAlign,d=e.querySelector("#nge-table-header-bg")?.value||dt.headerBgColor,u=e.querySelector("#nge-table-header-transparent")?.checked??dt.headerTransparent,g=e.querySelector("#nge-table-header-font")?.value||dt.headerFont,p=e.querySelector("#nge-table-header-size")?.value||dt.headerSize+"px";return{rows:t,columns:n,includeHeader:o,sortable:r,style:a,responsive:i,tableWidth:l,tableAlign:c,headerBgColor:d,headerTransparent:u,headerFont:g,headerSize:parseInt(p,10)||dt.headerSize,headerWeight:e.querySelector("#nge-table-header-weight")?.value||dt.headerWeight,headerTextColor:e.querySelector("#nge-table-header-text-color")?.value||dt.headerTextColor}}function ft(e={}){const t=mt(e);return H(D({id:"table-modal",title:e.isEdit?l("table.editTitle"):l("table.title"),content:t,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:l("table.insertTable"),variant:"primary"}]})).then(e=>{if("confirm"===e){const e=bt(t),o=(n=e).rows<1?{isValid:!1,error:l("table.errorRowsMin")}:n.columns<1?{isValid:!1,error:l("table.errorColsMin")}:n.rows>50?{isValid:!1,error:l("table.errorRowsMax")}:n.columns>20?{isValid:!1,error:l("table.errorColsMax")}:{isValid:!0};if(!o.isValid)throw new Error(o.error);return{action:"confirm",...e}}throw new Error("Modal cancelled");var n})}function vt(e){if(!e)return null;if(e.startsWith("#"))return e;const t=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(!t)return null;return"#"+[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10)].map(e=>{const t=e.toString(16);return 1===t.length?"0"+t:t}).join("").toUpperCase()}function yt(e,t=!1,n=null){const{rows:o,columns:r,includeHeader:a,sortable:i,style:s,responsive:c,tableWidth:d="100%",tableAlign:u="left",headerBgColor:g,headerTransparent:p,headerFont:m,headerSize:h,headerWeight:b,headerTextColor:f}=e,v=["nge-table","nge-table-"+s,c?"nge-table-responsive":"",i?"nge-table-sortable":""].filter(Boolean).join(" "),y=[];t?(y.push("width: "+d),"center"===u?(y.push("margin-left: auto"),y.push("margin-right: auto")):"right"===u&&(y.push("margin-left: auto"),y.push("margin-right: 0"))):y.push("width: 100%");const w=' style="'+y.join("; ")+'"',C=[];!p&&C.push("background-color: "+g),"inherit"!==m&&C.push("font-family: "+m),C.push("font-size: "+h+"px"),C.push("font-weight: "+b),C.push("color: "+f);const k=C.length>0?' style="'+C.join("; ")+'"':"";let x="";if(!t){const e=[];e.push("width: "+d),"center"===u?(e.push("margin-left: auto"),e.push("margin-right: auto")):"right"===u&&(e.push("margin-left: auto"),e.push("margin-right: 0"));const t=' style="'+e.join("; ")+'"',n=l("table.editTitle"),o=l("common.deleteTable");x+='<div class="nge-table-edit-wrapper" contenteditable="false" data-testid="nge-table-edit-wrapper" data-align="'+u+'"'+t+">",x+='<div class="nge-table-buttons"><button class="nge-table-edit-btn" data-testid="nge-table-edit-btn" title="'+n+'" aria-label="'+n+'"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">\n  <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="none" stroke="currentColor" stroke-width="2"/>\n  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" fill="none" stroke="currentColor" stroke-width="2"/>\n</svg></button><button class="nge-table-delete-btn" data-testid="nge-table-delete-btn" title="'+o+'" aria-label="'+o+'"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="14" height="14">\n  <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg></button></div>'}if(c&&(x+='<div class="nge-table-wrapper">'),x+='<table class="'+v+'"'+w+' data-testid="nge-table">',a){x+="<thead"+(t?"":' contenteditable="true"')+"><tr>";const e=!t&&n?.headerStyles&&n.headerStyles.length>0?n.headers.length:r;for(let o=0;o<e;o++){let e="";e=t?"En-tete "+(o+1):n?.headers?.[o]?n.headers[o]:"En-tete "+(o+1);const r=i?' data-sortable="true"':"";let a="";if(!t&&n?.headerStyles?.[o]){const e=n.headerStyles[o];e.colspan&&e.colspan>1&&(a+=' colspan="'+e.colspan+'"'),e.rowspan&&e.rowspan>1&&(a+=' rowspan="'+e.rowspan+'"')}x+="<th"+a+k+r+">"+e+"</th>"}x+="</tr></thead>"}const E=a?o-1:o;x+="<tbody"+(t?"":' contenteditable="true"')+">";const S=!t&&n?.bodyStyles&&n.bodyStyles.length>0;for(let e=0;e<Math.max(1,E);e++){x+="<tr>";const o=S&&n.bodyStyles[e]?n.bodyStyles[e].length:r;for(let r=0;r<o;r++){let o="";t?o='<span class="nge-preview-cell-icon">&#x1F4C4;</span> Cellule '+(e+1)+"."+(r+1):n?.body?.[e]?.[r]&&(o=n.body[e][r]);let a="",i="";if(!t&&n?.bodyStyles?.[e]?.[r]){const t=n.bodyStyles[e][r],o=[];t.bgColor&&o.push("background-color: "+t.bgColor),t.textColor&&o.push("color: "+t.textColor),t.hAlign&&o.push("text-align: "+t.hAlign),t.vAlign&&o.push("vertical-align: "+t.vAlign),o.length>0&&(a=' style="'+o.join("; ")+'"'),t.colspan&&t.colspan>1&&(i+=' colspan="'+t.colspan+'"'),t.rowspan&&t.rowspan>1&&(i+=' rowspan="'+t.rowspan+'"')}x+="<td"+i+a+">"+o+"</td>"}x+="</tr>"}return x+="</tbody>",x+="</table>",c&&(x+="</div>"),!t&&(x+="</div>"),x}function wt(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onEdit callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-table-edit-btn");if(n){e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-table-edit-wrapper");o&&t(o)}})}function Ct(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");if("function"!=typeof t)throw new Error("onDelete callback is required");e.addEventListener("click",e=>{const n=e.target.closest(".nge-table-delete-btn");if(!n)return;e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-table-edit-wrapper");o&&t(o)})}function kt(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");e.addEventListener("click",e=>{xt(e)})}function xt(e){const t=e.target.closest('th[data-sortable="true"]');if(!t)return;const n=t.closest(".nge-table-sortable");if(!n)return;const o=t.closest(".nge-content");if(o&&"false"!==o.getAttribute("contenteditable"))return;e.preventDefault(),e.stopPropagation();const r="asc"===t.getAttribute("data-sort")?"desc":"asc";n.querySelectorAll('th[data-sortable="true"]').forEach(e=>e.removeAttribute("data-sort")),t.setAttribute("data-sort",r);!function(e,t,n){const o=e.querySelector("tbody");if(!o)return;const r=Array.from(o.querySelectorAll("tr"));r.sort((e,o)=>{const r=e.querySelectorAll("td")[t],a=o.querySelectorAll("td")[t];if(!r||!a)return 0;const i=r.textContent.trim(),l=a.textContent.trim(),s=parseFloat(i),c=parseFloat(l);if(!isNaN(s)&&!isNaN(c))return"asc"===n?s-c:c-s;const d=i.localeCompare(l,"fr",{numeric:!0,sensitivity:"base"});return"asc"===n?d:-d}),r.forEach(e=>o.appendChild(e))}(n,Array.from(t.parentElement.children).indexOf(t),r)}let Et=!1;function St(){Et||"undefined"!=typeof document&&(document.addEventListener("click",xt),Et=!0)}"undefined"!=typeof document&&"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",St):St());const At='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 3l18 18"/></svg>',Lt=["#FFFFFF","#F8F9FA","#E9ECEF","#DEE2E6","#CED4DA","#ADB5BD","#E8F5E9","#C8E6C9","#FFF3E0","#FFE0B2","#FFECB3","#FFF9C4","#E3F2FD","#BBDEFB","#E1F5FE","#B3E5FC","#F3E5F5","#E1BEE7"],Tt=["#212529","#343A40","#495057","#6C757D","#868E96","#ADB5BD","#D32F2F","#F57C00","#FBC02D","#388E3C","#1976D2","#7B1FA2","#00897B","#43A047","#039BE5","#1E88E5","#8E24AA","#D81B60"],Nt={bgColor:"",textColor:"#212529",hAlign:"left",vAlign:"middle"};function Mt(e={}){const t={bgColor:e.bgColor||Nt.bgColor,textColor:e.textColor||Nt.textColor,hAlign:e.hAlign||Nt.hAlign,vAlign:e.vAlign||Nt.vAlign},n=we(),o=n.length>0,r=o?n:Lt,a=o?n:Tt,i=document.createElement("div");return i.className="nge-cell-format-content",i.innerHTML='\n    <div class="nge-cell-format-columns">\n      \x3c!-- Colors Section --\x3e\n      <div class="nge-cell-format-section">\n        <div class="nge-cell-format-section-header">\n          <span class="nge-cell-format-section-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="4" fill="currentColor"/></svg></span>\n          <span class="nge-cell-format-section-title">Couleurs</span>\n        </div>\n\n        \x3c!-- Background Color --\x3e\n        <div class="nge-cell-format-group">\n          <label class="nge-cell-format-label">\n            <span class="nge-cell-format-label-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" fill="currentColor" opacity="0.3"/><path d="M7 21V3M17 21V3M3 7h18M3 17h18"/></svg></span>\n            Couleur de fond\n          </label>\n          '+(o?'\n          \x3c!-- Restricted mode: only show palette --\x3e\n          <input type="hidden" id="nge-cell-bg-color-hex" data-testid="nge-cell-bg-color-hex" value="'+(t.bgColor||"")+'">\n          <div class="nge-cell-format-restricted-controls">\n            <button type="button"\n                    class="nge-cell-format-transparent-btn"\n                    data-testid="nge-cell-bg-transparent"\n                    title="Transparent">\n              '+At+"\n            </button>\n          </div>\n          ":'\n          <div class="nge-cell-format-color-input">\n            <input type="color"\n                   id="nge-cell-bg-color"\n                   class="nge-cell-format-color-picker"\n                   data-testid="nge-cell-bg-color"\n                   value="'+(t.bgColor||"#FFFFFF")+'">\n            <input type="text"\n                   id="nge-cell-bg-color-hex"\n                   class="nge-cell-format-hex-input"\n                   data-testid="nge-cell-bg-color-hex"\n                   value="'+(t.bgColor||"")+'"\n                   placeholder="transparent">\n            <button type="button"\n                    class="nge-cell-format-transparent-btn"\n                    data-testid="nge-cell-bg-transparent"\n                    title="Transparent">\n              '+At+"\n            </button>\n          </div>\n          ")+'\n          <div class="nge-cell-format-predefined">\n            <span class="nge-cell-format-predefined-label">'+(o?"Couleurs disponibles :":"Couleurs prédéfinies :")+'</span>\n            <div class="nge-cell-format-color-palette" data-target="bg">\n              '+r.map(e=>'\n                <button type="button"\n                        class="nge-cell-format-color-swatch'+(t.bgColor===e||t.bgColor===e.toUpperCase()||t.bgColor?.toUpperCase()===e.toUpperCase()?" selected":"")+'"\n                        style="background-color: '+e+'"\n                        data-color="'+e+'"\n                        title="'+e+'">\n                </button>\n              ').join("")+'\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Text Color --\x3e\n        <div class="nge-cell-format-group">\n          <label class="nge-cell-format-label">\n            <span class="nge-cell-format-label-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 20h16"/><path d="M12 4v12"/><path d="M8 8l4-4 4 4"/></svg></span>\n            Couleur du texte\n          </label>\n          '+(o?'\n          \x3c!-- Restricted mode: only show palette --\x3e\n          <input type="hidden" id="nge-cell-text-color-hex" data-testid="nge-cell-text-color-hex" value="'+t.textColor+'">\n          ':'\n          <div class="nge-cell-format-color-input">\n            <input type="color"\n                   id="nge-cell-text-color"\n                   class="nge-cell-format-color-picker"\n                   data-testid="nge-cell-text-color"\n                   value="'+t.textColor+'">\n            <input type="text"\n                   id="nge-cell-text-color-hex"\n                   class="nge-cell-format-hex-input"\n                   data-testid="nge-cell-text-color-hex"\n                   value="'+t.textColor+'">\n          </div>\n          ')+'\n          <div class="nge-cell-format-predefined">\n            <span class="nge-cell-format-predefined-label">'+(o?"Couleurs disponibles :":"Couleurs prédéfinies :")+'</span>\n            <div class="nge-cell-format-color-palette" data-target="text">\n              '+a.map(e=>'\n                <button type="button"\n                        class="nge-cell-format-color-swatch'+(t.textColor===e||t.textColor===e.toUpperCase()||t.textColor?.toUpperCase()===e.toUpperCase()?" selected":"")+'"\n                        style="background-color: '+e+'"\n                        data-color="'+e+'"\n                        title="'+e+'">\n                </button>\n              ').join("")+'\n            </div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Alignment Section --\x3e\n      <div class="nge-cell-format-section">\n        <div class="nge-cell-format-section-header">\n          <span class="nge-cell-format-section-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M3 12h18M3 18h18"/></svg></span>\n          <span class="nge-cell-format-section-title">Alignement</span>\n        </div>\n\n        \x3c!-- Horizontal Alignment --\x3e\n        <div class="nge-cell-format-group">\n          <label class="nge-cell-format-label">Alignement horizontal</label>\n          <div class="nge-cell-format-align-buttons" data-testid="nge-cell-halign-buttons">\n            <button type="button"\n                    class="nge-cell-format-align-btn'+("left"===t.hAlign?" selected":"")+'"\n                    data-align="left"\n                    data-type="horizontal"\n                    title="Gauche">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M3 12h12M3 18h18"/></svg>\n            </button>\n            <button type="button"\n                    class="nge-cell-format-align-btn'+("center"===t.hAlign?" selected":"")+'"\n                    data-align="center"\n                    data-type="horizontal"\n                    title="Centre">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M6 12h12M3 18h18"/></svg>\n            </button>\n            <button type="button"\n                    class="nge-cell-format-align-btn'+("right"===t.hAlign?" selected":"")+'"\n                    data-align="right"\n                    data-type="horizontal"\n                    title="Droite">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M9 12h12M3 18h18"/></svg>\n            </button>\n            <button type="button"\n                    class="nge-cell-format-align-btn'+("justify"===t.hAlign?" selected":"")+'"\n                    data-align="justify"\n                    data-type="horizontal"\n                    title="Justifié">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M3 12h18M3 18h18"/></svg>\n            </button>\n          </div>\n        </div>\n\n        \x3c!-- Vertical Alignment --\x3e\n        <div class="nge-cell-format-group">\n          <label class="nge-cell-format-label">Alignement vertical</label>\n          <div class="nge-cell-format-align-buttons" data-testid="nge-cell-valign-buttons">\n            <button type="button"\n                    class="nge-cell-format-align-btn'+("top"===t.vAlign?" selected":"")+'"\n                    data-align="top"\n                    data-type="vertical"\n                    title="Haut">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="12" height="6" fill="currentColor" opacity="0.3"/><path d="M6 4h12M6 10h12M6 16h12"/></svg>\n            </button>\n            <button type="button"\n                    class="nge-cell-format-align-btn'+("middle"===t.vAlign?" selected":"")+'"\n                    data-align="middle"\n                    data-type="vertical"\n                    title="Milieu">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="9" width="12" height="6" fill="currentColor" opacity="0.3"/><path d="M6 4h12M6 9h12M6 15h12M6 20h12"/></svg>\n            </button>\n            <button type="button"\n                    class="nge-cell-format-align-btn'+("bottom"===t.vAlign?" selected":"")+'"\n                    data-align="bottom"\n                    data-type="vertical"\n                    title="Bas">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="14" width="12" height="6" fill="currentColor" opacity="0.3"/><path d="M6 8h12M6 14h12M6 20h12"/></svg>\n            </button>\n          </div>\n        </div>\n\n        \x3c!-- Preview --\x3e\n        <div class="nge-cell-format-group">\n          <label class="nge-cell-format-label nge-cell-format-preview-label">APERÇU</label>\n          <div class="nge-cell-format-preview"\n               id="nge-cell-format-preview"\n               data-testid="nge-cell-format-preview"\n               style="background-color: '+(t.bgColor||"transparent")+";\n                      color: "+t.textColor+";\n                      text-align: "+t.hAlign+";\n                      vertical-align: "+t.vAlign+";\">\n            Texte d'exemple\n          </div>\n        </div>\n      </div>\n    </div>\n  ",function(e,t){const n=e.querySelector("#nge-cell-bg-color"),o=e.querySelector("#nge-cell-bg-color-hex"),r=e.querySelector('[data-testid="nge-cell-bg-transparent"]'),a=e.querySelector("#nge-cell-text-color"),i=e.querySelector("#nge-cell-text-color-hex"),l=e.querySelector("#nge-cell-format-preview");n&&n.addEventListener("input",n=>{t.bgColor=n.target.value,o&&(o.value=n.target.value),It(l,t),Rt(e,"bg",t.bgColor)}),o&&"hidden"!==o.type&&o.addEventListener("input",o=>{const r=o.target.value;/^#[0-9A-Fa-f]{6}$/.test(r)?(t.bgColor=r,n&&(n.value=r),It(l,t),Rt(e,"bg",t.bgColor)):(""===r||"transparent"===r.toLowerCase())&&(t.bgColor="",It(l,t),Rt(e,"bg",""))}),r&&r.addEventListener("click",()=>{t.bgColor="",o&&(o.value=""),n&&(n.value="#FFFFFF"),It(l,t),Rt(e,"bg","")}),a&&a.addEventListener("input",n=>{t.textColor=n.target.value,i&&(i.value=n.target.value),It(l,t),Rt(e,"text",t.textColor)}),i&&"hidden"!==i.type&&i.addEventListener("input",n=>{const o=n.target.value;/^#[0-9A-Fa-f]{6}$/.test(o)&&(t.textColor=o,a&&(a.value=o),It(l,t),Rt(e,"text",t.textColor))}),e.querySelectorAll(".nge-cell-format-color-palette").forEach(r=>{r.addEventListener("click",s=>{const c=s.target.closest(".nge-cell-format-color-swatch");if(!c)return;const d=c.dataset.color;"bg"===r.dataset.target?(t.bgColor=d,n&&(n.value=d),o&&(o.value=d),Rt(e,"bg",d)):(t.textColor=d,a&&(a.value=d),i&&(i.value=d),Rt(e,"text",d)),It(l,t)})}),e.querySelectorAll(".nge-cell-format-align-btn").forEach(e=>{e.addEventListener("click",()=>{const n=e.dataset.type,o=e.dataset.align;e.parentElement.querySelectorAll(".nge-cell-format-align-btn").forEach(e=>{e.classList.remove("selected")}),e.classList.add("selected"),"horizontal"===n?t.hAlign=o:t.vAlign=o,It(l,t)})})}(i,t),i}function It(e,t){e.style.backgroundColor=t.bgColor||"transparent",e.style.color=t.textColor;e.style.justifyContent={left:"flex-start",center:"center",right:"flex-end",justify:"flex-start"}[t.hAlign]||"flex-start";e.style.alignItems={top:"flex-start",middle:"center",bottom:"flex-end"}[t.vAlign]||"center"}function Rt(e,t,n){const o=e.querySelector('.nge-cell-format-color-palette[data-target="'+t+'"]');o&&o.querySelectorAll(".nge-cell-format-color-swatch").forEach(e=>{e.dataset.color===n?e.classList.add("selected"):e.classList.remove("selected")})}function qt(e){if(!e)return"";if(e.startsWith("#"))return e;const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(!t)return"";return"#"+[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10)].map(e=>{const t=e.toString(16);return 1===t.length?"0"+t:t}).join("").toUpperCase()}function Bt(e={}){const t=Mt(e),n=D({id:"cell-format",title:"Formater la cellule",content:t,buttons:[{id:"cancel",label:"Annuler",variant:"secondary"},{id:"reset",label:"Réinitialiser",variant:"outline"},{id:"confirm",label:"Appliquer",variant:"primary"}]}),o=n.querySelector('[data-action="reset"]');return o&&(o.onclick=e=>{e.preventDefault(),e.stopPropagation(),function(e){const t=e.querySelector("#nge-cell-bg-color"),n=e.querySelector("#nge-cell-bg-color-hex"),o=e.querySelector("#nge-cell-text-color"),r=e.querySelector("#nge-cell-text-color-hex"),a=e.querySelector("#nge-cell-format-preview");t.value="#FFFFFF",n.value="",o.value=Nt.textColor,r.value=Nt.textColor,e.querySelectorAll(".nge-cell-format-align-btn").forEach(e=>{e.classList.remove("selected"),"horizontal"===e.dataset.type&&e.dataset.align===Nt.hAlign&&e.classList.add("selected"),"vertical"===e.dataset.type&&e.dataset.align===Nt.vAlign&&e.classList.add("selected")}),e.querySelectorAll(".nge-cell-format-color-swatch").forEach(e=>{e.classList.remove("selected")}),It(a,{...Nt})}(t)}),new Promise((e,o)=>{document.body.appendChild(n),n.offsetHeight,n.classList.add("nge-modal-visible");const r=n.querySelector("input");r&&r.focus();const a=n.querySelector(".nge-modal-close");a&&(a.onclick=()=>{j(n),o(new Error("Modal cancelled"))});const i=n.querySelector('[data-action="cancel"]');i&&(i.onclick=()=>{j(n),o(new Error("Modal cancelled"))});const l=n.querySelector('[data-action="confirm"]');l&&(l.onclick=()=>{const o=function(e){const t=e.querySelector("#nge-cell-bg-color-hex"),n=e.querySelector("#nge-cell-text-color-hex"),o=e.querySelector('.nge-cell-format-align-btn[data-type="horizontal"].selected'),r=e.querySelector('.nge-cell-format-align-btn[data-type="vertical"].selected');return{bgColor:t?.value||"",textColor:n?.value||Nt.textColor,hAlign:o?.dataset.align||Nt.hAlign,vAlign:r?.dataset.align||Nt.vAlign}}(t);j(n),e(o)}),n.onclick=e=>{e.target===n&&(j(n),o(new Error("Modal cancelled")))};const s=e=>{"Escape"===e.key&&(j(n),document.removeEventListener("keydown",s),o(new Error("Modal cancelled")))};document.addEventListener("keydown",s)})}const Dt=[{action:"add-row-above",label:"Ajouter une ligne au-dessus",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 14h18"/><path d="M3 10h18"/><path d="M3 6h18"/><path d="M3 18h18"/><path d="M12 2v4"/><path d="M9 4l3-2 3 2"/></svg>'},{action:"add-row-below",label:"Ajouter une ligne en-dessous",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M3 10h18"/><path d="M3 14h18"/><path d="M3 18h18"/><path d="M12 22v-4"/><path d="M9 20l3 2 3-2"/></svg>'},{action:"delete-row",label:"Supprimer la ligne",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M3 12h18"/><path d="M3 18h18"/><path d="M17 9l-5 5m0-5l5 5" stroke="red"/></svg>',danger:!0},{separator:!0},{action:"add-col-left",label:"Ajouter une colonne à gauche",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3v18"/><path d="M10 3v18"/><path d="M14 3v18"/><path d="M18 3v18"/><path d="M2 12h4"/><path d="M4 9l-2 3 2 3"/></svg>'},{action:"add-col-right",label:"Ajouter une colonne à droite",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3v18"/><path d="M10 3v18"/><path d="M14 3v18"/><path d="M18 3v18"/><path d="M22 12h-4"/><path d="M20 9l2 3-2 3"/></svg>'},{action:"delete-col",label:"Supprimer la colonne",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3v18"/><path d="M12 3v18"/><path d="M18 3v18"/><path d="M9 17l5-5m0 5l-5-5" stroke="red"/></svg>',danger:!0},{separator:!0},{action:"merge-cells",label:"Fusionner les cellules",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 3v18"/><path d="M15 3v18"/><path d="M3 9h18"/><path d="M3 15h18"/><path d="M9 9h6v6H9z" fill="currentColor" opacity="0.3"/></svg>',requiresSelection:!0},{action:"unmerge-cells",label:"Défusionner les cellules",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 3v18"/><path d="M15 3v18"/><path d="M3 9h18"/><path d="M3 15h18"/></svg>',requiresMerged:!0},{separator:!0},{action:"format-cell",label:"Formater la cellule",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 3v18"/><circle cx="15" cy="15" r="3" fill="currentColor" opacity="0.3"/></svg>'}];let Ht=null,jt=new Set;function zt(e,t,n={}){Ft(),Ht=function(e={}){const t=document.createElement("div");return t.className="nge-context-menu",t.setAttribute("data-testid","nge-context-menu"),Dt.forEach(n=>{if(n.separator){const e=document.createElement("div");e.className="nge-context-menu-separator",t.appendChild(e)}else{const o=document.createElement("button");o.className="nge-context-menu-item",n.danger&&o.classList.add("nge-context-menu-item-danger"),o.setAttribute("data-action",n.action),o.type="button";const r=document.createElement("span");r.className="nge-context-menu-icon",r.innerHTML=n.icon,o.appendChild(r),o.appendChild(document.createTextNode(n.label)),n.requiresSelection&&!e.canMerge&&(o.disabled=!0),n.requiresMerged&&!e.canUnmerge&&(o.disabled=!0),t.appendChild(o)}}),t}(n),document.body.appendChild(Ht);const o=Ht.getBoundingClientRect(),r=window.innerWidth,a=window.innerHeight;let i=e,l=t;return e+o.width>r&&(i=r-o.width-5),t+o.height>a&&(l=a-o.height-5),Ht.style.left=i+"px",Ht.style.top=l+"px",Ht}function Ft(){Ht&&Ht.parentNode&&Ht.parentNode.removeChild(Ht),Ht=null}function Ot(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container: must be an HTMLElement");if(!t||"object"!=typeof t)throw new Error("Invalid callbacks: must be an object");e.addEventListener("contextmenu",n=>{const o=n.target.closest("td, th"),r=n.target.closest(".nge-table");if(!o||!r)return;n.preventDefault();const a=Zt(Wt(e)),i=Xt(o),l=zt(n.clientX,n.clientY,{canMerge:a,canUnmerge:i});l.dataset.targetCell="",l._targetCell=o,l._targetTable=r,l.addEventListener("click",n=>{const o=n.target.closest(".nge-context-menu-item");if(!o||o.disabled)return;const r=o.dataset.action,a=l._targetCell,i=l._targetTable;switch(r){case"add-row-above":!function(e,t){const n=e.querySelector("tbody");if(!n)return;const o=Gt(e),r=document.createElement("tr");for(let e=0;e<o;e++){const e=document.createElement("td");e.innerHTML="&nbsp;",r.appendChild(e)}const a=n.rows[t];a?n.insertBefore(r,a):n.appendChild(r)}(i,Ut(a)),t.onContentChange&&t.onContentChange();break;case"add-row-below":!function(e,t){const n=e.querySelector("tbody");if(!n)return;const o=Gt(e),r=document.createElement("tr");for(let e=0;e<o;e++){const e=document.createElement("td");e.innerHTML="&nbsp;",r.appendChild(e)}const a=n.rows[t];a&&a.nextSibling?n.insertBefore(r,a.nextSibling):n.appendChild(r)}(i,Ut(a)),t.onContentChange&&t.onContentChange();break;case"delete-row":!function(e,t){if(!e||!t)return!1;const n=t.closest("tr");if(!n)return!1;const o=n.closest("thead");if(o)return!(o.rows.length<=1)&&(n.remove(),!0);const r=e.querySelector("tbody");!!r&&(!(r.rows.length<=1)&&n.remove())}(i,a),t.onContentChange&&t.onContentChange();break;case"add-col-left":!function(e,t){const n=e.querySelector("thead");n&&Array.from(n.rows).forEach(e=>{const n=document.createElement("th");n.innerHTML="&nbsp;";Jt(n,e.cells[t]||e.cells[0]),e.cells[t]?e.insertBefore(n,e.cells[t]):e.appendChild(n)});const o=e.querySelector("tbody");o&&Array.from(o.rows).forEach(e=>{const n=document.createElement("td");n.innerHTML="&nbsp;";const o=e.cells[t];o?e.insertBefore(n,o):e.appendChild(n)})}(i,_t(a)),t.onContentChange&&t.onContentChange();break;case"add-col-right":!function(e,t){const n=e.querySelector("thead");n&&Array.from(n.rows).forEach(e=>{const n=document.createElement("th");n.innerHTML="&nbsp;";Jt(n,e.cells[t]||e.cells[0]),e.cells[t]&&e.cells[t].nextSibling?e.insertBefore(n,e.cells[t].nextSibling):e.appendChild(n)});const o=e.querySelector("tbody");o&&Array.from(o.rows).forEach(e=>{const n=document.createElement("td");n.innerHTML="&nbsp;";const o=e.cells[t];o&&o.nextSibling?e.insertBefore(n,o.nextSibling):e.appendChild(n)})}(i,_t(a)),t.onContentChange&&t.onContentChange();break;case"delete-col":!function(e,t){if(!e||t<0)return!1;if(Gt(e)<=1)return!1;const n=e.querySelector("thead");n&&Array.from(n.rows).forEach(e=>{e.cells[t]&&e.cells[t].remove()});const o=e.querySelector("tbody");o&&Array.from(o.rows).forEach(e=>{e.cells[t]&&e.cells[t].remove()})}(i,_t(a)),t.onContentChange&&t.onContentChange();break;case"merge-cells":const n=Wt(e);n.length>=2&&(function(e){if(!Zt(e))return!1;const t=e.map(e=>({row:Ut(e),col:_t(e),cell:e}));t.sort((e,t)=>e.row!==t.row?e.row-t.row:e.col-t.col);const n=[...new Set(t.map(e=>e.row))].sort((e,t)=>e-t),o=[...new Set(t.map(e=>e.col))].sort((e,t)=>e-t),r=n.length,a=o.length,i=t[0].cell,l=t.map(e=>e.cell.textContent.trim()).filter(e=>e&&" "!==e);r>1&&(i.rowSpan=r);a>1&&(i.colSpan=a);i.innerHTML=l.length>0?l.join(" "):"&nbsp;",t.slice(1).forEach(e=>{e.cell.remove()})}(n),Vt(e),t.onContentChange&&t.onContentChange());break;case"unmerge-cells":Xt(a)&&(!function(e,t){if(!e||!t)return!1;if(!Xt(e))return!1;const n=e.rowSpan||1,o=e.colSpan||1,r=e.closest("tr"),a=t.querySelector("tbody"),i=t.querySelector("thead");if(!r)return!1;const l="th"===e.tagName.toLowerCase(),s=l?"th":"td";let c=0;const d=Array.from(r.cells);for(let t=0;t<d.length&&d[t]!==e;t++)c+=d[t].colSpan||1;e.innerHTML,e.removeAttribute("rowspan"),e.removeAttribute("colspan");const u=i?.querySelector("th");let g=e;for(let e=1;e<o;e++){const e=document.createElement(s);e.innerHTML="&nbsp;",l&&u&&Jt(e,u),g.after(e),g=e}const p=l?i:a;if(!p)return!1;const m=Array.from(p.rows).indexOf(r);for(let e=1;e<n;e++){const t=p.rows[m+e];if(!t)continue;let n=0,r=0;const a=Array.from(t.cells);for(let e=0;e<a.length;e++){if(r>=c){n=e;break}r+=a[e].colSpan||1,n=e+1}for(let e=0;e<o;e++){const e=document.createElement(s);e.innerHTML="&nbsp;",l&&u&&Jt(e,u),t.cells[n]?t.insertBefore(e,t.cells[n]):t.appendChild(e)}}}(a,i),t.onContentChange&&t.onContentChange());break;case"format-cell":const o=Wt(e),r=o.length>0?o:[a];Bt(function(e){if(!e)return{...Nt};const t=window.getComputedStyle(e);let n="";const o=t.backgroundColor;o&&"rgba(0, 0, 0, 0)"!==o&&"transparent"!==o&&(n=qt(o));let r=Nt.textColor;const a=t.color;a&&(r=qt(a)||Nt.textColor);let i=t.textAlign||Nt.hAlign;"start"===i&&(i="left"),"end"===i&&(i="right");let l=t.verticalAlign||Nt.vAlign;return"baseline"===l&&(l="middle"),{bgColor:n,textColor:r,hAlign:i,vAlign:l}}(r[0])).then(n=>{r.forEach(e=>{return o=n,void((t=e)&&o&&(o.bgColor?t.style.backgroundColor=o.bgColor:t.style.backgroundColor="",o.textColor&&(t.style.color=o.textColor),o.hAlign&&(t.style.textAlign=o.hAlign),o.vAlign&&(t.style.verticalAlign=o.vAlign)));var t,o}),Vt(e),t.onContentChange&&t.onContentChange()}).catch(()=>{})}Ft()})}),document.addEventListener("click",e=>{Ht&&!Ht.contains(e.target)&&Ft()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&Ht&&Ft()}),document.addEventListener("scroll",()=>{Ft()},!0)}function Pt(e){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container: must be an HTMLElement");e.addEventListener("click",t=>{const n=t.target.closest("td, th"),o=t.target.closest(".nge-table");if(!n||!o)return void Vt(e);if(t.target.closest(".nge-table-edit-btn, .nge-table-sort-btn"))return;t.ctrlKey||t.metaKey?n.classList.contains("nge-cell-selected")?(n.classList.remove("nge-cell-selected"),jt.delete(n)):(n.classList.add("nge-cell-selected"),jt.add(n)):(Vt(e),n.classList.add("nge-cell-selected"),jt.add(n))})}function Vt(e){if(e){e.querySelectorAll(".nge-cell-selected").forEach(e=>e.classList.remove("nge-cell-selected"))}jt.clear()}function Wt(e){return e?Array.from(e.querySelectorAll(".nge-cell-selected")):[]}function Ut(e){const t=e.closest("tr");if(!t)return-1;const n=t.closest("tbody");return t.closest("thead")?-1:n?Array.from(n.rows).indexOf(t):-1}function _t(e){const t=e.closest("tr");return t?Array.from(t.cells).indexOf(e):-1}function Gt(e){const t=e.querySelector("tr");if(!t)return 0;let n=0;return Array.from(t.cells).forEach(e=>{n+=e.colSpan||1}),n}function Jt(e,t){t&&e&&(t.style.cssText&&(e.style.cssText=t.style.cssText),t.hasAttribute("data-sortable")&&e.setAttribute("data-sortable",t.getAttribute("data-sortable")))}function Zt(e){if(!e||e.length<2)return!1;if(1!==new Set(e.map(e=>e.closest("table"))).size)return!1;const t=e.map(e=>({row:Ut(e),col:_t(e),cell:e})),n=[...new Set(t.map(e=>e.row))].sort((e,t)=>e-t),o=[...new Set(t.map(e=>e.col))].sort((e,t)=>e-t);for(let e=1;e<n.length;e++)if(n[e]-n[e-1]!==1)return!1;for(let e=1;e<o.length;e++)if(o[e]-o[e-1]!==1)return!1;const r=n.length*o.length;return e.length===r}function Xt(e){return!!e&&(e.rowSpan&&e.rowSpan>1||e.colSpan&&e.colSpan>1)}function Kt(){return{small:{label:l("columns.spacingSmall"),value:"1rem"},medium:{label:l("columns.spacingMedium"),value:"2rem"},large:{label:l("columns.spacingLarge"),value:"3rem"}}}const $t=["25","50","75","100"];function Yt(){return{left:{label:l("columns.alignLeft"),icon:"⊏"},center:{label:l("columns.alignCenter"),icon:"⊡"},right:{label:l("columns.alignRight"),icon:"⊐"}}}function Qt(){return{block:{label:l("columns.wrapBlock"),description:l("columns.wrapBlockDesc")},float:{label:l("columns.wrapFloat"),description:l("columns.wrapFloatDesc")}}}const en={1:{label:"1px",value:"1px"},2:{label:"2px",value:"2px"},3:{label:"3px",value:"3px"},4:{label:"4px",value:"4px"}};function tn(){return{solid:{label:l("columns.styleSolid"),value:"solid"},dashed:{label:l("columns.styleDashed"),value:"dashed"},dotted:{label:l("columns.styleDotted"),value:"dotted"},double:{label:l("columns.styleDouble"),value:"double"}}}const nn={columns:2,gap:"medium",height:"auto",width:"100",align:"center",wrap:"block",valign:"top",border:!1,borderColor:"#dee2e6",borderWidth:"1",borderStyle:"solid",bgContainer:"",bgColumns:""},on={maxNumberOfColumns:3,allowBorder:!0};let rn={...on};function an(e){rn={...on,...e},void 0!==rn.maxNumberOfColumns&&(rn.maxNumberOfColumns=Math.max(1,Math.min(3,rn.maxNumberOfColumns)))}function ln(e,t,n,o){const r=document.createElement("div");return r.className="nge-button-group",r.setAttribute("role","radiogroup"),Object.entries(e).forEach(([e,t])=>{const a=document.createElement("button");a.type="button",a.className="nge-button-option",a.setAttribute("data-value",e),a.setAttribute("role","radio"),a.setAttribute("aria-checked",e===n?"true":"false"),e===n&&a.classList.add("nge-selected"),"object"==typeof t&&t.label?a.innerHTML=t.icon?'<span class="nge-option-icon">'+t.icon+"</span> "+t.label:t.label:a.textContent=t,a.addEventListener("click",()=>{r.querySelectorAll(".nge-button-option").forEach(e=>{e.classList.remove("nge-selected"),e.setAttribute("aria-checked","false")}),a.classList.add("nge-selected"),a.setAttribute("aria-checked","true"),o&&o(e)}),r.appendChild(a)}),r}function sn(e={}){const t={...nn,...e},n={...rn,...e.restrictions},o=document.createElement("div");let r;o.className="nge-column-modal-content";const a=document.createElement("div");a.className="nge-form-group";const i=document.createElement("label");i.className="nge-form-label nge-form-label-with-icon",i.innerHTML='<span class="nge-label-icon">⊞</span> '+l("columns.count");const s=n.maxNumberOfColumns,c={1:"☐ "+l("columns.col1"),2:"⊟ "+l("columns.col2"),3:"⊞ "+l("columns.col3")},d={};for(let e=1;e<=s;e++)d[e]=c[e];const u=Math.min(t.columns,s),g=ln(d,0,String(u),e=>{r&&r()});g.setAttribute("data-testid","nge-column-count");const p=document.createElement("span");p.className="nge-form-hint",p.textContent=l("columns.countHint"),a.appendChild(i),a.appendChild(g),a.appendChild(p);const m=document.createElement("div");m.className="nge-form-group";const h=document.createElement("label");h.className="nge-form-label nge-form-label-with-icon",h.setAttribute("for","nge-column-gap"),h.innerHTML='<span class="nge-label-icon">↔</span> '+l("columns.spacing");const b=document.createElement("select");b.id="nge-column-gap",b.className="nge-form-select",b.setAttribute("data-testid","nge-column-gap"),Object.entries(Kt()).forEach(([e,n])=>{const o=document.createElement("option");o.value=e,o.textContent=n.label,e===t.gap&&(o.selected=!0),b.appendChild(o)}),b.addEventListener("change",()=>{r&&r()}),m.appendChild(h),m.appendChild(b);const f=document.createElement("div");f.className="nge-form-group";const v=document.createElement("label");v.className="nge-form-label nge-form-label-with-icon",v.innerHTML='<span class="nge-label-icon">⊡</span> '+l("columns.blockWidth");const y={};$t.forEach(e=>{y[e]=e+"%"});const w=ln(y,0,t.width,e=>{r&&r()});w.setAttribute("data-testid","nge-column-width");const C=document.createElement("span");C.className="nge-form-hint",C.textContent=l("columns.widthHint"),f.appendChild(v),f.appendChild(w),f.appendChild(C);const k=document.createElement("div");k.className="nge-form-group";const x=document.createElement("label");x.className="nge-form-label nge-form-label-with-icon",x.innerHTML='<span class="nge-label-icon">≡</span> '+l("columns.blockAlignment");const E=ln(Yt(),0,t.align,e=>{r&&r()});E.setAttribute("data-testid","nge-column-align");const S=document.createElement("span");S.className="nge-form-hint",S.textContent=l("columns.alignHint"),k.appendChild(x),k.appendChild(E),k.appendChild(S);const A=document.createElement("div");A.className="nge-form-group";const L=document.createElement("label");L.className="nge-form-label nge-form-label-with-icon",L.innerHTML='<span class="nge-label-icon">≋</span> '+l("columns.textWrap");const T={};Object.entries(Qt()).forEach(([e,t])=>{T[e]="↵ "+t.label});const N=ln(T,0,t.wrap,e=>{const t=A.querySelector(".nge-form-hint");t&&(t.textContent=Qt()[e].description),r&&r()});N.setAttribute("data-testid","nge-column-wrap");const M=document.createElement("span");M.className="nge-form-hint",M.textContent=Qt()[t.wrap].description,A.appendChild(L),A.appendChild(N),A.appendChild(M);const I=document.createElement("div");I.className="nge-form-group";const R=document.createElement("label");R.className="nge-form-label nge-form-label-with-icon",R.setAttribute("for","nge-column-valign"),R.innerHTML='<span class="nge-label-icon">T</span> '+l("columns.verticalAlign");const q=document.createElement("select");q.id="nge-column-valign",q.className="nge-form-select",q.setAttribute("data-testid","nge-column-valign"),Object.entries({top:l("columns.vAlignTop"),middle:l("columns.vAlignMiddle"),bottom:l("columns.vAlignBottom")}).forEach(([e,n])=>{const o=document.createElement("option");o.value=e,o.textContent=n,e===t.valign&&(o.selected=!0),q.appendChild(o)}),q.addEventListener("change",()=>{r&&r()}),I.appendChild(R),I.appendChild(q);let B=null;if(n.allowBorder){B=document.createElement("div"),B.className="nge-form-group";const e=document.createElement("div");e.className="nge-form-group-inline";const n=document.createElement("label");n.className="nge-toggle-wrapper";const o=document.createElement("input");o.type="checkbox",o.id="nge-column-border",o.className="nge-toggle-input",o.checked=t.border,o.setAttribute("data-testid","nge-column-border");const a=document.createElement("span");a.className="nge-toggle-slider";const i=document.createElement("span");i.className="nge-form-label nge-form-label-with-icon",i.innerHTML='<span class="nge-label-icon">⊡</span> '+l("columns.borders"),n.appendChild(o),n.appendChild(a),e.appendChild(n),e.appendChild(i),B.appendChild(e);const s=document.createElement("div");s.className="nge-border-options-panel",s.id="nge-border-options",s.style.display=t.border?"block":"none",s.setAttribute("data-testid","nge-border-options");const c=document.createElement("div");c.className="nge-border-option-group";const d=document.createElement("label");d.className="nge-border-option-label",d.setAttribute("for","nge-column-border-color"),d.textContent=l("columns.borderColor");const u=Ce({id:"nge-column-border-color",testId:"nge-column-border-color",value:t.borderColor||"#dee2e6",onChange:()=>{r&&r()}});c.appendChild(d),c.appendChild(u);const g=document.createElement("div");g.className="nge-border-option-group";const p=document.createElement("label");p.className="nge-border-option-label",p.textContent=l("columns.borderThickness");const m={};Object.entries(en).forEach(([e,t])=>{m[e]=t.label});const h=ln(m,0,t.borderWidth||"1",e=>{r&&r()});h.setAttribute("data-testid","nge-column-border-width"),h.className="nge-button-group nge-button-group-small",g.appendChild(p),g.appendChild(h);const b=document.createElement("div");b.className="nge-border-option-group";const f=document.createElement("label");f.className="nge-border-option-label",f.textContent=l("columns.borderStyle");const v={};Object.entries(tn()).forEach(([e,t])=>{v[e]=t.label});const y=ln(v,0,t.borderStyle||"solid",e=>{r&&r()});y.setAttribute("data-testid","nge-column-border-style"),y.className="nge-button-group nge-button-group-small",b.appendChild(f),b.appendChild(y),s.appendChild(c),s.appendChild(g),s.appendChild(b),B.appendChild(s),o.addEventListener("change",()=>{s.style.display=o.checked?"block":"none",r&&r()})}const D=document.createElement("div");D.className="nge-form-group";const H=document.createElement("label");H.className="nge-form-label nge-form-label-with-icon",H.innerHTML='<span class="nge-label-icon">✎</span> '+l("columns.bgColors");const j=document.createElement("div");j.className="nge-colors-row";const z=document.createElement("div");z.className="nge-color-group";const F=document.createElement("label");F.className="nge-color-label",F.setAttribute("for","nge-column-bg-container"),F.textContent=l("columns.bgArea");const O=Ce({id:"nge-column-bg-container",testId:"nge-column-bg-container",value:t.bgContainer||"#ffffff",onChange:()=>{r&&r()}});z.appendChild(F),z.appendChild(O);const P=document.createElement("div");P.className="nge-color-group";const V=document.createElement("label");V.className="nge-color-label",V.setAttribute("for","nge-column-bg-columns"),V.textContent=l("columns.bgColumns");const W=Ce({id:"nge-column-bg-columns",testId:"nge-column-bg-columns",value:t.bgColumns||"#ffffff",onChange:()=>{r&&r()}});P.appendChild(V),P.appendChild(W),j.appendChild(z),j.appendChild(P),D.appendChild(H),D.appendChild(j);const U=document.createElement("div");U.className="nge-form-group nge-column-preview-section";const _=document.createElement("label");_.className="nge-form-label nge-form-label-with-icon",_.innerHTML='<span class="nge-label-icon">◉</span> '+l("columns.preview");const G=document.createElement("div");G.className="nge-column-preview-container",G.setAttribute("data-testid","nge-column-preview");const J=document.createElement("div");return J.className="nge-column-preview",G.appendChild(J),U.appendChild(_),U.appendChild(G),r=()=>{const e=cn(o),t=e.columns;let n="column-count: "+t+"; column-gap: "+Kt()[e.gap].value+";";if(e.border){n+=" column-rule: "+(en[e.borderWidth]?.value||"1px")+" "+(tn()[e.borderStyle]?.value||"solid")+" "+(e.borderColor||"#dee2e6")+";"}e.bgColumns&&"#ffffff"!==e.bgColumns&&(n+=" background-color: "+e.bgColumns+"; padding: 12px;"),J.setAttribute("style",n);let r="width: "+e.width+"%;";"center"===e.align?r+=" margin-left: auto; margin-right: auto;":"right"===e.align&&(r+=" margin-left: auto;"),e.bgContainer&&"#ffffff"!==e.bgContainer&&(r+=" background-color: "+e.bgContainer+"; padding: 8px;"),G.setAttribute("style",r);let a="";for(let e=1;e<=t;e++)a+="<strong>"+l("columns.previewColumn")+" "+e+"</strong><br>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.<br><br>";J.innerHTML=a},o.appendChild(a),o.appendChild(m),o.appendChild(f),o.appendChild(k),o.appendChild(A),o.appendChild(I),B&&o.appendChild(B),o.appendChild(D),o.appendChild(U),setTimeout(()=>r(),0),o}function cn(e){if(!e)return{...nn};const t=e.querySelector('[data-testid="nge-column-count"]'),n=t?.querySelector(".nge-selected"),o=n?parseInt(n.getAttribute("data-value"),10):nn.columns,r=e.querySelector("#nge-column-gap"),a=r?.value||nn.gap,i=e.querySelector('[data-testid="nge-column-width"]'),l=i?.querySelector(".nge-selected"),s=l?.getAttribute("data-value")||nn.width,c=e.querySelector('[data-testid="nge-column-align"]'),d=c?.querySelector(".nge-selected"),u=d?.getAttribute("data-value")||nn.align,g=e.querySelector('[data-testid="nge-column-wrap"]'),p=g?.querySelector(".nge-selected"),m=p?.getAttribute("data-value")||nn.wrap,h=e.querySelector("#nge-column-valign"),b=h?.value||nn.valign,f=e.querySelector("#nge-column-border"),v=f?.checked||!1,y=e.querySelector("#nge-column-border-color"),w=y?.value||nn.borderColor,C=e.querySelector('[data-testid="nge-column-border-width"]'),k=C?.querySelector(".nge-selected"),x=k?.getAttribute("data-value")||nn.borderWidth,E=e.querySelector('[data-testid="nge-column-border-style"]'),S=E?.querySelector(".nge-selected"),A=S?.getAttribute("data-value")||nn.borderStyle,L=e.querySelector("#nge-column-bg-container"),T=L?.value||"",N=e.querySelector("#nge-column-bg-columns"),M=N?.value||"";return{columns:o,gap:a,height:"auto",width:s,align:u,wrap:m,valign:b,border:v,borderColor:w,borderWidth:x,borderStyle:A,bgContainer:"#ffffff"===T?"":T,bgColumns:"#ffffff"===M?"":M}}function dn(e){return e?!e.columns||e.columns<1||e.columns>3?{isValid:!1,error:l("columns.errorCount")}:Kt()[e.gap]?$t.includes(e.width)?Yt()[e.align]?{isValid:!0}:{isValid:!1,error:l("columns.errorAlignment")}:{isValid:!1,error:l("columns.errorWidth")}:{isValid:!1,error:l("columns.errorSpacing")}:{isValid:!1,error:"No values provided"}}function un(e){const t=[];return t.push("width: "+e.width+"%"),"center"===e.align?t.push("margin-left: auto","margin-right: auto"):"right"===e.align&&t.push("margin-left: auto"),"float"===e.wrap?t.push("float: left","margin-right: 16px","margin-bottom: 16px"):t.push("display: block","clear: both"),e.bgContainer&&t.push("background-color: "+e.bgContainer,"padding: 12px","border-radius: 8px"),t.join("; ")}function gn(e){const t=[];if(t.push("column-count: "+e.columns),t.push("column-gap: "+Kt()[e.gap].value),e.border){const n=en[e.borderWidth]?.value||"1px",o=tn()[e.borderStyle]?.value||"solid",r=e.borderColor||"#dee2e6";t.push("column-rule: "+n+" "+o+" "+r)}return e.bgColumns&&t.push("background-color: "+e.bgColumns,"padding: 12px","border-radius: 4px"),t.join("; ")}function pn(e={}){const t=sn(e);return H(D({id:"column-modal",title:l("columns.title"),content:t,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:l("columns.apply"),variant:"primary"}]})).then(e=>{if("confirm"===e){const n=cn(t),o=dn(n);return o.isValid?{action:e,...n}:Promise.reject(new Error(o.error))}return{action:e}})}function mn(e,t){e&&"function"==typeof t&&e.addEventListener("click",e=>{const n=e.target.closest(".nge-column-edit-btn");if(n){e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-column-wrapper");o&&t(o)}})}function hn(e,t){e&&"function"==typeof t&&e.addEventListener("click",e=>{const n=e.target.closest(".nge-column-delete-btn");if(n){e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-column-wrapper");o&&t(o)}})}const bn={TEXT:"text",MEDIA:"media"},fn={10:{cols:1,label:"10%",description:"1 col"},25:{cols:3,label:"25%",description:"3 cols"},33:{cols:4,label:"33%",description:"4 cols"},50:{cols:6,label:"50%",description:"6 cols"},66:{cols:8,label:"66%",description:"8 cols"},75:{cols:9,label:"75%",description:"9 cols"},100:{cols:12,label:"100%",description:"12 cols"}},vn=Object.keys(fn),yn=1/0,wn={0:{value:"0",label:"0",pixels:0},1:{value:"1",label:"1",pixels:8},2:{value:"2",label:"2",pixels:16},3:{value:"3",label:"3",pixels:24},4:{value:"4",label:"4",pixels:32}},Cn={blockType:bn.TEXT,gridWidth:"100",bgImage:"",bgOpacity:1,bgColor:"",nestingLevel:1,padding:0,marginTop:0,marginRight:0,marginBottom:0,marginLeft:0};function kn(e,t,n,o){const r=document.createElement("div");return r.className="nge-button-group",r.setAttribute("role","radiogroup"),Object.entries(e).forEach(([e,t])=>{const a=document.createElement("button");a.type="button",a.className="nge-button-option",a.setAttribute("data-value",e),a.setAttribute("role","radio"),a.setAttribute("aria-checked",e===n?"true":"false"),e===n&&a.classList.add("nge-selected"),"object"==typeof t&&t.label?a.innerHTML=t.icon?'<span class="nge-option-icon">'+t.icon+"</span> "+t.label:t.label:a.textContent=t,a.addEventListener("click",()=>{r.querySelectorAll(".nge-button-option").forEach(e=>{e.classList.remove("nge-selected"),e.setAttribute("aria-checked","false")}),a.classList.add("nge-selected"),a.setAttribute("aria-checked","true"),o&&o(e)}),r.appendChild(a)}),r}function xn(e,t,n){const o=document.createElement("div");o.className="nge-spacing-control",o.setAttribute("data-name",e);const r=document.createElement("button");r.type="button",r.className="nge-spacing-btn nge-spacing-btn-minus",r.textContent="−",r.setAttribute("aria-label",l("gridBlock.decreaseSpacing")||"Decrease"),r.setAttribute("data-testid","nge-"+e+"-minus");const a=document.createElement("div");a.className="nge-spacing-value";const i=document.createElement("div");i.className="nge-spacing-level-indicator";for(let e=1;e<=4;e++){const t=document.createElement("span");t.className="nge-spacing-level-bar",t.setAttribute("data-level",e.toString()),i.appendChild(t)}a.appendChild(i);const s=document.createElement("button");s.type="button",s.className="nge-spacing-btn nge-spacing-btn-plus",s.textContent="+",s.setAttribute("aria-label",l("gridBlock.increaseSpacing")||"Increase"),s.setAttribute("data-testid","nge-"+e+"-plus");const c=document.createElement("input");c.type="hidden",c.name=e,c.value=t.toString(),c.setAttribute("data-testid","nge-"+e+"-value");const d=e=>{const t=parseInt(e,10);c.value=t.toString(),i.querySelectorAll(".nge-spacing-level-bar").forEach((e,n)=>{n<t?e.classList.add("nge-active"):e.classList.remove("nge-active")}),r.disabled=t<=0,s.disabled=t>=4,n&&n(t)};return r.addEventListener("click",()=>{const e=parseInt(c.value,10);e>0&&d(e-1)}),s.addEventListener("click",()=>{const e=parseInt(c.value,10);e<4&&d(e+1)}),o.appendChild(r),o.appendChild(a),o.appendChild(s),o.appendChild(c),d(t),o}function En(e){if(!e)return{...Cn};const t=e.querySelector('[data-testid="nge-grid-block-type"]'),n=t?.querySelector(".nge-selected"),o=n?.getAttribute("data-value")||e.getAttribute("data-block-type")||Cn.blockType,r=e.querySelector('[data-testid="nge-grid-block-width"]'),a=r?.querySelector(".nge-selected"),i=a?.getAttribute("data-value")||Cn.gridWidth,l=e.querySelector("#nge-grid-block-bg-image"),s=l?.value||"",c=e.querySelector("#nge-grid-block-bg-opacity"),d=c?parseInt(c.value,10)/100:Cn.bgOpacity,u=e.querySelector("#nge-grid-block-bg-color"),g=u?.value||"",p=e.querySelector('[data-testid="nge-grid-block-padding"] input[name="padding"]'),m=parseInt(p?.value||Cn.padding,10),h=e.querySelector('[data-testid="nge-grid-block-margin-top"] input[name="marginTop"]'),b=parseInt(h?.value||Cn.marginTop,10),f=e.querySelector('[data-testid="nge-grid-block-margin-right"] input[name="marginRight"]'),v=parseInt(f?.value||Cn.marginRight,10),y=e.querySelector('[data-testid="nge-grid-block-margin-bottom"] input[name="marginBottom"]'),w=parseInt(y?.value||Cn.marginBottom,10),C=e.querySelector('[data-testid="nge-grid-block-margin-left"] input[name="marginLeft"]');return{blockType:o,gridWidth:i,bgImage:s,bgOpacity:d,bgColor:g,padding:m,marginTop:b,marginRight:v,marginBottom:w,marginLeft:parseInt(C?.value||Cn.marginLeft,10)}}function Sn(e){if(!e)return{isValid:!1,error:"No values provided"};if(!e.blockType||!Object.values(bn).includes(e.blockType))return{isValid:!1,error:l("gridBlock.errorBlockType")};if(!e.gridWidth||!vn.includes(e.gridWidth))return{isValid:!1,error:l("gridBlock.errorWidth")};if(void 0!==e.gridStart){const t=parseInt(e.gridStart,10);if(isNaN(t)||t<1||t>12)return{isValid:!1,error:l("gridBlock.errorStartColumn")||"Start column must be between 1 and 12"};if(t+An(e.gridWidth)>13)return{isValid:!1,error:l("gridBlock.errorBlockOverflow")||"Block would extend beyond the grid"}}if(void 0!==e.nestingLevel){const t=parseInt(e.nestingLevel,10);if(isNaN(t)||t<1)return{isValid:!1,error:l("gridBlock.errorNesting")}}return{isValid:!0}}function An(e){const t=fn[e];return t?t.cols:12}function Ln(e,t=""){const n=Sn(e);if(!n.isValid)throw new Error(n.error);const o=An(e.gridWidth),r=e.gridStart||1,a=e.nestingLevel||1,i=e.bgImage||"",s=void 0!==e.bgOpacity?e.bgOpacity:Cn.bgOpacity,c=e.bgColor||"",d=void 0!==e.padding?e.padding:Cn.padding,u=void 0!==e.marginTop?e.marginTop:Cn.marginTop,g=void 0!==e.marginRight?e.marginRight:Cn.marginRight,p=void 0!==e.marginBottom?e.marginBottom:Cn.marginBottom,m=void 0!==e.marginLeft?e.marginLeft:Cn.marginLeft;let h=[];c&&h.push("background-color: "+c),i&&(h.push("--bg-image: url('"+i+"')"),h.push("--bg-opacity: "+s));const b=wn[u]?.pixels||0,f=wn[g]?.pixels||0,v=wn[p]?.pixels||0,y=wn[m]?.pixels||0;(b>0||f>0||v>0||y>0)&&h.push("margin: "+b+"px "+f+"px "+v+"px "+y+"px");const w=h.join("; ")+(h.length>0?";":""),C=wn[d]?.pixels||0,k=C>0?"padding: "+C+"px;":"";let x=t||"<br>";return'<div class="nge-grid-block nge-grid-block-visible" data-block-type="'+e.blockType+'" data-grid-cols="'+o+'" data-grid-start="'+r+'" data-grid-width="'+e.gridWidth+'" data-bg-image="'+i+'" data-bg-opacity="'+s+'" data-bg-color="'+c+'" data-nesting-level="'+a+'" data-padding="'+d+'" data-margin-top="'+u+'" data-margin-right="'+g+'" data-margin-bottom="'+p+'" data-margin-left="'+m+'" contenteditable="false" style="'+w+'"><div class="nge-grid-block-content" contenteditable="true" style="'+k+'">'+x+'</div><div class="nge-grid-block-buttons"><button class="nge-grid-block-config-btn" title="'+l("gridBlock.configure")+'" type="button" data-testid="nge-block-config-btn"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="none" stroke="currentColor" stroke-width="2"/>\n  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1.08-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1.08 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" fill="none" stroke="currentColor" stroke-width="2"/>\n</svg></button></div></div>'}function Tn(e={}){const t=function(e={}){const t={...Cn,...e},n=document.createElement("div");let o;n.className="nge-grid-block-modal-content",n.setAttribute("data-block-type",t.blockType);const r=document.createElement("div");r.className="nge-form-group";const a=document.createElement("label");a.className="nge-form-label nge-form-label-with-icon",a.innerHTML='<span class="nge-label-icon">&#9638;</span> '+l("gridBlock.blockType");const i=kn({[bn.TEXT]:{label:l("gridBlock.typeText"),icon:"&#128196;"},[bn.MEDIA]:{label:l("gridBlock.typeMedia"),icon:"&#128247;"}},0,t.blockType,e=>{n.setAttribute("data-block-type",e),o&&o()});i.setAttribute("data-testid","nge-grid-block-type");const s=document.createElement("span");s.className="nge-form-hint",s.textContent=l("gridBlock.blockTypeHint"),r.appendChild(a),r.appendChild(i),r.appendChild(s);const c=document.createElement("div");c.className="nge-form-group";const d=document.createElement("label");d.className="nge-form-label nge-form-label-with-icon",d.innerHTML='<span class="nge-label-icon">&#8596;</span> '+l("gridBlock.width");const u={};Object.entries(fn).forEach(([e,t])=>{u[e]=t.label});const g=kn(u,0,t.gridWidth,e=>{o&&o()});g.setAttribute("data-testid","nge-grid-block-width");const p=document.createElement("span");p.className="nge-form-hint",p.textContent=l("gridBlock.widthHint"),c.appendChild(d),c.appendChild(g),c.appendChild(p);const m=document.createElement("div");m.className="nge-form-group";const h=document.createElement("label");h.className="nge-form-label nge-form-label-with-icon",h.setAttribute("for","nge-grid-block-bg-image"),h.innerHTML='<span class="nge-label-icon">&#128444;</span> '+l("gridBlock.bgImage");const b=document.createElement("div");b.className="nge-bg-image-input-container";const f=document.createElement("input");f.type="text",f.id="nge-grid-block-bg-image",f.className="nge-form-input",f.placeholder=l("gridBlock.bgImagePlaceholder"),f.value=t.bgImage||"",f.setAttribute("data-testid","nge-grid-block-bg-image"),f.addEventListener("input",()=>{o&&o()}),b.appendChild(f);const v=document.createElement("button");v.type="button",v.className="nge-clear-color-btn",v.textContent="✕",v.title=l("modal.clear")||"Clear",v.setAttribute("data-testid","nge-grid-block-bg-image-clear"),v.addEventListener("click",()=>{f.value="",o&&o()}),b.appendChild(v);const y=document.createElement("div");y.className="nge-bg-image-dropzone",y.setAttribute("data-testid","nge-grid-block-bg-image-dropzone"),y.innerHTML='<span class="nge-dropzone-icon">📁</span><span class="nge-dropzone-text">'+(l("gridBlock.bgImageDropHint")||"Drop an image here or click to upload")+"</span>";const w=document.createElement("input");w.type="file",w.accept="image/*",w.style.display="none",w.setAttribute("data-testid","nge-grid-block-bg-image-file"),y.addEventListener("click",()=>w.click()),w.addEventListener("change",e=>{const t=e.target.files[0];if(t&&t.type.startsWith("image/")){const e=new FileReader;e.onload=e=>{f.value=e.target.result,o&&o()},e.readAsDataURL(t)}}),y.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation(),y.classList.add("nge-dropzone-active")}),y.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),y.classList.remove("nge-dropzone-active")}),y.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),y.classList.remove("nge-dropzone-active");const t=e.dataTransfer.files[0];if(t&&t.type.startsWith("image/")){const e=new FileReader;e.onload=e=>{f.value=e.target.result,o&&o()},e.readAsDataURL(t)}});const C=document.createElement("div");C.className="nge-opacity-container";const k=document.createElement("label");k.className="nge-opacity-label",k.setAttribute("for","nge-grid-block-bg-opacity"),k.textContent=l("gridBlock.bgOpacity")||"Opacity:";const x=document.createElement("input");x.type="range",x.id="nge-grid-block-bg-opacity",x.className="nge-opacity-slider",x.min="0",x.max="100",x.value=String(100*(void 0!==t.bgOpacity?t.bgOpacity:1)),x.setAttribute("data-testid","nge-grid-block-bg-opacity");const E=document.createElement("span");E.className="nge-opacity-value",E.textContent=x.value+"%",x.addEventListener("input",()=>{E.textContent=x.value+"%",o&&o()}),C.appendChild(k),C.appendChild(x),C.appendChild(E);const S=document.createElement("span");S.className="nge-form-hint",S.textContent=l("gridBlock.bgImageHint"),m.appendChild(h),m.appendChild(b),m.appendChild(y),m.appendChild(w),m.appendChild(C),m.appendChild(S);const A=document.createElement("div");A.className="nge-form-group";const L=document.createElement("label");L.className="nge-form-label nge-form-label-with-icon",L.setAttribute("for","nge-grid-block-bg-color"),L.innerHTML='<span class="nge-label-icon">&#127912;</span> '+l("gridBlock.bgColor");const T=document.createElement("div");T.className="nge-color-input-container";const N=Ce({id:"nge-grid-block-bg-color",testId:"nge-grid-block-bg-color",value:t.bgColor||"#ffffff",onChange:()=>{o&&o()}});T.appendChild(N);const M=document.createElement("button");M.type="button",M.className="nge-clear-color-btn",M.textContent="✕",M.title=l("modal.clear")||"Clear",M.setAttribute("data-testid","nge-grid-block-bg-color-clear"),M.addEventListener("click",()=>{const e=N.querySelector('input[type="hidden"]')||N.querySelector('input[type="color"]');if(e){e.value="";const t=N.querySelector(".nge-restricted-color-preview"),n=N.querySelector(".nge-restricted-color-code");t&&(t.style.backgroundColor="transparent"),n&&(n.textContent=l("modal.none")||"None"),"color"===e.type&&(e.style.opacity="0.5")}o&&o()}),T.appendChild(M);const I=document.createElement("span");I.className="nge-form-hint",I.textContent=l("gridBlock.bgColorHint"),A.appendChild(L),A.appendChild(T),A.appendChild(I);const R=document.createElement("div");R.className="nge-form-group nge-spacing-section";const q=document.createElement("label");q.className="nge-form-label nge-form-label-with-icon",q.innerHTML='<span class="nge-label-icon">&#9635;</span> '+l("gridBlock.padding");const B=document.createElement("div");B.className="nge-spacing-controls";const D=document.createElement("div");D.className="nge-spacing-row";const H=xn("padding",t.padding,()=>{o&&o()});H.setAttribute("data-testid","nge-grid-block-padding"),D.appendChild(H),B.appendChild(D);const j=document.createElement("span");j.className="nge-form-hint",j.textContent=l("gridBlock.paddingHint")||l("gridBlock.spacingHint"),R.appendChild(q),R.appendChild(B),R.appendChild(j);const z=document.createElement("div");z.className="nge-form-group nge-spacing-section nge-margin-section";const F=document.createElement("label");F.className="nge-form-label nge-form-label-with-icon",F.innerHTML='<span class="nge-label-icon">&#9634;</span> '+l("gridBlock.margin");const O=document.createElement("div");O.className="nge-margin-controls";const P=document.createElement("div");P.className="nge-margin-row nge-margin-row-top";const V=document.createElement("span");V.className="nge-margin-label",V.textContent=l("gridBlock.marginTop");const W=xn("marginTop",t.marginTop||0,()=>{o&&o()});W.setAttribute("data-testid","nge-grid-block-margin-top"),P.appendChild(V),P.appendChild(W);const U=document.createElement("div");U.className="nge-margin-row nge-margin-row-middle";const _=document.createElement("div");_.className="nge-margin-group";const G=document.createElement("span");G.className="nge-margin-label",G.textContent=l("gridBlock.marginLeft");const J=xn("marginLeft",t.marginLeft||0,()=>{o&&o()});J.setAttribute("data-testid","nge-grid-block-margin-left"),_.appendChild(G),_.appendChild(J);const Z=document.createElement("div");Z.className="nge-margin-block-visual",Z.textContent=l("gridBlock.blockLabel")||"Bloc";const X=document.createElement("div");X.className="nge-margin-group";const K=document.createElement("span");K.className="nge-margin-label",K.textContent=l("gridBlock.marginRight");const $=xn("marginRight",t.marginRight||0,()=>{o&&o()});$.setAttribute("data-testid","nge-grid-block-margin-right"),X.appendChild(K),X.appendChild($),U.appendChild(_),U.appendChild(Z),U.appendChild(X);const Y=document.createElement("div");Y.className="nge-margin-row nge-margin-row-bottom";const Q=document.createElement("span");Q.className="nge-margin-label",Q.textContent=l("gridBlock.marginBottom");const ee=xn("marginBottom",t.marginBottom||0,()=>{o&&o()});ee.setAttribute("data-testid","nge-grid-block-margin-bottom"),Y.appendChild(Q),Y.appendChild(ee),O.appendChild(P),O.appendChild(U),O.appendChild(Y);const te=document.createElement("span");te.className="nge-form-hint",te.textContent=l("gridBlock.marginHint"),z.appendChild(F),z.appendChild(O),z.appendChild(te);const ne=document.createElement("div");ne.className="nge-form-group nge-grid-block-preview-section";const oe=document.createElement("label");oe.className="nge-form-label nge-form-label-with-icon",oe.innerHTML='<span class="nge-label-icon">&#9673;</span> '+l("gridBlock.preview");const re=document.createElement("div");re.className="nge-grid-block-preview-container",re.setAttribute("data-testid","nge-grid-block-preview");const ae=document.createElement("div");return ae.className="nge-grid-block-preview",re.appendChild(ae),ne.appendChild(oe),ne.appendChild(re),o=()=>{const e=En(n),t=e.gridWidth,o=e.padding,r=wn[o]?.pixels||0,a=wn[e.marginTop]?.pixels||0,i=wn[e.marginRight]?.pixels||0,s=wn[e.marginBottom]?.pixels||0,c=wn[e.marginLeft]?.pixels||0,d=r>0?"background-color: rgba(34, 197, 94, 0.3); padding: "+r+"px;":"",u=a>0||i>0||s>0||c>0?"background-color: rgba(249, 115, 22, 0.3); padding: "+a+"px "+i+"px "+s+"px "+c+"px;":"";let g="";if(e.bgImage){const t=void 0!==e.bgOpacity?e.bgOpacity:1;g="<div style=\"position: absolute; inset: 0; background-image: url('"+e.bgImage+"'); background-size: contain; background-position: center; background-repeat: no-repeat; opacity: "+t+'; pointer-events: none;"></div>'}let p="";e.bgColor&&""!==e.bgColor&&(p="background-color: "+e.bgColor+";");const m=e.blockType===bn.TEXT?"&#128196;":"&#128247;",h=e.blockType===bn.TEXT?l("gridBlock.typeText"):l("gridBlock.typeMedia");ae.setAttribute("style","width: "+t+"%; border-radius: 4px;");const b=p||"background: rgba(255,255,255,0.9);",f=a+"/"+i+"/"+s+"/"+c;ae.innerHTML='\n      <div class="nge-preview-margin" style="'+u+' border-radius: 4px;">\n        <div class="nge-preview-padding" style="'+d+' border-radius: 4px;">\n          <div class="nge-preview-content-inner" style="position: relative; min-height: 40px; border: 2px dashed var(--nge-border-color, #dee2e6); border-radius: 2px; display: flex; align-items: center; justify-content: center; padding: 8px; '+b+'">\n            '+g+'\n            <span style="position: relative; z-index: 1; opacity: 0.6; font-size: 13px;">'+m+" "+h+" - "+t+'%</span>\n          </div>\n        </div>\n      </div>\n      <div class="nge-preview-legend" style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px; font-size: 11px; color: #666;">\n        <span style="display: flex; align-items: center; gap: 4px;"><span style="display: inline-block; width: 12px; height: 12px; background: rgba(249, 115, 22, 0.3); border-radius: 2px;"></span> '+l("gridBlock.margin")+" ("+f+'px)</span>\n        <span style="display: flex; align-items: center; gap: 4px;"><span style="display: inline-block; width: 12px; height: 12px; background: rgba(34, 197, 94, 0.3); border-radius: 2px;"></span> '+l("gridBlock.padding")+" ("+r+"px)</span>\n      </div>\n    "},!e.blockType&&n.appendChild(r),n.appendChild(c),n.appendChild(m),n.appendChild(A),n.appendChild(R),n.appendChild(z),n.appendChild(ne),setTimeout(()=>o(),0),n}(e);return H(D({id:"grid-block-modal",title:e.blockType?l("gridBlock.editTitle"):l("gridBlock.title"),content:t,buttons:[{id:"cancel",label:l("modal.cancel"),variant:"secondary"},{id:"confirm",label:l("gridBlock.insert"),variant:"primary"}]})).then(n=>{if("confirm"===n){const o=En(t);void 0!==e.nestingLevel&&(o.nestingLevel=e.nestingLevel);const r=Sn(o);return r.isValid?{action:n,...o}:Promise.reject(new Error(r.error))}return{action:n}})}function Nn(e,t){e&&"function"==typeof t&&e.addEventListener("click",e=>{const n=e.target.closest(".nge-grid-block-config-btn");if(n){e.preventDefault(),e.stopPropagation();const o=n.closest(".nge-grid-block");o&&t(o)}})}let Mn=null;function In(e={}){const t=document.createElement("div");t.className="nge-grid-context-menu",t.setAttribute("data-testid","nge-grid-context-menu");const n=[{action:"add-text-block",label:l("gridBlock.addTextBlock"),icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7V4h16v3"/><path d="M9 20h6"/><path d="M12 4v16"/></svg>',blockType:bn.TEXT},{action:"add-media-block",label:l("gridBlock.addMediaBlock"),icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>',blockType:bn.MEDIA}],o=e.nestingLevel<yn;return n.forEach(e=>{const n=document.createElement("button");n.className="nge-grid-context-menu-item",n.setAttribute("data-action",e.action),n.setAttribute("data-block-type",e.blockType),n.type="button";const r=document.createElement("span");r.className="nge-grid-context-menu-icon",r.innerHTML=e.icon,n.appendChild(r),n.appendChild(document.createTextNode(e.label)),!o&&(n.disabled=!0,n.title=l("gridBlock.maxNestingReached")),t.appendChild(n)}),t}function Rn(){Mn&&Mn.parentNode&&Mn.parentNode.removeChild(Mn),Mn=null}function qn(e,t={}){e&&e.addEventListener("contextmenu",n=>{if(n.target.closest(".nge-table, .nge-table-edit-wrapper, td, th, thead, tbody"))return;const o=function(e){let t=1,n=e?.closest(".nge-grid-block");for(;n;)t++,n=n.parentElement?.closest(".nge-grid-block");return Math.min(t,yn)}(n.target);n.preventDefault();const r=n.target.closest(".nge-grid-block-content")||e;let a=null;const i=window.getSelection();i.rangeCount>0&&(a=i.getRangeAt(0).cloneRange());const l=function(e,t,n={}){Rn(),Mn=In(n),document.body.appendChild(Mn);const o=Mn.getBoundingClientRect(),r=window.innerWidth,a=window.innerHeight;let i=e,l=t;return e+o.width>r&&(i=r-o.width-5),t+o.height>a&&(l=a-o.height-5),Mn.style.left=i+"px",Mn.style.top=l+"px",Mn}(n.clientX,n.clientY,{nestingLevel:o});l._insertionTarget=r,l._nestingLevel=o,l._savedRange=a;l.addEventListener("click",e=>{const n=e.target.closest(".nge-grid-context-menu-item");if(!n||n.disabled)return;const i=n.getAttribute("data-action");n.getAttribute("data-block-type"),Rn(),"add-text-block"===i&&"function"==typeof t.onAddTextBlock?t.onAddTextBlock(o,r,a):"add-media-block"===i&&"function"==typeof t.onAddMediaBlock&&t.onAddMediaBlock(o,r,a)});const s=e=>{Mn&&!Mn.contains(e.target)&&(Rn(),document.removeEventListener("click",s),document.removeEventListener("keydown",c))},c=e=>{"Escape"===e.key&&(Rn(),document.removeEventListener("click",s),document.removeEventListener("keydown",c))};setTimeout(()=>{document.addEventListener("click",s),document.addEventListener("keydown",c)},0)})}const Bn=12;function Dn(e=null){const t=document.createElement("div");return t.className="nge-grid-row",t.setAttribute("data-row-id",e||"row-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)),t.setAttribute("contenteditable","false"),t}function Hn(e){return parseInt(e.getAttribute("data-grid-start"),10)||1}function jn(e){return parseInt(e.getAttribute("data-grid-cols"),10)||12}function zn(e){return Hn(e)+jn(e)}function Fn(e,t,n,o=null){if(t<1||t>Bn)return!1;if(t+n-1>Bn)return!1;const r=function(e,t=null){const n=new Array(Bn).fill(!1);return e.querySelectorAll(":scope > .nge-grid-block").forEach(e=>{if(e===t)return;const o=Hn(e),r=zn(e);for(let e=o;e<r&&e<=Bn;e++)n[e-1]=!0}),n}(e,o);for(let e=t;e<t+n;e++)if(r[e-1])return!1;return!0}function On(e,t,n){if(!Fn(e,n,jn(t)))return!1;t.setAttribute("data-grid-start",n);const o=Array.from(e.querySelectorAll(":scope > .nge-grid-block"));let r=null;for(const e of o){if(Hn(e)>n){r=e;break}}return r?e.insertBefore(t,r):e.appendChild(t),!0}function Pn(e){const t=null!==e.querySelector(".nge-grid-row"),n=null!==e.querySelector(".nge-grid-block:not([data-grid-start])");return!t&&n}function Vn(e){const t=e.querySelectorAll(".nge-grid-block:not([data-grid-start])");if(0===t.length)return 0;let n=null,o=0,r=0;return t.forEach(e=>{const t=parseInt(e.getAttribute("data-grid-cols"),10)||12;(!n||o+t>Bn)&&(n=Dn(),e.parentNode.insertBefore(n,e),o=0);const a=o+1;e.setAttribute("data-grid-start",a),n.appendChild(e),o+=t,r++}),r}function Wn(e){const t=Array.from(e.children).filter(e=>e.classList.contains("nge-grid-block")&&!e.closest(".nge-grid-row"));if(0===t.length)return;let n=null,o=0;t.forEach(t=>{const r=parseInt(t.getAttribute("data-grid-cols"),10)||12,a=parseInt(t.getAttribute("data-grid-start"),10)||o+1;!(n&&a+r-1<=Bn&&o+r<=Bn)&&(n=Dn(),e.insertBefore(n,t),o=0),!t.hasAttribute("data-grid-start")&&t.setAttribute("data-grid-start",o+1),n.appendChild(t),o=zn(t)-1})}function Un(e){const t=e.querySelectorAll(".nge-grid-row");let n=0;return t.forEach(e=>{!(null!==e.querySelector(".nge-grid-block"))&&(e.remove(),n++)}),n}function _n(e){return e.closest(".nge-grid-row")}let Gn=null;function Jn(e){const t=e.parentElement?.classList.contains("nge-grid-row")?e.parentElement:null;if(t){const e=t.parentElement;return e?(e.classList.contains("nge-grid-block-content")||e.classList.contains("nge-content"),e):null}let n=e.parentElement;for(;n;){if(n.classList.contains("nge-grid-block-content"))return n;if(n.classList.contains("nge-content"))return n;n=n.parentElement}return null}function Zn(e){if(!e)return null;if(e.classList.contains("nge-content"))return null;if(e.classList.contains("nge-grid-block-content")){const t=e.closest(".nge-grid-block");if(!t)return null;const n=t.parentElement;if(!n||!n.classList.contains("nge-grid-row"))return null;const o=n.parentElement;if(o)return o}return null}function Xn(e){return!!e&&e.classList.contains("nge-grid-block-content")}function Kn(e,t,n,o,r){const a=document.createElement("div");a.className="nge-grid-placement-cell",a.setAttribute("data-col",e+1),a.setAttribute("data-row",n),t.occupied?(a.classList.add("nge-grid-placement-cell--occupied"),a.setAttribute("tabindex","0"),a.setAttribute("role","button"),a.setAttribute("data-insert-into","true"),a.setAttribute("data-block-start",t.blockStart),a.setAttribute("data-block-cols",t.blockCols),a.setAttribute("title",l("blockPlacement.insertIntoBlock")||"Block will be inserted at the end of this block")):r?(a.classList.add("nge-grid-placement-cell--available"),a.setAttribute("tabindex","0"),a.setAttribute("role","button"),a.setAttribute("aria-label",(l("blockPlacement.clickToPlace")||"Place here")+", column "+(e+1))):a.classList.add("nge-grid-placement-cell--insufficient");const i=document.createElement("span");return i.className="nge-grid-placement-cell-num",i.textContent=e+1,a.appendChild(i),a}function $n(e,t,n,o){const r=document.createElement("div");r.className="nge-grid-placement-row",r.setAttribute("data-row-index",t);const a=document.createElement("div");a.className="nge-grid-placement-row-label",a.textContent=(l("blockPlacement.rowLabel")||"Row")+" "+(t+1),r.appendChild(a);const i=e?function(e,t){const n=new Array(Bn).fill(null).map(()=>({occupied:!1,blockStart:null,blockCols:null}));return e?(e.querySelectorAll(":scope > .nge-grid-block").forEach(e=>{if(e===t)return;const o=parseInt(e.getAttribute("data-grid-start"),10)||1,r=parseInt(e.getAttribute("data-grid-cols"),10)||Bn;for(let e=o;e<o+r&&e<=Bn;e++)n[e-1]={occupied:!0,blockStart:o,blockCols:r}}),n):n}(e,o):new Array(Bn).fill(null).map(()=>({occupied:!1,blockStart:null,blockCols:null}));for(let e=0;e<Bn;e++){let o=!0;if(!i[e].occupied){for(let t=0;t<n&&e+t<Bn;t++)if(i[e+t].occupied){o=!1;break}e+n>Bn&&(o=!1)}const a=Kn(e,i[e],t,0,o);r.appendChild(a)}return r}function Yn(e,t,n){const o=document.createElement("div");o.className="nge-grid-placement-overlay",o.setAttribute("data-testid","nge-grid-placement-overlay");const r=document.createElement("div");r.className="nge-grid-placement-header";const a=document.createElement("div");a.className="nge-grid-placement-title",a.textContent=l("blockPlacement.title")||"Select position for block",r.appendChild(a);const i=document.createElement("button");if(i.type="button",i.className="nge-grid-placement-cancel",i.textContent=l("blockPlacement.cancel")||"Cancel",i.setAttribute("aria-label",l("blockPlacement.cancel")||"Cancel"),r.appendChild(i),o.appendChild(r),n){const e=function(){const e=document.createElement("div");e.className="nge-grid-placement-exit",e.setAttribute("data-action","exit-container"),e.setAttribute("tabindex","0"),e.setAttribute("role","button"),e.setAttribute("aria-label",l("blockPlacement.exitZoneLabel")||"Move block out of container");const t=document.createElement("span");t.className="nge-grid-placement-exit-icon",t.innerHTML="↑",e.appendChild(t);const n=document.createElement("span");return n.className="nge-grid-placement-exit-text",n.textContent=l("blockPlacement.exitZone")||"Click to move out of this container",e.appendChild(n),e}();o.appendChild(e)}const s=document.createElement("div");s.className="nge-grid-placement-grid";const c=jn(t),d=e.querySelectorAll(":scope > .nge-grid-row");d.forEach((e,n)=>{const o=$n(e,n,c,t);o.setAttribute("data-grid-row","existing"),s.appendChild(o)});const u=function(e,t){const n=document.createElement("div");n.className="nge-grid-placement-row nge-grid-placement-row--new",n.setAttribute("data-row-index",e),n.setAttribute("data-new-row","true");const o=document.createElement("div");o.className="nge-grid-placement-row-label",o.textContent=l("blockPlacement.newRow")||"+ New Row",n.appendChild(o);const r={occupied:!1,blockStart:null,blockCols:null};for(let o=0;o<Bn;o++){const a=Kn(o,r,e,0,o+t<=Bn);n.appendChild(a)}return n}(d.length,c);s.appendChild(u),o.appendChild(s);const g=document.createElement("div");return g.className="nge-grid-placement-footer",g.textContent=l("blockPlacement.instructions")||"Click a green cell to place the block, or press Escape to cancel",o.appendChild(g),o}function Qn(e,t,n={}){eo();const{onPlacementComplete:o,onPlacementCancel:r}=n,a=Yn(t,e,Xn(t));e.classList.add("nge-grid-block--moving"),t.style.position="relative",t.appendChild(a),Gn={active:!0,block:e,container:t,overlay:a,originalRow:_n(e),onPlacementComplete:o,onPlacementCancel:r},function(e,t,n,o){document.addEventListener("keydown",to);const r=e.querySelector(".nge-grid-placement-cancel");r&&r.addEventListener("click",()=>{eo(!0)});const a=e.querySelector(".nge-grid-placement-exit");a&&(a.addEventListener("click",()=>{no(t,n,o)}),a.addEventListener("keydown",e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),no(t,n,o))})),e.addEventListener("click",e=>{const r=e.target.closest(".nge-grid-placement-cell--occupied");if(r&&"true"===r.getAttribute("data-insert-into")){const e=parseInt(r.getAttribute("data-col"),10),a=parseInt(r.getAttribute("data-row"),10),i=n.querySelectorAll(":scope > .nge-grid-row")[a];if(i){const r=po(i,e,t);r&&bo(t,r,n)&&(eo(!1),o.onPlacementComplete&&o.onPlacementComplete(t,{type:"insert-into-block",targetBlock:r,container:n}))}return}const a=e.target.closest(".nge-grid-placement-cell--available");if(!a)return;const i=parseInt(a.getAttribute("data-col"),10),l=parseInt(a.getAttribute("data-row"),10),s=a.closest(".nge-grid-placement-row"),c="true"===s?.getAttribute("data-new-row");!function(e,t,n,o,r,a){jn(e);const i=Gn?.container;let l;if(r)l=Dn(),t.appendChild(l);else{l=t.querySelectorAll(":scope > .nge-grid-row")[o]}if(!l)return void console.error("Target row not found");e.setAttribute("data-grid-start",n),On(l,e,n),i&&Un(i),eo(!1),a.onPlacementComplete&&a.onPlacementComplete(e,{type:"cell",container:t,row:l,col:n,isNewRow:r})}(t,n,i,l,c,o)}),e.addEventListener("keydown",e=>{if("Enter"===e.key||" "===e.key){const t=e.target.closest(".nge-grid-placement-cell--available"),n=e.target.closest(".nge-grid-placement-cell--occupied");(t||n)&&(e.preventDefault(),(t||n).click())}});const i=jn(t);e.addEventListener("mouseover",e=>{const t=e.target.closest(".nge-grid-placement-cell--available");if(t){const e=parseInt(t.getAttribute("data-col"),10);return void function(e,t,n){if(!e)return;e.querySelectorAll(".nge-grid-placement-cell--preview").forEach(e=>{e.classList.remove("nge-grid-placement-cell--preview")});for(let o=t;o<t+n&&o<=Bn;o++){const t=e.querySelector('[data-col="'+o+'"]');t&&t.classList.contains("nge-grid-placement-cell--available")&&t.classList.add("nge-grid-placement-cell--preview")}}(t.closest(".nge-grid-placement-row"),e,i)}const n=e.target.closest(".nge-grid-placement-cell--occupied");if(n){const e=parseInt(n.getAttribute("data-block-start"),10),t=parseInt(n.getAttribute("data-block-cols"),10),o=n.closest(".nge-grid-placement-row");if(o&&e&&t)for(let n=e;n<e+t&&n<=Bn;n++){const e=o.querySelector('.nge-grid-placement-cell--occupied[data-col="'+n+'"]');e&&e.classList.add("nge-grid-placement-cell--block-hover")}}}),e.addEventListener("mouseout",t=>{if(t.target.closest(".nge-grid-placement-cell--available"))return void e.querySelectorAll(".nge-grid-placement-cell--preview").forEach(e=>{e.classList.remove("nge-grid-placement-cell--preview")});t.target.closest(".nge-grid-placement-cell--occupied")&&e.querySelectorAll(".nge-grid-placement-cell--block-hover").forEach(e=>{e.classList.remove("nge-grid-placement-cell--block-hover")})})}(a,e,t,n);const i=a.querySelector(".nge-grid-placement-cell--available");i&&i.focus()}function eo(e=!1){if(!Gn)return;const{block:t,container:n,overlay:o,onPlacementComplete:r,onPlacementCancel:a}=Gn;t&&t.classList.remove("nge-grid-block--moving"),o&&o.parentNode&&o.parentNode.removeChild(o),document.removeEventListener("keydown",to),e&&a&&a(),Gn=null}function to(e){"Escape"===e.key&&Gn&&eo(!0)}function no(e,t,n){const o=Zn(t);if(!o)return;const r=Gn?.container,a=t.closest(".nge-grid-block");if(!a)return;const i=_n(a),l=Dn();i?i.after(l):o.appendChild(l),e.setAttribute("data-grid-start",1),On(l,e,1),r&&Un(r),eo(!1),n.onPlacementComplete&&n.onPlacementComplete(e,{type:"exit-container",container:o,row:l,col:1})}function oo(e,t={}){if(!e)throw new Error("Container is required");const{onPlacementStart:n,onPlacementComplete:o,onPlacementCancel:r}=t;e.addEventListener("click",e=>{const t=e.target.closest(".nge-grid-block-drag-btn");if(!t)return;const a=t.closest(".nge-grid-block");if(!a)return;e.preventDefault(),e.stopPropagation();const i=Jn(a);i&&(n&&n(a),Qn(a,i,{onPlacementComplete:(e,t)=>{o&&o(e,t)},onPlacementCancel:()=>{r&&r()}}))})}let ro=null;function ao(e,t,n,o,r){const a=document.createElement("div");a.className="nge-config-grid-cell",a.setAttribute("data-col",e+1),a.setAttribute("data-row",n),t.occupied?(a.classList.add("nge-config-grid-cell--occupied"),a.setAttribute("tabindex","0"),a.setAttribute("role","button"),a.setAttribute("data-insert-into","true"),a.setAttribute("data-block-start",t.blockStart),a.setAttribute("data-block-cols",t.blockCols),a.setAttribute("title",l("blockPlacement.insertIntoBlock")||"Block will be inserted at the end of this block")):r?(a.classList.add("nge-config-grid-cell--available"),a.setAttribute("tabindex","0"),a.setAttribute("role","button"),a.setAttribute("aria-label",(l("blockPlacement.clickToPlace")||"Place here")+", column "+(e+1))):a.classList.add("nge-config-grid-cell--insufficient");const i=document.createElement("span");return i.className="nge-config-grid-cell-num",i.textContent=e+1,a.appendChild(i),a}function io(e,t,n,o,r){const a=document.createElement("div");a.className="nge-config-grid-row",a.setAttribute("data-row-index",t);const i=document.createElement("div");i.className="nge-config-grid-row-label";const s=document.createElement("button");s.type="button",s.className="nge-config-row-arrow nge-config-row-arrow--up",s.innerHTML="↑",s.setAttribute("data-action","move-row-up"),s.setAttribute("data-row-index",t),s.setAttribute("title",l("blockPlacement.moveRowUp")||"Move row up"),0===t&&(s.disabled=!0,s.classList.add("nge-config-row-arrow--disabled")),i.appendChild(s);const c=document.createElement("span");c.className="nge-config-grid-row-label-text",c.textContent=(l("blockPlacement.rowLabel")||"Row")+" "+(t+1),i.appendChild(c);const d=document.createElement("button");d.type="button",d.className="nge-config-row-arrow nge-config-row-arrow--down",d.innerHTML="↓",d.setAttribute("data-action","move-row-down"),d.setAttribute("data-row-index",t),d.setAttribute("title",l("blockPlacement.moveRowDown")||"Move row down"),t>=r-1&&(d.disabled=!0,d.classList.add("nge-config-row-arrow--disabled")),i.appendChild(d),a.appendChild(i);const u=function(e,t){const n=new Array(Bn).fill(null).map(()=>({occupied:!1,blockStart:null,blockCols:null}));return e?(e.querySelectorAll(":scope > .nge-grid-block").forEach(e=>{if(e===t)return;const o=parseInt(e.getAttribute("data-grid-start"),10)||1,r=parseInt(e.getAttribute("data-grid-cols"),10)||Bn;for(let e=o;e<o+r&&e<=Bn;e++)n[e-1]={occupied:!0,blockStart:o,blockCols:r}}),n):n}(e,o);for(let e=0;e<Bn;e++){let o=!0;if(!u[e].occupied){for(let t=0;t<n&&e+t<Bn;t++)if(u[e+t].occupied){o=!1;break}e+n>Bn&&(o=!1)}const r=ao(e,u[e],t,0,o);a.appendChild(r)}return a}function lo(e,t,n,o){const r=An(String(t));e.innerHTML="";const a=o.querySelectorAll(":scope > .nge-grid-row"),i=a.length;a.forEach((t,o)=>{const a=io(t,o,r,n,i);a.setAttribute("data-grid-row","existing"),e.appendChild(a)});const s=function(e,t){const n=document.createElement("div");n.className="nge-config-grid-row nge-config-grid-row--new",n.setAttribute("data-row-index",e),n.setAttribute("data-new-row","true");const o=document.createElement("div");o.className="nge-config-grid-row-label",o.textContent=l("blockPlacement.newRow")||"+ New Row",n.appendChild(o);const r={occupied:!1,blockStart:null,blockCols:null};for(let o=0;o<Bn;o++){const a=ao(o,r,e,0,o+t<=Bn);n.appendChild(a)}return n}(a.length,r);e.appendChild(s)}function so(e,t,n={top:0,right:0,bottom:0,left:0}){const o=wn[t]?.pixels||0,r=wn[n.top]?.pixels||0,a=wn[n.right]?.pixels||0,i=wn[n.bottom]?.pixels||0,s=wn[n.left]?.pixels||0,c=r>0||a>0||i>0||s>0,d=o>0,u=c?"background-color: rgba(249, 115, 22, 0.3); padding: "+r+"px "+a+"px "+i+"px "+s+"px;":"",g=d?"background-color: rgba(34, 197, 94, 0.3); padding: "+o+"px;":"",p=r+"/"+a+"/"+i+"/"+s;e.innerHTML='\n    <div class="nge-preview-margin" style="'+u+' border-radius: 4px;">\n      <div class="nge-preview-padding" style="'+g+' border-radius: 4px;">\n        <div class="nge-preview-content-inner" style="min-height: 30px; border: 2px dashed var(--nge-border-color, #dee2e6); border-radius: 2px; display: flex; align-items: center; justify-content: center; padding: 4px; background: rgba(255,255,255,0.9);">\n          <span style="opacity: 0.6; font-size: 11px;">Content</span>\n        </div>\n      </div>\n    </div>\n    <div style="display: flex; gap: 12px; margin-top: 8px; font-size: 11px; justify-content: center;">\n      '+(d?'<span style="display: flex; align-items: center; gap: 4px;"><span style="width: 10px; height: 10px; background: rgba(34, 197, 94, 0.5); border-radius: 2px;"></span>'+(l("gridBlock.padding")||"Padding")+": "+o+"px</span>":"")+"\n      "+(c?'<span style="display: flex; align-items: center; gap: 4px;"><span style="width: 10px; height: 10px; background: rgba(249, 115, 22, 0.5); border-radius: 2px;"></span>'+(l("gridBlock.margin")||"Margin")+": "+p+"px</span>":"")+"\n    </div>\n  "}function co(e,t,n){const o=document.createElement("div");o.className="nge-spacing-control",o.setAttribute("data-name",e);const r=document.createElement("button");r.type="button",r.className="nge-spacing-btn nge-spacing-btn-minus",r.textContent="−",r.setAttribute("aria-label",l("gridBlock.decreaseSpacing")||"Decrease");const a=document.createElement("div");a.className="nge-spacing-value";const i=document.createElement("div");i.className="nge-spacing-level-indicator";for(let e=1;e<=4;e++){const t=document.createElement("span");t.className="nge-spacing-level-bar",t.setAttribute("data-level",e.toString()),i.appendChild(t)}a.appendChild(i);const s=document.createElement("button");s.type="button",s.className="nge-spacing-btn nge-spacing-btn-plus",s.textContent="+",s.setAttribute("aria-label",l("gridBlock.increaseSpacing")||"Increase");const c=document.createElement("input");c.type="hidden",c.name=e,c.value=t.toString();const d=e=>{const t=parseInt(e,10);c.value=t.toString(),i.querySelectorAll(".nge-spacing-level-bar").forEach((e,n)=>{n<t?e.classList.add("nge-active"):e.classList.remove("nge-active")}),r.disabled=t<=0,s.disabled=t>=4};return r.addEventListener("click",()=>{const e=parseInt(c.value,10);e>0&&(d(e-1),n&&n())}),s.addEventListener("click",()=>{const e=parseInt(c.value,10);e<4&&(d(e+1),n&&n())}),o.appendChild(r),o.appendChild(a),o.appendChild(s),o.appendChild(c),d(t),o}function uo(e,t,n){const o=e.getAttribute("data-grid-width")||"100";parseInt(e.getAttribute("data-grid-start"),10);const r=parseInt(e.getAttribute("data-padding"),10)||0,a=e.getAttribute("data-bg-color")||"",i=e.getAttribute("data-bg-image")||"",s=parseFloat(e.getAttribute("data-bg-opacity"))||1,c=parseInt(e.getAttribute("data-margin-top"),10)||0,d=parseInt(e.getAttribute("data-margin-right"),10)||0,u=parseInt(e.getAttribute("data-margin-bottom"),10)||0,g=parseInt(e.getAttribute("data-margin-left"),10)||0;jn(e);const p=document.createElement("div");p.className="nge-config-modal-overlay",p.setAttribute("data-testid","nge-config-modal");const m=document.createElement("div");m.className="nge-config-modal";const h=document.createElement("div");h.className="nge-config-modal-header";const b=document.createElement("h3");b.className="nge-config-modal-title",b.textContent=l("blockConfig.title")||"Block Configuration",h.appendChild(b);const f=document.createElement("button");f.type="button",f.className="nge-config-modal-close",f.innerHTML="&times;",f.setAttribute("aria-label",l("modal.close")||"Close"),h.appendChild(f),m.appendChild(h);const v=document.createElement("div");v.className="nge-config-modal-body";const y=document.createElement("div");y.className="nge-config-section";const w=document.createElement("label");w.className="nge-config-section-label",w.textContent=l("blockConfig.width")||"Block Width:",y.appendChild(w);const C=document.createElement("div");var k;C.className="nge-config-width-selector",C.innerHTML=(k=o,Object.keys(fn).map(e=>'\n      <button\n        type="button"\n        class="nge-config-width-btn '+(e===k?"nge-selected":"")+'"\n        data-width="'+e+'"\n        data-testid="nge-width-btn-'+e+'"\n      >\n        '+fn[e].label+"\n      </button>\n    ").join("")),y.appendChild(C),v.appendChild(y);const x=document.createElement("div");x.className="nge-config-section";const E=document.createElement("label");E.className="nge-config-section-label",E.textContent=l("blockConfig.position")||"Position on Grid:",x.appendChild(E);const S=document.createElement("div");S.className="nge-config-grid-container",x.appendChild(S),v.appendChild(x);const A=document.createElement("div");A.className="nge-config-section nge-config-padding-section";const L=document.createElement("label");L.className="nge-config-section-label",L.textContent=l("gridBlock.padding")||"Padding:",A.appendChild(L);const T=function(e){const t=document.createElement("div");t.className="nge-config-padding-control",t.setAttribute("data-testid","nge-config-padding-control");const n=document.createElement("button");n.type="button",n.className="nge-spacing-btn nge-spacing-btn-minus",n.textContent="−",n.setAttribute("aria-label",l("gridBlock.decreaseSpacing")||"Decrease"),n.setAttribute("data-testid","nge-config-padding-minus");const o=document.createElement("div");o.className="nge-spacing-value";const r=document.createElement("div");r.className="nge-spacing-level-indicator";for(let e=1;e<=4;e++){const t=document.createElement("span");t.className="nge-spacing-level-bar",t.setAttribute("data-level",e.toString()),r.appendChild(t)}o.appendChild(r);const a=document.createElement("button");a.type="button",a.className="nge-spacing-btn nge-spacing-btn-plus",a.textContent="+",a.setAttribute("aria-label",l("gridBlock.increaseSpacing")||"Increase"),a.setAttribute("data-testid","nge-config-padding-plus");const i=document.createElement("input");i.type="hidden",i.name="padding",i.value=e.toString(),i.setAttribute("data-testid","nge-config-padding-value");const s=e=>{const o=parseInt(e,10);i.value=o.toString(),r.querySelectorAll(".nge-spacing-level-bar").forEach((e,t)=>{t<o?e.classList.add("nge-active"):e.classList.remove("nge-active")}),n.disabled=o<=0,a.disabled=o>=4;const l=t.closest(".nge-config-padding-section")?.querySelector(".nge-config-padding-preview");l&&so(l,o)};return n.addEventListener("click",()=>{const e=parseInt(i.value,10);e>0&&s(e-1)}),a.addEventListener("click",()=>{const e=parseInt(i.value,10);e<4&&s(e+1)}),t.appendChild(n),t.appendChild(o),t.appendChild(a),t.appendChild(i),s(e),t}(r);A.appendChild(T);const N=document.createElement("div");N.className="nge-config-padding-preview",N.setAttribute("data-testid","nge-config-padding-preview"),so(N,r,{top:c,right:d,bottom:u,left:g}),A.appendChild(N),v.appendChild(A);const M=document.createElement("div");M.className="nge-config-section nge-config-margin-section";const I=document.createElement("label");I.className="nge-config-section-label",I.textContent=l("gridBlock.margin")||"Margin:",M.appendChild(I);const R=function(e,t){const n=document.createElement("div");n.className="nge-config-margin-controls",n.setAttribute("data-testid","nge-config-margin-controls");const o=document.createElement("div");o.className="nge-margin-row nge-margin-row-top";const r=document.createElement("span");r.className="nge-margin-label",r.textContent=l("gridBlock.marginTop")||"Top";const a=co("marginTop",e.top||0,t);a.setAttribute("data-testid","nge-config-margin-top"),o.appendChild(r),o.appendChild(a);const i=document.createElement("div");i.className="nge-margin-row nge-margin-row-middle";const s=document.createElement("div");s.className="nge-margin-group";const c=document.createElement("span");c.className="nge-margin-label",c.textContent=l("gridBlock.marginLeft")||"Left";const d=co("marginLeft",e.left||0,t);d.setAttribute("data-testid","nge-config-margin-left"),s.appendChild(c),s.appendChild(d);const u=document.createElement("div");u.className="nge-margin-block-visual",u.textContent=l("gridBlock.blockLabel")||"Block";const g=document.createElement("div");g.className="nge-margin-group";const p=document.createElement("span");p.className="nge-margin-label",p.textContent=l("gridBlock.marginRight")||"Right";const m=co("marginRight",e.right||0,t);m.setAttribute("data-testid","nge-config-margin-right"),g.appendChild(p),g.appendChild(m),i.appendChild(s),i.appendChild(u),i.appendChild(g);const h=document.createElement("div");h.className="nge-margin-row nge-margin-row-bottom";const b=document.createElement("span");b.className="nge-margin-label",b.textContent=l("gridBlock.marginBottom")||"Bottom";const f=co("marginBottom",e.bottom||0,t);f.setAttribute("data-testid","nge-config-margin-bottom"),h.appendChild(b),h.appendChild(f),n.appendChild(o),n.appendChild(i),n.appendChild(h);const v=document.createElement("p");return v.className="nge-config-hint",v.textContent=l("gridBlock.marginHint")||"Margins reduce block space without affecting neighbors",n.appendChild(v),n}({top:c,right:d,bottom:u,left:g},()=>{const t=(()=>{const e=M.querySelector('[data-testid="nge-config-margin-top"] input[name="marginTop"]'),t=M.querySelector('[data-testid="nge-config-margin-right"] input[name="marginRight"]'),n=M.querySelector('[data-testid="nge-config-margin-bottom"] input[name="marginBottom"]'),o=M.querySelector('[data-testid="nge-config-margin-left"] input[name="marginLeft"]');return{top:parseInt(e?.value||"0",10),right:parseInt(t?.value||"0",10),bottom:parseInt(n?.value||"0",10),left:parseInt(o?.value||"0",10)}})();e.setAttribute("data-margin-top",t.top.toString()),e.setAttribute("data-margin-right",t.right.toString()),e.setAttribute("data-margin-bottom",t.bottom.toString()),e.setAttribute("data-margin-left",t.left.toString());const o=wn[t.top]?.pixels||0,r=wn[t.right]?.pixels||0,a=wn[t.bottom]?.pixels||0,i=wn[t.left]?.pixels||0;e.style.margin=o>0||r>0||a>0||i>0?o+"px "+r+"px "+a+"px "+i+"px":"";const l=T.querySelector('input[name="padding"]'),s=parseInt(l?.value||"0",10);so(N,s,t),n.onConfigChange&&n.onConfigChange(e,{marginTop:t.top,marginRight:t.right,marginBottom:t.bottom,marginLeft:t.left})});M.appendChild(R),v.appendChild(M);const q=document.createElement("div");q.className="nge-config-section nge-config-bgImage-section";const B=document.createElement("label");B.className="nge-config-section-label",B.setAttribute("for","nge-config-bg-image"),B.textContent=l("gridBlock.bgImage")||"Background Image:",q.appendChild(B);const D=document.createElement("div");D.className="nge-bg-image-input-container",D.setAttribute("data-testid","nge-config-bg-image-container");const H=document.createElement("input");H.type="text",H.id="nge-config-bg-image",H.className="nge-config-input",H.placeholder=l("gridBlock.bgImagePlaceholder")||"https://example.com/image.jpg",H.value=i,H.setAttribute("data-testid","nge-config-bg-image"),H.addEventListener("input",()=>{const t=H.value.trim();t?(e.style.setProperty("--bg-image","url('"+t+"')"),e.style.setProperty("--bg-opacity",s.toString()),e.setAttribute("data-bg-image",t)):(e.style.removeProperty("--bg-image"),e.style.removeProperty("--bg-opacity"),e.setAttribute("data-bg-image","")),n.onConfigChange&&n.onConfigChange(e,{bgImage:t})}),D.appendChild(H);const j=document.createElement("button");j.type="button",j.className="nge-clear-color-btn",j.textContent="✕",j.title=l("modal.clear")||"Clear",j.setAttribute("data-testid","nge-config-bg-image-clear"),j.addEventListener("click",()=>{H.value="",e.style.removeProperty("--bg-image"),e.style.removeProperty("--bg-opacity"),e.setAttribute("data-bg-image",""),e.setAttribute("data-bg-opacity","1"),n.onConfigChange&&n.onConfigChange(e,{bgImage:"",bgOpacity:1})}),D.appendChild(j),q.appendChild(D);const z=document.createElement("div");z.className="nge-bg-image-dropzone",z.setAttribute("data-testid","nge-config-bg-image-dropzone"),z.innerHTML='<span class="nge-dropzone-icon">📁</span><span class="nge-dropzone-text">'+(l("gridBlock.bgImageDropHint")||"Drop an image here or click to upload")+"</span>";const F=document.createElement("input");F.type="file",F.accept="image/*",F.style.display="none",F.setAttribute("data-testid","nge-config-bg-image-file"),z.addEventListener("click",()=>F.click()),F.addEventListener("change",t=>{const o=t.target.files[0];if(o&&o.type.startsWith("image/")){const t=new FileReader;t.onload=t=>{const o=t.target.result;H.value=o,e.style.setProperty("--bg-image","url('"+o+"')"),e.style.setProperty("--bg-opacity",s.toString()),e.setAttribute("data-bg-image",o),n.onConfigChange&&n.onConfigChange(e,{bgImage:o})},t.readAsDataURL(o)}}),z.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation(),z.classList.add("nge-dropzone-active")}),z.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),z.classList.remove("nge-dropzone-active")}),z.addEventListener("drop",t=>{t.preventDefault(),t.stopPropagation(),z.classList.remove("nge-dropzone-active");const o=t.dataTransfer.files[0];if(o&&o.type.startsWith("image/")){const t=new FileReader;t.onload=t=>{const o=t.target.result;H.value=o,e.style.setProperty("--bg-image","url('"+o+"')"),e.style.setProperty("--bg-opacity",s.toString()),e.setAttribute("data-bg-image",o),n.onConfigChange&&n.onConfigChange(e,{bgImage:o})},t.readAsDataURL(o)}}),q.appendChild(z),q.appendChild(F);const O=document.createElement("p");O.className="nge-config-hint",O.textContent=l("gridBlock.bgImageHint")||"Optional URL for a background image",q.appendChild(O),v.appendChild(q);const P=document.createElement("div");P.className="nge-config-section nge-config-opacity-section";const V=document.createElement("label");V.className="nge-config-section-label",V.textContent=l("gridBlock.bgOpacity")||"Image Opacity:",P.appendChild(V);const W=document.createElement("div");W.className="nge-opacity-container";const U=document.createElement("input");U.type="range",U.className="nge-opacity-slider",U.id="nge-config-bg-opacity",U.setAttribute("data-testid","nge-config-bg-opacity"),U.min="0",U.max="100",U.value=Math.round(100*s).toString();const _=document.createElement("span");_.className="nge-opacity-value",_.textContent=Math.round(100*s)+"%",U.addEventListener("input",()=>{const t=parseInt(U.value,10),o=t/100;_.textContent=t+"%",e.style.setProperty("--bg-opacity",o.toString()),e.setAttribute("data-bg-opacity",o.toString()),n.onConfigChange&&n.onConfigChange(e,{bgOpacity:o})}),W.appendChild(U),W.appendChild(_),P.appendChild(W),v.appendChild(P);const G=document.createElement("div");G.className="nge-config-section nge-config-bgColor-section";const J=document.createElement("label");J.className="nge-config-section-label",J.textContent=l("gridBlock.bgColor")||"Background Color:",G.appendChild(J);const Z=document.createElement("div");Z.className="nge-color-input-container",Z.setAttribute("data-testid","nge-config-bg-color-container");const X=Ce({id:"nge-config-bg-color",testId:"nge-config-bg-color",value:a||"#ffffff",onChange:()=>{const t=X.querySelector('input[type="hidden"]')?.value||X.querySelector('input[type="color"]')?.value||"";t&&(e.style.backgroundColor=t,e.setAttribute("data-bg-color",t)),n.onConfigChange&&n.onConfigChange(e,{bgColor:t})}});Z.appendChild(X);const K=document.createElement("button");K.type="button",K.className="nge-clear-color-btn",K.textContent="✕",K.title=l("modal.clear")||"Clear",K.setAttribute("data-testid","nge-config-bg-color-clear"),K.addEventListener("click",()=>{const t=X.querySelector('input[type="hidden"]')||X.querySelector('input[type="color"]');if(t){t.value="";const e=X.querySelector(".nge-restricted-color-preview"),n=X.querySelector(".nge-restricted-color-code");e&&(e.style.backgroundColor="transparent"),n&&(n.textContent=l("modal.none")||"None"),"color"===t.type&&(t.style.opacity="0.5")}e.style.backgroundColor="",e.setAttribute("data-bg-color",""),n.onConfigChange&&n.onConfigChange(e,{bgColor:""})}),Z.appendChild(K),G.appendChild(Z),v.appendChild(G);if(Xn(t)){const e=document.createElement("div");e.className="nge-config-exit-zone",e.setAttribute("data-action","exit-container"),e.setAttribute("tabindex","0"),e.setAttribute("role","button");const t=document.createElement("span");t.className="nge-config-exit-icon",t.innerHTML="↑",e.appendChild(t);const n=document.createElement("span");n.textContent=l("blockPlacement.exitZone")||"Move out of this container",e.appendChild(n),v.appendChild(e)}m.appendChild(v);const $=document.createElement("div");$.className="nge-config-modal-footer";const Y=document.createElement("button");Y.type="button",Y.className="nge-config-delete-btn",Y.setAttribute("data-testid","nge-config-delete-btn"),Y.textContent=l("blockConfig.delete")||"Delete Block",$.appendChild(Y);const Q=document.createElement("button");return Q.type="button",Q.className="nge-config-validate-btn",Q.textContent=l("modal.validate")||"Valider",$.appendChild(Q),m.appendChild($),p.appendChild(m),lo(S,parseInt(o,10),e,t),p}function go(e,t,n,o){e.querySelector(".nge-config-modal");const r=e.querySelector(".nge-config-grid-container");let a=parseInt(t.getAttribute("data-grid-width"),10)||100;e.addEventListener("click",t=>{t.target===e&&yo()});const i=e.querySelector(".nge-config-modal-close");i&&i.addEventListener("click",()=>{yo()});const l=e.querySelector(".nge-config-validate-btn");l&&l.addEventListener("click",()=>{yo()});const s=e=>{"Escape"===e.key&&yo()};document.addEventListener("keydown",s),ro.escapeHandler=s;const c=e.querySelector(".nge-config-width-selector");c&&c.addEventListener("click",e=>{const i=e.target.closest(".nge-config-width-btn");if(!i)return;const l=parseInt(i.getAttribute("data-width"),10);a=l,c.querySelectorAll(".nge-config-width-btn").forEach(e=>{e.classList.remove("nge-selected")}),i.classList.add("nge-selected");const s=An(String(l));t.setAttribute("data-grid-width",l),t.setAttribute("data-grid-cols",s),lo(r,l,t,n),o.onConfigChange&&o.onConfigChange(t,{width:l})});const d=e.querySelector(".nge-config-padding-control"),u=e.querySelector(".nge-config-padding-preview");if(d){const n=()=>{const n=d.querySelector('input[name="padding"]');if(n){const r=parseInt(n.value,10),a=wn[r]?.pixels||0;t.setAttribute("data-padding",r);const i=t.querySelector(".nge-grid-block-content");if(i&&(i.style.padding=a>0?a+"px":""),u){const t=e.querySelector(".nge-config-margin-section"),n={top:parseInt(t?.querySelector('[data-testid="nge-config-margin-top"] input[name="marginTop"]')?.value||"0",10),right:parseInt(t?.querySelector('[data-testid="nge-config-margin-right"] input[name="marginRight"]')?.value||"0",10),bottom:parseInt(t?.querySelector('[data-testid="nge-config-margin-bottom"] input[name="marginBottom"]')?.value||"0",10),left:parseInt(t?.querySelector('[data-testid="nge-config-margin-left"] input[name="marginLeft"]')?.value||"0",10)};so(u,r,n)}o.onConfigChange&&o.onConfigChange(t,{padding:r})}};d.addEventListener("click",e=>{e.target.closest(".nge-spacing-btn")&&setTimeout(n,0)})}r.addEventListener("click",e=>{const i=e.target.closest(".nge-config-row-arrow");if(i&&!i.disabled){e.preventDefault(),e.stopPropagation();const l=parseInt(i.getAttribute("data-row-index"),10),s="move-row-up"===i.getAttribute("data-action")?"up":"down";return void(function(e,t,n){const o=e.querySelectorAll(":scope > .nge-grid-row"),r=o.length;if("up"===n&&t<=0)return!1;if("down"===n&&t>=r-1)return!1;const a=o[t],i=o["up"===n?t-1:t+1];return!(!a||!i)&&("up"===n?e.insertBefore(a,i):i.nextSibling?e.insertBefore(a,i.nextSibling):e.appendChild(a),!0)}(n,l,s)&&(lo(r,a,t,n),o.onConfigChange&&o.onConfigChange(t,{type:"row-reorder",direction:s,rowIndex:l})))}if(e.target.closest(".nge-config-grid-cell--selected"))return void fo(r);const l=e.target.closest(".nge-config-grid-cell--occupied");if(l&&"true"===l.getAttribute("data-insert-into")){const e=parseInt(l.getAttribute("data-col"),10),i=parseInt(l.getAttribute("data-row"),10),s=n.querySelectorAll(":scope > .nge-grid-row")[i];if(s){const i=po(s,e,t);i&&bo(t,i,n)&&(lo(r,a,t,n),yo(),o.onConfigChange&&o.onConfigChange(t,{type:"insert-into-block",targetBlock:i,container:n}))}return}const s=e.target.closest(".nge-config-grid-cell--available");if(!s)return;const c=parseInt(s.getAttribute("data-col"),10),d=parseInt(s.getAttribute("data-row"),10),u=s.closest(".nge-config-grid-row"),g="true"===u?.getAttribute("data-new-row");!function(e,t,n,o,r,a,i){let l;if(r)l=Dn(),t.appendChild(l);else{l=t.querySelectorAll(":scope > .nge-grid-row")[o]}if(!l)return void console.error("Target row not found");e.setAttribute("data-grid-start",n),On(l,e,n),Un(t);const s=parseInt(e.getAttribute("data-grid-width"),10)||100;lo(i,s,e,t),function(e,t,n){fo(e);const o=parseInt(t.getAttribute("data-grid-start"),10)||1,r=parseInt(t.getAttribute("data-grid-cols"),10)||Bn,a=t.closest(".nge-grid-row");if(!a)return;const i=n.querySelectorAll(":scope > .nge-grid-row");let l=-1;if(i.forEach((e,t)=>{e===a&&(l=t)}),l<0)return;const s=e.querySelector('[data-row-index="'+l+'"]');if(!s)return;for(let e=o;e<o+r&&e<=Bn;e++){const t=s.querySelector('[data-col="'+e+'"]');t&&t.classList.add("nge-config-grid-cell--selected")}}(i,e,t),a.onConfigChange&&a.onConfigChange(e,{type:"position",container:t,row:l,col:n,isNewRow:r})}(t,n,c,d,g,o,r)}),r.addEventListener("keydown",e=>{if("Enter"===e.key||" "===e.key){const t=e.target.closest(".nge-config-grid-cell--available");t&&(e.preventDefault(),t.click())}}),r.addEventListener("mouseover",e=>{const t=e.target.closest(".nge-config-grid-cell--available");if(t){const e=parseInt(t.getAttribute("data-col"),10);return void function(e,t,n){if(!e)return;e.querySelectorAll(".nge-config-grid-cell--preview").forEach(e=>{e.classList.remove("nge-config-grid-cell--preview")});for(let o=t;o<t+n&&o<=Bn;o++){const t=e.querySelector('[data-col="'+o+'"]');t&&(t.classList.contains("nge-config-grid-cell--available")||t.classList.contains("nge-config-grid-cell--insufficient"))&&t.classList.add("nge-config-grid-cell--preview")}}(t.closest(".nge-config-grid-row"),e,An(String(a)))}const n=e.target.closest(".nge-config-grid-cell--occupied");if(n){const e=parseInt(n.getAttribute("data-block-start"),10),t=parseInt(n.getAttribute("data-block-cols"),10),o=n.closest(".nge-config-grid-row");if(o&&e&&t)for(let n=e;n<e+t&&n<=Bn;n++){const e=o.querySelector('.nge-config-grid-cell--occupied[data-col="'+n+'"]');e&&e.classList.add("nge-config-grid-cell--block-hover")}}}),r.addEventListener("mouseout",e=>{if(e.target.closest(".nge-config-grid-cell--available"))return void r.querySelectorAll(".nge-config-grid-cell--preview").forEach(e=>{e.classList.remove("nge-config-grid-cell--preview")});e.target.closest(".nge-config-grid-cell--occupied")&&r.querySelectorAll(".nge-config-grid-cell--block-hover").forEach(e=>{e.classList.remove("nge-config-grid-cell--block-hover")})});const g=e.querySelector(".nge-config-exit-zone");g&&(g.addEventListener("click",()=>{vo(t,n,o)}),g.addEventListener("keydown",e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),vo(t,n,o))}));const p=e.querySelector(".nge-config-delete-btn");p&&p.addEventListener("click",()=>{!function(e,t,n){const o=e.closest(".nge-grid-row");e.remove(),o&&0===o.querySelectorAll(".nge-grid-block").length&&o.remove(),yo(),n.onDelete&&n.onDelete(e)}(t,0,o)})}function po(e,t,n){if(!e)return null;const o=e.querySelectorAll(":scope > .nge-grid-block");for(const e of o){if(e===n)continue;const o=parseInt(e.getAttribute("data-grid-start"),10)||1,r=parseInt(e.getAttribute("data-grid-cols"),10)||Bn;if(t>=o&&t<o+r)return e}return null}function mo(e,t){const n=document.createElement("div");n.className="nge-grid-block nge-grid-block-visible",n.setAttribute("data-block-type",e),n.setAttribute("data-grid-cols",Bn),n.setAttribute("data-grid-start",1),n.setAttribute("data-grid-width","100"),n.setAttribute("data-nesting-level","1"),n.setAttribute("contenteditable","false");const o=document.createElement("div");o.className="nge-grid-block-content",o.setAttribute("contenteditable","true"),t&&o.appendChild(t),n.appendChild(o);const r=document.createElement("div");r.className="nge-grid-block-buttons";const a=document.createElement("button");return a.className="nge-grid-block-config-btn",a.setAttribute("type","button"),a.setAttribute("data-testid","nge-block-config-btn"),a.innerHTML="⚙",r.appendChild(a),n.appendChild(r),n}function ho(e){if(!e)return[];const t=[];e.querySelectorAll(":scope > .nge-image-wrapper, :scope > p > .nge-image-wrapper").forEach(e=>t.push({type:"media",element:e}));return e.querySelectorAll(":scope > .nge-video-wrapper, :scope > p > .nge-video-wrapper").forEach(e=>t.push({type:"media",element:e})),t}function bo(e,t,n){if(!e||!t)return!1;let o=t.querySelector(".nge-grid-block-content");if(!o)return!1;const r=t.getAttribute("data-block-type");if(!o.querySelector(".nge-grid-row, .nge-grid-block"))if("media"===r){const e=ho(o);if(e.length>0){const t=o.innerHTML,n=document.createElement("div");n.innerHTML=t,n.querySelectorAll(".nge-image-wrapper, .nge-video-wrapper").forEach(e=>e.remove());const r=n.textContent.trim().length>0;o.innerHTML="";const a=Dn();if(o.appendChild(a),e.forEach(e=>{const t=mo("media",e.element.cloneNode(!0));t.setAttribute("data-grid-start",1),On(a,t,1)}),r){const e=Dn();o.appendChild(e);const t=mo("text",null);t.querySelector(".nge-grid-block-content").innerHTML=n.innerHTML,t.setAttribute("data-grid-start",1),On(e,t,1)}}}else if("text"===r){const e=o.innerHTML;if(o.textContent.trim().length>0||o.querySelector("img, .nge-image-wrapper, .nge-video-wrapper")){const t=ho(o);o.innerHTML="";const n=Dn();if(o.appendChild(n),t.length>0){const r=document.createElement("div");if(r.innerHTML=e,r.querySelectorAll(".nge-image-wrapper, .nge-video-wrapper").forEach(e=>e.remove()),r.textContent.trim().length>0){const e=mo("text",null);e.querySelector(".nge-grid-block-content").innerHTML=r.innerHTML,e.setAttribute("data-grid-start",1),On(n,e,1);const a=Dn();o.appendChild(a),t.forEach(e=>{const t=mo("media",e.element.cloneNode(!0));t.setAttribute("data-grid-start",1),On(a,t,1)})}else t.forEach(e=>{const t=mo("media",e.element.cloneNode(!0));t.setAttribute("data-grid-start",1),On(n,t,1)})}else{const t=mo("text",null);t.querySelector(".nge-grid-block-content").innerHTML=e,t.setAttribute("data-grid-start",1),On(n,t,1)}}}const a=Dn();o.appendChild(a),e.setAttribute("data-grid-start",1),On(a,e,1);const i=e.querySelector(":scope > .nge-grid-block-content");return i&&i.setAttribute("contenteditable","true"),n&&Un(n),!0}function fo(e){e.querySelectorAll(".nge-config-grid-cell--selected").forEach(e=>{e.classList.remove("nge-config-grid-cell--selected")})}function vo(e,t,n){const o=Zn(t);if(!o)return;const r=t.closest(".nge-grid-block");if(!r)return;const a=_n(r),i=Dn();a?a.after(i):o.appendChild(i),e.setAttribute("data-grid-start",1),On(i,e,1),Un(t),yo(),n.onConfigChange&&n.onConfigChange(e,{type:"exit-container",container:o,row:i,col:1})}function yo(){if(!ro)return;const{overlay:e,escapeHandler:t}=ro;t&&document.removeEventListener("keydown",t),e&&e.parentNode&&e.parentNode.removeChild(e),ro=null}let wo={overlayElement:null,rows:[],selectedCell:null};function Co(e,t,n){const o=document.createElement("div");return o.className="nge-grid-overlay-cell",o.setAttribute("data-col",e+1),o.setAttribute("data-row",n),o.setAttribute("data-occupied",t.occupied?"true":"false"),t.occupied?(o.classList.add("nge-grid-overlay-cell--occupied"),o.setAttribute("data-insert-into","true"),o.setAttribute("data-block-start",t.blockStart),o.setAttribute("data-block-cols",t.blockCols),o.setAttribute("title",l("blockPlacement.insertIntoBlock")||"Block will be inserted at the end of this block")):o.classList.add("nge-grid-overlay-cell--available"),o}function ko(e,t,n,o=null){const r=document.createElement("div");r.className="nge-grid-overlay-row",r.setAttribute("data-row-index",t);const a=function(e,t){const n=new Array(Bn).fill(null).map(()=>({occupied:!1,blockStart:null,blockCols:null}));return e?(e.querySelectorAll(":scope > .nge-grid-block").forEach(e=>{if(e===t)return;const o=parseInt(e.getAttribute("data-grid-start"),10)||1,r=parseInt(e.getAttribute("data-grid-cols"),10)||Bn;for(let e=o;e<o+r&&e<=Bn;e++)n[e-1]={occupied:!0,blockStart:o,blockCols:r}}),n):n}(e,o);for(let e=0;e<Bn;e++){const o=Co(e,a[e],t);if(!a[e].occupied){let t=!0;for(let o=0;o<n&&e+o<Bn;o++)if(a[e+o].occupied){t=!1;break}(!t||e+n>Bn)&&(o.classList.add("nge-grid-overlay-cell--insufficient"),o.classList.remove("nge-grid-overlay-cell--available"))}r.appendChild(o)}return r}function xo(e,t={}){Eo();const{requiredCols:n=1,mode:o="insert",onCellSelect:r=null,excludeBlock:a=null}=t,i=function(){const e=document.createElement("div");return e.className="nge-grid-overlay",e.setAttribute("data-testid","nge-grid-overlay"),e}(),s=e.querySelectorAll(":scope > .nge-grid-row"),c=[];s.forEach((e,t)=>{const o=function(e){const t=document.createElement("div");t.className="nge-grid-overlay-insert-zone",t.setAttribute("data-insert-before",e),t.setAttribute("data-new-row","true");const n=document.createElement("span");return n.className="nge-grid-overlay-insert-hint",n.textContent=l("gridBlock.insertRowHere")||"Insérer une ligne ici",t.appendChild(n),t.setAttribute("data-row",e),t}(t);i.appendChild(o),c.push({overlayRow:o,gridRow:null,index:t,isInsertZone:!0,insertBefore:t});const r=ko(e,t,n,a);i.appendChild(r),c.push({overlayRow:r,gridRow:e,index:t})});const d=s.length,u=function(e,t){const n=document.createElement("div");n.className="nge-grid-overlay-row nge-grid-overlay-row--new",n.setAttribute("data-row-index",e),n.setAttribute("data-new-row","true");const o=document.createElement("div");o.className="nge-grid-overlay-new-row-label",o.textContent=l("gridBlock.newRow"),n.appendChild(o);const r={occupied:!1,blockStart:null,blockCols:null};for(let o=0;o<Bn;o++){const a=Co(o,r,e);o+t>Bn&&(a.classList.add("nge-grid-overlay-cell--insufficient"),a.classList.remove("nge-grid-overlay-cell--available")),n.appendChild(a)}return n}(d,n);return i.appendChild(u),c.push({overlayRow:u,gridRow:null,index:d,isNew:!0}),e.style.position="relative",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.right="0",i.style.minHeight="100%",i.style.pointerEvents="auto",p=r,m=n,(g=i).addEventListener("click",e=>{const t=e.target.closest(".nge-grid-overlay-insert-zone");if(t){const e=parseInt(t.getAttribute("data-insert-before"),10);return Ao(),t.classList.add("nge-grid-overlay-insert-zone--selected"),wo.selectedCell={row:e,col:1,isNewRow:!0,insertBefore:e},void(p&&p({row:e,col:1,span:m,isNewRow:!0,insertBefore:e,gridRow:null}))}const n=e.target.closest(".nge-grid-overlay-cell");if(!n)return;if(n.classList.contains("nge-grid-overlay-cell--insufficient"))return;const o=parseInt(n.getAttribute("data-col"),10),r=parseInt(n.getAttribute("data-row"),10),a=n.closest(".nge-grid-overlay-row"),i=a&&"true"===a.getAttribute("data-new-row");if(n.classList.contains("nge-grid-overlay-cell--occupied")&&"true"===n.getAttribute("data-insert-into")){Ao();const e=parseInt(n.getAttribute("data-block-start"),10),t=parseInt(n.getAttribute("data-block-cols"),10);if(a&&e&&t)for(let n=e;n<e+t&&n<=Bn;n++){const e=a.querySelector('.nge-grid-overlay-cell--occupied[data-col="'+n+'"]');e&&e.classList.add("nge-grid-overlay-cell--selected")}if(wo.selectedCell={row:r,col:o,isNewRow:!1,insertIntoBlock:!0},p){const n=wo.rows.find(e=>!e.isInsertZone&&e.index===r)?.gridRow;p({row:r,col:o,span:m,isNewRow:!1,gridRow:n,insertIntoBlock:!0,blockStart:e,blockCols:t})}return}Ao(),function(e,t,n){if(!wo.overlayElement)return;wo.overlayElement.querySelectorAll(".nge-grid-overlay-cell--selected").forEach(e=>{e.classList.remove("nge-grid-overlay-cell--selected")});const o=wo.overlayElement.querySelector('[data-row-index="'+e+'"]');if(o)for(let e=t;e<t+n&&e<=Bn;e++){const t=o.querySelector('[data-col="'+e+'"]');t&&!t.classList.contains("nge-grid-overlay-cell--occupied")&&t.classList.add("nge-grid-overlay-cell--selected")}}(r,o,m),wo.selectedCell={row:r,col:o,isNewRow:i},p&&p({row:r,col:o,span:m,isNewRow:i,gridRow:i?null:wo.rows.find(e=>!e.isInsertZone&&e.index===r)?.gridRow})}),g.addEventListener("mouseover",e=>{const t=e.target.closest(".nge-grid-overlay-cell");if(!t)return;if(t.classList.contains("nge-grid-overlay-cell--insufficient"))return;const n=parseInt(t.getAttribute("data-col"),10),o=parseInt(t.getAttribute("data-row"),10);if(t.classList.contains("nge-grid-overlay-cell--occupied")){const e=parseInt(t.getAttribute("data-block-start"),10),n=parseInt(t.getAttribute("data-block-cols"),10),o=t.closest(".nge-grid-overlay-row");if(o&&e&&n)for(let t=e;t<e+n&&t<=Bn;t++){const e=o.querySelector('.nge-grid-overlay-cell--occupied[data-col="'+t+'"]');e&&e.classList.add("nge-grid-overlay-cell--block-hover")}return}!function(e,t,n){if(!wo.overlayElement)return;So();const o=wo.overlayElement.querySelector('[data-row-index="'+e+'"]');if(o)for(let e=t;e<t+n&&e<=Bn;e++){const t=o.querySelector('[data-col="'+e+'"]');t&&!t.classList.contains("nge-grid-overlay-cell--occupied")&&t.classList.add("nge-grid-overlay-cell--preview")}}(o,n,m)}),g.addEventListener("mouseout",e=>{const t=e.target.closest(".nge-grid-overlay-cell");t&&(t.classList.contains("nge-grid-overlay-cell--occupied")?g.querySelectorAll(".nge-grid-overlay-cell--block-hover").forEach(e=>{e.classList.remove("nge-grid-overlay-cell--block-hover")}):So())}),e.appendChild(i),wo={active:!0,container:e,overlayElement:i,rows:c,selectedCell:null,onCellSelect:r,requiredCols:n,mode:o},i;var g,p,m}function Eo(){wo.overlayElement&&wo.overlayElement.parentNode&&wo.overlayElement.parentNode.removeChild(wo.overlayElement),wo={active:!1,container:null,overlayElement:null,rows:[],selectedCell:null,onCellSelect:null,requiredCols:1,mode:"insert"}}function So(){wo.overlayElement&&wo.overlayElement.querySelectorAll(".nge-grid-overlay-cell--preview").forEach(e=>{e.classList.remove("nge-grid-overlay-cell--preview")})}function Ao(){wo.overlayElement&&(wo.overlayElement.querySelectorAll(".nge-grid-overlay-cell--selected").forEach(e=>{e.classList.remove("nge-grid-overlay-cell--selected")}),wo.selectedCell=null)}let Lo=null,To=null;function No(){return Lo||{smileys:{name:"Smileys & Émotions",icon:"😀",emojis:["😀","😃","😄","😁","😊","🙂","😉","😍","🥰","😘","😂","🤣","😢","😭","😡","🤔","👍","👎","❤️","💯"]},people:{name:"Personnes & Corps",icon:"👋",emojis:["👋","👍","👎","👏","🙌","🤝","🙏","💪","👀","🗣️"]},symbols:{name:"Symboles",icon:"❤️",emojis:["❤️","💛","💚","💙","💜","✅","❌","⭐","🔥","💯"]}}}new Proxy({},{get:(e,t)=>No()[t],ownKeys(){const e=No();return Object.keys(e)},getOwnPropertyDescriptor(e,t){const n=No();if(t in n)return{enumerable:!0,configurable:!0,value:n[t]}},has:(e,t)=>t in No()});const Mo="nge-emoji-usage";function Io(){try{const e=localStorage.getItem(Mo);return e?JSON.parse(e):{}}catch{return{}}}function Ro(e){const t=document.createElement("div");t.className="nge-emoji-picker",t.setAttribute("data-testid","nge-emoji-picker");const n=document.createElement("div");n.className="nge-emoji-search-container";const o=document.createElement("input");o.type="text",o.className="nge-emoji-search",o.placeholder=l("emoji.search"),o.setAttribute("data-testid","nge-emoji-search"),n.appendChild(o),t.appendChild(n);const r=document.createElement("div");r.className="nge-emoji-tabs",r.setAttribute("data-testid","nge-emoji-tabs");const a=document.createElement("button");a.type="button",a.className="nge-emoji-tab nge-emoji-tab-active",a.setAttribute("data-category","most-used"),a.setAttribute("title",l("emoji.mostUsed")),a.textContent="⏱️",r.appendChild(a);const i=e=>{r.querySelectorAll('.nge-emoji-tab:not([data-category="most-used"])').forEach(e=>e.remove()),Object.entries(e).forEach(([e,t])=>{const n=document.createElement("button");n.type="button",n.className="nge-emoji-tab",n.setAttribute("data-category",e),n.setAttribute("title",t.name),n.textContent=t.icon,r.appendChild(n)})},s=No();i(s),t.appendChild(r);const c=document.createElement("div");c.className="nge-emoji-grid-container",c.setAttribute("data-testid","nge-emoji-grid"),t.appendChild(c);const d=(t,n=null)=>{if(c.innerHTML="",n){const e=document.createElement("div");e.className="nge-emoji-category-title",e.textContent=n,c.appendChild(e)}if(0===t.length){const e=document.createElement("div");return e.className="nge-emoji-empty",e.textContent=n===l("emoji.mostUsed")?l("emoji.noRecentEmoji"):l("emoji.noResults"),void c.appendChild(e)}const o=document.createElement("div");o.className="nge-emoji-grid",t.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="nge-emoji-button",n.textContent=t,n.setAttribute("data-emoji",t),n.addEventListener("click",()=>{!function(e){try{const t=Io();t[e]=(t[e]||0)+1,localStorage.setItem(Mo,JSON.stringify(t))}catch{}}(t),e&&e(t)}),o.appendChild(n)}),c.appendChild(o)},u=e=>{if(r.querySelectorAll(".nge-emoji-tab").forEach(t=>{t.classList.toggle("nge-emoji-tab-active",t.getAttribute("data-category")===e)}),"most-used"===e){const e=function(){const e=Io();return Object.entries(e).sort((e,t)=>t[1]-e[1]).slice(0,10).map(([e])=>e)}();d(e,l("emoji.mostUsed"))}else{const t=No()[e];t&&d(t.emojis,t.name)}};return r.addEventListener("click",e=>{const t=e.target.closest(".nge-emoji-tab");if(t){const e=t.getAttribute("data-category");u(e),o.value=""}}),o.addEventListener("input",()=>{const e=o.value.toLowerCase().trim();if(!e)return void u("most-used");const t=[],n=No();Object.values(n).forEach(e=>{e.emojis.forEach(e=>{!t.includes(e)&&t.push(e)})});let a=[];Object.entries({sourire:["😀","😃","😄","😁","😊","🙂"],rire:["😂","🤣","😆","😅"],coeur:["❤️","🧡","💛","💚","💙","💜","🖤","🤍","💕","💖","💗","💘","💝"],triste:["😢","😭","😞","😔","🙁","☹️"],colere:["😠","😡","🤬","😤"],peur:["😨","😰","😱","😧"],bisou:["😘","😗","😙","😚","💋"],main:["👋","🤚","🖐️","✋","👌","✌️","🤞","👍","👎","👏","🙌"],soleil:["☀️","🌞","🌅","🌄"],lune:["🌙","🌛","🌜","🌝","🌚"],etoile:["⭐","🌟","✨","💫"],feu:["🔥","🧯"],eau:["💧","💦","🌊"],fleur:["🌸","💐","🌹","🌺","🌻","🌼","🌷"],animal:["🐶","🐱","🐭","🐹","🐰","🐻","🐼","🐨","🐯","🦁"],chien:["🐶","🐕","🦮","🐩"],chat:["🐱","🐈","😺","😸"],pizza:["🍕"],burger:["🍔"],cafe:["☕","🍵"],gateau:["🎂","🍰","🧁"],fete:["🎉","🎊","🥳","🎈","🎁"],musique:["🎵","🎶","🎤","🎧","🎸","🎹","🎷","🎺"],sport:["⚽","🏀","🏈","⚾","🎾","🏐"],voiture:["🚗","🚕","🚙","🏎️"],avion:["✈️","🛫","🛬","🛩️"],telephone:["📱","📲","☎️","📞"],ordinateur:["💻","🖥️","⌨️"],argent:["💰","💵","💴","💶","💷","💳"],temps:["⏰","⏱️","⌚","🕐"],ok:["👌","✅","👍","🆗"],non:["❌","🚫","⛔","👎"],question:["❓","❔","🤔"],exclamation:["❗","❕","‼️","⁉️"],france:["🇫🇷"],usa:["🇺🇸"],espagne:["🇪🇸"],italie:["🇮🇹"],allemagne:["🇩🇪"],japon:["🇯🇵"],chine:["🇨🇳"],royaume:["🇬🇧"],angleterre:["🇬🇧"],belgique:["🇧🇪"],suisse:["🇨🇭"],canada:["🇨🇦"]}).forEach(([t,n])=>{(t.includes(e)||e.includes(t))&&n.forEach(e=>{!a.includes(e)&&a.push(e)})}),0===a.length&&e.length>0&&(a=t.slice(0,50)),r.querySelectorAll(".nge-emoji-tab").forEach(e=>{e.classList.remove("nge-emoji-tab-active")}),d(a,l("emoji.resultsFor")+' "'+e+'"')}),u("most-used"),async function(){return Lo||To||(To=(async()=>{try{const e=await fetch("data/emojis.json");if(!e.ok)throw new Error("Failed to load emoji data: "+e.status);return Lo=await e.json(),Lo}catch(e){return console.warn("Failed to load emoji data, using fallback:",e.message),Lo={smileys:{name:"Smileys & Émotions",icon:"😀",emojis:["😀","😃","😄","😁","😊","🙂","😉","😍","🥰","😘","😂","🤣","😢","😭","😡","🤔","👍","👎","❤️","💯"]},people:{name:"Personnes & Corps",icon:"👋",emojis:["👋","👍","👎","👏","🙌","🤝","🙏","💪","👀","🗣️"]},symbols:{name:"Symboles",icon:"❤️",emojis:["❤️","💛","💚","💙","💜","✅","❌","⭐","🔥","💯"]}},Lo}finally{To=null}})(),To)}().then(e=>{i(e)}),t}function qo(e){if(!e||"transparent"===e||"inherit"===e||"initial"===e)return null;if(e.startsWith("#"))return 4===e.length?"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]:e.toLowerCase();const t=e.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*[\d.]+)?\s*\)/i);if(t){return"#"+((1<<24)+(parseInt(t[1],10)<<16)+(parseInt(t[2],10)<<8)+parseInt(t[3],10)).toString(16).slice(1).toLowerCase()}try{const t=document.createElement("canvas");t.width=1,t.height=1;const n=t.getContext("2d");if(!n)return Bo(e);n.fillStyle=e,n.fillRect(0,0,1,1);const o=n.getImageData(0,0,1,1).data;return"#"+((1<<24)+(o[0]<<16)+(o[1]<<8)+o[2]).toString(16).slice(1).toLowerCase()}catch{return Bo(e)}}function Bo(e){return{red:"#ff0000",green:"#008000",blue:"#0000ff",white:"#ffffff",black:"#000000",yellow:"#ffff00",cyan:"#00ffff",magenta:"#ff00ff",orange:"#ffa500",purple:"#800080",pink:"#ffc0cb",gray:"#808080",grey:"#808080",lime:"#00ff00",navy:"#000080",teal:"#008080",maroon:"#800000",olive:"#808000",silver:"#c0c0c0",aqua:"#00ffff",fuchsia:"#ff00ff"}[e.toLowerCase()]||null}function Do(e){if(!e||!e.startsWith("#"))return null;const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function Ho(e,t){const n=Do(e),o=Do(t);return n&&o?Math.sqrt(Math.pow(n.r-o.r,2)+Math.pow(n.g-o.g,2)+Math.pow(n.b-o.b,2)):1/0}function jo(e,t=30){const n=Do(e);if(!n)return!0;if(Math.max(Math.abs(n.r-n.g),Math.abs(n.g-n.b),Math.abs(n.r-n.b))<15){const t=function(e){const t=Do(e);return t?(299*t.r+587*t.g+114*t.b)/1e3:128}(e);if(t<20||t>235)return!0}return!1}function zo(e,t,n){e/=255,t/=255,n/=255;const o=Math.max(e,t,n),r=Math.min(e,t,n);let a=0;if(o!==r){const i=o-r;switch(o){case e:a=((t-n)/i+(t<n?6:0))/6;break;case t:a=((n-e)/i+2)/6;break;case n:a=((e-t)/i+4)/6}}return 360*a}function Fo(e={}){const{maxColors:t=10,similarityThreshold:n=40,includeGrays:o=!1,sortByHue:r=!0}=e;let a=[...function(){const e=[];try{const t=getComputedStyle(document.documentElement),n=[/color/i,/primary/i,/secondary/i,/accent/i,/brand/i,/background/i,/bg/i,/text/i,/link/i,/border/i,/hover/i,/active/i,/success/i,/error/i,/warning/i,/info/i,/danger/i],o=[];for(const e of document.styleSheets)try{for(const t of e.cssRules)if(":root"===t.selectorText||"html"===t.selectorText){const e=t.cssText.matchAll(/--([a-zA-Z0-9-_]+)\s*:\s*([^;]+)/g);for(const t of e)o.push({name:t[1],value:t[2].trim()})}}catch{}for(const t of o)if(n.some(e=>e.test(t.name))){const n=qo(t.value);n&&!jo(n)&&e.push(n)}const r=["--primary-color","--primary","--color-primary","--secondary-color","--secondary","--color-secondary","--accent-color","--accent","--color-accent","--brand-color","--brand","--color-brand","--link-color","--color-link","--text-color","--color-text","--heading-color","--color-heading","--border-color","--color-border","--success","--error","--warning","--info","--bs-primary","--bs-secondary","--bs-success","--bs-danger","--bs-warning","--bs-info","--wp--preset--color--primary","--wp--preset--color--secondary"];for(const n of r){const o=t.getPropertyValue(n).trim();if(o){const t=qo(o);t&&!jo(t)&&e.push(t)}}}catch{}return e}(),...function(){const e=["header","nav","footer","h1","h2","h3","a","button",".btn",".primary",".secondary",".accent",'[class*="brand"]','[class*="logo"]',".navbar",".menu",".nav-link",".card",".panel",".alert","main","article","aside"],t=["color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor"],n=new Map;for(const o of e)try{const e=document.querySelectorAll(o);for(const o of e){if(null===o.offsetParent&&"fixed"!==getComputedStyle(o).position)continue;const e=getComputedStyle(o);for(const o of t){const t=e[o];if(t){const e=qo(t);e&&!jo(e)&&n.set(e,(n.get(e)||0)+1)}}}}catch{}return[...n.entries()].sort((e,t)=>t[1]-e[1]).map(([e])=>e)}(),...function(){const e=[],t=/#[0-9a-fA-F]{3,6}|rgb\s*\([^)]+\)|rgba\s*\([^)]+\)/g,n=document.querySelectorAll("style");for(const o of n){const n=(o.textContent||"").match(t)||[];for(const t of n){const n=qo(t);n&&!jo(n)&&e.push(n)}}return e}()];a=[...new Set(a)],!o&&(a=a.filter(e=>!jo(e,25)));let i=function(e,t=40){if(!e.length)return[];const n=[],o=new Set;for(const r of e){if(o.has(r))continue;const a=e.filter(e=>!o.has(e)&&Ho(r,e)<t);a.forEach(e=>o.add(e)),a.length>0&&n.push(a[0])}return n}(a,n);return r&&(i=i.sort((e,t)=>{const n=Do(e),o=Do(t);return n&&o?zo(n.r,n.g,n.b)-zo(o.r,o.g,o.b):0})),i.slice(0,t)}const Oo="nge-toolbar-config",Po=[{id:"font",title:"Selecteurs et couleurs",tools:[{id:"paragraph",label:"Style de paragraphe"},{id:"font-family",label:"Police"},{id:"font-size",label:"Taille"},{id:"line-height",label:"Interlignage"},{id:"text-color",label:"Couleur du texte"},{id:"bg-color",label:"Couleur de fond"}]},{id:"text-style",title:"Style de texte",tools:[{id:"bold",label:"Gras"},{id:"italic",label:"Italique"},{id:"underline",label:"Souligne"},{id:"strikethrough",label:"Barre"},{id:"text-case",label:"Changer la casse"},{id:"superscript",label:"Exposant"}]},{id:"alignment",title:"Alignement",tools:[{id:"align-left",label:"Aligner a gauche"},{id:"align-center",label:"Centrer"},{id:"align-right",label:"Aligner a droite"},{id:"align-justify",label:"Justifier"},{id:"indent",label:"Augmenter le retrait"},{id:"outdent",label:"Diminuer le retrait"}]},{id:"lists",title:"Listes",tools:[{id:"list-ul",label:"Liste a puces"},{id:"list-ol",label:"Liste numerotee"},{id:"list-todo",label:"Liste de taches"}]},{id:"insert",title:"Insertion",tools:[{id:"link",label:"Lien"},{id:"image",label:"Image"},{id:"video",label:"Video"},{id:"table",label:"Tableau"},{id:"columns",label:"Colonnes"},{id:"emoji",label:"Emoji"},{id:"quote",label:"Citation"},{id:"code",label:"Code"},{id:"hr",label:"Separateur"}]},{id:"action",title:"Actions",tools:[{id:"undo",label:"Annuler"},{id:"redo",label:"Retablir"},{id:"preview",label:"Apercu"},{id:"block-outlines",label:"Voir les blocs"},{id:"import-json",label:"Import JSON"},{id:"export-json",label:"Export JSON"},{id:"export-pdf",label:"Export PDF"},{id:"export-html",label:"Export HTML"}]}];function Vo(){const e={};for(const t of function(){const e=[];for(const t of Po)for(const n of t.tools)e.push(n.id);return e}())e[t]=!0;return e}function Wo(){try{const e=localStorage.getItem(Oo);if(e){const t=JSON.parse(e);if(t&&"object"==typeof t){if(6!==t._version)return localStorage.removeItem(Oo),Vo();return{...Vo(),...t}}}}catch(e){}return Vo()}function Uo(e){if(!e||"object"!=typeof e)throw new Error("Invalid configuration object");try{const t={_version:6};for(const[n,o]of Object.entries(e))"_version"!==n&&(t[n]=o);localStorage.setItem(Oo,JSON.stringify(t))}catch(e){}}function _o(e){const t=e.querySelectorAll("[data-tool]"),n=Array.from(t).filter(e=>e.checked).length,o=e.querySelector("#nge-toolbar-select-all"),r=e.querySelector("#nge-toolbar-select-all-text");o&&r&&(n>=2?(r.textContent=l("config.deselectAll"),o.checked=!0,o.indeterminate=!1):(r.textContent=l("config.selectAll"),o.checked=!1,o.indeterminate=1===n),e.querySelectorAll("[data-group-checkbox]").forEach(e=>{e.getAttribute("data-group-checkbox");const t=e.closest(".nge-toolbar-config-group");if(!t)return;const n=t.querySelectorAll("[data-tool]:not(:disabled)"),o=Array.from(n).filter(e=>e.checked).length,r=n.length;0===o?(e.checked=!1,e.indeterminate=!1):o===r?(e.checked=!0,e.indeterminate=!1):(e.checked=!1,e.indeterminate=!0)}))}function Go(e=null,t=[],n=!0,r=!1){const i=e||Vo(),s=document.createElement("div");s.className="nge-toolbar-config-content",s.setAttribute("data-testid","nge-toolbar-config-content");const u=document.createElement("div");u.className="nge-toolbar-config-language";const g=document.createElement("label");g.setAttribute("for","nge-language-select"),g.textContent=l("config.language");const p=document.createElement("select");p.id="nge-language-select",p.setAttribute("data-testid","nge-language-select");const m=a();o.forEach(e=>{const t=document.createElement("option");t.value=e.code,t.textContent=e.label,e.code===m&&(t.selected=!0),p.appendChild(t)}),u.appendChild(g),u.appendChild(p),s.appendChild(u);const h=document.createElement("div");h.className="nge-toolbar-config-theme";const b=document.createElement("label");b.setAttribute("for","nge-theme-select"),b.textContent=l("config.theme");const f=document.createElement("select");f.id="nge-theme-select",f.setAttribute("data-testid","nge-theme-select");const v=[{value:"light",label:l("config.themeLight")},{value:"dark",label:l("config.themeDark")},{value:"warm",label:l("config.themeWarm")},{value:"cold",label:l("config.themeCold")},{value:"taupe",label:l("config.themeTaupe")},{value:"pink",label:l("config.themePink")}],y=i.theme||"light";v.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,e.value===y&&(t.selected=!0),f.appendChild(t)}),h.appendChild(b),h.appendChild(f),s.appendChild(h);const w=document.createElement("div");w.className="nge-toolbar-config-icon-size";const C=document.createElement("label");C.setAttribute("for","nge-icon-size-select"),C.textContent=l("config.iconSize");const k=document.createElement("select");k.id="nge-icon-size-select",k.setAttribute("data-testid","nge-icon-size-select");const x=[{value:"small",label:l("config.iconSizeSmall")},{value:"large",label:l("config.iconSizeLarge")}],E=i.iconSize||"small";x.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,e.value===E&&(t.selected=!0),k.appendChild(t)}),w.appendChild(C),w.appendChild(k),s.appendChild(w);const S=document.createElement("div");S.className="nge-toolbar-config-toolbar-mode";const A=document.createElement("label");A.setAttribute("for","nge-toolbar-mode-select"),A.textContent=l("config.toolbarMode");const L=document.createElement("select");L.id="nge-toolbar-mode-select",L.setAttribute("data-testid","nge-toolbar-mode-select");const T=[{value:"integrated",label:l("config.toolbarModeIntegrated")},{value:"fullwidth-top",label:l("config.toolbarModeFullwidthTop")}],N=i.toolbarMode||"integrated";T.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,e.value===N&&(t.selected=!0),L.appendChild(t)}),S.appendChild(A),S.appendChild(L),s.appendChild(S);const M=document.createElement("div");M.className="nge-toolbar-config-custom-colors";const I=document.createElement("label");I.textContent=l("config.customColors");const R=document.createElement("small");R.className="nge-toolbar-config-help",R.textContent=l("config.customColorsHelp");const q=document.createElement("div");q.className="nge-toolbar-config-colors-input-row";const B=document.createElement("input");B.type="text",B.id="nge-custom-color-input",B.setAttribute("data-testid","nge-custom-color-input"),B.placeholder="#FF0000",B.maxLength=7;const D=document.createElement("button");D.type="button",D.className="nge-toolbar-config-add-color-btn",D.setAttribute("data-testid","nge-add-color-btn"),D.textContent="+",D.title=l("config.addColor");const H=document.createElement("button");H.type="button",H.className="nge-toolbar-config-detect-colors-btn",H.setAttribute("data-testid","nge-detect-colors-btn"),H.textContent=l("config.detectColors"),H.title=l("config.detectColorsHelp"),q.appendChild(B),q.appendChild(D),q.appendChild(H);const j=document.createElement("div");j.className="nge-toolbar-config-colors-list",j.id="nge-custom-colors-list",j.setAttribute("data-testid","nge-custom-colors-list"),M.appendChild(I),M.appendChild(R),M.appendChild(q),M.appendChild(j),n&&!r&&s.appendChild(M);const z=i.customColors||[];function F(e){j.innerHTML="",e.forEach((e,t)=>{const n=document.createElement("div");n.className="nge-toolbar-config-color-item",n.setAttribute("data-color",e);const o=document.createElement("span");o.className="nge-toolbar-config-color-swatch",o.style.backgroundColor=e;const r=document.createElement("span");r.className="nge-toolbar-config-color-value",r.textContent=e;const a=document.createElement("button");a.type="button",a.className="nge-toolbar-config-remove-color-btn",a.setAttribute("data-testid","nge-remove-color-"+t),a.innerHTML="&times;",a.title=l("config.removeColor"),a.addEventListener("click",()=>{F(O().filter(t=>t!==e))}),n.appendChild(o),n.appendChild(r),n.appendChild(a),j.appendChild(n)})}function O(){const e=j.querySelectorAll(".nge-toolbar-config-color-item");return Array.from(e).map(e=>e.getAttribute("data-color"))}D.addEventListener("click",()=>{const e=B.value.trim();if(function(e){if(!e||"string"!=typeof e)return!1;const t=e.startsWith("#")?e:"#"+e;return/^#[0-9A-Fa-f]{6}$/.test(t)||/^#[0-9A-Fa-f]{3}$/.test(t)}(e)){const t=function(e){let t=e.startsWith("#")?e:"#"+e;return t=t.toUpperCase(),4===t.length&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),t}(e),n=O();!n.includes(t)&&(n.push(t),F(n)),B.value="",B.classList.remove("nge-input-error")}else B.classList.add("nge-input-error")}),H.addEventListener("click",()=>{const e=Fo({maxColors:10,includeGrays:!1,sortByHue:!0});if(0===e.length)return;const t=O();let n=0;for(const o of e)!t.includes(o)&&(t.push(o),n++);n>0&&F(t)}),B.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),D.click())}),B.addEventListener("input",()=>{B.classList.remove("nge-input-error")}),F(z),s._getCustomColors=O;const P=document.createElement("div");P.className="nge-toolbar-config-custom-fonts";const V=document.createElement("label");V.className="nge-toolbar-config-custom-fonts-header nge-checkbox-label";const W=document.createElement("input");W.type="checkbox",W.id="nge-custom-fonts-toggle",W.setAttribute("data-testid","nge-custom-fonts-toggle");const U=document.createElement("span");U.textContent=l("config.customFonts"),V.appendChild(W),V.appendChild(U);const _=document.createElement("small");_.className="nge-toolbar-config-help",_.textContent=l("config.customFontsHelp"),_.style.display="none";const G=document.createElement("div");G.className="nge-toolbar-config-fonts-list",G.id="nge-custom-fonts-list",G.setAttribute("data-testid","nge-custom-fonts-list"),G.style.display="none",G.style.flexDirection="column",P.appendChild(V),P.appendChild(_),P.appendChild(G),n&&!r&&s.appendChild(P);const J=[{value:"Arial, sans-serif",label:"Arial"},{value:"Helvetica, Arial, sans-serif",label:"Helvetica"},{value:"Georgia, serif",label:"Georgia"},{value:"Times New Roman, Times, serif",label:"Times New Roman"},{value:"Courier New, Courier, monospace",label:"Courier New"},{value:"Verdana, Geneva, sans-serif",label:"Verdana"},{value:"Trebuchet MS, sans-serif",label:"Trebuchet MS"},{value:"Impact, sans-serif",label:"Impact"},{value:"Comic Sans MS, cursive",label:"Comic Sans MS"},{value:"Palatino Linotype, Book Antiqua, Palatino, serif",label:"Palatino"},{value:"Lucida Sans Unicode, Lucida Grande, sans-serif",label:"Lucida Sans"},{value:"Tahoma, Geneva, sans-serif",label:"Tahoma"},{value:"Century Gothic, sans-serif",label:"Century Gothic"},{value:"Garamond, serif",label:"Garamond"},{value:"Bookman Old Style, serif",label:"Bookman"},{value:"Arial Black, sans-serif",label:"Arial Black"},{value:"Brush Script MT, cursive",label:"Brush Script"},{value:"Copperplate, Copperplate Gothic Light, fantasy",label:"Copperplate"},{value:"Rockwell, serif",label:"Rockwell"}];c=null;const Z=d(),X=new Set(J.map(e=>e.label.toLowerCase())),K=Z.filter(e=>!X.has(e.label.toLowerCase())),$=i.customFonts||[],Y=$.map(e=>e.value);$.length>0&&(W.checked=!0,_.style.display="block",G.style.display="flex");let Q=0;if(K.length>0){const e=document.createElement("div");e.className="nge-toolbar-config-fonts-separator",e.textContent=l("fonts.siteFonts"),G.appendChild(e),K.forEach(e=>{const t=document.createElement("label");t.className="nge-toolbar-config-font-item nge-checkbox-label";const n=document.createElement("input");n.type="checkbox",n.setAttribute("data-font-value",e.value),n.setAttribute("data-font-label",e.label),n.setAttribute("data-testid","nge-font-checkbox-"+Q),n.checked=Y.includes(e.value);const o=document.createElement("span");o.className="nge-toolbar-config-font-preview",o.style.fontFamily=e.value,o.textContent=e.label,t.appendChild(n),t.appendChild(o),G.appendChild(t),Q++})}const ee=document.createElement("div");ee.className="nge-toolbar-config-fonts-separator",ee.textContent=l("fonts.standardFonts"),G.appendChild(ee),J.forEach(e=>{const t=document.createElement("label");t.className="nge-toolbar-config-font-item nge-checkbox-label";const n=document.createElement("input");n.type="checkbox",n.setAttribute("data-font-value",e.value),n.setAttribute("data-font-label",e.label),n.setAttribute("data-testid","nge-font-checkbox-"+Q),n.checked=Y.includes(e.value);const o=document.createElement("span");o.className="nge-toolbar-config-font-preview",o.style.fontFamily=e.value,o.textContent=e.label,t.appendChild(n),t.appendChild(o),G.appendChild(t),Q++}),W.addEventListener("change",()=>{const e=W.checked;_.style.display=e?"block":"none",G.style.display=e?"flex":"none",!e&&G.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.checked=!1})}),s._getCustomFonts=function(){if(!W.checked)return[];const e=G.querySelectorAll('input[type="checkbox"]:checked');return Array.from(e).map(e=>({value:e.getAttribute("data-font-value"),label:e.getAttribute("data-font-label")}))};const te=document.createElement("div");te.className="nge-toolbar-config-header";const ne=document.createElement("label");ne.className="nge-checkbox-label nge-select-all-label";const oe=document.createElement("input");oe.type="checkbox",oe.id="nge-toolbar-select-all",oe.setAttribute("data-testid","nge-toolbar-select-all");const re=document.createElement("span");re.id="nge-toolbar-select-all-text",re.textContent=l("config.selectAll"),ne.appendChild(oe),ne.appendChild(re),te.appendChild(ne),s.appendChild(te);const ae=document.createElement("div");ae.className="nge-toolbar-config-groups";const ie=[{id:"font",title:l("config.groupFont"),tools:[{id:"paragraph",label:l("config.toolParagraph")},{id:"font-family",label:l("config.toolFontFamily")},{id:"font-size",label:l("config.toolFontSize")},{id:"line-height",label:l("config.toolLineHeight")},{id:"text-color",label:l("config.toolTextColor")},{id:"bg-color",label:l("config.toolBgColor")}]},{id:"text-style",title:l("config.groupTextStyle"),tools:[{id:"bold",label:l("config.toolBold")},{id:"italic",label:l("config.toolItalic")},{id:"underline",label:l("config.toolUnderline")},{id:"strikethrough",label:l("config.toolStrikethrough")},{id:"text-case",label:l("config.toolTextCase")},{id:"superscript",label:l("config.toolSuperscript")}]},{id:"alignment",title:l("config.groupAlignment"),tools:[{id:"align-left",label:l("config.toolAlignLeft")},{id:"align-center",label:l("config.toolAlignCenter")},{id:"align-right",label:l("config.toolAlignRight")},{id:"align-justify",label:l("config.toolAlignJustify")},{id:"indent",label:l("config.toolIndent")},{id:"outdent",label:l("config.toolOutdent")}]},{id:"lists",title:l("config.groupLists"),tools:[{id:"list-ul",label:l("config.toolListUl")},{id:"list-ol",label:l("config.toolListOl")},{id:"list-todo",label:l("config.toolListTodo")}]},{id:"media",title:l("config.groupMedia"),tools:[{id:"link",label:l("config.toolLink")},{id:"image",label:l("config.toolImage")},{id:"video",label:l("config.toolVideo")},{id:"table",label:l("config.toolTable")},{id:"columns",label:l("config.toolColumns")},{id:"emoji",label:l("config.toolEmoji")}]},{id:"insert",title:l("config.groupInsert"),tools:[{id:"quote",label:l("config.toolQuote")},{id:"code",label:l("config.toolCode")},{id:"hr",label:l("config.toolHr")}]},{id:"action",title:l("config.groupAction"),tools:[{id:"undo",label:l("config.toolUndo")},{id:"redo",label:l("config.toolRedo")},{id:"preview",label:l("config.toolPreview")},{id:"block-outlines",label:l("config.toolBlockOutlines")},{id:"import-json",label:l("config.toolImportJson")},{id:"export-json",label:l("config.toolExportJson")},{id:"export-pdf",label:l("config.toolExportPdf")},{id:"export-html",label:l("config.toolExportHtml")}]}];for(const e of ie){const n=document.createElement("div");n.className="nge-toolbar-config-group",n.setAttribute("data-testid","nge-toolbar-config-group-"+e.id);const o=document.createElement("label");o.className="nge-toolbar-config-group-title nge-checkbox-label";const r=document.createElement("input");r.type="checkbox",r.setAttribute("data-group-checkbox",e.id),r.setAttribute("data-testid","nge-toolbar-config-group-checkbox-"+e.id);const a=document.createElement("span");a.textContent=e.title,o.appendChild(r),o.appendChild(a),n.appendChild(o);const s=document.createElement("div");s.className="nge-toolbar-config-items";for(const n of e.tools){const e=document.createElement("label");e.className="nge-checkbox-label";const o=document.createElement("input");o.type="checkbox",o.setAttribute("data-tool",n.id),o.setAttribute("data-testid","nge-toolbar-config-"+n.id),o.checked=!1!==i[n.id];t.includes(n.id)&&(o.disabled=!0,e.classList.add("nge-tool-restricted"),e.setAttribute("title",l("status.restrictedTool"))),e.appendChild(o),e.appendChild(document.createTextNode(n.label)),s.appendChild(e)}n.appendChild(s),ae.appendChild(n)}s.appendChild(ae),oe.addEventListener("click",()=>{!function(e){const t=e.querySelectorAll("[data-tool]"),n=Array.from(t).filter(e=>e.checked).length<2;t.forEach(e=>{e.checked=n}),_o(e)}(s)});s.querySelectorAll("[data-tool]").forEach(e=>{e.addEventListener("change",()=>{_o(s)})});return s.querySelectorAll("[data-group-checkbox]").forEach(e=>{e.addEventListener("click",t=>{const n=e.getAttribute("data-group-checkbox");!function(e,t,n){const o=e.querySelector('[data-testid="nge-toolbar-config-group-'+t+'"]');if(!o)return;o.querySelectorAll("[data-tool]:not(:disabled)").forEach(e=>{e.checked=n}),_o(e)}(s,n,e.checked)})}),_o(s),s}function Jo(e=null,t=[],n=!0,o=!1){const r=Go(e,t,n,o);return H(D({id:"toolbar-config-modal",title:l("config.title"),content:r,buttons:[{id:"cancel",label:l("config.cancel"),variant:"secondary"},{id:"confirm",label:l("config.apply"),variant:"primary"}]})).then(e=>{if("confirm"===e){return{action:"confirm",config:function(e){const t={};return e.querySelectorAll("[data-tool]").forEach(e=>{const n=e.getAttribute("data-tool");n&&(t[n]=e.checked)}),t}(r),language:function(e){const t=e.querySelector("#nge-language-select");return t?t.value:a()}(r),theme:function(e){const t=e.querySelector("#nge-theme-select");return t?t.value:"light"}(r),iconSize:function(e){const t=e.querySelector("#nge-icon-size-select");return t?t.value:"small"}(r),toolbarMode:function(e){const t=e.querySelector("#nge-toolbar-mode-select");return t?t.value:"integrated"}(r),customColors:(n=r)._getCustomColors?n._getCustomColors():[],customFonts:(t=r)._getCustomFonts?t._getCustomFonts():[]}}throw new Error("Modal cancelled");var t,n})}const Zo={keywords:/\b(async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|export|extends|finally|for|from|function|if|import|in|instanceof|let|new|of|return|static|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/g,builtins:/\b(Array|Boolean|Date|Error|Function|JSON|Math|Number|Object|Promise|Proxy|RegExp|String|Symbol|console|document|window|setTimeout|setInterval|fetch|null|undefined|NaN|Infinity)\b/g,strings:/(["'`])(?:(?!\1|\\).|\\.)*\1/g,comments:/(\/\/.*$|\/\*[\s\S]*?\*\/)/gm,numbers:/\b(\d+\.?\d*|0x[a-fA-F0-9]+|0b[01]+|0o[0-7]+)\b/g,functions:/\b([a-zA-Z_$][a-zA-Z0-9_$]*)\s*(?=\()/g},Xo={keywords:/\b(and|as|assert|async|await|break|class|continue|def|del|elif|else|except|finally|for|from|global|if|import|in|is|lambda|nonlocal|not|or|pass|raise|return|try|while|with|yield)\b/g,builtins:/\b(True|False|None|print|len|range|str|int|float|list|dict|set|tuple|open|input|type|isinstance|hasattr|getattr|setattr|super|self|cls)\b/g,strings:/("""[\s\S]*?"""|'''[\s\S]*?'''|"(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*')/g,comments:/(#.*$)/gm,numbers:/\b(\d+\.?\d*)\b/g,decorators:/(@[\w.]+)/g,functions:/\b([a-zA-Z_][a-zA-Z0-9_]*)\s*(?=\()/g},Ko={keywords:/\b(abstract|and|array|as|break|callable|case|catch|class|clone|const|continue|declare|default|die|do|echo|else|elseif|empty|enddeclare|endfor|endforeach|endif|endswitch|endwhile|eval|exit|extends|final|finally|for|foreach|function|global|goto|if|implements|include|include_once|instanceof|insteadof|interface|isset|list|match|namespace|new|or|print|private|protected|public|readonly|require|require_once|return|static|switch|throw|trait|try|unset|use|var|while|xor|yield)\b/g,variables:/(\$[a-zA-Z_][a-zA-Z0-9_]*)/g,strings:/(["'])(?:(?!\1|\\).|\\.)*\1/g,comments:/(\/\/.*$|\/\*[\s\S]*?\*\/|#.*$)/gm,numbers:/\b(\d+\.?\d*)\b/g,functions:/\b([a-zA-Z_][a-zA-Z0-9_]*)\s*(?=\()/g},$o={keywords:/\b(SELECT|FROM|WHERE|AND|OR|NOT|IN|LIKE|BETWEEN|IS|NULL|AS|ON|JOIN|LEFT|RIGHT|INNER|OUTER|FULL|CROSS|UNION|ALL|DISTINCT|ORDER|BY|ASC|DESC|GROUP|HAVING|LIMIT|OFFSET|INSERT|INTO|VALUES|UPDATE|SET|DELETE|CREATE|TABLE|INDEX|VIEW|DROP|ALTER|ADD|COLUMN|PRIMARY|KEY|FOREIGN|REFERENCES|CONSTRAINT|DEFAULT|CHECK|UNIQUE|DATABASE|SCHEMA|GRANT|REVOKE|COMMIT|ROLLBACK|TRANSACTION|BEGIN|END|IF|ELSE|THEN|WHEN|CASE|EXISTS|COUNT|SUM|AVG|MIN|MAX|COALESCE|CAST|CONVERT)\b/gi,strings:/(["'])(?:(?!\1).)*\1/g,comments:/(--.*$|\/\*[\s\S]*?\*\/)/gm,numbers:/\b(\d+\.?\d*)\b/g},Yo={keywords:/\b(if|then|else|elif|fi|case|esac|for|while|until|do|done|in|function|select|time|coproc)\b/g,builtins:/\b(echo|printf|read|cd|pwd|ls|cat|grep|sed|awk|find|sort|uniq|head|tail|wc|cut|tr|mkdir|rm|rmdir|cp|mv|chmod|chown|export|source|alias|unalias|exit|return|shift|test)\b/g,variables:/(\$[a-zA-Z_][a-zA-Z0-9_]*|\$\{[^}]+\}|\$[0-9@#?*!$-])/g,strings:/(["'])(?:(?!\1|\\).|\\.)*\1/g,comments:/(#.*$)/gm,numbers:/\b(\d+)\b/g},Qo="nge-sh-keyword",er="nge-sh-builtin",tr="nge-sh-string",nr="nge-sh-comment",or="nge-sh-number",rr="nge-sh-function",ar="nge-sh-tag",ir="nge-sh-attribute",lr="nge-sh-selector",sr="nge-sh-property",cr="nge-sh-variable",dr="nge-sh-decorator",ur="nge-sh-color",gr="nge-sh-important",pr="nge-sh-key",mr="nge-sh-boolean",hr="nge-sh-null",br="nge-sh-doctype",fr="nge-sh-tagname",vr={html:[/<!DOCTYPE\s+html/i,/<html[\s>]/i,/<head[\s>]/i,/<body[\s>]/i,/<div[\s>]/i,/<span[\s>]/i,/<p[\s>]/i,/<a\s+href/i,/<img\s+src/i,/<script[\s>]/i,/<style[\s>]/i,/<link[\s>]/i,/<meta[\s>]/i,/<form[\s>]/i,/<input[\s>]/i,/<button[\s>]/i],css:[/\{[\s\S]*?[\w-]+\s*:\s*[^;]+;[\s\S]*?\}/,/@media\s*\(/,/@import\s+/,/@keyframes\s+/,/\.([\w-]+)\s*\{/,/#([\w-]+)\s*\{/,/:\s*(flex|grid|block|inline|none|absolute|relative|fixed)/,/:\s*\d+(px|em|rem|%|vh|vw)/,/background(-color)?:\s*/,/margin|padding|border|font-size|color|display|position/],javascript:[/\bconst\s+\w+\s*=/,/\blet\s+\w+\s*=/,/\bvar\s+\w+\s*=/,/\bfunction\s+\w+\s*\(/,/\bclass\s+\w+/,/=>\s*[{(]/,/\bimport\s+.*\s+from\s+['"]/,/\bexport\s+(default\s+)?(const|let|var|function|class)/,/\basync\s+function/,/\bawait\s+/,/document\.(getElementById|querySelector|createElement)/,/console\.(log|error|warn)/,/\bnew\s+(Promise|Date|Array|Object|Map|Set)/,/\.then\s*\(/,/\.catch\s*\(/,/\btypeof\s+/,/===|!==|\?\?|\?\.|\.\.\./],python:[/\bdef\s+\w+\s*\(/,/\bclass\s+\w+\s*[:(]/,/\bimport\s+\w+/,/\bfrom\s+\w+\s+import/,/\bif\s+.*:\s*$/m,/\bfor\s+\w+\s+in\s+/,/\bwhile\s+.*:\s*$/m,/\bprint\s*\(/,/\bself\./,/\bTrue\b|\bFalse\b|\bNone\b/,/@\w+/,/\bdef\s+__\w+__/,/:\s*$/m,/\belif\s+/,/\bexcept\s*.*:/,/\blambda\s+/,/"""[\s\S]*?"""|'''[\s\S]*?'''/],php:[/<\?php/i,/\$[a-zA-Z_]\w*/,/\becho\s+/,/\bfunction\s+\w+\s*\(/,/\bclass\s+\w+/,/\bpublic\s+function/,/\bprivate\s+function/,/\bprotected\s+function/,/\bnamespace\s+/,/\buse\s+\w+/,/\bnew\s+\w+\s*\(/,/\b(require|include)(_once)?\s*\(/,/->/,/::/,/\$this->/],sql:[/\bSELECT\s+.*\s+FROM\b/i,/\bINSERT\s+INTO\b/i,/\bUPDATE\s+.*\s+SET\b/i,/\bDELETE\s+FROM\b/i,/\bCREATE\s+(TABLE|INDEX|VIEW|DATABASE)\b/i,/\bDROP\s+(TABLE|INDEX|VIEW|DATABASE)\b/i,/\bALTER\s+TABLE\b/i,/\bJOIN\s+.*\s+ON\b/i,/\bWHERE\s+.*\s+(=|<|>|LIKE|IN)\b/i,/\bGROUP\s+BY\b/i,/\bORDER\s+BY\b/i,/\bPRIMARY\s+KEY\b/i,/\bFOREIGN\s+KEY\b/i],json:[/^\s*\{[\s\S]*"[\w-]+"\s*:[\s\S]*\}\s*$/,/^\s*\[[\s\S]*\]\s*$/,/"[\w-]+"\s*:\s*(".*?"|[\d.]+|true|false|null|\[|\{)/],bash:[/^#!\/bin\/(ba)?sh/m,/\becho\s+["'$]/,/\bif\s+\[\s+/,/\bfor\s+\w+\s+in\b/,/\bwhile\s+.*;\s*do\b/,/\bcase\s+.*\s+in\b/,/\$\([^)]+\)/,/\$\{[^}]+\}/,/\|\s*(grep|sed|awk|sort|uniq|head|tail|wc|cut)/,/\bsudo\s+/,/\bchmod\s+/,/\bcd\s+/,/\bmkdir\s+/,/\brm\s+(-rf?)?\s+/]};function yr(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function wr(e,t){return'<span class="'+t+'">'+e+"</span>"}function Cr(e,t=null){if(!e||"string"!=typeof e)return{html:"",language:null};const n=t||function(e){if(!e||"string"!=typeof e)return null;const t={};for(const[n,o]of Object.entries(vr)){t[n]=0;for(const r of o)r.test(e)&&t[n]++}let n=0,o=null;for(const[e,r]of Object.entries(t))r>n&&(n=r,o=e);return n>=2?o:null}(e);let o;switch(n){case"javascript":o=function(e){const t=Zo;let n=yr(e);const o=[];let r=0;n=n.replace(t.comments,e=>{const t="__PLACEHOLDER_"+r+++"__";return o.push({placeholder:t,replacement:wr(e,nr)}),t}),n=n.replace(t.strings,e=>{const t="__PLACEHOLDER_"+r+++"__";return o.push({placeholder:t,replacement:wr(e,tr)}),t}),n=n.replace(t.keywords,e=>wr(e,Qo)),n=n.replace(t.builtins,e=>wr(e,er)),n=n.replace(t.functions,e=>wr(e,rr)),n=n.replace(t.numbers,e=>wr(e,or));for(const{placeholder:e,replacement:t}of o)n=n.replace(e,t);return n}(e);break;case"html":o=function(e){let t=yr(e);const n=[];let o=0;t=t.replace(/&lt;!--[\s\S]*?--&gt;/g,e=>{const t="__PLACEHOLDER_"+o+++"__";return n.push({placeholder:t,replacement:wr(e,nr)}),t}),t=t.replace(/&lt;!DOCTYPE[^&]*&gt;/gi,e=>wr(e,br)),t=t.replace(/(&lt;\/?)([\w-]+)([^&]*?)(&gt;)/g,(e,t,n,o,r)=>{let a=o.replace(/\s([\w-]+)(=)/g,(e,t,n)=>" "+wr(t,ir)+n);return a=a.replace(/(["'])([^"']*)\1/g,(e,t,n)=>wr(""+t+n+t,tr)),""+wr(t,ar)+wr(n,fr)+a+wr(r,ar)});for(const{placeholder:e,replacement:o}of n)t=t.replace(e,o);return t}(e);break;case"css":o=function(e){let t=yr(e);const n=[];let o=0;t=t.replace(/\/\*[\s\S]*?\*\//g,e=>{const t="__PLACEHOLDER_"+o+++"__";return n.push({placeholder:t,replacement:wr(e,nr)}),t}),t=t.replace(/(["'])(?:(?!\1).)*\1/g,e=>{const t="__PLACEHOLDER_"+o+++"__";return n.push({placeholder:t,replacement:wr(e,tr)}),t}),t=t.replace(/([^{}]+)(\{)/g,(e,t,n)=>""+t.replace(/([.#]?[\w-]+)/g,e=>e.startsWith(".")||e.startsWith("#")?wr(e,lr):e)+n),t=t.replace(/([\w-]+)(\s*:\s*)([^;{}]+)(;?)/g,(e,t,n,o,r)=>{let a=o;return a=a.replace(/#[a-fA-F0-9]{3,8}\b/g,e=>wr(e,ur)),a=a.replace(/\b\d+\.?\d*(px|em|rem|%|vh|vw|deg|s|ms)?\b/g,e=>wr(e,or)),a=a.replace(/!important/g,e=>wr(e,gr)),""+wr(t,sr)+n+a+r});for(const{placeholder:e,replacement:o}of n)t=t.replace(e,o);return t}(e);break;case"python":o=function(e){const t=Xo;let n=yr(e);const o=[];let r=0;n=n.replace(t.comments,e=>{const t="__PLACEHOLDER_"+r+++"__";return o.push({placeholder:t,replacement:wr(e,nr)}),t}),n=n.replace(t.strings,e=>{const t="__PLACEHOLDER_"+r+++"__";return o.push({placeholder:t,replacement:wr(e,tr)}),t}),n=n.replace(t.decorators,e=>wr(e,dr)),n=n.replace(t.keywords,e=>wr(e,Qo)),n=n.replace(t.builtins,e=>wr(e,er)),n=n.replace(t.functions,e=>wr(e,rr)),n=n.replace(t.numbers,e=>wr(e,or));for(const{placeholder:e,replacement:t}of o)n=n.replace(e,t);return n}(e);break;case"php":o=function(e){const t=Ko;let n=yr(e);const o=[];let r=0;n=n.replace(t.comments,e=>{const t="__PLACEHOLDER_"+r+++"__";return o.push({placeholder:t,replacement:wr(e,nr)}),t}),n=n.replace(t.strings,e=>{const t="__PLACEHOLDER_"+r+++"__";return o.push({placeholder:t,replacement:wr(e,tr)}),t}),n=n.replace(t.keywords,e=>wr(e,Qo)),n=n.replace(t.variables,e=>wr(e,cr)),n=n.replace(t.functions,e=>wr(e,rr)),n=n.replace(t.numbers,e=>wr(e,or));for(const{placeholder:e,replacement:t}of o)n=n.replace(e,t);return n}(e);break;case"sql":o=function(e){const t=$o;let n=yr(e);const o=[];let r=0;n=n.replace(t.comments,e=>{const t="__PLACEHOLDER_"+r+++"__";return o.push({placeholder:t,replacement:wr(e,nr)}),t}),n=n.replace(t.strings,e=>{const t="__PLACEHOLDER_"+r+++"__";return o.push({placeholder:t,replacement:wr(e,tr)}),t}),n=n.replace(t.keywords,e=>wr(e,Qo)),n=n.replace(t.numbers,e=>wr(e,or));for(const{placeholder:e,replacement:t}of o)n=n.replace(e,t);return n}(e);break;case"json":o=function(e){let t=yr(e);return t=t.replace(/"([^"]+)"(\s*:)/g,(e,t,n)=>""+wr('"'+t+'"',pr)+n),t=t.replace(/:\s*"([^"]*)"/g,(e,t)=>": "+wr('"'+t+'"',tr)),t=t.replace(/:\s*(-?\d+\.?\d*)/g,(e,t)=>": "+wr(t,or)),t=t.replace(/\b(true|false)\b/g,e=>wr(e,mr)),t=t.replace(/\b(null)\b/g,e=>wr(e,hr)),t}(e);break;case"bash":o=function(e){const t=Yo;let n=yr(e);const o=[];let r=0;n=n.replace(t.comments,e=>{const t="__PLACEHOLDER_"+r+++"__";return o.push({placeholder:t,replacement:wr(e,nr)}),t}),n=n.replace(t.strings,e=>{const t="__PLACEHOLDER_"+r+++"__";return o.push({placeholder:t,replacement:wr(e,tr)}),t}),n=n.replace(t.keywords,e=>wr(e,Qo)),n=n.replace(t.builtins,e=>wr(e,er)),n=n.replace(t.variables,e=>wr(e,cr)),n=n.replace(t.numbers,e=>wr(e,or));for(const{placeholder:e,replacement:t}of o)n=n.replace(e,t);return n}(e);break;default:o=yr(e)}return{html:o,language:n}}function kr(){return"row-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function xr(e){const t=(e.textContent||"").trim();return{wordCount:t.split(/\s+/).filter(e=>e.length>0).length,charCount:t.length,charCountNoSpaces:t.replace(/\s/g,"").length,rowCount:e.querySelectorAll(":scope > .nge-grid-row").length,blockCount:e.querySelectorAll(".nge-grid-block").length}}function Er(e){const t=[];function n(e){if(e.nodeType===Node.TEXT_NODE){const t=e.textContent.trim();return t?{type:"text",content:t}:null}if(e.nodeType!==Node.ELEMENT_NODE)return null;const t=e.tagName.toLowerCase();if(/^h[1-6]$/.test(t))return{type:"heading",level:parseInt(t.charAt(1),10),content:e.textContent.trim()};if("p"===t)return{type:"paragraph",content:e.innerHTML};if("ul"===t||"ol"===t){return{type:"list",listType:"ul"===t?"unordered":"ordered",items:Array.from(e.querySelectorAll("li")).map(e=>e.textContent.trim())}}if("img"===t||e.classList.contains("nge-image-wrapper")){const n="img"===t?e:e.querySelector("img");if(n)return{type:"img",src:n.getAttribute("src")||"",alt:n.getAttribute("alt")||"",width:n.getAttribute("width")||"",height:n.getAttribute("height")||""}}if(e.classList.contains("nge-video-wrapper")){const t=e.querySelector("iframe");if(t)return{type:"video",src:t.getAttribute("src")||"",width:e.style.width||""}}if("table"===t||e.classList.contains("nge-table-wrapper")){const n="table"===t?e:e.querySelector("table");if(n){return{type:"table",rows:Array.from(n.querySelectorAll("tr")).map(e=>Array.from(e.querySelectorAll("td, th")).map(e=>e.textContent.trim()))}}}if("blockquote"===t||e.classList.contains("nge-quote-wrapper")){const n="blockquote"===t?e:e.querySelector("blockquote");return{type:"quote",content:n?n.textContent.trim():e.textContent.trim()}}if(e.classList.contains("nge-code-block")){const t=e.querySelector("code");return{type:"code",content:t?t.textContent:e.textContent,language:t&&t.getAttribute("data-language")||""}}if("hr"===t)return{type:"hr"};if(e.classList.contains("nge-column-wrapper")){const t=Array.from(e.querySelectorAll(".nge-column")).map(e=>e.innerHTML);return{type:"columns",count:t.length,columns:t}}const o=[];for(const t of e.childNodes){const e=n(t);e&&o.push(e)}return 1===o.length?o[0]:o.length>1?{type:"container",children:o}:null}for(const o of e.childNodes){const e=n(o);e&&t.push(e)}return t}function Sr(e){const t=e.querySelector(":scope > .nge-grid-block-content");let n="",o="";if(t){const e=t.cloneNode(!0);e.querySelectorAll(".nge-grid-row").forEach(e=>e.remove()),n=e.innerHTML.trim(),o=e.textContent.trim()}const r=[];if(t){t.querySelectorAll(":scope > .nge-grid-row").forEach(e=>{const t=e.querySelectorAll(":scope > .nge-grid-block");t.length>0&&r.push({id:e.getAttribute("data-row-id")||kr(),blocks:Array.from(t).map(e=>Sr(e))})})}return{id:"block-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),type:e.getAttribute("data-block-type")||"text",gridStart:parseInt(e.getAttribute("data-grid-start"),10)||1,gridCols:parseInt(e.getAttribute("data-grid-cols"),10)||12,gridWidth:e.getAttribute("data-grid-width")||"100",bgImage:e.getAttribute("data-bg-image")||"",bgOpacity:parseFloat(e.getAttribute("data-bg-opacity"))||1,bgColor:e.getAttribute("data-bg-color")||"",padding:parseInt(e.getAttribute("data-padding"),10)||0,marginTop:parseInt(e.getAttribute("data-margin-top"),10)||0,marginRight:parseInt(e.getAttribute("data-margin-right"),10)||0,marginBottom:parseInt(e.getAttribute("data-margin-bottom"),10)||0,marginLeft:parseInt(e.getAttribute("data-margin-left"),10)||0,nestingLevel:parseInt(e.getAttribute("data-nesting-level"),10)||1,content:{html:n,text:o},nestedRows:r,children:r.flatMap(e=>e.blocks)}}function Ar(e){const t=e.querySelectorAll(":scope > .nge-grid-block");return{id:e.getAttribute("data-row-id")||kr(),blocks:Array.from(t).map(e=>Sr(e))}}const Lr=["1.0","2.0"];function Tr(e){if(!e||"object"!=typeof e)return{isValid:!1,error:"Invalid JSON format"};if(!e.version)return{isValid:!1,error:"Version not specified"};if(!Lr.includes(e.version))return{isValid:!1,error:"Unsupported version: "+e.version};if("2.0"===e.version){if(!e.layout)return{isValid:!1,error:"Missing layout structure"};if(!Array.isArray(e.layout.rows))return{isValid:!1,error:"Invalid layout.rows"}}return{isValid:!0}}function Nr(e){let t="";return e.structure&&Array.isArray(e.structure)?t=Ir(e.structure):e.content&&e.content.text&&(t="<p>"+Mr(e.content.text)+"</p>"),{version:"2.0",exportedAt:e.exportedAt||(new Date).toISOString(),metadata:e.metadata||{wordCount:0,charCount:0,charCountNoSpaces:0,rowCount:1,blockCount:1},content:e.content||{text:"",html:""},layout:{rows:[{id:"migrated-row-"+Date.now(),blocks:[{id:"migrated-block-"+Date.now(),type:"text",gridStart:1,gridCols:12,gridWidth:"100",bgImage:"",bgOpacity:1,bgColor:"",padding:0,nestingLevel:1,content:{html:t,text:e.content?.text||""},children:[]}]}]},legacyStructure:e.structure||[]}}function Mr(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function Ir(e){return Array.isArray(e)?e.map(e=>{switch(e.type){case"text":return"<p>"+Mr(e.content)+"</p>";case"heading":return"<h"+e.level+">"+Mr(e.content)+"</h"+e.level+">";case"paragraph":return"<p>"+e.content+"</p>";case"list":{const t="ordered"===e.listType?"ol":"ul";return"<"+t+">"+(e.items||[]).map(e=>"<li>"+Mr(e)+"</li>").join("")+"</"+t+">"}case"img":return'<div class="nge-image-wrapper"><img src="'+e.src+'" alt="'+(e.alt||"")+'"'+(e.width?' width="'+e.width+'"':"")+(e.height?' height="'+e.height+'"':"")+"></div>";case"video":return'<div class="nge-video-wrapper"><iframe src="'+e.src+'"></iframe></div>';case"table":return'<div class="nge-table-wrapper"><table class="nge-table"><tbody>'+(e.rows||[]).map(e=>"<tr>"+e.map(e=>"<td>"+Mr(e)+"</td>").join("")+"</tr>").join("")+"</tbody></table></div>";case"quote":return'<div class="nge-quote-wrapper"><blockquote class="nge-quote">'+Mr(e.content)+"</blockquote></div>";case"code":return'<div class="nge-code-block"><code'+(e.language?' data-language="'+e.language+'"':"")+">"+Mr(e.content)+"</code></div>";case"hr":return"<hr>";case"columns":{const t=(e.columns||[]).map(e=>'<div class="nge-column">'+e+"</div>").join("");return'<div class="nge-column-wrapper" data-columns="'+e.count+'">'+t+"</div>"}case"container":return Ir(e.children||[]);default:return""}}).join(""):""}function Rr(e){let t=e.gridWidth||"100";const n=An(t);e.gridCols&&n!==e.gridCols&&(t=function(e){for(const[t,n]of Object.entries(fn))if(n.cols===e)return t;let t="100",n=1/0;for(const[o,r]of Object.entries(fn)){const a=Math.abs(r.cols-e);a<n&&(n=a,t=o)}return t}(e.gridCols));const o=Ln({blockType:e.type||"text",gridWidth:t,gridStart:e.gridStart||1,bgImage:e.bgImage||"",bgOpacity:void 0!==e.bgOpacity?e.bgOpacity:1,bgColor:e.bgColor||"",padding:e.padding||0,marginTop:e.marginTop||0,marginRight:e.marginRight||0,marginBottom:e.marginBottom||0,marginLeft:e.marginLeft||0,nestingLevel:e.nestingLevel||1},e.content?.html||"<br>"),r=document.createElement("div");r.innerHTML=o.trim();const a=r.firstElementChild;if(a.classList.remove("nge-grid-block-visible"),e.gridCols&&a.setAttribute("data-grid-cols",e.gridCols),e.gridStart&&a.setAttribute("data-grid-start",e.gridStart),e.nestedRows&&e.nestedRows.length>0){const t=a.querySelector(".nge-grid-block-content");t&&e.nestedRows.forEach(e=>{const n=Dn(e.id);if(e.blocks&&Array.isArray(e.blocks)){[...e.blocks].sort((e,t)=>(e.gridStart||1)-(t.gridStart||1)).forEach(e=>{const t=Rr(e);n.appendChild(t)})}t.appendChild(n)})}else if(e.children&&e.children.length>0){const t=a.querySelector(".nge-grid-block-content");if(t){const n=[];let o=[],r=0;[...e.children].sort((e,t)=>(e.gridStart||1)-(t.gridStart||1)).forEach(e=>{const t=e.gridStart||1,a=t+(e.gridCols||12)-1;t>r?(o.push(e),r=a):(o.length>0&&n.push(o),o=[e],r=a)}),o.length>0&&n.push(o),n.forEach(e=>{const n=Dn();e.forEach(e=>{const t=Rr(e);n.appendChild(t)}),t.appendChild(n)})}}return a}function qr(e,t){if(!t)return{success:!1,error:"Content element is required"};const n=Tr(e);if(!n.isValid)return{success:!1,error:n.error};const o="1.0"===e.version?Nr(e):e;return t.innerHTML="",o.layout&&o.layout.rows?o.layout.rows.forEach(e=>{const n=function(e){const t=Dn(e.id);e.blocks&&Array.isArray(e.blocks)&&[...e.blocks].sort((e,t)=>(e.gridStart||1)-(t.gridStart||1)).forEach(e=>{const n=Rr(e);t.appendChild(n)});return t}(e);t.appendChild(n)}):o.content&&o.content.html&&(t.innerHTML=o.content.html),{success:!0}}function Br(e={}){const t=document.createElement("div");t.className="nge-import-json-modal-content",t.setAttribute("data-testid","import-json-modal-content");const n=document.createElement("div");n.className="nge-import-json-dropzone",n.setAttribute("data-testid","import-json-dropzone");const o=document.createElement("div");o.className="nge-import-json-dropzone-icon",o.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="48" height="48">\n    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M12 18v-6M9 15l3-3 3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>';const r=document.createElement("div");r.className="nge-import-json-dropzone-text",r.textContent=l("importJson.dropzone")||"Drag and drop a JSON file here";const a=document.createElement("input");a.type="file",a.accept=".json,application/json",a.className="nge-import-json-file-input",a.setAttribute("data-testid","import-json-file-input"),a.style.display="none";const i=document.createElement("button");i.type="button",i.className="nge-import-json-choose-btn",i.setAttribute("data-testid","import-json-choose-btn"),i.textContent=l("importJson.chooseFile")||"Choose file";const s=document.createElement("span");s.className="nge-import-json-or-text",s.textContent=l("importJson.orDrop")||"or drag and drop here",n.appendChild(o),n.appendChild(r),n.appendChild(a),n.appendChild(i),n.appendChild(s);const c=document.createElement("div");c.className="nge-import-json-preview",c.setAttribute("data-testid","import-json-preview");const d=document.createElement("h4");d.className="nge-import-json-preview-title",d.textContent=l("importJson.preview")||"Document Preview";const u=document.createElement("div");u.className="nge-import-json-preview-header",u.setAttribute("data-testid","import-json-preview-info");[{id:"version",label:l("importJson.version")||"Version"},{id:"exportedAt",label:l("importJson.exportedAt")||"Exported on"},{id:"rows",label:l("importJson.rows")||"Rows"},{id:"blocks",label:l("importJson.blocks")||"Blocks"},{id:"words",label:l("importJson.words")||"Words"},{id:"chars",label:l("importJson.chars")||"Characters"}].forEach(e=>{const t=document.createElement("div");t.className="nge-import-json-preview-item",t.setAttribute("data-info",e.id);const n=document.createElement("span");n.className="nge-import-json-preview-label",n.textContent=e.label;const o=document.createElement("span");o.className="nge-import-json-preview-value",o.textContent="-",t.appendChild(n),t.appendChild(o),u.appendChild(t)});const g=document.createElement("div");g.className="nge-import-json-preview-label",g.style.marginTop="12px",g.textContent=l("importJson.contentPreview")||"Content Preview";const p=document.createElement("div");p.className="nge-import-json-content-preview nge-readonly",p.setAttribute("data-testid","import-json-content-preview"),p.innerHTML='<p style="color: #6c757d; font-style: italic;">-</p>',c.appendChild(d),c.appendChild(u),c.appendChild(g),c.appendChild(p);const m=document.createElement("div");m.className="nge-import-json-warning",m.setAttribute("data-testid","import-json-warning"),m.textContent=l("importJson.warning")||"Warning: importing will replace all current content";const h=document.createElement("div");return h.className="nge-import-json-error",h.setAttribute("data-testid","import-json-error"),h.style.display="none",t.appendChild(n),t.appendChild(c),t.appendChild(m),t.appendChild(h),t._jsonData=null,function(e,t,n,o,r){const a=n.querySelector(".nge-import-json-choose-btn");a.addEventListener("click",e=>{e.stopPropagation(),t.click()}),n.addEventListener("click",e=>{e.target!==a&&t.click()}),t.addEventListener("change",async()=>{const n=t.files[0];n&&await Dr(e,n,o,r)}),n.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation(),n.classList.add("nge-dropzone-dragover")}),n.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),n.classList.remove("nge-dropzone-dragover")}),n.addEventListener("drop",async t=>{t.preventDefault(),t.stopPropagation(),n.classList.remove("nge-dropzone-dragover");const a=t.dataTransfer.files[0];a&&await Dr(e,a,o,r)})}(t,a,n,c,h),t}async function Dr(e,t,n,o){o.style.display="none",n.classList.remove("nge-visible"),e._jsonData=null;try{const a=await(r=t,new Promise((e,t)=>{if(!(r&&r instanceof File))return void t(new Error(l("importJson.errorInvalidFile")||"Invalid file"));if(!r.name.endsWith(".json")&&"application/json"!==r.type)return void t(new Error(l("importJson.errorInvalidFormat")||"Invalid JSON format"));const n=new FileReader;n.onload=()=>{try{const t=JSON.parse(n.result);e(t)}catch(e){t(new Error(l("importJson.errorInvalidFormat")||"Invalid JSON format"))}},n.onerror=()=>{t(new Error(l("importJson.errorReadFailed")||"Failed to read file"))},n.readAsText(r)})),i=function(e){if(!e||"object"!=typeof e)return{isValid:!1,error:l("importJson.errorInvalidFormat")||"Invalid JSON format"};if(!e.version)return{isValid:!1,error:l("importJson.errorNoVersion")||"Version not specified"};if(!Lr.includes(e.version))return{isValid:!1,error:l("importJson.errorUnsupportedVersion")||"Unsupported version"};const t=Tr(e);return t.isValid?{isValid:!0}:{isValid:!1,error:t.error}}(a);if(!i.isValid)return void Hr(o,i.error);e._jsonData=a,function(e,t){const n=function(e){if(!e||"object"!=typeof e)return null;const t=e.metadata||{};return{version:e.version||"unknown",exportedAt:e.exportedAt||null,wordCount:t.wordCount||0,charCount:t.charCount||0,rowCount:t.rowCount||e.layout?.rows?.length||0,blockCount:t.blockCount||0,hasLayout:!(!e.layout||!e.layout.rows),contentPreview:(e.content?.text||"").slice(0,200),contentHtml:e.content?.html||""}}(t);if(!n)return;e.querySelectorAll(".nge-import-json-preview-item").forEach(e=>{const t=e.getAttribute("data-info"),o=e.querySelector(".nge-import-json-preview-value");switch(t){case"version":o.textContent=n.version;break;case"exportedAt":o.textContent=function(e){if(!e)return"-";try{return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}}(n.exportedAt);break;case"rows":o.textContent=n.rowCount.toString();break;case"blocks":o.textContent=n.blockCount.toString();break;case"words":o.textContent=n.wordCount.toString();break;case"chars":o.textContent=n.charCount.toString()}});const o=e.querySelector(".nge-import-json-content-preview");o&&(n.contentHtml?o.innerHTML=n.contentHtml:n.contentPreview?o.innerHTML="<p>"+n.contentPreview+(n.contentPreview.length>=200?"...":"")+"</p>":o.innerHTML='<p style="color: #6c757d; font-style: italic;">-</p>')}(n,a),n.classList.add("nge-visible")}catch(e){Hr(o,e.message)}var r}function Hr(e,t){e.textContent=t,e.style.display="block"}const jr={maxUndoLevels:100,debounceMs:500,enabled:!0};class zr{constructor(e={}){this.config={...jr,...e},this.undoStack=[],this.redoStack=[],this.currentState=null,this.debounceTimer=null,this.contentElement=null,this._isRestoring=!1}init(e){if(!(e&&e instanceof HTMLElement))throw new Error("HistoryManager requires a valid content element");this.contentElement=e,this.currentState=this._captureState()}_captureState(){return this.contentElement?{html:this.contentElement.innerHTML,timestamp:Date.now()}:null}_hasStateChanged(){if(!this.currentState)return!0;return this.contentElement.innerHTML!==this.currentState.html}saveState(e=!1){this.config.enabled&&!this._isRestoring&&this.contentElement&&(this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),e?this._doSaveState():this.debounceTimer=setTimeout(()=>{this._doSaveState(),this.debounceTimer=null},this.config.debounceMs))}_doSaveState(){if(this._hasStateChanged()){if(this.currentState)for(this.undoStack.push(this.currentState);this.undoStack.length>this.config.maxUndoLevels;)this.undoStack.shift();this.redoStack=[],this.currentState=this._captureState()}}flush(){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null,this._doSaveState())}undo(){if(!this.canUndo()||!this.contentElement)return!1;this.flush(),this.currentState&&this.redoStack.push(this.currentState);const e=this.undoStack.pop();return this._restoreState(e),!0}redo(){if(!this.canRedo()||!this.contentElement)return!1;this.currentState&&this.undoStack.push(this.currentState);const e=this.redoStack.pop();return this._restoreState(e),!0}_restoreState(e){if(e&&this.contentElement){this._isRestoring=!0;try{this.contentElement.innerHTML=e.html,this.currentState=e}finally{this._isRestoring=!1}}}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),this.undoStack=[],this.redoStack=[],this.currentState=this._captureState()}getState(){return{undoCount:this.undoStack.length,redoCount:this.redoStack.length,enabled:this.config.enabled,maxUndoLevels:this.config.maxUndoLevels}}destroy(){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),this.undoStack=[],this.redoStack=[],this.currentState=null,this.contentElement=null}}const Fr=[/xmlns:o\s*=\s*["']urn:schemas-microsoft-com:office:office["']/i,/xmlns:w\s*=\s*["']urn:schemas-microsoft-com:office:word["']/i,/xmlns:m\s*=\s*["']http:\/\/schemas\.microsoft\.com\/office\/math["']/i,/class\s*=\s*["']?Mso[a-zA-Z]+/i,/style\s*=\s*["'][^"']*mso-/i,/<o:p[\s>]/i,/<w:[a-z]/i,/<v:shape/i,/<m:oMath/i,/<!--\[if\s+[!]?(?:mso|support|gt|lt|gte|lte)/i],Or=[/name\s*=\s*["']GENERATOR["']\s+content\s*=\s*["']LibreOffice/i,/content\s*=\s*["']LibreOffice[^"']*["']\s+name\s*=\s*["']GENERATOR["']/i],Pr=["p","br","div","span","h1","h2","h3","h4","h5","h6","ul","ol","li","table","thead","tbody","tfoot","tr","td","th","caption","colgroup","col","strong","b","em","i","u","s","strike","sub","sup","a","img","blockquote","pre","code"],Vr={a:["href","title","target","style"],img:["src","alt","width","height","style"],table:["border","cellpadding","cellspacing","style"],thead:["style"],tbody:["style"],tfoot:["style"],tr:["style"],td:["colspan","rowspan","style"],th:["colspan","rowspan","scope","style"],col:["span","style"],colgroup:["span","style"],caption:["style"],ol:["type","start","style"],ul:["style"],li:["style"],p:["style","align"],div:["style","align"],blockquote:["style","align"],pre:["style"],h1:["style","align"],h2:["style","align"],h3:["style","align"],h4:["style","align"],h5:["style","align"],h6:["style","align"],span:["style"],strong:["style"],b:["style"],em:["style"],i:["style"],u:["style"],s:["style"],strike:["style"],sub:["style"],sup:["style"],code:["style"],br:[]};function Wr(e){return e?e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function Ur(e){if(!e||"string"!=typeof e)return"";let t=e;return t=(o=t)?o.replace(/<!--StartFragment-->/gi,"").replace(/<!--EndFragment-->/gi,""):"",t=function(e){if(!e)return"";let t=e;return t=t.replace(/<\?xml[^?]*\?>/gi,""),t=t.replace(/\s*xmlns:[a-z]+\s*=\s*["'][^"']*["']/gi,""),t}(t),t=function(e){if(!e)return"";const t=/<style[^>]*>([\s\S]*?)<\/style>/gi,n=[];let o;for(;null!==(o=t.exec(e));)n.push(o[1]);if(0===n.length)return e;const r=[];let a=n.join("\n");a=a.replace(/<!--/g,"").replace(/-->/g,"");const i=/([^{}]+)\{([^{}]+)\}/g;for(;null!==(o=i.exec(a));){const e=o[1].trim(),t=o[2].trim();if(e.startsWith("@"))continue;const n={};t.split(";").forEach(e=>{const t=e.indexOf(":");if(t>0){const o=e.substring(0,t).trim(),r=e.substring(t+1).trim();o&&r&&!o.toLowerCase().startsWith("mso-")&&(n[o]=r)}}),Object.keys(n).length>0&&r.push({selector:e,styles:n})}if(0===r.length)return e;const l=document.createElement("div");l.innerHTML=e;for(const e of r)try{l.querySelectorAll(e.selector).forEach(t=>{const n=t.getAttribute("style")||"",o={};n.split(";").forEach(e=>{const t=e.indexOf(":");if(t>0){const n=e.substring(0,t).trim(),r=e.substring(t+1).trim();n&&r&&(o[n]=r)}});const r={...e.styles,...o},a=Object.entries(r).map(([e,t])=>e+": "+t).join("; ");a&&t.setAttribute("style",a)})}catch(e){}return l.innerHTML}(t),t=function(e){if(!e)return"";let t=e;return t=t.replace(/<!DOCTYPE[^>]*>/gi,""),t=t.replace(/<html[^>]*>/gi,""),t=t.replace(/<\/html>/gi,""),t=t.replace(/<head[\s\S]*?<\/head>/gi,""),t=t.replace(/<body[^>]*>/gi,""),t=t.replace(/<\/body>/gi,""),t=t.replace(/<meta[^>]*>/gi,""),t=t.replace(/<link[^>]*>/gi,""),t=t.replace(/<style[\s\S]*?<\/style>/gi,""),t}(t),t=function(e){if(!e)return"";let t=e;return t=t.replace(/<!--\[if\s+!vml\]-->([\s\S]*?)<!--\[endif\]-->/gi,"$1"),t=t.replace(/<!\[if\s+!vml\]>([\s\S]*?)<!\[endif\]>/gi,"$1"),t=t.replace(/<!--\[if\s+!supportVml\]-->([\s\S]*?)<!--\[endif\]-->/gi,"$1"),t=t.replace(/<!--\[if[^\]]*vml[^\]]*\]>[\s\S]*?<!\[endif\]-->/gi,""),t=t.replace(/<!--\[if[^\]]*\]-->[\s\S]*?<!--\[endif\]-->/gi,""),t=t.replace(/<!--\[if[^\]]*\]>[\s\S]*?<!\[endif\]-->/gi,""),t=t.replace(/<!--\[if[^\]]*\]-->/gi,""),t=t.replace(/<!--\[if[^\]]*\]>/gi,""),t=t.replace(/<!--\[endif\]-->/gi,""),t=t.replace(/<!\[endif\]-->/gi,""),t=t.replace(/<!\[if[^\]]*\]>/gi,""),t=t.replace(/<!\[endif\]>/gi,""),t}(t),t=function(e){if(!e)return"";let t=e;return t=t.replace(/<v:shapetype[\s\S]*?<\/v:shapetype>/gi,""),t=t.replace(/<v:shape[^>]*>[\s\S]*?<v:imagedata[^>]*\ssrc\s*=\s*["']([^"']+)["'][^>]*\/?>[\s\S]*?<\/v:shape>/gi,(e,t)=>{if(t.startsWith("file://")||t.startsWith("file:///"))return"";const n=e.match(/style\s*=\s*["']([^"']+)["']/i);let o="",r="";if(n){const e=n[1].match(/width:\s*([0-9.]+(?:px|pt|in|cm)?)/i),t=n[1].match(/height:\s*([0-9.]+(?:px|pt|in|cm)?)/i);e&&(o=e[1]),t&&(r=t[1])}let a='<img src="'+t+'"';return o&&(a+=' width="'+o+'"'),r&&(a+=' height="'+r+'"'),a+=' alt="">',a}),t=t.replace(/<v:shape[^>]*>[\s\S]*?<\/v:shape>/gi,""),t=t.replace(/<\/v:shape>/gi,""),t=t.replace(/<v:imagedata[^>]*\ssrc\s*=\s*["']([^"']+)["'][^>]*\/?>/gi,(e,t)=>t.startsWith("file://")||t.startsWith("file:///")?"":'<img src="'+t+'" alt="">'),t=t.replace(/<w:pict[^>]*>/gi,""),t=t.replace(/<\/w:pict>/gi,""),t}(t),t=function(e){if(!e)return"";let t=e;return t=t.replace(/<(o|w|v|m|st1):[a-z0-9]+[^>]*\/>/gi,""),t=t.replace(/<(o|w|v|m|st1):[a-z0-9]+[^>]*>/gi,""),t=t.replace(/<\/(o|w|v|m|st1):[a-z0-9]+>/gi,""),t}(t),t=function(e){if(!e)return"";const t=document.createElement("div");t.innerHTML=e;const n=t.querySelectorAll('p[class*="MsoList"], p[style*="mso-list"]');if(0===n.length)return e;const o=[];let r=[];return n.forEach((e,t)=>{const a=t>0?n[t-1]:null;if(a){let t=a.nextElementSibling,n=!1,i=5;for(;t&&i>0;){if(t===e){n=!0;break}if(""!==t.textContent.trim())break;t=t.nextElementSibling,i--}n?r.push(e):(r.length>0&&o.push(r),r=[e])}else r.push(e)}),r.length>0&&o.push(r),o.forEach(e=>{if(0===e.length)return;const t=e[0].textContent.trim(),n=/^[\d]+[.)\]]|^[a-zA-Z][.)\]]|^[ivxIVX]+[.)\]]|^\([a-zA-Z\d]+\)/.test(t),o=document.createElement(n?"ol":"ul");e.forEach(e=>{const t=document.createElement("li"),n=e.getAttribute("style");if(n){const e=n.split(";").filter(e=>{const t=e.trim().toLowerCase();return t&&!t.startsWith("mso-")&&!t.startsWith("text-indent")&&!t.startsWith("margin-left")}).join("; ");e&&t.setAttribute("style",e)}let r=e.innerHTML;r=r.replace(/^(\s*(<[^>]+>\s*)*)([\u2022\u2023\u25E6\u2043\u2219•\-\*]\s*)/i,"$1"),r=r.replace(/^(\s*(<[^>]+>\s*)*)(\d+[.)\]]\s*)/i,"$1"),r=r.replace(/^(\s*(<[^>]+>\s*)*)([a-zA-Z][.)\]]\s*)/i,"$1"),r=r.replace(/^(\s*(<[^>]+>\s*)*)(\([a-zA-Z\d]+\)\s*)/i,"$1"),r=r.replace(/^(\s*(<[^>]+>\s*)*)([ivxIVX]+[.)\]]\s*)/i,"$1"),r=r.replace(/^(\s|&nbsp;)+/,""),t.innerHTML=r,o.appendChild(t)});const r=e[0];r.parentNode&&(r.parentNode.insertBefore(o,r),e.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}))}),t.innerHTML}(t),t=function(e){if(!e)return"";const t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll("[align]").forEach(e=>{const t=e.getAttribute("align");if(t){const n=e.getAttribute("style")||"";if(!n.toLowerCase().includes("text-align")){const o=n?n+"; text-align: "+t:"text-align: "+t;e.setAttribute("style",o)}e.removeAttribute("align")}}),t.innerHTML}(t),t=function(e){if(!e)return"";const t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll("[style]").forEach(e=>{const t=(n=e.getAttribute("style"))?n.split(";").map(e=>e.trim()).filter(e=>e&&!e.toLowerCase().startsWith("mso-")).join("; "):"";var n;t?e.setAttribute("style",t):e.removeAttribute("style")}),t.innerHTML}(t),t=(n=t)?n.replace(/\s*class\s*=\s*(["'])([^"']*)\1/gi,(e,t,n)=>{const o=n.split(/\s+/).filter(e=>e&&!/^Mso/i.test(e)).join(" ");return o?' class="'+o+'"':""}):"",t=function(e){if(!e)return"";const t=Pr.map(e=>e.toLowerCase()),n=document.createElement("div");function o(e){if(e.nodeType===Node.TEXT_NODE)return e.textContent;if(e.nodeType!==Node.ELEMENT_NODE)return"";const n=e.tagName.toLowerCase();let r="";for(const t of e.childNodes)r+=o(t);if(t.includes(n)){const t=Vr[n]||[];let o="";for(const n of e.attributes)if(t.includes(n.name.toLowerCase())){const e=Wr(n.value);o+=" "+n.name+'="'+e+'"'}return["br","img","col"].includes(n)?"<"+n+o+">":"<"+n+o+">"+r+"</"+n+">"}return r}n.innerHTML=e;let r="";for(const e of n.childNodes)r+=o(e);return r}(t),t=function(e){if(!e)return"";let t=e,n="";for(;t!==n;)n=t,t=t.replace(/<(span|font|b|i|em|strong|u|s)(\s[^>]*)?>(\s|&nbsp;)*<\/\1>/gi,""),t=t.replace(/<p(\s[^>]*)?>(\s|&nbsp;)*<\/p>/gi,""),t=t.replace(/<div(\s[^>]*)?>(\s|&nbsp;)*<\/div>/gi,"");return t}(t),t=function(e){if(!e)return"";const t=document.createElement("div");t.innerHTML=e,function e(t){if(t.nodeType===Node.TEXT_NODE)t.textContent=t.textContent.replace(/\s+/g," ");else if(t.nodeType===Node.ELEMENT_NODE)for(const n of t.childNodes)e(n)}(t);let n=t.innerHTML;return n=n.trim(),n=n.replace(/(<\/(?:p|h[1-6]|li|tr|div|blockquote)>)(<(?:p|h[1-6]|li|tr|div|blockquote|ul|ol|table))/gi,"$1\n$2"),n}(t),t;var n,o}const _r="paragraph",Gr="heading",Jr="list",Zr="table",Xr="image",Kr="text",$r="media";function Yr(e){return e?{src:e.getAttribute("src")||"",alt:e.getAttribute("alt")||"",width:e.getAttribute("width")||"",height:e.getAttribute("height")||""}:{src:"",alt:"",width:"",height:""}}function Qr(e){if(!e)return"";return e.split(";").map(e=>e.trim()).filter(e=>e&&!e.toLowerCase().startsWith("mso-")).join("; ")}function ea(e){switch(e){case Zr:case Xr:return $r;default:return Kr}}function ta(e){if(!e)return!0;const t=document.createElement("div");t.innerHTML=e;const n=t.textContent.trim(),o=t.querySelectorAll("img").length>0,r=t.querySelectorAll("table").length>0;return""===n&&!o&&!r}function na(e,t,n={}){return{type:e,content:t,blockType:ea(e),metadata:n}}function oa(e){if(!e)return null;const t=e.tagName.toLowerCase(),n=parseInt(t.charAt(1),10);return na(Gr,e.outerHTML,{level:n})}function ra(e){if(!e)return null;if((t=e)&&t.querySelector("img")&&""===t.textContent.trim()){const t=e.querySelector("img");return na(Xr,'<img src="'+(t.getAttribute("src")||"")+'" alt="'+(t.getAttribute("alt")||"")+'">',Yr(t))}var t;return ta(e.innerHTML)?null:na(_r,e.outerHTML,{})}function aa(e){if(!e)return null;const t="ol"===e.tagName.toLowerCase()?"ordered":"unordered",n=e.querySelectorAll(":scope > li");return na(Jr,e.outerHTML,{listType:t,itemCount:n.length})}function ia(e){if(!e)return null;const t=e.querySelectorAll("tr"),n=t.length>0?t[0].querySelectorAll("td, th").length:0;return na(Zr,function(e){if(!e)return"";const t=e.cloneNode(!0);t.querySelectorAll("*").forEach(e=>{const t=e.getAttribute("style");if(t){const n=Qr(t);n?e.setAttribute("style",n):e.removeAttribute("style")}e.removeAttribute("class"),e.removeAttribute("id")});const n=t.getAttribute("style");if(n){const e=Qr(n);e?t.setAttribute("style",e):t.removeAttribute("style")}const o=["border","cellpadding","cellspacing","style"];return Array.from(t.attributes).forEach(e=>{!o.includes(e.name)&&t.removeAttribute(e.name)}),t.outerHTML}(e),{rowCount:t.length,colCount:n})}function la(e){if(!e)return null;const t=Yr(e);return na(Xr,'<img src="'+t.src+'" alt="'+t.alt+'">',t)}function sa(e){if(!e)return null;if(ta(e.innerHTML))return null;const t=e.firstElementChild;if(t){const n=t.tagName.toLowerCase();if(1===e.children.length){if(/^h[1-6]$/.test(n))return oa(t);if("ul"===n||"ol"===n)return aa(t);if("table"===n)return ia(t);if("img"===n)return la(t)}}return na(_r,e.innerHTML,{})}function ca(e){if(!e)return{targetBlock:null,targetRow:null,insertAfterBlock:!1};const t=window.getSelection();if(!t||0===t.rangeCount)return{targetBlock:null,targetRow:null,insertAfterBlock:!1};let n=t.getRangeAt(0).commonAncestorContainer;n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);const o=n?.closest(".nge-grid-block");if(!o)return{targetBlock:null,targetRow:null,insertAfterBlock:!1};const r=o.closest(".nge-grid-row");return{targetBlock:o,targetRow:r,insertAfterBlock:!0}}function da(e,t=1){const n=Ln({blockType:e.blockType,gridWidth:"100",nestingLevel:t},e.content),o=document.createElement("div");return o.innerHTML=n,o.firstElementChild}function ua(e,t,n){if(!e||0===e.length||!t)return[];const o=function(e,t=1){const n=[];for(const o of e){const e=da(o,t),r=Dn();On(r,e,1),n.push(r)}return n}(e,n.targetBlock?function(e){if(!e)return 1;const t=e.getAttribute("data-nesting-level");if(t){const e=parseInt(t,10);return isNaN(e)?1:e}return 1}(n.targetBlock):1);!function(e,t,n){if(e&&0!==e.length&&t)if(n.targetRow&&n.targetRow.parentElement){let t=n.targetRow;for(const n of e)t.after(n),t=n}else for(const n of e)t.appendChild(n)}(o,t,n);const r=[];for(const e of o){const t=e.querySelector(".nge-grid-block");t&&r.push(t)}return r}function ga(e,t,n={}){if(!e||!t)return!1;const o=e.clipboardData||window.clipboardData;if(!o)return!1;const r=o.files;if(r&&r.length>0){const o=Array.from(r).find(e=>e.type.startsWith("image/"));if(o){e.preventDefault(),e.stopPropagation(),n.onBeforeInsert&&n.onBeforeInsert();const r=new FileReader;return r.onload=e=>{pa(e.target.result,t,n)},r.readAsDataURL(o),!0}}const a=o.getData("text/html");if(a){const o=function(e){if(!e||"string"!=typeof e)return{isImage:!1,imgSrc:null};const t=document.createElement("div");t.innerHTML=e;const n=t.querySelectorAll("img");if(0===n.length)return{isImage:!1,imgSrc:null};const o=t.textContent.trim();if(1===n.length&&""===o){const e=n[0],t=e.getAttribute("src");if(t&&(t.startsWith("data:image/")||t.startsWith("http://")||t.startsWith("https://")))return{isImage:!0,imgSrc:t,width:e.getAttribute("width")||"",height:e.getAttribute("height")||"",alt:e.getAttribute("alt")||""}}return{isImage:!1,imgSrc:null}}(a);if(o.isImage)return e.preventDefault(),e.stopPropagation(),n.onBeforeInsert&&n.onBeforeInsert(),pa(o.imgSrc,t,n,o),!0}return!1}function pa(e,t,n,o={}){const r=ca(t);let a=300,i="auto";if(o.width&&(a="string"==typeof o.width&&o.width.endsWith("pt")?Math.round(1.33*parseFloat(o.width)):parseInt(o.width,10)||300),o.height&&"auto"!==o.height)if("string"==typeof o.height&&o.height.endsWith("pt"))i=Math.round(1.33*parseFloat(o.height));else{const e=parseInt(o.height,10);i=e>0?e:"auto"}const l=Ie({src:e,width:a,height:i,rotation:0,opacity:100,borderStyle:"none",borderWidth:0,borderColor:"#000000",borderRadius:0,align:"center"}),s=ua([{type:Xr,content:l,blockType:$r,metadata:{src:e,...o}}],t,r);n.onAfterInsert&&n.onAfterInsert(s),n.onContentChange&&n.onContentChange()}function ma(e,t,n={}){if(!e||!t)return!1;const o=e.clipboardData||window.clipboardData;if(!o)return!1;if(ga(e,t,n))return!0;const r=o.getData("text/html");if(!r)return!1;if(!function(e){if(!e||"string"!=typeof e)return{isOffice:!1,source:null};for(const t of Fr)if(t.test(e))return{isOffice:!0,source:"word"};for(const t of Or)if(t.test(e))return{isOffice:!0,source:"libreoffice"};return{isOffice:!1,source:null}}(r).isOffice)return!1;e.preventDefault(),e.stopPropagation(),n.onBeforeInsert&&n.onBeforeInsert();try{const e=function(e){if(!e||"string"!=typeof e)return[];const t=[],n=document.createElement("div");n.innerHTML=e;for(const e of n.children){const n=e.tagName.toLowerCase();let o=null;/^h[1-6]$/.test(n)?o=oa(e):"p"===n?o=ra(e):"ul"===n||"ol"===n?o=aa(e):"table"===n?o=ia(e):"img"===n?o=la(e):"div"===n||"section"===n||"article"===n?o=sa(e):"blockquote"===n?o=na(_r,e.outerHTML,{isBlockquote:!0}):"pre"===n?o=na(_r,e.outerHTML,{isCode:!0}):("span"===n||"b"===n||"i"===n||"strong"===n||"em"===n)&&!ta(e.innerHTML)&&(o=na(_r,"<p>"+e.outerHTML+"</p>",{})),o&&t.push(o)}for(const e of n.childNodes)if(e.nodeType===Node.TEXT_NODE){const n=e.textContent.trim();n&&t.push(na(_r,"<p>"+n+"</p>",{}))}return t}(Ur(r));if(0===e.length)return!0;const o=(i=e)&&Array.isArray(i)?i:[],l=(a=o)&&Array.isArray(a)?a.map(e=>{if(e.type!==Xr)return e;const t=e.metadata||{};let n=t.src||"",o=t.width||"",r=t.height||"";if(!n&&e.content){const t=document.createElement("div");t.innerHTML=e.content;const a=t.querySelector("img");a&&(n=a.getAttribute("src")||"",o=a.getAttribute("width")||"",r=a.getAttribute("height")||"")}if(!n)return e;let a=300,i="auto";if(o&&(a="string"==typeof o&&o.endsWith("pt")?Math.round(1.33*parseFloat(o)):parseInt(o,10)||300),r&&"auto"!==r)if("string"==typeof r&&r.endsWith("pt"))i=Math.round(1.33*parseFloat(r));else{const e=parseInt(r,10);i=e>0?e:"auto"}const l=Ie({src:n,width:a,height:i,rotation:0,opacity:100,borderStyle:"none",borderWidth:0,borderColor:"#000000",borderRadius:0,align:"center"});return{...e,content:l}}):[],s=ua(l,t,ca(t));if(s.length>0){const e=s[0].querySelector(".nge-grid-block-content");e&&setTimeout(()=>{e.focus();const t=window.getSelection(),n=document.createRange();e.firstChild&&(n.setStart(e.firstChild,0),n.collapse(!0),t.removeAllRanges(),t.addRange(n))},0)}return n.onAfterInsert&&n.onAfterInsert(s),n.onContentChange&&n.onContentChange(),!0}catch(e){console.warn("NGTextEditor: Error handling Office paste:",e);try{const e=o.getData("text/plain");if(e){const o=ca(t);ua([{type:"paragraph",content:"<p>"+e.replace(/\n/g,"<br>")+"</p>",blockType:Kr,metadata:{}}],t,o),n.onContentChange&&n.onContentChange()}}catch(e){console.warn("NGTextEditor: Fallback paste also failed:",e)}return!0}var a,i}const ha="nge-license-cache",ba=500,fa=["paragraph","font-family","font-size","line-height","text-color","bg-color","bold","italic","underline","strikethrough","text-case","superscript","align-left","align-center","align-right","align-justify","indent","outdent","list-ul","list-ol","link","image","emoji","hr","undo","redo","block-outlines","toolbar-config"],va=["paragraph","font-family","font-size","line-height","text-color","bg-color","bold","italic","underline","strikethrough","text-case","superscript","align-left","align-center","align-right","align-justify","indent","outdent","list-ul","list-ol","list-todo","link","image","video","table","columns","emoji","quote","code","hr","undo","redo","preview","block-outlines","import-json","export-json","export-pdf","export-html","toolbar-config"];function ya(e){try{const t={...e,cachedAt:Date.now(),domain:wa(window.location.hostname)};localStorage.setItem(ha,JSON.stringify(t))}catch(e){}}function wa(e){return(e=(e||"").toLowerCase().trim()).startsWith("www.")&&(e=e.substring(4)),e}async function Ca(e,t=!1){const n=wa(e);if(!t){const e=function(){try{const e=localStorage.getItem(ha);if(!e)return null;const t=JSON.parse(e);if(t.cachedAt&&Date.now()-t.cachedAt>864e5)return localStorage.removeItem(ha),null;const n=wa(window.location.hostname);return t.domain!==n?(localStorage.removeItem(ha),null):t}catch(e){return null}}();if(null!==e)return e}try{const e=await fetch(window.NGE_LICENSE_API_URL||"https://ngedition.fr/api/license/validate",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({domain:n})});if(!e.ok){const e={valid:!1,error:"api_error"};return ya(e),e}const t=await e.json();return ya(t),t}catch(e){return{valid:!1,error:"network_error"}}}function ka(e){return e?[]:va.filter(e=>!fa.includes(e))}function xa(e){if(!e||"string"!=typeof e)return 0;const t=e.trim();return""===t?0:t.split(/\s+/).filter(e=>e.length>0).length}class NGTextEditor{constructor(e,t={}){if(!(e&&e instanceof HTMLElement))throw new Error("NGTextEditor requires a valid HTMLElement");this.element=e,this.options={autoSync:!0,syncInterval:1e3,initialFormat:"html",...t},this.structure=null,this.syncTimer=null,this.initialized=!1,this.toolbarConfig=null,this.savedSelection=null,this.isLocal=null,this.licenseValid=!1,this.licenseData=null,this.wordLimitReached=!1,this.externalConfig=null,this.configLocked=!1,this.lockedCustomColors=null,this.lockedCustomFonts=null,this.historyManager=null,this.init()}init(){if(this.initialized)throw new Error("Editor already initialized");try{this.isLocal=this.isLocalEnvironment(),this.isLocal&&(this.licenseValid=!0),this.toolbarConfig=Wo();const e=this.isLocal?[]:ka(this.licenseValid);for(const t of e)this.toolbarConfig[t]=!1;const t=this.getCustomFonts();t&&t.length>0&&p(t),this.structure=function(e,t=null,n="html"){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid target element");const o=document.createElement("div");o.className="nge-container",o.setAttribute("data-testid","nge-container");const r=E(t),a=document.createElement("div");a.className="nge-main-drop-zone",a.setAttribute("data-testid","nge-main-drop-zone"),a.setAttribute("aria-hidden","true");const i=document.createElement("div");i.className="nge-content",i.setAttribute("contenteditable","true"),i.setAttribute("role","textbox"),i.setAttribute("aria-multiline","true"),i.setAttribute("aria-label","Text editor content"),i.setAttribute("data-testid","nge-content"),e.value&&("html"===n?i.innerHTML=e.value:i.textContent=e.value),o._originalElement=e;const l=document.createElement("div");l.className="nge-counter",l.setAttribute("data-testid","nge-counter");const s=document.createElement("span");s.className="nge-counter-words",s.setAttribute("data-testid","nge-counter-words");const c=document.createElement("span");c.className="nge-counter-chars",c.setAttribute("data-testid","nge-counter-chars"),l.appendChild(s),l.appendChild(c);const d=document.createElement("div");return d.className="nge-statusbar",d.setAttribute("data-testid","nge-statusbar"),d.style.display="none",o.appendChild(r),o.appendChild(a),o.appendChild(i),o.appendChild(l),o.appendChild(d),{container:o,toolbar:r,mainDropZone:a,content:i,counter:l,wordCount:s,charCount:c,statusBar:d,originalElement:e}}(this.element,this.toolbarConfig,this.options.initialFormat),Pn(this.structure.content)&&Vn(this.structure.content),Wn(this.structure.content),function(e,t){if(!e||!t||!t.container)throw new Error("Invalid parameters for replaceElement");if(e.style.display="none",!e.parentNode)throw new Error("Target element has no parent node");e.parentNode.insertBefore(t.container,e.nextSibling)}(this.element,this.structure),B(),this.setTheme(this.getCurrentTheme()),this.setIconSize(this.getCurrentIconSize()),this.setToolbarMode(this.getCurrentToolbarMode()),this.initBlockOutlines(),this.setupEventListeners(),pe(this.structure.content),qe(this.structure.content,e=>{this.handleImageEdit(e)}),De(this.structure.content,e=>{this.handleElementDelete(e)}),Be(this.structure.content,(e,t)=>{Le().allowRotation&&this.handleImageRotate(e,t)}),_e(this.structure.content,(e,t,n)=>{this.handleImageResize(e,t,n)},(e,t)=>{Le().allowRotation&&this.handleImageRotate(e,t)}),rt(this.structure.content,e=>{this.handleVideoEdit(e)}),at(this.structure.content,e=>{this.handleElementDelete(e)}),wt(this.structure.content,e=>{this.handleTableEdit(e)}),Ct(this.structure.content,e=>{this.handleElementDelete(e)}),kt(this.structure.content),Ot(this.structure.content,{onContentChange:()=>this.handleContentChange()}),Pt(this.structure.content),mn(this.structure.content,e=>{this.handleColumnEdit(e)}),hn(this.structure.content,e=>{this.handleElementDelete(e)}),ne(this.structure.content,e=>{this.handleElementDelete(e)}),me(this.structure.content,e=>{this.handleElementDelete(e)}),qn(this.structure.content,{onAddTextBlock:(e,t,n)=>{this.handleAddGridBlock(bn.TEXT,e,t,n)},onAddMediaBlock:(e,t,n)=>{this.handleAddGridBlock(bn.MEDIA,e,t,n)},onContentChange:()=>this.handleContentChange()}),Nn(this.structure.content,e=>{this.handleGridBlockConfig(e)}),oo(this.structure.content,{onPlacementStart:()=>{this.historyManager&&this.historyManager.saveState(!0)},onPlacementComplete:e=>{setTimeout(()=>{const t=e.querySelector(".nge-grid-block-content");if(t){""===t.innerHTML.trim()&&(t.innerHTML="<br>"),t.focus();const e=window.getSelection(),n=document.createRange();t.firstChild?(n.setStart(t.firstChild,0),n.collapse(!0)):(n.selectNodeContents(t),n.collapse(!0)),e.removeAllRanges(),e.addRange(n)}this.handleContentChange(),this.updateToolbar()},10)},onPlacementCancel:()=>{}}),this.structure.content._ngeHandlersSetup=!0,this.structure.content.addEventListener("click",e=>{const t=e.target.closest(".nge-grid-block");if(!t)return;if(e.target.closest(".nge-grid-block-buttons"))return;const n=t.querySelector(":scope > .nge-grid-block-content");if(!n)return;t.classList.contains("nge-grid-block-visible")&&t.classList.remove("nge-grid-block-visible");const o=e.target.closest(".nge-grid-block-content");if(o&&o!==n)return;const r=o===n;if("true"===n.getAttribute("contenteditable")){if(""===n.innerHTML.trim()&&(n.innerHTML="<br>"),!r){n.focus();const e=window.getSelection(),t=document.createRange();n.firstChild?(t.setStart(n.firstChild,0),t.collapse(!0)):(t.selectNodeContents(n),t.collapse(!0)),e.removeAllRanges(),e.addRange(t)}setTimeout(()=>{this.updateToolbar()},0)}}),this.options.autoSync&&this.startAutoSync(),this.updateCounter(),this.updateStatusBar(),this.historyManager=new zr({maxUndoLevels:this.options.maxUndoLevels||100,debounceMs:this.options.historyDebounceMs||500}),this.historyManager.init(this.structure.content),this.initialized=!0;const n=this.options.configUrl||this.element.getAttribute("data-ngte-config")||"/ngTextEditor-config.json";this.isLocal?this.loadExternalConfigAsync(n):this.validateLicenseAsync().then(()=>{this.licenseValid&&this.loadExternalConfigAsync(n)})}catch(e){throw new Error("Failed to initialize NGTextEditor: "+e.message)}}async validateLicenseAsync(){try{const e=window.location.hostname;this.licenseData=await Ca(e,!0);const t=this.licenseValid;if(this.licenseValid=function(e){if(!e||!0!==e.valid)return!1;if(e.expiresAt&&new Date(e.expiresAt)<new Date)return!1;return!0}(this.licenseData),this.licenseValid!==t){if(this.toolbarConfig=Wo(),!this.licenseValid){const e=ka(!1);for(const t of e)this.toolbarConfig[t]=!1}this.rebuildToolbar()}this.updateStatusBar(),this.checkWordLimit()}catch(e){console.warn("License validation failed:",e)}}checkWordLimit(){if(this.licenseValid||this.isLocal)return void(this.wordLimitReached=!1);const e=this.structure?.content?.textContent||"";var t;this.wordLimitReached=(t=e,!!1&&xa(t)>=ba),this.updateStatusBar()}async loadExternalConfigAsync(e){try{const t=await fetch(e);if(!t.ok)throw new Error("HTTP "+t.status+": "+t.statusText);const n=await t.json();this.applyExternalConfig(n)}catch(e){console.warn("Failed to load external configuration:",e)}}applyExternalConfig(e){if(!e)return;if(!this.isLocal&&!this.licenseValid)return void console.warn("External configuration requires a valid license");if(this.externalConfig=e,this.configLocked=!0===e.locked||"true"===e.locked,!this.configLocked){ye(null),p(null);const e=this.getCustomFonts();e&&e.length>0&&p(e),this.setTheme(this.getCurrentTheme());if(i(a()),this.setIconSize(this.getCurrentIconSize()),this.setToolbarMode(this.getCurrentToolbarMode()),this.toolbarConfig=Wo(),this.toolbarConfig["toolbar-config"]=!0,Uo(this.toolbarConfig),!this.isLocal&&!this.licenseValid){const e=ka(!1);for(const t of e)this.toolbarConfig[t]=!1}return this.rebuildToolbar(),void this.element.dispatchEvent(new CustomEvent("nge:configLoaded",{detail:{config:this.externalConfig,locked:this.configLocked}}))}e.settings&&(e.settings.theme&&this.setTheme(e.settings.theme,!1),e.settings.language&&i(e.settings.language,!1),e.settings.iconSize&&this.setIconSize(e.settings.iconSize,!1),e.settings.toolbarMode&&this.setToolbarMode(e.settings.toolbarMode,!1),e.settings.showBlockOutlines&&this.setBlockOutlines(e.settings.showBlockOutlines));let t=[];e.customColors&&Array.isArray(e.customColors)&&(t=[...e.customColors]);const n=e.autoDetectColors;if(!0===n||"object"==typeof n&&!1!==n.enabled){const e="object"==typeof n?n:{},o=Fo({maxColors:e.maxColors||10,similarityThreshold:e.similarityThreshold||40,includeGrays:e.includeGrays||!1,sortByHue:!1!==e.sortByHue});for(const e of o){!t.some(t=>t.toLowerCase()===e.toLowerCase())&&t.push(e)}const r=e.maxTotal||15;t.length>r&&(t=t.slice(0,r))}if(t.length>0&&(this.lockedCustomColors=t,ye(t)),e.customFonts&&Array.isArray(e.customFonts)&&(this.lockedCustomFonts=e.customFonts,p(e.customFonts),this.rebuildToolbar()),e.tools){const t={},n={};for(const o in e.tools){const r=e.tools[o];for(const e in r){const o=r[e];"object"==typeof o&&null!==o?(n[e]=o,t[e]=!1!==o.activate):t[e]=o}}if(C(n),n.image?Ae({allowImageUrl:!1!==n.image.allowImageUrl,allowDragNDrop:!1!==n.image.allowDragNDrop,allowRotation:!1!==n.image.allowRotation,allowOpacity:!1!==n.image.allowOpacity,allowBorder:!1!==n.image.allowBorder}):Ae({}),n.video?Ke({allowBorder:!1!==n.video.allowBorder}):Ke({}),n.columns?an({maxNumberOfColumns:void 0!==n.columns.maxNumberOfColumns?n.columns.maxNumberOfColumns:3,allowBorder:!1!==n.columns.allowBorder}):an({}),n.quote?Q({classic:!1!==n.quote.classic,modern:!1!==n.quote.modern,elegant:!1!==n.quote.elegant,minimal:!1!==n.quote.minimal,boxed:!1!==n.quote.boxed,shadow:!1!==n.quote.shadow,gradient:!1!==n.quote.gradient,retro:!1!==n.quote.retro,academic:!1!==n.quote.academic,callout:!1!==n.quote.callout}):Q({}),t["toolbar-config"]=!1,this.toolbarConfig={...this.toolbarConfig,...t},!this.isLocal&&!this.licenseValid){const e=ka(!1);for(const t of e)this.toolbarConfig[t]=!1}this.rebuildToolbar()}else{if(C({}),Ae({}),Ke({}),an({}),Q({}),this.toolbarConfig["toolbar-config"]=!1,!this.isLocal&&!this.licenseValid){const e=ka(!1);for(const t of e)this.toolbarConfig[t]=!1}this.rebuildToolbar()}this.element.dispatchEvent(new CustomEvent("nge:configLoaded",{detail:{config:this.externalConfig,locked:this.configLocked}}))}isConfigLocked(){return this.configLocked}setupEventListeners(){if(!this.structure)throw new Error("Editor structure not initialized");const{content:e,toolbar:t}=this.structure;e.addEventListener("input",()=>{this.historyManager&&this.historyManager.saveState(!1),this.handleContentChange()}),e.addEventListener("keydown",e=>{this.handleKeyDown(e)}),e.addEventListener("paste",e=>{try{const t=window.getSelection();if(!t||0===t.rangeCount)return;let n=t.getRangeAt(0).commonAncestorContainer;n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);let o=null;if(n&&(o=n.closest?n.closest(".nge-code-block"):null,!o)){const e=n.closest?n.closest("code, pre"):null;e&&(o=e.closest(".nge-code-block"))}if(o){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const n=e.clipboardData||window.clipboardData,r=n?n.getData("text/plain"):"";if(!r)return;const a=o.querySelector("code");if(!a)return;const i=a.textContent||"";let l=i.length;try{const e=t.getRangeAt(0),n=e.cloneRange();n.selectNodeContents(a),n.setEnd(e.startContainer,e.startOffset),l=n.toString().length}catch(e){l=i.length}const s=i.slice(0,l)+r+i.slice(l);this.applySyntaxHighlighting(o,s);const c=l+r.length;return this.setCursorInCodeBlock(a,c),void this.handleContentChange()}}catch(e){console.warn("NGTextEditor: Error handling paste in code block:",e)}},!0),e.addEventListener("paste",t=>{if(t.defaultPrevented)return;const n=window.getSelection();if(n&&n.rangeCount>0){let o=n.getRangeAt(0).commonAncestorContainer;if(o.nodeType===Node.TEXT_NODE&&(o=o.parentElement),o){if(!o.closest(".nge-grid-block")&&e.contains(o))return void t.preventDefault();const n=o.closest('.nge-grid-block[data-block-type="media"]');if(n){const e=o.closest("td, th"),r=o.closest(".nge-column-content"),a=o.closest('.nge-grid-block[data-block-type="text"]'),i=a&&n.contains(a);if(!e&&!r&&!i)return void t.preventDefault()}}}},!0),e.addEventListener("paste",e=>{if(e.defaultPrevented)return;const t=window.getSelection();if(!t||0===t.rangeCount)return;let n=t.getRangeAt(0).commonAncestorContainer;n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);const o=n?.closest('.nge-grid-block[data-block-type="text"]');o&&ma(e,this.structure.content,{onBeforeInsert:()=>{this.historyManager.saveState(!0)},onContentChange:()=>{this.handleContentChange()}})},!0),e.addEventListener("paste",t=>{if(t.defaultPrevented)return;if(this.licenseValid)return;if(this.wordLimitReached)return void t.preventDefault();const n=(t.clipboardData||window.clipboardData).getData("text");if(!n)return;const o=xa(e.textContent||"");if(o+xa(n)>ba){t.preventDefault();const e=ba-o;if(e>0){const t=n.trim().split(/\s+/).slice(0,e).join(" "),o=window.getSelection();if(o.rangeCount>0){const e=o.getRangeAt(0);e.deleteContents(),e.insertNode(document.createTextNode(t)),e.collapse(!1),o.removeAllRanges(),o.addRange(e)}}this.updateStatusBar()}}),e.addEventListener("mouseup",()=>{this.updateToolbar()}),e.addEventListener("keyup",()=>{this.updateToolbar()}),document.addEventListener("selectionchange",()=>{const t=window.getSelection();if(t.rangeCount>0){const n=t.getRangeAt(0);e.contains(n.commonAncestorContainer)&&this.updateToolbar()}}),this.setupToolbarEventListeners(t)}setupToolbarEventListeners(e){e.addEventListener("mousedown",e=>{e.target.closest(".nge-toolbar-button")&&(e.preventDefault(),this.saveSelection(),this.savedGridContext=this.saveGridBlockContext());e.target.closest(".nge-toolbar-select")&&(this.saveSelection(),this.savedGridContext=this.saveGridBlockContext())}),e.addEventListener("click",e=>{const t=e.target.closest(".nge-toolbar-button");if(t){e.preventDefault();const n=t.getAttribute("data-command");n&&this.executeCommand(n)}}),e.addEventListener("change",e=>{const t=e.target.closest(".nge-toolbar-select");if(t){const e=t.getAttribute("data-command"),n=t.value;e&&(this.restoreSelection(),this.executeSelectCommand(e,n))}})}saveSelection(){const e=window.getSelection();e.rangeCount>0&&(this.savedSelection=e.getRangeAt(0).cloneRange())}restoreSelection(){if(this.savedSelection){const e=window.getSelection();e.removeAllRanges(),e.addRange(this.savedSelection),this.savedSelection=null}}handleContentChange(){this.ensureGridBlockContents(),this.updateCounter(),this.checkWordLimit();const e=new CustomEvent("nge:change",{detail:{content:this.getContent(),editor:this,wordLimitReached:this.wordLimitReached}});this.element.dispatchEvent(e)}setupContentHandlers(){this.structure&&this.structure.content&&(this.structure.content._ngeHandlersSetup||(this.structure.content._ngeHandlersSetup=!0,pe(this.structure.content),qe(this.structure.content,e=>{this.handleImageEdit(e)}),De(this.structure.content,e=>{this.handleElementDelete(e)}),Be(this.structure.content,(e,t)=>{Le().allowRotation&&this.handleImageRotate(e,t)}),_e(this.structure.content,(e,t,n)=>{this.handleImageResize(e,t,n)},(e,t)=>{Le().allowRotation&&this.handleImageRotate(e,t)}),rt(this.structure.content,e=>{this.handleVideoEdit(e)}),at(this.structure.content,e=>{this.handleElementDelete(e)}),wt(this.structure.content,e=>{this.handleTableEdit(e)}),Ct(this.structure.content,e=>{this.handleElementDelete(e)}),kt(this.structure.content),Ot(this.structure.content,{onContentChange:()=>this.handleContentChange()}),Pt(this.structure.content),mn(this.structure.content,e=>{this.handleColumnEdit(e)}),hn(this.structure.content,e=>{this.handleElementDelete(e)}),ne(this.structure.content,e=>{this.handleElementDelete(e)}),me(this.structure.content,e=>{this.handleElementDelete(e)}),qn(this.structure.content,{onAddTextBlock:(e,t,n)=>{this.handleAddGridBlock(bn.TEXT,e,t,n)},onAddMediaBlock:(e,t,n)=>{this.handleAddGridBlock(bn.MEDIA,e,t,n)},onContentChange:()=>this.handleContentChange()}),Nn(this.structure.content,e=>{this.handleGridBlockConfig(e)}),oo(this.structure.content,{onPlacementStart:()=>{this.historyManager&&this.historyManager.saveState(!0)},onPlacementComplete:e=>{setTimeout(()=>{const t=e.querySelector(".nge-grid-block-content");if(t){""===t.innerHTML.trim()&&(t.innerHTML="<br>"),t.focus();const e=document.createRange(),n=window.getSelection();t.firstChild?(e.setStart(t.firstChild,0),e.collapse(!0)):(e.selectNodeContents(t),e.collapse(!0)),n.removeAllRanges(),n.addRange(e)}this.handleContentChange()},50)},onPlacementCancel:()=>{}})))}ensureGridBlockContents(){if(!this.structure||!this.structure.content)return;this.structure.content.querySelectorAll(".nge-grid-block-content").forEach(e=>{const t=e.textContent.trim(),n="<br>"===e.innerHTML.trim()||""===e.innerHTML.trim(),o=0===e.children.length||1===e.children.length&&"BR"===e.children[0].tagName;""===t&&(n||o||""===e.innerHTML.trim())&&""===e.innerHTML.trim()&&(e.innerHTML="<br>")})}updateCounter(){if(!this.structure||!this.structure.wordCount||!this.structure.charCount)return;const e=this.structure.content.textContent||"",t=e.length,n=e.trim().split(/\s+/).filter(e=>e.length>0).length,o=l("counter.words")||"{count} mot(s)",r=l("counter.chars")||"{count} caractère(s)";this.structure.wordCount.textContent=o.replace("{count}",n),this.structure.charCount.textContent=r.replace("{count}",t)}updateStatusBar(){if(!this.structure||!this.structure.statusBar)return;const e=this.structure.statusBar;if(e.classList.remove("nge-local","nge-licensed","nge-free","nge-word-limit"),this.isLocal)e.textContent=l("status.localMode"),e.classList.add("nge-local"),e.style.display="block";else if(this.licenseValid)e.style.display="none",e.classList.add("nge-licensed");else{const t=xa(this.structure.content?.textContent||""),n=l("status.freeVersion").replace("{current}",t.toString()).replace("{limit}",ba.toString());if(e.textContent=n,e.classList.add("nge-free"),this.wordLimitReached){e.classList.add("nge-word-limit");const t=l("status.wordLimitReached").replace("{limit}",ba.toString());e.textContent=t}e.style.display="block"}}handleKeyDown(e){const t=window.getSelection();if(t&&t.rangeCount>0){let n=t.getRangeAt(0).commonAncestorContainer;if(n.nodeType===Node.TEXT_NODE&&(n=n.parentElement),n){if(!n.closest(".nge-grid-block")&&this.structure.content.contains(n)){const t=["Backspace","Delete","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","PageUp","PageDown","Escape","Tab","Shift","Control","Alt","Meta"].includes(e.key),n=e.ctrlKey||e.metaKey||e.altKey;if(!t&&!n)return void e.preventDefault()}const t=n.closest('.nge-grid-block[data-block-type="media"]');if(t){const o=n.closest("td, th"),r=n.closest(".nge-column-content"),a=n.closest('.nge-grid-block[data-block-type="text"]'),i=a&&t.contains(a);if(!o&&!r&&!i){const t=["Enter","Backspace","Delete","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","PageUp","PageDown","Escape","Tab","Shift","Control","Alt","Meta"].includes(e.key),n=e.ctrlKey||e.metaKey||e.altKey;if(!t&&!n)return void e.preventDefault()}}}}if(this.wordLimitReached){const t=["Backspace","Delete","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","PageUp","PageDown","Escape","Tab","Shift","Control","Alt","Meta"].includes(e.key),n=e.ctrlKey||e.metaKey||e.altKey;if(!t&&!n)return void e.preventDefault()}if(!function(e){if("Tab"!==e.key)return!1;const t=window.getSelection();if(!t.rangeCount)return!1;const n=t.getRangeAt(0);let o=n.commonAncestorContainer;o.nodeType===Node.TEXT_NODE&&(o=o.parentElement);const r=o?.closest?.(".nge-code-block");if(!r)return!1;e.preventDefault(),n.deleteContents();const a=document.createTextNode("\t");return n.insertNode(a),n.setStartAfter(a),n.setEndAfter(a),t.removeAllRanges(),t.addRange(n),!0}(e)&&!function(e){if("Enter"!==e.key)return!1;const t=window.getSelection();if(!t.rangeCount)return!1;const n=t.getRangeAt(0);let o=n.commonAncestorContainer;o.nodeType===Node.TEXT_NODE&&(o=o.parentElement);const r=o?.closest?.(".nge-code-block");if(!r)return!1;e.preventDefault(),n.deleteContents();const a=document.createTextNode("\n");return n.insertNode(a),n.setStartAfter(a),n.setEndAfter(a),t.removeAllRanges(),t.addRange(n),!0}(e)){if("Tab"===e.key)if(e.shiftKey){if(this.handleListShiftTab(e))return}else if(this.handleListTab(e))return;if("Enter"===e.key&&!e.shiftKey){if(this.handleTodoListEnter(e))return;if(this.handleListEnter(e))return}if(e.ctrlKey||e.metaKey)switch(e.key.toLowerCase()){case"b":e.preventDefault(),this.executeCommand("bold");break;case"i":e.preventDefault(),this.executeCommand("italic");break;case"u":e.preventDefault(),this.executeCommand("underline");break;case"z":e.preventDefault(),e.shiftKey?this.executeCommand("redo"):this.executeCommand("undo");break;case"y":e.preventDefault(),this.executeCommand("redo")}}}updateToolbar(){if(!this.structure)return;const e={bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikethrough:document.queryCommandState("strikethrough")};!function(e,t){if(!e||!t)throw new Error("Invalid toolbar or states");e.querySelectorAll(".nge-toolbar-button").forEach(e=>{const n=e.getAttribute("data-command");n&&t.hasOwnProperty(n)&&(t[n]?(e.classList.add("nge-active"),e.setAttribute("aria-pressed","true")):(e.classList.remove("nge-active"),e.setAttribute("aria-pressed","false")))})}(this.structure.toolbar,e);const t={paragraph:this.getCurrentParagraphStyle(),"font-family":this.getCurrentFontFamily(),"font-size":this.getCurrentFontSize(),"line-height":this.getCurrentLineHeight()};!function(e,t){if(!e||!t)return;e.querySelectorAll(".nge-toolbar-select").forEach(e=>{const n=e.getAttribute("data-command");n&&t.hasOwnProperty(n)&&(e.value=t[n]||"")})}(this.structure.toolbar,t);const n=this.getCurrentGridBlockType();!function(e,t){if(!e)return;[...e.querySelectorAll(".nge-toolbar-button"),...e.querySelectorAll(".nge-toolbar-select")].forEach(e=>{const n=e.getAttribute("data-command");if(!n)return;if(T.includes(n))return e.disabled=!1,void e.classList.remove("nge-disabled");if(!t)return e.disabled=!0,void e.classList.add("nge-disabled");let o=!1;"text"===t?o=N.includes(n):"media"===t?o=M.includes(n):"media-text"===t&&(o=N.includes(n)||"image"===n),o?(e.disabled=!1,e.classList.remove("nge-disabled")):(e.disabled=!0,e.classList.add("nge-disabled"))})}(this.structure.toolbar,n)}getCurrentGridBlockType(){const e=window.getSelection();if(!e.rangeCount)return null;let t=e.getRangeAt(0).startContainer;if(t.nodeType===Node.TEXT_NODE&&(t=t.parentElement),!t)return null;const n=t.closest(".nge-grid-block");if(!n)return null;const o=n.dataset.blockType;if("media"===o){const e=t.closest("td, th"),n=t.closest(".nge-column-content");if(e||n)return"media-text"}return o||null}saveSelectionRange(){const e=window.getSelection();return e.rangeCount>0?e.getRangeAt(0).cloneRange():null}restoreSelectionRange(e){if(e){const t=window.getSelection();t.removeAllRanges(),t.addRange(e)}}saveGridBlockContext(){const e=window.getSelection();if(!e.rangeCount)return null;const t=e.getRangeAt(0);let n=t.startContainer;if(n.nodeType===Node.TEXT_NODE&&(n=n.parentElement),!n)return null;const o=n.closest(".nge-grid-block");if(!o)return null;const r=o.querySelector(".nge-grid-block-content"),a=this.getCaretCharacterOffset(r);return{gridBlock:o,contentArea:r,savedRange:t.cloneRange(),cursorOffset:a}}getCaretCharacterOffset(e){const t=window.getSelection();if(!t.rangeCount)return 0;const n=t.getRangeAt(0),o=n.cloneRange();return o.selectNodeContents(e),o.setEnd(n.startContainer,n.startOffset),o.toString().length}setCaretCharacterOffset(e,t){const n=window.getSelection(),o=document.createRange(),r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);let a=0,i=r.nextNode();for(;i;){const e=i.textContent.length;if(a+e>=t)return o.setStart(i,t-a),o.collapse(!0),n.removeAllRanges(),n.addRange(o),!0;a+=e,i=r.nextNode()}return o.selectNodeContents(e),o.collapse(!1),n.removeAllRanges(),n.addRange(o),!1}insertElementAtCharacterOffset(e,t,n){const o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);let r=0,a=o.nextNode();for(;a;){const e=a.textContent.length;if(r+e>=n){const o=n-r;if(0===o)a.parentNode.insertBefore(t,a);else if(o>=e)a.nextSibling?a.parentNode.insertBefore(t,a.nextSibling):a.parentNode.appendChild(t);else{const e=a.textContent.substring(0,o),n=a.textContent.substring(o),r=document.createTextNode(e),i=document.createTextNode(n),l=a.parentNode;l.insertBefore(r,a),l.insertBefore(t,a),l.insertBefore(i,a),l.removeChild(a)}return!0}r+=e,a=o.nextNode()}return e.appendChild(t),!1}restoreGridBlockContext(e){if(!e||!e.contentArea)return!1;const t=e.contentArea;""===t.innerHTML.trim()&&(t.innerHTML="<br>"),t.focus();const n=window.getSelection();if(e.savedRange)try{const o=e.savedRange.startContainer;if(t.contains(o)||t===o)return n.removeAllRanges(),n.addRange(e.savedRange),!0}catch(e){}if(void 0!==e.cursorOffset&&e.cursorOffset>0&&this.setCaretCharacterOffset(t,e.cursorOffset))return!0;const o=document.createRange();return t.firstChild?(o.setStart(t.firstChild,0),o.collapse(!0)):(o.selectNodeContents(t),o.collapse(!0)),n.removeAllRanges(),n.addRange(o),!0}ensureSelectionInEditor(){if(!this.structure||!this.structure.content)return!1;const e=window.getSelection(),t=this.structure.content;if(e.rangeCount>0){const n=e.getRangeAt(0).commonAncestorContainer;if(t.contains(n))return!0}t.focus();const n=document.createRange();return t.lastChild?t.lastChild.nodeType===Node.TEXT_NODE?(n.setStart(t.lastChild,t.lastChild.textContent.length),n.setEnd(t.lastChild,t.lastChild.textContent.length)):"BR"===t.lastChild.nodeName?(n.setStartBefore(t.lastChild),n.setEndBefore(t.lastChild)):(n.selectNodeContents(t.lastChild),n.collapse(!1)):(n.setStart(t,0),n.setEnd(t,0)),e.removeAllRanges(),e.addRange(n),!1}isLocalEnvironment(){const e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e||"::1"===e||(""===e||(!!/^10\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(e)||(!!/^172\.(1[6-9]|2\d|3[01])\.\d{1,3}\.\d{1,3}$/.test(e)||!!/^192\.168\.\d{1,3}\.\d{1,3}$/.test(e))))}getRestrictedTools(){return this.isLocal||this.licenseValid?[]:ka(!1)}ensureElementAfterBlock(e){if(!e||!e.parentNode)return null;let t=e.nextSibling;for(;t&&t.nodeType===Node.TEXT_NODE&&!t.textContent.trim();)t=t.nextSibling;if(!t){const t=document.createElement("p");return t.innerHTML="<br>",e.parentNode.insertBefore(t,e.nextSibling),t}return t}ensureCursorAfterElement(e){const t=this.ensureElementAfterBlock(e);if(!t)return;const n=window.getSelection(),o=document.createRange();t.nodeType===Node.TEXT_NODE?(o.setStart(t,0),o.setEnd(t,0)):t.firstChild?(o.setStart(t.firstChild,0),o.setEnd(t.firstChild,0)):(o.setStart(t,0),o.setEnd(t,0)),n.removeAllRanges(),n.addRange(o)}executeCommand(e,t=null){if(!this.structure)throw new Error("Editor not initialized");const n=["image","video","table","columns"];if(!["preview","import-json","export-json","export-pdf","export-html","toolbar-config","block-outlines","undo","redo"].includes(e)){const t=window.getSelection();if(t&&t.rangeCount>0){let o=t.getRangeAt(0).commonAncestorContainer;if(o.nodeType===Node.TEXT_NODE&&(o=o.parentElement),o&&this.structure.content.contains(o)){if(!o.closest(".nge-grid-block"))return;const t=o.closest('.nge-grid-block[data-block-type="text"]');if(o.closest('.nge-grid-block[data-block-type="media"]')&&!t)if(n.includes(e));else{const e=o.closest("td, th"),t=o.closest(".nge-column-content");if(!e&&!t)return}}}}if("text-color"===e||"bg-color"===e)return void this.handleColorCommand(e);if("link"===e)return void this.handleLinkCommand();if("quote"===e)return void this.handleQuoteCommand();if("code"===e)return void this.handleCodeCommand();if("hr"===e)return void this.handleHrCommand();if("image"===e)return void this.handleImageCommand();if("video"===e)return void this.handleVideoCommand();if("table"===e)return void this.handleTableCommand();if("columns"===e)return void this.handleColumnsCommand();if("emoji"===e)return void this.handleEmojiCommand();if("toolbar-config"===e){if(this.configLocked)return;return void this.handleToolbarConfigCommand()}if("preview"===e)return void this.handlePreviewCommand();if("block-outlines"===e)return void this.toggleBlockOutlines();if("text-case"===e)return void this.handleTextCaseCommand();if("list-todo"===e)return void this.handleTodoListCommand();if("import-json"===e)return void this.handleImportJsonCommand();if("export-json"===e)return void this.handleExportJsonCommand();if("export-pdf"===e)return void this.handleExportPdfCommand();if("export-html"===e)return void this.handleExportHtmlCommand();if("undo"===e)return void(this.historyManager&&this.historyManager.undo()&&(this.handleContentChange(),this.updateToolbar()));if("redo"===e)return void(this.historyManager&&this.historyManager.redo()&&(this.handleContentChange(),this.updateToolbar()));const o=window.getSelection();!(o.rangeCount>0&&this.structure.content.contains(o.getRangeAt(0).commonAncestorContainer))&&this.structure.content.focus();const r={bold:"bold",italic:"italic",underline:"underline",strikethrough:"strikeThrough",superscript:"superscript","align-left":"justifyLeft","align-center":"justifyCenter","align-right":"justifyRight","align-justify":"justifyFull","list-ul":"insertUnorderedList","list-ol":"insertOrderedList",indent:"indent",outdent:"outdent"}[e]||e;try{document.execCommand(r,!1,t),this.updateToolbar(),this.handleContentChange()}catch(t){console.error('Failed to execute command "'+e+'":',t)}}executeSelectCommand(e,t){if(!this.structure)throw new Error("Editor not initialized");const n=window.getSelection();if(n.rangeCount>0&&this.structure.content.contains(n.getRangeAt(0).commonAncestorContainer)){const e=n.getRangeAt(0).cloneRange();this.structure.content.focus(),n.removeAllRanges(),n.addRange(e)}else this.structure.content.focus(),this.ensureSelectionInEditor();"paragraph"===e?this.applyParagraphStyle(t):"font-family"===e?this.applyFontFamily(t):"font-size"===e?this.applyFontSize(t):"line-height"===e?this.applyLineHeight(t):"list-ol"===e&&this.applyOrderedList(t),this.updateToolbar(),this.handleContentChange()}applyOrderedList(e){const t=window.getSelection();if(0===t.rangeCount)return;let n=t.getRangeAt(0).commonAncestorContainer,o=null,r=n;for(;r&&r!==this.structure.content;){if("OL"===r.nodeName){o=r;break}r=r.parentNode}if(o)o.style.listStyleType=e;else for(document.execCommand("insertOrderedList",!1,null),n=t.getRangeAt(0).commonAncestorContainer;n&&n!==this.structure.content;){if("OL"===n.nodeName){n.style.listStyleType=e;break}n=n.parentNode}}applyParagraphStyle(e){e&&document.execCommand("formatBlock",!1,e)}getCurrentParagraphStyle(){try{const e=window.getSelection();if(!e.rangeCount)return"p";let t=e.getRangeAt(0).commonAncestorContainer;for(t.nodeType===Node.TEXT_NODE&&(t=t.parentElement);t&&t!==this.structure?.content;){const e=t.tagName?.toLowerCase();if(["h1","h2","h3","h4","h5","p"].includes(e))return e;t=t.parentElement}}catch(e){}return"p"}getSelectedTableCells(e){const t=e.commonAncestorContainer,n=t.nodeType===Node.TEXT_NODE?t.parentElement:t,o=n?.closest("table");if(!o)return null;const r=Array.from(o.querySelectorAll("td, th")).filter(t=>e.intersectsNode(t));return r.length>1?r:null}applyStyleToCell(e,t,n){const o=Array.from(e.childNodes);if(1===o.length&&"SPAN"===o[0].nodeName)return void(o[0].style[t]=n);if(o.every(e=>e.nodeType===Node.ELEMENT_NODE&&"SPAN"===e.nodeName)&&o.length>0)return void o.forEach(e=>{e.style[t]=n});const r=document.createRange();r.selectNodeContents(e);const a=r.extractContents(),i=document.createElement("span");i.style[t]=n,i.appendChild(a),e.appendChild(i)}applyInlineStyle(e,t){const n=window.getSelection();if(!n.rangeCount)return;const o=n.getRangeAt(0);if(o.collapsed)return;const r=this.getSelectedTableCells(o);if(r)r.forEach(n=>{this.applyStyleToCell(n,e,t)});else{let r=o.commonAncestorContainer;if(r.nodeType===Node.TEXT_NODE&&(r=r.parentElement),r&&"SPAN"===r.nodeName){const n=document.createRange();if(n.selectNodeContents(r),o.toString()===n.toString())return void(r.style[e]=t)}const a=o.extractContents(),i=document.createElement("span");i.style[e]=t,i.appendChild(a),o.insertNode(i),o.selectNodeContents(i),n.removeAllRanges(),n.addRange(o)}}applyFontFamily(e){window.getSelection().rangeCount&&(e?this.applyInlineStyle("fontFamily",e):document.execCommand("removeFormat",!1,null))}applyFontSize(e){const t=window.getSelection();if(!t.rangeCount)return;t.getRangeAt(0).collapsed||this.applyInlineStyle("fontSize",e)}applyLineHeight(e){const t=window.getSelection();if(!t.rangeCount)return;let n=t.getRangeAt(0).commonAncestorContainer;for(n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);n&&n!==this.structure?.content;){const t=window.getComputedStyle(n).display;if("block"===t||"list-item"===t)return void(n.style.lineHeight=e);n=n.parentElement}this.structure?.content&&(this.structure.content.style.lineHeight=e)}getCurrentLineHeight(){try{const e=window.getSelection();if(!e.rangeCount)return"";let t=e.getRangeAt(0).commonAncestorContainer;if(t.nodeType===Node.TEXT_NODE&&(t=t.parentElement),t&&t.nodeType===Node.ELEMENT_NODE){const e=window.getComputedStyle(t),n=e.lineHeight;if("normal"===n)return"";const o=parseFloat(e.fontSize),r=parseFloat(n);if(o>0&&r>0){const e=r/o,t=["1","1.15","1.5","2","2.5","3"];for(const n of t)if(Math.abs(e-parseFloat(n))<.1)return n}}}catch(e){}return""}getCurrentFontFamily(){try{const e=window.getSelection();if(!e.rangeCount)return"";let t=e.getRangeAt(0).commonAncestorContainer;if(t.nodeType===Node.TEXT_NODE&&(t=t.parentElement),t&&t.nodeType===Node.ELEMENT_NODE){const e=window.getComputedStyle(t).fontFamily;for(const t of f)if(t.value&&e.includes(t.label))return t.value}}catch(e){}return""}getCurrentFontSize(){try{const e=window.getSelection();if(!e.rangeCount)return"";let t=e.getRangeAt(0).commonAncestorContainer;if(t.nodeType===Node.TEXT_NODE&&(t=t.parentElement),t&&t.nodeType===Node.ELEMENT_NODE){return window.getComputedStyle(t).fontSize}}catch(e){}return""}normalizeColor(e){return e?"transparent"===e||"rgba(0, 0, 0, 0)"===e?null:e.startsWith("rgb")?e:/^[0-9a-fA-F]{6}$/.test(e)?"#"+e:e.startsWith("#")?e:null:null}getCurrentColor(e){try{let t=document.queryCommandValue(e),n=this.normalizeColor(t);if(n)return n;if("hiliteColor"===e&&(t=document.queryCommandValue("backColor"),n=this.normalizeColor(t),n))return n;const o=window.getSelection();if(o.rangeCount>0){let r=o.getRangeAt(0).commonAncestorContainer;if(r.nodeType===Node.TEXT_NODE&&(r=r.parentElement),r&&r.nodeType===Node.ELEMENT_NODE){const o=window.getComputedStyle(r);if(t=o["foreColor"===e?"color":"backgroundColor"],n=this.normalizeColor(t),n)return n}}}catch(e){}return null}updateColorIndicator(e,t){if(!this.structure||!this.structure.toolbar)return;const n=this.structure.toolbar.querySelector('[data-command="'+e+'"]');if(n){const e=n.querySelector(".nge-color-indicator");e&&(e.style.fill=t)}}getSelectedText(){return window.getSelection().toString()||""}getCurrentTextStyles(){return{bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikethrough:document.queryCommandState("strikeThrough"),fontFamily:this.getCurrentFontFamily(),fontSize:this.getCurrentFontSize()}}getCurrentBgStyles(){const e={borderRadius:0,padding:0};try{const t=window.getSelection();if(!t.rangeCount)return e;let n=t.getRangeAt(0).commonAncestorContainer;if(n.nodeType===Node.TEXT_NODE&&(n=n.parentElement),!n||n.nodeType!==Node.ELEMENT_NODE)return e;let o=n;for(;o&&o!==this.structure?.content;){const t=o.style;if(t&&t.backgroundColor){const n=parseInt(t.borderRadius,10);!isNaN(n)&&(e.borderRadius=n);const o=t.padding;if(o){const t=o.split(" "),n=parseInt(t[0],10);!isNaN(n)&&(e.padding=n)}break}o=o.parentElement}}catch(e){}return e}async handleColorCommand(e){const t=this.saveSelectionRange(),n="text-color"===e,o=n?"Couleur du texte":"Couleur de fond",r=n?"foreColor":"hiliteColor",a=this.getCurrentColor(r),i=this.getSelectedText(),l=this.getCurrentTextStyles(),s=n?null:this.getCurrentColor("foreColor"),c=n?this.getCurrentColor("hiliteColor"):null,d=n?null:this.getCurrentBgStyles(),u=this.getCustomColors();try{const g=await Z({title:o,initialColor:a,showAlpha:!n&&0===u.length,selectedText:i,mode:e,textColor:s,bgColor:c,textStyles:l,initialBorderRadius:d?.borderRadius||0,initialPadding:d?.padding||0,restrictedColors:u});if("confirm"===g.action&&g.color){this.structure.content.focus(),this.restoreSelectionRange(t),this.ensureSelectionInEditor();const o=window.getSelection(),a=o.rangeCount>0?o.getRangeAt(0):null,i=a?this.getSelectedTableCells(a):null;if(i){const e=n?"color":"backgroundColor";i.forEach(t=>{this.applyStyleToCell(t,e,g.color)})}else document.execCommand(r,!1,g.color);!n&&t&&this.applyBgColorStyles(t,g.borderRadius,g.padding),this.updateColorIndicator(e,g.color),this.updateToolbar(),this.handleContentChange()}}catch(e){}}applyBgColorStyles(e,t,n){if(!e)return;const o=window.getSelection();if(!o.rangeCount)return;const r=o.getRangeAt(0).commonAncestorContainer;let a=r;r.nodeType===Node.TEXT_NODE&&(a=r.parentElement);const i=n>0||t>0?n+"px "+(t>0?4:2)+"px":"",l=e=>{e.style.borderRadius=t>0?t+"px":"",e.style.padding=i};a.querySelectorAll('[style*="background"]').forEach(l),a.style&&a.style.backgroundColor&&l(a);let s=a.parentElement;for(;s&&s!==this.structure?.content;)s.style&&s.style.backgroundColor&&l(s),s=s.parentElement}getSelectedLink(){const e=window.getSelection();if(!e.rangeCount)return null;let t=e.getRangeAt(0).commonAncestorContainer;for(t.nodeType===Node.TEXT_NODE&&(t=t.parentElement);t&&t!==this.structure?.content;){if("A"===t.tagName)return t;t=t.parentElement}return null}extractLinkData(e){if(!e||"A"!==e.tagName)return null;const t=(e.rel||"").split(/\s+/).filter(Boolean);return{url:e.href||"",text:e.textContent||"",title:e.title||"",newWindow:"_blank"===e.target,nofollow:t.includes("nofollow")}}async handleLinkCommand(){const e=this.saveSelectionRange(),t=this.getSelectedLink(),n=t?this.extractLinkData(t):null,o=this.getSelectedText();try{const r=n?{url:n.url,text:n.text,title:n.title,newWindow:n.newWindow,nofollow:n.nofollow}:{selectedText:o},a=await X(r);if("confirm"===a.action&&a.url){this.structure.content.focus(),this.restoreSelectionRange(e),this.ensureSelectionInEditor();const n=a.text||a.url;if(t)if(t.href=a.url,t.textContent=n,a.title?t.title=a.title:t.removeAttribute("title"),a.newWindow){t.target="_blank";const e=["noopener","noreferrer"];a.nofollow&&e.push("nofollow"),t.rel=e.join(" ")}else t.removeAttribute("target"),a.nofollow?t.rel="nofollow":t.removeAttribute("rel");else{const e=window.getSelection();if(!e.rangeCount)return;const t=e.getRangeAt(0),o=document.createElement("a");if(o.href=a.url,o.textContent=n,a.title&&(o.title=a.title),a.newWindow){o.target="_blank";const e=["noopener","noreferrer"];a.nofollow&&e.push("nofollow"),o.rel=e.join(" ")}else a.nofollow&&(o.rel="nofollow");t.deleteContents(),t.insertNode(o),t.setStartAfter(o),t.setEndAfter(o),e.removeAllRanges(),e.addRange(t)}this.updateToolbar(),this.handleContentChange()}}catch(e){}}async handleQuoteCommand(){const e=this.saveSelectionRange(),t=this.getSelectedText();try{const n=await oe();if("confirm"===n.action&&n.templateId){this.structure.content.focus(),this.restoreSelectionRange(e),this.ensureSelectionInEditor();const o=te(n.templateId,t),r=window.getSelection();if(!r.rangeCount)return;const a=r.getRangeAt(0);a.deleteContents();const i=document.createElement("div");i.innerHTML=o;const l=i.firstChild;a.insertNode(l),this.ensureCursorAfterElement(l),this.updateToolbar(),this.handleContentChange()}}catch(e){}}handleTodoListEnter(e){const t=window.getSelection();if(!t.rangeCount)return!1;const n=t.getRangeAt(0),o=n.startContainer.closest?n.startContainer.closest(".nge-todo-item"):n.startContainer.parentElement?.closest(".nge-todo-item");if(!o)return!1;const r=o.closest(".nge-todo-list");if(!r)return!1;const a=o.querySelector(".nge-todo-text");if(""===(a?a.textContent.trim():"")){e.preventDefault();const n=o.nextSibling;if(o.remove(),0===r.children.length){const e=document.createElement("p");e.innerHTML="<br>",r.parentNode.insertBefore(e,r),r.remove();const n=document.createRange();n.setStart(e,0),n.setEnd(e,0),t.removeAllRanges(),t.addRange(n)}else{const e=document.createElement("p");if(e.innerHTML="<br>",n){const t=document.createElement("div");for(t.className="nge-todo-list";n&&r.contains(n);){const e=n.nextSibling;if(t.appendChild(n),!e)break}r.parentNode.insertBefore(e,r.nextSibling),t.children.length>0&&e.parentNode.insertBefore(t,e.nextSibling)}else r.parentNode.insertBefore(e,r.nextSibling);const o=document.createRange();o.setStart(e,0),o.setEnd(e,0),t.removeAllRanges(),t.addRange(o)}return this.handleContentChange(),!0}e.preventDefault();let i="";if(a&&a.contains(n.startContainer)){const e=n.startContainer;e.nodeType===Node.TEXT_NODE&&(i=e.textContent.substring(n.startOffset),e.textContent=e.textContent.substring(0,n.startOffset))}const l=this.createTodoItem(i);o.nextSibling?r.insertBefore(l,o.nextSibling):r.appendChild(l);const s=l.querySelector(".nge-todo-text");if(s){const e=document.createRange();e.setStart(s,0),e.setEnd(s,0),t.removeAllRanges(),t.addRange(e)}return this.handleContentChange(),!0}handleListEnter(e){const t=window.getSelection();if(!t.rangeCount)return!1;let n=t.getRangeAt(0).startContainer;n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);const o=n?.closest("li");if(!o)return!1;const r=o.closest("ul, ol");if(!r||r.classList.contains("nge-todo-list"))return!1;const a=o.textContent.trim(),i=1===o.childNodes.length&&"BR"===o.firstChild.nodeName;if(!(""===a||i))return!1;e.preventDefault();const l=r.parentElement?.closest("li"),s=l?.parentElement?.closest("ul, ol");if(l&&s){const e=[];let n=o.nextElementSibling;for(;n;)e.push(n),n=n.nextElementSibling;o.remove();const a=document.createElement("li");if(a.innerHTML="<br>",s.insertBefore(a,l.nextSibling),e.length>0){const t=document.createElement(r.tagName);r.style.listStyleType&&(t.style.listStyleType=r.style.listStyleType),e.forEach(e=>t.appendChild(e)),a.appendChild(t)}0===r.children.length&&r.remove();const i=document.createRange();return i.setStart(a,0),i.setEnd(a,0),t.removeAllRanges(),t.addRange(i),this.handleContentChange(),!0}const c=o.nextSibling;if(o.remove(),0===r.children.length){const e=document.createElement("p");e.innerHTML="<br>",r.parentNode.insertBefore(e,r),r.remove();const n=document.createRange();n.setStart(e,0),n.setEnd(e,0),t.removeAllRanges(),t.addRange(n)}else{const e=document.createElement("p");if(e.innerHTML="<br>",c){const t=document.createElement(r.tagName);for(t.style.cssText=r.style.cssText;r.contains(c)&&c;){const e=c.nextSibling;if(t.appendChild(c),!e||!r.contains(e))break}r.parentNode.insertBefore(e,r.nextSibling),t.children.length>0&&e.parentNode.insertBefore(t,e.nextSibling)}else r.parentNode.insertBefore(e,r.nextSibling);const n=document.createRange();n.setStart(e,0),n.setEnd(e,0),t.removeAllRanges(),t.addRange(n)}return this.handleContentChange(),!0}handleListTab(e){const t=window.getSelection();if(!t.rangeCount)return!1;let n=t.getRangeAt(0).startContainer;n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);const o=n?.closest("li");if(!o)return!1;const r=o.closest("ul, ol");if(!r||r.classList.contains("nge-todo-list"))return!1;const a=o.previousElementSibling;if(!a||"LI"!==a.tagName)return!1;e.preventDefault();let i=Array.from(a.children).find(e=>"UL"===e.tagName||"OL"===e.tagName);!i&&(i=document.createElement(r.tagName),"OL"===r.tagName&&r.style.listStyleType&&(i.style.listStyleType=r.style.listStyleType),a.appendChild(i)),i.appendChild(o);const l=document.createRange();return o.firstChild?(l.setStart(o.firstChild,0),l.setEnd(o.firstChild,0)):(l.setStart(o,0),l.setEnd(o,0)),t.removeAllRanges(),t.addRange(l),this.handleContentChange(),!0}handleListShiftTab(e){const t=window.getSelection();if(!t.rangeCount)return!1;let n=t.getRangeAt(0).startContainer;n.nodeType===Node.TEXT_NODE&&(n=n.parentElement);const o=n?.closest("li");if(!o)return!1;const r=o.parentElement;if(!r||"UL"!==r.tagName&&"OL"!==r.tagName)return!1;if(r.classList.contains("nge-todo-list"))return!1;const a=r.parentElement;if(!a||"LI"!==a.tagName)return!1;const i=a.parentElement;if(!i||"UL"!==i.tagName&&"OL"!==i.tagName)return!1;e.preventDefault();const l=[];let s=o.nextElementSibling;for(;s;)l.push(s),s=s.nextElementSibling;if(i.insertBefore(o,a.nextSibling),l.length>0){const e=document.createElement(r.tagName);r.style.listStyleType&&(e.style.listStyleType=r.style.listStyleType),l.forEach(t=>e.appendChild(t)),o.appendChild(e)}0===r.children.length&&r.remove();const c=document.createRange();return o.firstChild&&o.firstChild.nodeType===Node.TEXT_NODE||o.firstChild?(c.setStart(o.firstChild,0),c.setEnd(o.firstChild,0)):(c.setStart(o,0),c.setEnd(o,0)),t.removeAllRanges(),t.addRange(c),this.handleContentChange(),!0}handleTodoListCommand(){const e=this.saveSelectionRange();this.structure.content.focus(),this.restoreSelectionRange(e),this.ensureSelectionInEditor();const t=window.getSelection();if(!t.rangeCount)return;const n=t.getRangeAt(0),o=this.getSelectedText()||"Nouvelle tâche";n.deleteContents();const r=document.createElement("ul");r.className="nge-todo-list",r.setAttribute("data-testid","nge-todo-list");const a=this.createTodoItem(o);r.appendChild(a),n.insertNode(r);const i=a.querySelector(".nge-todo-text");i&&(n.setStart(i,i.childNodes.length||0),n.setEnd(i,i.childNodes.length||0),t.removeAllRanges(),t.addRange(n)),this.updateToolbar(),this.handleContentChange()}createTodoItem(e="",t=!1){const n=document.createElement("li");n.className="nge-todo-item",t&&n.classList.add("nge-todo-checked");const o=document.createElement("input");o.type="checkbox",o.className="nge-todo-checkbox",o.checked=t,o.setAttribute("data-testid","nge-todo-checkbox"),o.addEventListener("change",e=>{const t=e.target.closest(".nge-todo-item");t&&(e.target.checked?t.classList.add("nge-todo-checked"):t.classList.remove("nge-todo-checked"),this.handleContentChange())});const r=document.createElement("span");return r.className="nge-todo-text",r.textContent=e,n.appendChild(o),n.appendChild(r),n}handleCodeCommand(){const e=this.saveSelectionRange();this.structure.content.focus(),this.restoreSelectionRange(e),this.ensureSelectionInEditor();const t=window.getSelection();if(!t.rangeCount)return;const n=t.getRangeAt(0);n.deleteContents();const o=function(){const e=document.createElement("div");e.className="nge-code-block",e.setAttribute("data-testid","nge-code-block");const t=document.createElement("div");t.className="nge-code-buttons",t.setAttribute("contenteditable","false");const n=document.createElement("button");n.type="button",n.className="nge-code-copy-btn",n.setAttribute("title",l("code.copy")),n.setAttribute("aria-label",l("code.copyCode")),n.setAttribute("data-testid","nge-code-copy-btn"),n.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <rect x="9" y="9" width="11" height="11" rx="2" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>\n  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n</svg>';const o=document.createElement("button");o.type="button",o.className="nge-code-delete-btn",o.setAttribute("title",l("common.deleteCode")),o.setAttribute("aria-label",l("common.deleteCode")),o.setAttribute("data-testid","nge-code-delete-btn"),o.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',t.appendChild(n),t.appendChild(o);const r=document.createElement("pre"),a=document.createElement("code");return a.setAttribute("data-placeholder",l("code.placeholder")),r.appendChild(a),e.appendChild(t),e.appendChild(r),e}();n.insertNode(o),this.ensureElementAfterBlock(o);const r=o.querySelector("code");r&&(n.setStart(r,0),n.setEnd(r,0),t.removeAllRanges(),t.addRange(n)),this.updateToolbar(),this.handleContentChange()}applySyntaxHighlighting(e,t){const n=e.querySelector("code");if(!n)return;const{html:o,language:r}=Cr(t);n.innerHTML=o;let a=e.querySelector(".nge-code-language");var i;r?(!a&&(a=document.createElement("span"),a.className="nge-code-language",a.setAttribute("contenteditable","false"),e.insertBefore(a,e.firstChild)),a.textContent={javascript:"JavaScript",html:"HTML",css:"CSS",python:"Python",php:"PHP",sql:"SQL",json:"JSON",bash:"Bash"}[i=r]||i||"Plain Text",e.classList.add("nge-has-language"),e.setAttribute("data-language",r)):(a&&a.remove(),e.classList.remove("nge-has-language"),e.removeAttribute("data-language"))}setCursorInCodeBlock(e,t){const n=window.getSelection(),o=document.createRange();let r=0;const a=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);let i;for(;i=a.nextNode();){const e=i.textContent.length;if(r+e>=t)return o.setStart(i,t-r),o.setEnd(i,t-r),n.removeAllRanges(),void n.addRange(o);r+=e}o.selectNodeContents(e),o.collapse(!1),n.removeAllRanges(),n.addRange(o)}async handleHrCommand(){const e=this.saveSelectionRange();try{const t=await de();if("confirm"===t.action&&t.templateId){this.structure.content.focus(),this.restoreSelectionRange(e),this.ensureSelectionInEditor();const n=function(e,t=1,n=100){const o=ae(e);if(!o)throw new Error('Template "'+e+'" not found');const r=le(o.styles,t);if(n<100&&(r.width=n+"%",r.marginLeft="auto",r.marginRight="auto"),o.beforeContent)return'<div style="'+ce({...o.beforeStyles?le(o.beforeStyles,t):{},...r})+'" data-hr-template="'+e+'">'+o.beforeContent+"</div>";return'<hr style="'+ce(r)+'" data-hr-template="'+e+'">'}(t.templateId,t.opacity,t.width),o=window.getSelection();if(!o.rangeCount)return;const r=o.getRangeAt(0);r.deleteContents();const a=document.createElement("div");a.innerHTML=n;const i=a.firstChild;r.insertNode(i),this.ensureCursorAfterElement(i),this.updateToolbar(),this.handleContentChange()}}catch(e){}}async handleImageCommand(){const e=this.savedGridContext;try{const t=await Re();if("confirm"===t.action&&t.src){const n=Ie(t),o=document.createElement("div");o.innerHTML=n;const r=o.firstChild;if(e&&e.contentArea&&e.savedRange){const t=e.contentArea,n=e.savedRange;t.focus();try{const e=n.startContainer;if(t.contains(e)||t===e)return"BR"===e.nodeName||e.nodeType===Node.TEXT_NODE&&""===e.textContent?e.parentNode.replaceChild(r,e):(n.deleteContents(),n.insertNode(r)),this.ensureCursorAfterElement(r),this.updateToolbar(),void this.handleContentChange()}catch(e){}if(void 0!==e.cursorOffset)return this.insertElementAtCharacterOffset(t,r,e.cursorOffset),this.ensureCursorAfterElement(r),this.updateToolbar(),void this.handleContentChange()}if(e&&e.contentArea)this.restoreGridBlockContext(e);else{this.structure.content.focus(),this.restoreSelection();const e=window.getSelection();(!e.rangeCount||!this.structure.content.contains(e.getRangeAt(0).startContainer))&&this.ensureSelectionInEditor()}const a=window.getSelection();if(!a.rangeCount)return;const i=a.getRangeAt(0),l=i.startContainer;"BR"===l.nodeName||l.nodeType===Node.TEXT_NODE&&""===l.textContent?l.parentNode.replaceChild(r,l):(i.deleteContents(),i.insertNode(r)),this.ensureCursorAfterElement(r),this.updateToolbar(),this.handleContentChange()}}catch(e){}}async handleImageEdit(e){const t=function(e){if(!e||!e.classList.contains("nge-image-wrapper"))return null;const t=e.querySelector("img");return t?{src:t.src||"",width:parseInt(e.dataset.width,10)||ke.width,height:"auto"===e.dataset.height?"auto":parseInt(e.dataset.height,10)||"auto",rotation:parseInt(e.dataset.rotation,10)||ke.rotation,opacity:parseInt(e.dataset.opacity,10)||ke.opacity,borderStyle:e.dataset.borderStyle||ke.borderStyle,borderWidth:parseInt(e.dataset.borderWidth,10)||ke.borderWidth,borderColor:e.dataset.borderColor||ke.borderColor,borderRadius:parseInt(e.dataset.borderRadius,10)||ke.borderRadius,align:e.dataset.align||ke.align,naturalWidth:t.naturalWidth||0,naturalHeight:t.naturalHeight||0}:null}(e);if(t){this.historyManager&&this.historyManager.saveState(!0);try{const n=await Re(t);"confirm"===n.action&&n.src&&(function(e,t){if(!e||!e.classList.contains("nge-image-wrapper"))return;const n=e.querySelector("img");if(!n)return;const{src:o,width:r=ke.width,height:a=ke.height,rotation:i=ke.rotation,opacity:l=ke.opacity,align:s=ke.align,borderStyle:c=ke.borderStyle,borderWidth:d=ke.borderWidth,borderColor:u=ke.borderColor,borderRadius:g=ke.borderRadius}=t;e.dataset.width=r,e.dataset.height=a,e.dataset.rotation=i,e.dataset.opacity=l,e.dataset.align=s,e.dataset.borderStyle=c,e.dataset.borderWidth=d,e.dataset.borderColor=u,e.dataset.borderRadius=g,n.src=o,n.style.width=r+"px",n.style.height="auto"===a?"auto":a+"px",n.style.transform="rotate("+i+"deg)",n.style.opacity=l/100,n.style.border=c&&"none"!==c&&d>0?d+"px "+c+" "+u:"none",n.style.borderRadius=xe(g)}(e,n),this.handleContentChange())}catch(e){}}}handleImageResize(e,t,n){this.handleContentChange()}handleImageRotate(e,t){this.handleContentChange()}handleElementDelete(e){e&&e.parentNode&&(this.historyManager&&this.historyManager.saveState(!0),e.parentNode.removeChild(e),this.handleContentChange())}async handleVideoCommand(){const e=this.savedGridContext;try{const t=await ot();if("confirm"===t.action&&t.videoId){if(e&&e.contentArea)this.restoreGridBlockContext(e);else{this.structure.content.focus(),this.restoreSelection();const e=window.getSelection();(!e.rangeCount||!this.structure.content.contains(e.getRangeAt(0).startContainer))&&this.ensureSelectionInEditor()}const n=function(e){const{url:t=Je.url,platform:n=Je.platform,videoId:o=Je.videoId,width:r=Je.width,autostart:a=Je.autostart,align:i=Je.align,borderStyle:s=Je.borderStyle,borderWidth:c=Je.borderWidth,borderColor:d=Je.borderColor,borderRadius:u=Je.borderRadius}=e,g=$e(n,o,a);if(!g)return"";const p=Math.round(9*r/16);let m="";s&&"none"!==s&&c>0&&(m="border: "+c+"px "+s+" "+d+";"),u>0&&(m+=" border-radius: "+u+"px; overflow: hidden;");const h=l("video.editTitle"),b=l("common.deleteVideo");return'<div class="nge-video-wrapper" data-testid="nge-video-wrapper" data-url="'+t+'" data-platform="'+n+'" data-video-id="'+o+'" data-width="'+r+'" data-autostart="'+a+'" data-align="'+i+'" data-border-style="'+s+'" data-border-width="'+c+'" data-border-color="'+d+'" data-border-radius="'+u+'" contenteditable="false" style="'+m+'"><iframe src="'+g+'" width="'+r+'" height="'+p+'" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><div class="nge-video-buttons"><button type="button" class="nge-video-edit-btn" data-testid="nge-video-edit-btn" title="'+h+'" aria-label="'+h+'"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1.08-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1.08 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>\n</svg></button><button type="button" class="nge-video-delete-btn" data-testid="nge-video-delete-btn" title="'+b+'" aria-label="'+b+'"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg></button></div></div>'}(t),o=window.getSelection();if(!o.rangeCount)return;const r=o.getRangeAt(0),a=document.createElement("div");a.innerHTML=n;const i=a.firstChild,s=r.startContainer;"BR"===s.nodeName||s.nodeType===Node.TEXT_NODE&&""===s.textContent?s.parentNode.replaceChild(i,s):(r.deleteContents(),r.insertNode(i)),this.ensureCursorAfterElement(i),this.updateToolbar(),this.handleContentChange()}}catch(e){}}async handleVideoEdit(e){const t=(n=e)&&n.classList.contains("nge-video-wrapper")?{url:n.dataset.url||"",platform:n.dataset.platform||"",videoId:n.dataset.videoId||"",width:parseInt(n.dataset.width,10)||Je.width,autostart:"true"===n.dataset.autostart,align:n.dataset.align||Je.align,borderStyle:n.dataset.borderStyle||Je.borderStyle,borderWidth:parseInt(n.dataset.borderWidth,10)||Je.borderWidth,borderColor:n.dataset.borderColor||Je.borderColor,borderRadius:parseInt(n.dataset.borderRadius,10)||Je.borderRadius}:null;var n;if(t){this.historyManager&&this.historyManager.saveState(!0);try{const n=await ot(t);"confirm"===n.action&&n.videoId&&(function(e,t){if(!e||!e.classList.contains("nge-video-wrapper"))return;const{url:n=Je.url,platform:o=Je.platform,videoId:r=Je.videoId,width:a=Je.width,autostart:i=Je.autostart,align:l=Je.align,borderStyle:s=Je.borderStyle,borderWidth:c=Je.borderWidth,borderColor:d=Je.borderColor,borderRadius:u=Je.borderRadius}=t,g=$e(o,r,i);if(!g)return;e.dataset.url=n,e.dataset.platform=o,e.dataset.videoId=r,e.dataset.width=a,e.dataset.autostart=i,e.dataset.align=l,e.dataset.borderStyle=s,e.dataset.borderWidth=c,e.dataset.borderColor=d,e.dataset.borderRadius=u,e.style.border=s&&"none"!==s&&c>0?c+"px "+s+" "+d:"",u>0?(e.style.borderRadius=u+"px",e.style.overflow="hidden"):(e.style.borderRadius="",e.style.overflow="");const p=e.querySelector("iframe");if(p){const e=Math.round(9*a/16);p.src=g,p.width=a,p.height=e}}(e,n),this.handleContentChange())}catch(e){}}}async handleTableCommand(){const e=this.savedGridContext;try{const t=await ft();if("confirm"===t.action){if(e&&e.contentArea)this.restoreGridBlockContext(e);else{this.structure.content.focus(),this.restoreSelection();const e=window.getSelection();(!e.rangeCount||!this.structure.content.contains(e.getRangeAt(0).startContainer))&&this.ensureSelectionInEditor()}const n=yt(t,!1),o=window.getSelection();if(!o.rangeCount)return;const r=o.getRangeAt(0),a=document.createElement("div");a.innerHTML=n;const i=a.firstChild,l=r.startContainer;"BR"===l.nodeName||l.nodeType===Node.TEXT_NODE&&""===l.textContent?l.parentNode.replaceChild(i,l):(r.deleteContents(),r.insertNode(i));const s=document.createElement("p");s.innerHTML="<br>",i.parentNode.insertBefore(s,i.nextSibling);const c=document.createRange();c.setStart(s,0),c.collapse(!0),o.removeAllRanges(),o.addRange(c),this.updateToolbar(),this.handleContentChange()}}catch(e){}}async handleTableEdit(e){const t=function(e){if(!(e&&e instanceof HTMLElement))return null;const t=e.classList.contains("nge-table")?e:e.querySelector(".nge-table");if(!t)return null;const n=t.className.match(/nge-table-(\w+)/);let o="standard";n&&["standard","bordered","striped","minimal"].includes(n[1])&&(o=n[1]);let r=dt.tableWidth,a=dt.tableAlign;const i=e.closest(".nge-table-edit-wrapper")||(e.classList.contains("nge-table-edit-wrapper")?e:null),l=i||t,s=l.style.width;if(s&&gt.some(e=>e.value===s)&&(r=s),i&&i.dataset.align)a=i.dataset.align;else{const e=l.style.marginLeft,t=l.style.marginRight;"auto"===e&&"auto"===t?a="center":"auto"===e&&("0"===t||"0px"===t)&&(a="right")}const c=t.querySelector("thead"),d=t.querySelector("tbody"),u=!!c,g=t.classList.contains("nge-table-sortable"),p=e.classList.contains("nge-table-wrapper"),m=c?c.querySelector("tr"):d?.querySelector("tr"),h=m?m.querySelectorAll("th, td").length:0,b=(u?1:0)+(d?d.querySelectorAll("tr").length:0),f=c?.querySelector("th");let v=dt.headerBgColor,y=!1,w=dt.headerFont,C=dt.headerSize,k=dt.headerWeight,x=dt.headerTextColor;if(f){const e=f.style;e.backgroundColor?v=vt(e.backgroundColor)||v:y=!0,e.fontFamily&&"inherit"!==e.fontFamily&&(w=e.fontFamily),e.fontSize&&(C=parseInt(e.fontSize,10)||C),e.fontWeight&&(k=e.fontWeight),e.color&&(x=vt(e.color)||x)}const E={headers:[],headerStyles:[],body:[],bodyStyles:[]};c&&c.querySelectorAll("th").forEach(e=>{E.headers.push(e.innerHTML);const t={},n=e.getAttribute("colspan"),o=e.getAttribute("rowspan");n&&parseInt(n,10)>1&&(t.colspan=parseInt(n,10)),o&&parseInt(o,10)>1&&(t.rowspan=parseInt(o,10)),E.headerStyles.push(t)});d&&d.querySelectorAll("tr").forEach(e=>{const t=[],n=[];e.querySelectorAll("td").forEach(e=>{t.push(e.innerHTML);const o={};e.style.backgroundColor&&"transparent"!==e.style.backgroundColor&&(o.bgColor=vt(e.style.backgroundColor)||e.style.backgroundColor),e.style.color&&(o.textColor=vt(e.style.color)||e.style.color),e.style.textAlign&&(o.hAlign=e.style.textAlign),e.style.verticalAlign&&(o.vAlign=e.style.verticalAlign);const r=e.getAttribute("colspan"),a=e.getAttribute("rowspan");r&&parseInt(r,10)>1&&(o.colspan=parseInt(r,10)),a&&parseInt(a,10)>1&&(o.rowspan=parseInt(a,10)),n.push(o)}),E.body.push(t),E.bodyStyles.push(n)});return{rows:b,columns:h,includeHeader:u,sortable:g,style:o,responsive:p,tableWidth:r,tableAlign:a,headerBgColor:v,headerTransparent:y,headerFont:w,headerSize:C,headerWeight:k,headerTextColor:x,cellData:E}}(e);if(t){this.historyManager&&this.historyManager.saveState(!0);try{const n=await ft({rows:t.rows,columns:t.columns,includeHeader:t.includeHeader,sortable:t.sortable,style:t.style,responsive:t.responsive,headerBgColor:t.headerBgColor,headerTransparent:t.headerTransparent,headerFont:t.headerFont,headerSize:t.headerSize,headerWeight:t.headerWeight,headerTextColor:t.headerTextColor});"confirm"===n.action&&(function(e,t,n=null){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid wrapper element");const o=yt(t,!1,n),r=document.createElement("div");r.innerHTML=o;const a=r.firstChild;e.replaceWith(a)}(e,n,t.cellData),this.updateToolbar(),this.handleContentChange())}catch(e){}}}async handleColumnsCommand(){const e=this.savedGridContext;try{const t=await pn();if("confirm"===t.action){if(e&&e.contentArea)this.restoreGridBlockContext(e);else{this.structure.content.focus(),this.restoreSelection();const e=window.getSelection();(!e.rangeCount||!this.structure.content.contains(e.getRangeAt(0).startContainer))&&this.ensureSelectionInEditor()}const n=function(e,t=""){const n=dn(e);if(!n.isValid)throw new Error(n.error);const o=un(e),r=gn(e),a=t||"<p>Commencez à écrire ici...</p>";return'<div class="nge-column-wrapper"\n    data-columns="'+e.columns+'"\n    data-gap="'+e.gap+'"\n    data-height="'+e.height+'"\n    data-width="'+e.width+'"\n    data-align="'+e.align+'"\n    data-wrap="'+e.wrap+'"\n    data-valign="'+e.valign+'"\n    data-border="'+e.border+'"\n    data-border-color="'+(e.borderColor||"#dee2e6")+'"\n    data-border-width="'+(e.borderWidth||"1")+'"\n    data-border-style="'+(e.borderStyle||"solid")+'"\n    data-bg-container="'+(e.bgContainer||"")+'"\n    data-bg-columns="'+(e.bgColumns||"")+'"\n    contenteditable="false"\n    style="'+o+'">\n  <div class="nge-column-content" contenteditable="true" style="'+r+'">'+a+'</div>\n  <div class="nge-column-buttons"><button class="nge-column-edit-btn" title="'+l("columns.editTitle")+'" type="button"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="none" stroke="currentColor" stroke-width="2"/>\n  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1.08-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1.08 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" fill="none" stroke="currentColor" stroke-width="2"/>\n</svg></button><button class="nge-column-delete-btn" title="'+l("common.deleteColumn")+'" type="button"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M5 7h14M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  <path d="M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg></button></div>\n</div>'}(t),o=window.getSelection();if(!o.rangeCount)return;const r=o.getRangeAt(0),a=document.createElement("div");a.innerHTML=n;const i=a.firstChild,s=r.startContainer;"BR"===s.nodeName||s.nodeType===Node.TEXT_NODE&&""===s.textContent?s.parentNode.replaceChild(i,s):(r.deleteContents(),r.insertNode(i)),this.ensureCursorAfterElement(i),this.updateToolbar(),this.handleContentChange()}}catch(e){}}handleEmojiCommand(){const e=this.structure.toolbar.querySelector('[data-command="emoji"]');if(!e)return;const t=this.saveSelectionRange();!function(e,t){const n=document.querySelector(".nge-emoji-picker-dropdown");n&&n.remove();const o=document.createElement("div");o.className="nge-emoji-picker-dropdown";const r=Ro(e=>{t&&t(e),o.remove(),document.removeEventListener("click",c)});o.appendChild(r),document.body.appendChild(o);const a=e.getBoundingClientRect(),i=window.innerHeight-a.bottom,l=a.top;o.style.top=i>=400||i>l?a.bottom+window.scrollY+4+"px":a.top+window.scrollY-400-4+"px";let s=a.left+window.scrollX;s+380>window.innerWidth&&(s=window.innerWidth-380-10),o.style.left=s+"px";const c=t=>{!o.contains(t.target)&&!e.contains(t.target)&&(o.remove(),document.removeEventListener("click",c))};setTimeout(()=>{document.addEventListener("click",c)},0);const d=r.querySelector(".nge-emoji-search");d&&setTimeout(()=>d.focus(),50)}(e,e=>{this.structure.content.focus(),this.restoreSelectionRange(t),this.ensureSelectionInEditor();const n=window.getSelection();if(n.rangeCount>0){const t=n.getRangeAt(0);t.deleteContents();const o=document.createTextNode(e);t.insertNode(o),t.setStartAfter(o),t.setEndAfter(o),n.removeAllRanges(),n.addRange(t)}else this.structure.content.innerHTML+=e;this.updateToolbar(),this.handleContentChange()})}handleTextCaseCommand(){const e=window.getSelection();if(!e.rangeCount)return;const t=e.getRangeAt(0),n=e.toString();if(!n||0===n.length)return;let o;const r=n===n.toUpperCase()&&n!==n.toLowerCase();o=n===n.toLowerCase()&&n!==n.toUpperCase()?n.toUpperCase():r?n.toLowerCase().replace(/(?:^|\s|[-'])\S/g,e=>e.toUpperCase()):n.toLowerCase(),t.deleteContents();const a=document.createTextNode(o);t.insertNode(a),t.selectNodeContents(a),e.removeAllRanges(),e.addRange(t),this.updateToolbar(),this.handleContentChange()}async handleColumnEdit(e){const t=(n=e)&&n.classList.contains("nge-column-wrapper")?{columns:parseInt(n.getAttribute("data-columns"),10)||nn.columns,gap:n.getAttribute("data-gap")||nn.gap,height:n.getAttribute("data-height")||nn.height,width:n.getAttribute("data-width")||nn.width,align:n.getAttribute("data-align")||nn.align,wrap:n.getAttribute("data-wrap")||nn.wrap,valign:n.getAttribute("data-valign")||nn.valign,border:"true"===n.getAttribute("data-border"),borderColor:n.getAttribute("data-border-color")||nn.borderColor,borderWidth:n.getAttribute("data-border-width")||nn.borderWidth,borderStyle:n.getAttribute("data-border-style")||nn.borderStyle,bgContainer:n.getAttribute("data-bg-container")||"",bgColumns:n.getAttribute("data-bg-columns")||""}:{...nn};var n;if(!t)return;const o=e.querySelector(".nge-column-content");o&&o.innerHTML,this.historyManager&&this.historyManager.saveState(!0);try{const n=await pn(t);"confirm"===n.action&&(function(e,t){if(!e||!e.classList.contains("nge-column-wrapper"))throw new Error("Invalid column wrapper element");const n=dn(t);if(!n.isValid)throw new Error(n.error);e.setAttribute("data-columns",t.columns),e.setAttribute("data-gap",t.gap),e.setAttribute("data-height",t.height),e.setAttribute("data-width",t.width),e.setAttribute("data-align",t.align),e.setAttribute("data-wrap",t.wrap),e.setAttribute("data-valign",t.valign),e.setAttribute("data-border",t.border),e.setAttribute("data-border-color",t.borderColor||"#dee2e6"),e.setAttribute("data-border-width",t.borderWidth||"1"),e.setAttribute("data-border-style",t.borderStyle||"solid"),e.setAttribute("data-bg-container",t.bgContainer||""),e.setAttribute("data-bg-columns",t.bgColumns||""),e.setAttribute("style",un(t));const o=e.querySelector(".nge-column-content");o&&o.setAttribute("style",gn(t))}(e,n),this.updateToolbar(),this.handleContentChange())}catch(e){}}async handleAddGridBlock(e,t,n,o){if(!this._addingGridBlock){this._addingGridBlock=!0,this.historyManager&&this.historyManager.saveState(!0);try{let r=null,a=null,i=!1;o&&n&&(r=n.closest(".nge-grid-block-content"),a=r?r.closest('.nge-grid-block[data-block-type="text"]'):null,i=a&&r&&(r.contains(o.startContainer)||r===o.startContainer));const l=await Tn({blockType:e,nestingLevel:t+1});if("confirm"===l.action){if(i)return await this.insertBlockAtCursorPosition(l,a,r,o,t),void(this._addingGridBlock=!1);const e=An(l.gridWidth);let s=this.structure.content;if(n){const e=n.closest(".nge-grid-block-content");e&&(s=e)}await this.showGridPositionSelector(l,t,e,s)}this._addingGridBlock=!1}catch(e){Eo(),this._addingGridBlock=!1}}}isContentEmpty(e){if(!e)return!0;const t=e.replace(/<br\s*\/?>/gi,"").replace(/&nbsp;/gi," ").trim(),n=document.createElement("div");return n.innerHTML=t,""===n.textContent.trim()}splitContentAtRange(e,t){e.cloneNode(!0);const n=document.createRange();n.setStart(e,0),n.setEnd(t.startContainer,t.startOffset);const o=document.createRange();o.setStart(t.startContainer,t.startOffset),o.setEndAfter(e.lastChild||e);const r=n.cloneContents(),a=o.cloneContents(),i=document.createElement("div");i.appendChild(r);const l=document.createElement("div");return l.appendChild(a),{beforeHtml:i.innerHTML,afterHtml:l.innerHTML}}createTextBlockWithContent(e,t){const n=Ln({blockType:bn.TEXT,gridWidth:"100",gridStart:1,nestingLevel:t},e),o=document.createElement("div");return o.innerHTML=n,o.firstElementChild}async insertBlockAtCursorPosition(e,t,n,o,r){const a=(parseInt(t.getAttribute("data-nesting-level"),10)||1)+1,{beforeHtml:i,afterHtml:l}=this.splitContentAtRange(n,o),s=!this.isContentEmpty(i),c=!this.isContentEmpty(l),d=Ln({...e,gridStart:1,nestingLevel:a}),u=document.createElement("div");u.innerHTML=d;const g=u.firstElementChild;n.innerHTML="",n.setAttribute("contenteditable","false");const p=[];if(s){const e=this.createTextBlockWithContent(i,a),t=Dn();On(t,e,1),p.push(t)}const m=Dn();if(On(m,g,1),p.push(m),c){const e=this.createTextBlockWithContent(l,a),t=Dn();On(t,e,1),p.push(t)}p.forEach(e=>{n.appendChild(e)}),setTimeout(()=>{const e=g.querySelector(".nge-grid-block-content");if(e){""===e.innerHTML.trim()&&(e.innerHTML="<br>"),e.focus();const t=window.getSelection(),n=document.createRange();e.firstChild&&(n.setStart(e.firstChild,0),n.collapse(!0)),t.removeAllRanges(),t.addRange(n)}},0),this.updateToolbar(),this.handleContentChange()}showGridPositionSelector(e,t,n,o=null){const r=o||this.structure.content;return new Promise((o,a)=>{xo(r,{requiredCols:n,mode:"insert",onCellSelect:n=>{const{row:a,col:i,isNewRow:l,gridRow:s,insertBefore:c,insertIntoBlock:d}=n,u=Ln({...e,gridStart:1,nestingLevel:t+1}),g=document.createElement("div");g.innerHTML=u;const p=g.firstElementChild;if(d&&s){const e=s.querySelectorAll(":scope > .nge-grid-block");let t=null;for(const n of e){const e=parseInt(n.getAttribute("data-grid-start"),10)||1,o=parseInt(n.getAttribute("data-grid-cols"),10)||12;if(i>=e&&i<e+o){t=n;break}}if(t)return bo(p,t,null),Eo(),setTimeout(()=>{const e=p.querySelector(".nge-grid-block-content");if(e){""===e.innerHTML.trim()&&(e.innerHTML="<br>"),e.focus();const t=window.getSelection(),n=document.createRange();e.firstChild?(n.setStart(e.firstChild,0),n.collapse(!0)):(n.selectNodeContents(e),n.collapse(!0)),t.removeAllRanges(),t.addRange(n)}this.updateToolbar(),this.handleContentChange()},10),void o()}let m;if(p.setAttribute("data-grid-start",i),l)if(m=Dn(),void 0!==c){const e=r.querySelectorAll(":scope > .nge-grid-row");e[c]?e[c].before(m):r.appendChild(m)}else r.appendChild(m);else if(s)m=s;else{const e=r.querySelectorAll(":scope > .nge-grid-row");e[a]?m=e[a]:(m=Dn(),r.appendChild(m))}On(m,p,i),Eo(),setTimeout(()=>{const e=p.querySelector(".nge-grid-block-content");if(e){""===e.innerHTML.trim()&&(e.innerHTML="<br>"),e.focus();const t=window.getSelection(),n=document.createRange();e.firstChild?(n.setStart(e.firstChild,0),n.collapse(!0)):(n.selectNodeContents(e),n.collapse(!0)),t.removeAllRanges(),t.addRange(n)}this.updateToolbar(),this.handleContentChange()},10),o()}});const i=e=>{"Escape"===e.key&&(Eo(),document.removeEventListener("keydown",i),a(new Error("Position selection cancelled")))};document.addEventListener("keydown",i)})}handleGridBlockConfig(e){const t=Jn(e);t?(this.historyManager&&this.historyManager.saveState(!0),function(e,t,n={}){yo();const o=uo(e,t,n);document.body.appendChild(o),ro={active:!0,block:e,container:t,overlay:o,callbacks:n},go(o,e,t,n);const r=o.querySelector(".nge-config-width-btn");r&&r.focus()}(e,t,{onConfigChange:(e,t)=>{this.updateToolbar(),this.handleContentChange()},onDelete:e=>{this.handleContentChange()}})):console.error("Could not find block container")}async handleToolbarConfigCommand(){try{const e=this.getRestrictedTools(),t={...Wo(),theme:this.getCurrentTheme(),iconSize:this.getCurrentIconSize(),toolbarMode:this.getCurrentToolbarMode(),customColors:this.getCustomColors(),customFonts:this.getCustomFonts()},n=await Jo(t,e,this.licenseValid,this.configLocked);if("confirm"===n.action){Uo(n.config);const t={...n.config};for(const n of e)t[n]=!1;this.toolbarConfig=t;const o=a();n.language&&n.language!==o&&i(n.language),n.theme&&this.setTheme(n.theme),n.iconSize&&this.setIconSize(n.iconSize),void 0!==n.customColors&&this.setCustomColors(n.customColors),void 0!==n.customFonts&&this.setCustomFonts(n.customFonts),n.toolbarMode&&this.setToolbarMode(n.toolbarMode),this.rebuildToolbar()}}catch(e){}}handlePreviewCommand(){const e=this.structure.container.getBoundingClientRect(),t=e.width,n=e.height,o=document.createElement("div");o.className="nge-modal-overlay nge-preview-overlay",o.setAttribute("data-testid","nge-preview-overlay");const r=document.createElement("div");r.className="nge-modal nge-preview-modal",r.setAttribute("data-testid","nge-preview-modal"),r.style.width=t+"px",r.style.maxWidth=t+"px",r.style.height=n+"px",r.style.maxHeight=n+"px";const a=document.createElement("div");a.className="nge-modal-header";const i=document.createElement("h3");i.className="nge-modal-title",i.textContent=l("preview.title");const s=document.createElement("button");s.type="button",s.className="nge-modal-close",s.setAttribute("data-testid","nge-preview-close"),s.innerHTML='<span class="nge-icon nge-icon-close"></span>',s.setAttribute("title",l("preview.close")),a.appendChild(i),a.appendChild(s);const c=document.createElement("div");c.className="nge-modal-body nge-preview-body";const d=document.createElement("div");d.className="nge-preview-content",d.setAttribute("data-testid","nge-preview-content"),d.innerHTML=this.structure.content.innerHTML,c.appendChild(d);const u=document.createElement("div");u.className="nge-modal-footer";const g=document.createElement("button");function p(){document.removeEventListener("keydown",m),o.classList.remove("nge-modal-visible"),setTimeout(()=>{o.remove()},300)}function m(e){"Escape"===e.key&&p()}g.type="button",g.className="nge-modal-btn nge-modal-btn-secondary",g.setAttribute("data-testid","nge-preview-close-btn"),g.textContent=l("preview.close"),u.appendChild(g),r.appendChild(a),r.appendChild(c),r.appendChild(u),o.appendChild(r),document.body.appendChild(o),B(),requestAnimationFrame(()=>{o.classList.add("nge-modal-visible")}),s.addEventListener("click",p),g.addEventListener("click",p),o.addEventListener("click",e=>{e.target===o&&p()}),document.addEventListener("keydown",m)}toggleBlockOutlines(){const e=this.structure.content.classList.toggle("nge-show-block-outlines"),t=this.structure.toolbar.querySelector('[data-command="block-outlines"]');t&&(e?(t.classList.add("nge-active"),t.setAttribute("aria-pressed","true")):(t.classList.remove("nge-active"),t.setAttribute("aria-pressed","false")));try{localStorage.setItem("nge-show-block-outlines",e?"true":"false")}catch(e){}}setBlockOutlines(e){e?this.structure.content.classList.add("nge-show-block-outlines"):this.structure.content.classList.remove("nge-show-block-outlines");const t=this.structure.toolbar.querySelector('[data-command="block-outlines"]');t&&(e?(t.classList.add("nge-active"),t.setAttribute("aria-pressed","true")):(t.classList.remove("nge-active"),t.setAttribute("aria-pressed","false")));try{localStorage.setItem("nge-show-block-outlines",e?"true":"false")}catch(e){}}getBlockOutlines(){return this.structure.content.classList.contains("nge-show-block-outlines")}initBlockOutlines(){try{"true"===localStorage.getItem("nge-show-block-outlines")&&this.setBlockOutlines(!0)}catch(e){}}getCurrentTheme(){try{return localStorage.getItem("nge-theme")||"light"}catch(e){return"light"}}setTheme(e,t=!0){if(!["light","dark","warm","cold","taupe","pink"].includes(e)&&(e="light"),this.structure.container.setAttribute("data-theme",e),t)try{localStorage.setItem("nge-theme",e)}catch(e){}}getCurrentIconSize(){try{return localStorage.getItem("nge-icon-size")||"small"}catch(e){return"small"}}setIconSize(e,t=!0){if(!["small","large"].includes(e)&&(e="small"),this.structure.container.setAttribute("data-icon-size",e),t)try{localStorage.setItem("nge-icon-size",e)}catch(e){}}getCurrentToolbarMode(){try{return localStorage.getItem("nge-toolbar-mode")||"integrated"}catch(e){return"integrated"}}setToolbarMode(e,t=!0){if(!["integrated","fullwidth-top"].includes(e)&&(e="integrated"),this.structure.container.setAttribute("data-toolbar-mode",e),t)try{localStorage.setItem("nge-toolbar-mode",e)}catch(e){}}getCustomColors(){if(this.configLocked)return this.lockedCustomColors||[];try{const e=localStorage.getItem("nge-custom-colors");if(e){const t=JSON.parse(e);if(Array.isArray(t))return t}}catch(e){}return[]}setCustomColors(e){!Array.isArray(e)&&(e=[]);try{localStorage.setItem("nge-custom-colors",JSON.stringify(e))}catch(e){}}getCustomFonts(){if(this.configLocked)return this.lockedCustomFonts||[];try{const e=localStorage.getItem("nge-custom-fonts");if(e){const t=JSON.parse(e);if(Array.isArray(t))return t}}catch(e){}return[]}setCustomFonts(e){!Array.isArray(e)&&(e=[]);try{localStorage.setItem("nge-custom-fonts",JSON.stringify(e)),p(e.length>0?e:null)}catch(e){}}rebuildToolbar(){const e=this.structure.toolbar,t=E(this.toolbarConfig);e.replaceWith(t),this.structure.toolbar=t,this.setupToolbarEventListeners(t),B(),this.updateToolbar()}startAutoSync(){this.syncTimer||(this.syncTimer=setInterval(()=>{this.sync()},this.options.syncInterval))}stopAutoSync(){this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null)}sync(){this.structure&&I(this.structure.content,this.element)}getContent(e="html"){if(!this.structure)throw new Error("Editor not initialized");return R(this.structure.content,e)}setContent(e,t="html"){if(!this.structure)throw new Error("Editor not initialized");(function(e,t,n="text"){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid editor content element");if("string"!=typeof t)throw new Error("Content must be a string");if("html"===n)e.innerHTML=t;else{if("text"!==n)throw new Error('Invalid format: must be "text" or "html"');e.textContent=t}})(this.structure.content,e,t),Pn(this.structure.content)&&Vn(this.structure.content),Wn(this.structure.content),this.handleContentChange()}handleExportJsonCommand(){if(!this.structure)return;const e=function(e){if(!e)return{version:"2.0",exportedAt:(new Date).toISOString(),metadata:{wordCount:0,charCount:0,charCountNoSpaces:0,rowCount:0,blockCount:0},content:{text:"",html:""},layout:{rows:[]},legacyStructure:[]};const t=e.querySelectorAll(":scope > .nge-grid-row");return{version:"2.0",exportedAt:(new Date).toISOString(),metadata:xr(e),content:{text:e.textContent.trim(),html:e.innerHTML},layout:{rows:Array.from(t).map(e=>Ar(e))},legacyStructure:Er(e)}}(this.structure.content),t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(n),r="export-"+(new Date).toISOString().replace(/[:.]/g,"-").slice(0,19)+".json",a=document.createElement("a");a.href=o,a.download=r,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}async handleImportJsonCommand(){if(this.structure)try{const e=await function(){const e=Br();return H(D({id:"import-json-modal",title:l("importJson.title")||"Import JSON Document",content:e,buttons:[{id:"cancel",label:l("modal.cancel")||"Cancel",variant:"secondary"},{id:"confirm",label:l("importJson.import")||"Import",variant:"primary"}]})).then(t=>{if("confirm"===t){const t=e._jsonData||null;if(!t)throw new Error(l("importJson.noFile")||"No file selected");return{action:"confirm",jsonData:t}}throw new Error("Modal cancelled")})}();"confirm"===e.action&&e.jsonData&&(qr(e.jsonData,this.structure.content),I(this.structure.content,this.element),this.setupContentHandlers(),requestAnimationFrame(()=>{this.handleContentChange()}))}catch(e){"Modal cancelled"!==e.message&&console.error("Import JSON error:",e)}}handleExportPdfCommand(){if(!this.structure)return;const e=Sa(this.getContent("html")),t=window.open("","_blank","width=800,height=600");if(!t)return void window.print();const n='\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>Export PDF</title>\n  <style>\n    * {\n      box-sizing: border-box;\n    }\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, Oxygen, Ubuntu, sans-serif;\n      font-size: 12pt;\n      line-height: 1.6;\n      color: #000;\n      background: #fff;\n      max-width: 100%;\n      margin: 0;\n      padding: 20mm;\n    }\n    h1, h2, h3, h4, h5, h6 {\n      margin-top: 1em;\n      margin-bottom: 0.5em;\n      font-weight: 600;\n    }\n    h1 { font-size: 24pt; }\n    h2 { font-size: 20pt; }\n    h3 { font-size: 16pt; }\n    h4 { font-size: 14pt; }\n    h5 { font-size: 12pt; }\n    h6 { font-size: 10pt; }\n    p {\n      margin: 0.5em 0;\n    }\n    ul, ol {\n      margin: 0.5em 0;\n      padding-left: 2em;\n    }\n    li {\n      margin: 0.25em 0;\n    }\n    img {\n      max-width: 100%;\n      height: auto;\n    }\n    /* Image wrapper styles */\n    .nge-image-wrapper {\n      position: relative;\n      display: inline-block;\n      max-width: 100%;\n      margin: 8px 0;\n      line-height: 0;\n    }\n    .nge-image-wrapper[data-wrap="block"] {\n      display: block;\n      width: fit-content;\n    }\n    .nge-image-wrapper[data-wrap="left"] {\n      float: left;\n      margin-right: 16px;\n      margin-bottom: 8px;\n    }\n    .nge-image-wrapper[data-wrap="right"] {\n      float: right;\n      margin-left: 16px;\n      margin-bottom: 8px;\n    }\n    .nge-image-wrapper img {\n      max-width: 100%;\n      height: auto;\n      display: block;\n      border-radius: 4px;\n    }\n    .nge-image-wrapper[data-wrap="block"][data-align="left"] {\n      margin-left: 0;\n      margin-right: auto;\n    }\n    .nge-image-wrapper[data-wrap="block"][data-align="center"] {\n      margin-left: auto;\n      margin-right: auto;\n    }\n    .nge-image-wrapper[data-wrap="block"][data-align="right"] {\n      margin-left: auto;\n      margin-right: 0;\n    }\n    /* Clear floats after floating images */\n    .clearfix::after {\n      content: "";\n      display: table;\n      clear: both;\n    }\n    table {\n      border-collapse: collapse;\n      width: 100%;\n      margin: 1em 0;\n    }\n    th, td {\n      border: 1px solid #000;\n      padding: 8px;\n      text-align: left;\n    }\n    th {\n      background: #f0f0f0;\n      font-weight: 600;\n    }\n    blockquote, .nge-quote {\n      margin: 1em 0;\n      padding: 0.5em 1em;\n      border-left: 4px solid #ccc;\n      background: #f9f9f9;\n    }\n    pre, .nge-code-block {\n      background: #f4f4f4;\n      padding: 1em;\n      overflow-x: auto;\n      font-family: \'Courier New\', monospace;\n      font-size: 10pt;\n      border-radius: 4px;\n    }\n    code {\n      font-family: \'Courier New\', monospace;\n      background: #f4f4f4;\n      padding: 0.2em 0.4em;\n      border-radius: 3px;\n    }\n    hr, .nge-hr {\n      border: none;\n      border-top: 1px solid #ccc;\n      margin: 1em 0;\n    }\n    .nge-columns {\n      display: flex;\n      gap: 1em;\n    }\n    .nge-column {\n      flex: 1;\n    }\n    .nge-todo-list {\n      list-style: none;\n      padding-left: 0;\n    }\n    .nge-todo-item {\n      display: flex;\n      align-items: flex-start;\n      gap: 0.5em;\n      margin: 0.25em 0;\n    }\n    .nge-todo-checkbox {\n      margin-top: 0.3em;\n    }\n    .nge-todo-checked .nge-todo-text {\n      text-decoration: line-through;\n      color: #666;\n    }\n    /* Grid system styles */\n    .nge-grid-row {\n      display: grid;\n      grid-template-columns: repeat(12, 1fr);\n      gap: 0;\n      min-height: 20px;\n      position: relative;\n      margin: 0;\n      padding: 0;\n    }\n    .nge-grid-block {\n      position: relative;\n      min-height: 20px;\n    }\n    .nge-grid-row > .nge-grid-block {\n      display: block !important;\n      width: auto !important;\n      box-sizing: border-box;\n    }\n    .nge-grid-block-content {\n      min-height: 20px;\n    }\n    /* Grid block widths */\n    .nge-grid-row > .nge-grid-block[data-grid-cols="1"] { grid-column-end: span 1; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="2"] { grid-column-end: span 2; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="3"] { grid-column-end: span 3; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="4"] { grid-column-end: span 4; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="5"] { grid-column-end: span 5; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="6"] { grid-column-end: span 6; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="7"] { grid-column-end: span 7; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="8"] { grid-column-end: span 8; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="9"] { grid-column-end: span 9; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="10"] { grid-column-end: span 10; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="11"] { grid-column-end: span 11; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="12"] { grid-column-end: span 12; }\n    /* Grid block start positions */\n    .nge-grid-row > .nge-grid-block[data-grid-start="1"] { grid-column-start: 1; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="2"] { grid-column-start: 2; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="3"] { grid-column-start: 3; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="4"] { grid-column-start: 4; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="5"] { grid-column-start: 5; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="6"] { grid-column-start: 6; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="7"] { grid-column-start: 7; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="8"] { grid-column-start: 8; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="9"] { grid-column-start: 9; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="10"] { grid-column-start: 10; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="11"] { grid-column-start: 11; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="12"] { grid-column-start: 12; }\n    /* Nested grid rows inside block content */\n    .nge-grid-block-content > .nge-grid-row {\n      position: relative;\n    }\n    /* Padding levels (0-4) */\n    .nge-grid-block[data-padding="1"] > .nge-grid-block-content { padding: 8px; }\n    .nge-grid-block[data-padding="2"] > .nge-grid-block-content { padding: 16px; }\n    .nge-grid-block[data-padding="3"] > .nge-grid-block-content { padding: 24px; }\n    .nge-grid-block[data-padding="4"] > .nge-grid-block-content { padding: 32px; }\n    /* Margin levels (0-4) */\n    .nge-grid-block[data-margin-top="1"] { margin-top: 8px !important; }\n    .nge-grid-block[data-margin-top="2"] { margin-top: 16px !important; }\n    .nge-grid-block[data-margin-top="3"] { margin-top: 24px !important; }\n    .nge-grid-block[data-margin-top="4"] { margin-top: 32px !important; }\n    .nge-grid-block[data-margin-right="1"] { margin-right: 8px !important; }\n    .nge-grid-block[data-margin-right="2"] { margin-right: 16px !important; }\n    .nge-grid-block[data-margin-right="3"] { margin-right: 24px !important; }\n    .nge-grid-block[data-margin-right="4"] { margin-right: 32px !important; }\n    .nge-grid-block[data-margin-bottom="1"] { margin-bottom: 8px !important; }\n    .nge-grid-block[data-margin-bottom="2"] { margin-bottom: 16px !important; }\n    .nge-grid-block[data-margin-bottom="3"] { margin-bottom: 24px !important; }\n    .nge-grid-block[data-margin-bottom="4"] { margin-bottom: 32px !important; }\n    .nge-grid-block[data-margin-left="1"] { margin-left: 8px !important; }\n    .nge-grid-block[data-margin-left="2"] { margin-left: 16px !important; }\n    .nge-grid-block[data-margin-left="3"] { margin-left: 24px !important; }\n    .nge-grid-block[data-margin-left="4"] { margin-left: 32px !important; }\n    /* Hide editor UI elements */\n    .nge-image-edit-btn,\n    .nge-image-rotate-btn,\n    .nge-image-delete-btn,\n    .nge-image-buttons,\n    .nge-video-edit-btn,\n    .nge-video-delete-btn,\n    .nge-video-buttons,\n    .nge-table-edit-btn,\n    .nge-table-delete-btn,\n    .nge-table-buttons,\n    .nge-column-edit-btn,\n    .nge-column-delete-btn,\n    .nge-column-buttons,\n    .nge-quote-delete-btn,\n    .nge-code-delete-btn,\n    .nge-code-buttons,\n    .nge-code-copy-btn,\n    .nge-resize-handle {\n      display: none !important;\n    }\n    @media print {\n      body {\n        padding: 0;\n      }\n      @page {\n        size: A4;\n        margin: 20mm;\n      }\n    }\n  </style>\n</head>\n<body>\n  '+e+"\n</body>\n</html>";t.document.write(n),t.document.close(),t.onload=()=>{t.focus(),t.print(),t.onafterprint=()=>{t.close()}}}handleExportHtmlCommand(){if(!this.structure)return;const e=Sa(this.getContent("html")),t=new Blob(['<!DOCTYPE html>\n<html lang="fr">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Export HTML</title>\n  <style>\n    * {\n      box-sizing: border-box;\n    }\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, Oxygen, Ubuntu, sans-serif;\n      font-size: 16px;\n      line-height: 1.6;\n      color: #333;\n      background: #fff;\n      max-width: 900px;\n      margin: 0 auto;\n      padding: 20px;\n    }\n    h1, h2, h3, h4, h5, h6 {\n      margin-top: 1em;\n      margin-bottom: 0.5em;\n      font-weight: 600;\n    }\n    h1 { font-size: 2em; }\n    h2 { font-size: 1.5em; }\n    h3 { font-size: 1.25em; }\n    h4 { font-size: 1.1em; }\n    h5 { font-size: 1em; }\n    h6 { font-size: 0.9em; }\n    p {\n      margin: 0.5em 0;\n    }\n    ul, ol {\n      margin: 0.5em 0;\n      padding-left: 2em;\n    }\n    li {\n      margin: 0.25em 0;\n    }\n    img {\n      max-width: 100%;\n      height: auto;\n    }\n    /* Image wrapper styles */\n    .nge-image-wrapper {\n      position: relative;\n      display: inline-block;\n      max-width: 100%;\n      margin: 8px 0;\n      line-height: 0;\n    }\n    .nge-image-wrapper[data-wrap="block"] {\n      display: block;\n      width: fit-content;\n    }\n    .nge-image-wrapper[data-wrap="left"] {\n      float: left;\n      margin-right: 16px;\n      margin-bottom: 8px;\n    }\n    .nge-image-wrapper[data-wrap="right"] {\n      float: right;\n      margin-left: 16px;\n      margin-bottom: 8px;\n    }\n    .nge-image-wrapper img {\n      max-width: 100%;\n      height: auto;\n      display: block;\n      border-radius: 4px;\n    }\n    .nge-image-wrapper[data-wrap="block"][data-align="left"] {\n      margin-left: 0;\n      margin-right: auto;\n    }\n    .nge-image-wrapper[data-wrap="block"][data-align="center"] {\n      margin-left: auto;\n      margin-right: auto;\n    }\n    .nge-image-wrapper[data-wrap="block"][data-align="right"] {\n      margin-left: auto;\n      margin-right: 0;\n    }\n    /* Clear floats after floating images */\n    .clearfix::after {\n      content: "";\n      display: table;\n      clear: both;\n    }\n    table {\n      border-collapse: collapse;\n      width: 100%;\n      margin: 1em 0;\n    }\n    th, td {\n      border: 1px solid #ddd;\n      padding: 8px;\n    }\n    th {\n      background: #f5f5f5;\n      font-weight: 600;\n    }\n    blockquote, .nge-quote {\n      margin: 1em 0;\n      padding: 0.5em 1em;\n      border-left: 4px solid #ccc;\n      background: #f9f9f9;\n    }\n    pre, .nge-code-block {\n      background: #f4f4f4;\n      padding: 1em;\n      overflow-x: auto;\n      font-family: \'Courier New\', monospace;\n      font-size: 14px;\n      border-radius: 4px;\n    }\n    code {\n      font-family: \'Courier New\', monospace;\n      background: #f4f4f4;\n      padding: 0.2em 0.4em;\n      border-radius: 3px;\n    }\n    hr, .nge-hr {\n      border: none;\n      border-top: 1px solid #ccc;\n      margin: 1em 0;\n    }\n    .nge-columns {\n      display: flex;\n      gap: 1em;\n    }\n    .nge-column {\n      flex: 1;\n    }\n    .nge-todo-list {\n      list-style: none;\n      padding-left: 0;\n    }\n    .nge-todo-item {\n      display: flex;\n      align-items: flex-start;\n      gap: 0.5em;\n      margin: 0.25em 0;\n    }\n    .nge-todo-checkbox {\n      margin-top: 0.3em;\n      width: 16px;\n      height: 16px;\n      flex-shrink: 0;\n    }\n    .nge-todo-text {\n      flex: 1;\n    }\n    .nge-todo-checked .nge-todo-text {\n      text-decoration: line-through;\n      color: #666;\n    }\n    /* Grid system styles */\n    .nge-grid-row {\n      display: grid;\n      grid-template-columns: repeat(12, 1fr);\n      gap: 0;\n      min-height: 20px;\n      position: relative;\n      margin: 0;\n      padding: 0;\n    }\n    .nge-grid-block {\n      position: relative;\n      min-height: 20px;\n    }\n    .nge-grid-row > .nge-grid-block {\n      display: block !important;\n      width: auto !important;\n      box-sizing: border-box;\n    }\n    .nge-grid-block-content {\n      min-height: 20px;\n    }\n    /* Grid block widths */\n    .nge-grid-row > .nge-grid-block[data-grid-cols="1"] { grid-column-end: span 1; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="2"] { grid-column-end: span 2; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="3"] { grid-column-end: span 3; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="4"] { grid-column-end: span 4; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="5"] { grid-column-end: span 5; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="6"] { grid-column-end: span 6; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="7"] { grid-column-end: span 7; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="8"] { grid-column-end: span 8; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="9"] { grid-column-end: span 9; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="10"] { grid-column-end: span 10; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="11"] { grid-column-end: span 11; }\n    .nge-grid-row > .nge-grid-block[data-grid-cols="12"] { grid-column-end: span 12; }\n    /* Grid block start positions */\n    .nge-grid-row > .nge-grid-block[data-grid-start="1"] { grid-column-start: 1; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="2"] { grid-column-start: 2; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="3"] { grid-column-start: 3; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="4"] { grid-column-start: 4; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="5"] { grid-column-start: 5; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="6"] { grid-column-start: 6; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="7"] { grid-column-start: 7; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="8"] { grid-column-start: 8; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="9"] { grid-column-start: 9; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="10"] { grid-column-start: 10; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="11"] { grid-column-start: 11; }\n    .nge-grid-row > .nge-grid-block[data-grid-start="12"] { grid-column-start: 12; }\n    /* Nested grid rows inside block content */\n    .nge-grid-block-content > .nge-grid-row {\n      position: relative;\n    }\n    /* Padding levels (0-4) */\n    .nge-grid-block[data-padding="1"] > .nge-grid-block-content { padding: 8px; }\n    .nge-grid-block[data-padding="2"] > .nge-grid-block-content { padding: 16px; }\n    .nge-grid-block[data-padding="3"] > .nge-grid-block-content { padding: 24px; }\n    .nge-grid-block[data-padding="4"] > .nge-grid-block-content { padding: 32px; }\n    /* Margin levels (0-4) */\n    .nge-grid-block[data-margin-top="1"] { margin-top: 8px !important; }\n    .nge-grid-block[data-margin-top="2"] { margin-top: 16px !important; }\n    .nge-grid-block[data-margin-top="3"] { margin-top: 24px !important; }\n    .nge-grid-block[data-margin-top="4"] { margin-top: 32px !important; }\n    .nge-grid-block[data-margin-right="1"] { margin-right: 8px !important; }\n    .nge-grid-block[data-margin-right="2"] { margin-right: 16px !important; }\n    .nge-grid-block[data-margin-right="3"] { margin-right: 24px !important; }\n    .nge-grid-block[data-margin-right="4"] { margin-right: 32px !important; }\n    .nge-grid-block[data-margin-bottom="1"] { margin-bottom: 8px !important; }\n    .nge-grid-block[data-margin-bottom="2"] { margin-bottom: 16px !important; }\n    .nge-grid-block[data-margin-bottom="3"] { margin-bottom: 24px !important; }\n    .nge-grid-block[data-margin-bottom="4"] { margin-bottom: 32px !important; }\n    .nge-grid-block[data-margin-left="1"] { margin-left: 8px !important; }\n    .nge-grid-block[data-margin-left="2"] { margin-left: 16px !important; }\n    .nge-grid-block[data-margin-left="3"] { margin-left: 24px !important; }\n    .nge-grid-block[data-margin-left="4"] { margin-left: 32px !important; }\n    /* Image wrapper alignment */\n    .nge-image-wrapper {\n      display: block;\n      margin: 1em 0;\n    }\n    .nge-image-wrapper[data-wrap="block"] {\n      clear: both;\n    }\n    .nge-image-wrapper[data-wrap="left"] {\n      float: left;\n      margin-right: 1em;\n    }\n    .nge-image-wrapper[data-wrap="right"] {\n      float: right;\n      margin-left: 1em;\n    }\n    .nge-image-wrapper[data-wrap="block"][data-align="left"] {\n      text-align: left;\n    }\n    .nge-image-wrapper[data-wrap="block"][data-align="center"] {\n      text-align: center;\n    }\n    .nge-image-wrapper[data-wrap="block"][data-align="right"] {\n      text-align: right;\n    }\n    .nge-image-wrapper img {\n      max-width: 100%;\n      height: auto;\n      display: inline-block;\n    }\n    a {\n      color: #0066cc;\n      text-decoration: none;\n    }\n    a:hover {\n      text-decoration: underline;\n    }\n    iframe {\n      max-width: 100%;\n    }\n    /* Ensure all elements can inherit text-align */\n    p, div, h1, h2, h3, h4, h5, h6, li, td, th, blockquote {\n      text-align: inherit;\n    }\n    /* Respect inline text-align styles (with or without space after colon) */\n    [style*="text-align:center"], [style*="text-align: center"] {\n      text-align: center !important;\n    }\n    [style*="text-align:right"], [style*="text-align: right"] {\n      text-align: right !important;\n    }\n    [style*="text-align:justify"], [style*="text-align: justify"] {\n      text-align: justify !important;\n    }\n    [style*="text-align:left"], [style*="text-align: left"] {\n      text-align: left !important;\n    }\n    /* Support for align attribute */\n    [align="center"] {\n      text-align: center !important;\n    }\n    [align="right"] {\n      text-align: right !important;\n    }\n    [align="justify"] {\n      text-align: justify !important;\n    }\n    [align="left"] {\n      text-align: left !important;\n    }\n    /* Support for deprecated center tag */\n    center {\n      text-align: center;\n    }\n  </style>\n</head>\n<body>\n  '+e+"\n</body>\n</html>"],{type:"text/html;charset=utf-8"}),n=URL.createObjectURL(t),o="export-"+(new Date).toISOString().replace(/[:.]/g,"-").slice(0,19)+".html",r=document.createElement("a");r.href=n,r.download=o,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}parseContentStructure(){if(!this.structure)return[];const e=[],t=this.structure.content,n=e=>{if(e.nodeType===Node.TEXT_NODE){const t=e.textContent.trim();return t?{type:"text",content:t}:null}if(e.nodeType!==Node.ELEMENT_NODE)return null;const t=e.tagName.toLowerCase();if(/^h[1-6]$/.test(t))return{type:"heading",level:parseInt(t.charAt(1)),content:e.textContent.trim()};if("p"===t){const t=[];if(e.childNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE&&(e.classList.contains("nge-image-wrapper")||e.classList.contains("nge-video-wrapper"))){const o=n(e);o&&t.push(o)}}),t.length>0){const n=e.textContent.trim();return n&&t.length!==e.childNodes.length?{type:"paragraph",content:n,embedded:t}:1===t.length?t[0]:{type:"container",children:t}}return{type:"paragraph",content:e.textContent.trim()}}if(e.classList.contains("nge-todo-list")){return{type:"todolist",items:Array.from(e.querySelectorAll(":scope > .nge-todo-item")).map(e=>{const t=e.querySelector(".nge-todo-checkbox"),n=e.querySelector(".nge-todo-text");return{text:n?n.textContent.trim():e.textContent.trim(),checked:t?t.checked:e.classList.contains("nge-todo-checked")}})}}if("ul"===t||"ol"===t){const n={type:"list",listType:"ul"===t?"unordered":"ordered",items:Array.from(e.querySelectorAll(":scope > li")).map(e=>e.textContent.trim())};return"ol"===t&&(n.listStyleType=e.style.listStyleType||"decimal"),n}if("img"===t||e.classList.contains("nge-image-wrapper")){const n="img"===t?e:e.querySelector("img");if(n)return{type:"img",src:n.src,alt:n.alt||"",width:n.width||null,height:n.height||null}}if(e.classList.contains("nge-video-wrapper")){const t=e.querySelector("iframe");if(t)return{type:"video",src:t.src,width:t.width||null}}if("table"===t||e.classList.contains("nge-table-wrapper")){const n="table"===t?e:e.querySelector("table");if(n){return{type:"table",rows:Array.from(n.querySelectorAll("tr")).map(e=>Array.from(e.querySelectorAll("th, td")).map(e=>e.textContent.trim()))}}}if("blockquote"===t||e.classList.contains("nge-quote"))return{type:"quote",content:e.textContent.trim()};if("pre"===t||e.classList.contains("nge-code-block")){const t=e.querySelector("code")||e;return{type:"code",content:t.textContent.trim(),language:t.className.replace("language-","")||null}}if("hr"===t||e.classList.contains("nge-hr"))return{type:"hr"};if(e.classList.contains("nge-columns")){const t=Array.from(e.querySelectorAll(".nge-column")).map(e=>e.innerHTML);return{type:"columns",count:t.length,columns:t}}if("div"===t||"span"===t){const t=[];if(e.childNodes.forEach(e=>{const o=n(e);o&&t.push(o)}),1===t.length)return t[0];if(t.length>1)return{type:"container",children:t}}return null};return t.childNodes.forEach(t=>{const o=n(t);o&&e.push(o)}),e}destroy(){this.initialized&&(this.stopAutoSync(),this.historyManager&&(this.historyManager.destroy(),this.historyManager=null),this.structure&&(function(e){if(!(e&&e.container&&e.originalElement&&e.content))throw new Error("Invalid editor structure");I(e.content,e.originalElement),e.originalElement.style.display="",e.container.parentNode&&e.container.parentNode.removeChild(e.container)}(this.structure),this.structure=null),this.initialized=!1)}}function Ea(){const e=document.querySelectorAll(".ngeditor"),t=[];return e.forEach(e=>{if(!e._ngeditor)try{const n=new NGTextEditor(e);e._ngeditor=n,t.push(n)}catch(e){console.error("Failed to initialize NGTextEditor:",e)}}),t}function Sa(e){const t=document.createElement("div");if("string"==typeof e)t.innerHTML=e;else{if(!(e instanceof HTMLElement))throw new Error("Content must be a string or HTMLElement");t.innerHTML=e.innerHTML}t.querySelectorAll(".nge-image-edit-btn, .nge-image-rotate-btn, .nge-image-delete-btn, .nge-image-buttons, .nge-video-edit-btn, .nge-video-delete-btn, .nge-video-buttons, .nge-table-edit-btn, .nge-table-delete-btn, .nge-table-buttons, .nge-column-edit-btn, .nge-column-delete-btn, .nge-column-buttons, .nge-grid-block-edit-btn, .nge-grid-block-delete-btn, .nge-grid-block-buttons, .nge-quote-delete-btn, .nge-code-delete-btn, .nge-code-buttons, .nge-resize-handle").forEach(e=>e.remove()),t.querySelectorAll(".nge-grid-block-visible").forEach(e=>{e.classList.remove("nge-grid-block-visible")});return t.querySelectorAll("[contenteditable]").forEach(e=>{e.removeAttribute("contenteditable")}),t.querySelectorAll(".nge-grid-block-content").forEach(e=>{e.querySelectorAll("p").forEach(e=>{(""===e.innerHTML.trim()||"<br>"===e.innerHTML.trim())&&e.remove()});const t=Array.from(e.childNodes);t.forEach((e,n)=>{"BR"===e.nodeName&&(0===n||n===t.length-1)&&e.remove()})}),t.innerHTML}return"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",Ea):Ea()),e.NGTextEditor=NGTextEditor,e.autoInit=Ea,e.default=NGTextEditor,e.initGlobalCodeBlockCopy=fe,e.initGlobalTableSorting=St,e.sanitizeForReadOnly=Sa,e.setupTableSorting=kt,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
